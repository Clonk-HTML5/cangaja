var CG=CG||{VERSION:1,Const_PI_180:Math.PI/180,Const_180_PI:180/Math.PI,LEFT:1,RIGHT:2,UP:3,DOWN:4};(function(){var d=0;var e=["ms","moz","webkit","o"];for(var b=0;b<e.length&&!window.requestAnimationFrame;++b){window.requestAnimationFrame=window[e[b]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[e[b]+"CancelAnimationFrame"]||window[e[b]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(m,g){var f=new Date().getTime();var j=Math.max(0,16-(f-d));var k=window.setTimeout(function(){m(f+j)},j);d=f+j;return k}}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(f){clearTimeout(f)}}}());(function(){var b=false,d=/xyz/.test(function(){var e})?/\b_super\b/:/.*/;CG.Class=function(){};CG.Class.prototype.isA=function(e){return this.className===e};CG.Class.extend=function(m,f,j){if(!typeof m==="string"){j=f;f=m;m=null}var q=this.prototype,r=this;b=true;var n=new r();b=false;function k(u,v){return function(){var z=this._super;this._super=q[u];var y=v.apply(this,arguments);this._super=z;return y}}for(var g in f){n[g]=typeof f[g]==="function"&&typeof q[g]==="function"&&d.test(f[g])?k(g,f[g]):f[g]}function e(){if(!b&&this.init){this.init.apply(this,arguments)}}e.prototype=n;e.prototype.constructor=e;e.extend=CG.Class.extend;if(j){CG._extend(e,j)}if(m){CG[m]=e;e.prototype.className=m;e.className=m}return e}}());function loadString(b){var d=new XMLHttpRequest();d.open("GET",b,false);d.send(null);if((d.status==200)||(d.status==0)){return d.responseText}return""}String.prototype.ltrim=function(b){if(b){return this.replace(new RegExp("^["+b+"]+"),"")}return this.replace(/^\s+/,"")};String.prototype.rtrim=function(b){if(b){return this.replace(new RegExp("["+b+"]+$"),"")}return this.replace(/\s+$/,"")};String.prototype.trim=function(b){if(b){return this.ltrim(b).rtrim(b)}return this.ltrim().rtrim()};String.prototype.startsWith=function(b){return !this.indexOf(b)};CG.Class.extend("Delta",{init:function(b){this.targetfps=b;this.currentticks=0;this.lastticks=Date.now();this.frametime=0;this.delta=0},update:function(){this.currentticks=Date.now();this.frametime=this.currentticks-this.lastticks;this.delta=this.frametime/(1000/this.targetfps);this.lastticks=this.currentticks},get:function(){return this.delta}});CG.Class.extend("Entity",{init:function(b){this.name=b||"";this.visible=true},update:function(){throw {name:"Entity Error",message:"Subclass has no update method."}},draw:function(){throw {name:"Entity Error",message:"Subclass has no draw method."}},setImage:function(b){this.atlasimage=false;if(b){if(b instanceof CG.TPImage){this.image=Game.asset.getImageByName(b.atlasname);this.imagerotation=b.rotation;this.xoffset=b.xoffset;this.yoffset=b.yoffset;this.width=b.width;this.height=b.height;this.atlasimage=true;if(this.imagerotation!==0){this.cutwidth=b.height;this.cutheight=b.width}else{this.cutwidth=b.width;this.cutheight=b.height}}else{if(typeof b=="string"&&b!=""){this.image=new Image();this.image.src=b;this.width=this.image.width;this.height=this.image.height}else{this.image=b;this.width=this.image.width;this.height=this.image.height}}}}});CG.Entity.extend("Point",{init:function(b,d){this.x=b||0;this.y=d||0}});CG.Point.extend("Vector",{init:function(b,e,d){this._super(this,b,e);this.z=d||0}});CG.Entity.extend("Rectangle",{init:function(d,e,b){this.position=d||new CG.Point(0,0);this.width=e||0;this.height=b||0;this.clickable=false;this.dragable=false;this.rotation=0;this.xscale=1;this.yscale=1;this.clicked=false;this.hover=false;this.boundingradius=0;this.mapcollision=false;return this},AABB:function(){a=this.rotation*CG.Const_PI_180;s=Math.sin(a);c=Math.cos(a);if(s<0){s=-s}if(c<0){c=-c}return{bw:this.height*this.xscale*s+this.width*this.yscale*c,bh:this.height*this.xscale*c+this.width*this.yscale*s}},ifClicked:function(){if(mousedown&&this.clickable){var e=mousex-this.position.x,b=mousey-this.position.y;var j=Math.sqrt(e*e+b*b);var g=Math.atan2(b,e);var k=g-(this.rotation*CG.Const_PI_180);var d=Math.cos(k)*j;var f=Math.sin(k)*j;if(d>-0.5*(this.width*this.xscale)&&d<0.5*(this.width*this.xscale)&&f>-0.5*(this.height*this.yscale)&&f<0.5*(this.height*this.yscale)){this.clicked=true;mousedown=false}}return false},ifMouseOver:function(){var e=mousex-this.position.x,b=mousey-this.position.y;var j=Math.sqrt(e*e+b*b);var g=Math.atan2(b,e);var k=g-(this.rotation*CG.Const_PI_180);var d=Math.cos(k)*j;var f=Math.sin(k)*j;if(d>-0.5*(this.width*this.xscale)&&d<0.5*(this.width*this.xscale)&&f>-0.5*(this.height*this.yscale)&&f<0.5*(this.height*this.yscale)){this.hover=true}else{this.hover=false}},checkCollision:function(b,d){b.forEach(function(f,e){if(f.className=="MapArea"){if((this.position.y+this.AABB().bh/2)>=f.bound.y&&this.position.y-this.AABB().bh/2<=(f.bound.y+f.bound.height)&&(this.position.x+this.AABB().bw/2)>=f.bound.x&&this.position.x-this.AABB().bw/2<=(f.bound.x+f.bound.width)){if(f.type==="outer"){w=0.5*(this.width+f.bound.width);h=0.5*(this.height+f.bound.height);dx=this.position.x-(f.bound.width/2+f.bound.x);dy=this.position.y-(f.bound.height/2+f.bound.y);if(Math.abs(dx)<=w&&Math.abs(dy)<=h){wy=w*dy;hx=h*dx;if(wy>hx){if(wy>-hx){direction="bottom";overlap=((this.position.y-this.AABB().bh/2)-(f.bound.y+f.bound.height))>>0}else{direction="CG.LEFT";overlap=((this.position.x+this.AABB().bw/2)-f.bound.x)>>0}}else{if(wy>-hx){direction="right";overlap=((this.position.x-this.AABB().bw/2)-(f.bound.x+f.bound.width))>>0}else{direction="top";overlap=((this.position.y+this.AABB().bh/2)-f.bound.y)>>0}}}collision={overlap:overlap,direction:direction};d(this,f,collision)}}}else{if(this.boundingradius>0&&f.boundingradius>0){distx=this.position.x-f.position.x;disty=this.position.y-f.position.y;dist=Math.sqrt((distx*distx)+(disty*disty));if(dist<=(this.boundingradius/2*this.xscale+f.boundingradius/2*f.yscale)){collision=false;d(this,f,collision)}}else{if((this.position.y+this.AABB().bh/2)>=f.position.y-f.AABB().bh/2&&this.position.y-this.AABB().bh/2<=(f.position.y+f.AABB().bh/2)&&(this.position.x+this.AABB().bw/2)>=f.position.x-f.AABB().bw/2&&this.position.x-this.AABB().bw/2<=(f.position.x+f.AABB().bw/2)){w=0.5*(this.width+f.width);h=0.5*(this.height+f.height);dx=this.position.x-f.position.x;dy=this.position.y-f.position.y;if(Math.abs(dx)<=w&&Math.abs(dy)<=h){wy=w*dy;hx=h*dx;if(wy>hx){if(wy>-hx){direction="bottom";overlap=((this.position.y-this.AABB().bh/2)-(f.position.y-f.AABB().bh/2))>>0}else{direction="CG.LEFT";overlap=((this.position.x+this.AABB().bw/2)-(f.position.x+f.AABB().bw/2))>>0}}else{if(wy>-hx){direction="right";overlap=((this.position.x-this.AABB().bw/2)-(f.position.x-f.AABB().bw/2))>>0}else{direction="top";overlap=((this.position.y+this.AABB().bh/2)-(f.position.y+f.AABB().bh/2))>>0}}}collision={overlap:overlap,direction:direction};d(this,f,collision)}}}},this);return this}});CG.Entity.extend("Bound",{init:function(d,f,e,b){this._super();this.x=d;this.y=f;this.width=e;this.height=b;return this},setName:function(b){this.name=b;return this}});CG.Entity.extend("Buffer",{init:function(e,b,d){this._super(d);this.b_canvas=document.createElement("canvas");this.b_canvas.width=e;this.b_canvas.height=b;this.b_ctx=this.b_canvas.getContext("2d");return this}});CG.Rectangle.extend("Sprite",{init:function(d,b){this._super(b,0,0);this.atlasimage=false;this.setImage(d);this.bound=Game.bound;this.diffpoint=new CG.Point(this.bound.x,this.bound.y);this.xspeed=0;this.xscale=1;this.xhandle=0;this.yspeed=0;this.yscale=1;this.yhandle=0;this.boundsMode=false;this.rotation=0;this.rotationspeed=0;this.alpha=1;this.clicked=false;this.followobject=false;this.followspeed=false;this.followsteps=false;this.attachedobject=false;this.offsetx=0;this.offsety=0;return this},update:function(){this.ifClicked();this.ifMouseOver();this.ifAttached();if(this.followobject){this.follow()}this.position.x+=this.xspeed;this.position.y+=this.yspeed;this.rotation+=this.rotationspeed;this.xhandle=(this.width*this.xscale/2);this.yhandle=(this.height*this.yscale/2);if(this.boundsMode){this.checkBound()}},draw:function(){this.updateDiff();Game.b_ctx.save();Game.b_ctx.globalAlpha=this.alpha;Game.b_ctx.translate(this.position.x,this.position.y);if(this.atlasimage){Game.b_ctx.rotate((this.rotation-this.imagerotation)*CG.Const_PI_180);Game.b_ctx.drawImage(this.image,this.xoffset,this.yoffset,this.cutwidth,this.cutheight,0-this.xhandle,0-this.yhandle,this.cutwidth*this.xscale,this.cutheight*this.yscale)}else{Game.b_ctx.rotate(this.rotation*CG.Const_PI_180);Game.b_ctx.drawImage(this.image,0-this.xhandle,0-this.yhandle,this.image.width*this.xscale,this.image.height*this.yscale)}Game.b_ctx.restore()},checkBound:function(){switch(this.boundsMode){case"bounce":if(this.position.x>(this.bound.width-this.xhandle+this.bound.x)){this.position.x=this.bound.width-this.xhandle+this.bound.x;this.xspeed=this.xspeed*-1}else{if(this.position.x<this.bound.x+this.xhandle){this.position.x=this.bound.x+this.xhandle;this.xspeed=this.xspeed*-1}}if(this.position.y>(this.bound.height-this.yhandle+this.bound.y)){this.position.y=this.bound.height-this.yhandle+this.bound.y;this.yspeed=this.yspeed*-1}else{if(this.position.y<this.bound.y+this.yhandle){this.position.y=this.bound.y+this.yhandle;this.yspeed=this.yspeed*-1}}break;case"slide":if(this.position.x>(this.bound.width+this.xhandle+this.bound.x)){this.position.x=(this.bound.x-this.xhandle)}else{if(this.position.x<this.bound.x-this.xhandle){this.position.x=this.bound.x+this.bound.width+this.xhandle}}if(this.position.y>(this.bound.height+this.yhandle+this.bound.y)){this.position.y=(this.bound.y-this.yhandle)}else{if(this.position.y<this.bound.y-this.yhandle){this.position.y=this.bound.height+this.yhandle+this.bound.y}}break;default:break}},updateDiff:function(){if(this.diffpoint.x!==this.bound.x){this.position.x+=this.bound.x-this.diffpoint.x}if(this.diffpoint.y!==this.bound.y){this.position.y+=this.bound.y-this.diffpoint.y}this.diffpoint.x=this.bound.x;this.diffpoint.y=this.bound.y},follow:function(){if(this.followspeed){angl=Math.atan2(this.followobject.position.x-this.position.x,this.followobject.position.y-this.position.y)*CG.Const_180_PI;xs=this.followspeed*Math.sin(angl*CG.Const_PI_180);ys=this.followspeed*Math.cos(angl*CG.Const_PI_180);this.xspeed=xs;this.yspeed=ys;this.rotation=angl*-1}else{if(this.followsteps){angl=Math.atan2(this.followobject.position.x-this.position.x,this.followobject.position.y-this.position.y)*CG.Const_180_PI;this.rotation=angl*-1;if(this.followobject.position.x!=this.position.x){distx=this.followobject.position.x-this.position.x;this.xspeed=distx/this.followsteps}else{this.xspeed=0}if(this.followobject.position.y!=this.position.y){disty=this.followobject.position.y-this.position.y;this.yspeed=disty/this.followsteps}else{this.yspeed=0}}}},setBound:function(b){this.bound=b;return this},ifAttached:function(){if(this.attachedobject!=false){this.attachedobject.position._x=this.attachedobject.position.x=(this.position.x+this.offsetx);this.attachedobject.position._y=this.attachedobject.position.y=(this.position.y+this.offsety)}},attachObject:function(b){this.attachedobject=b;return this},removeAttachedObject:function(){this.attachedobject=false;return this},setAttachedOffsetX:function(b){this.offsetx=b;return this},setAttachedOffsetY:function(b){this.offsety=b;return this}});CG.Class.extend("TPImage",{init:function(f,e,g,d,b){this.source="";this.atlasimage="";this.atlasname="";this.image=f||"";this.name=f.split(/(\\|\/)/g).pop().split(".")[0];this.xoffset=e||0;this.yoffset=g||0;this.width=d||0;this.height=b||0;this.rotation=0}});CG.Class.extend("TexturePacker",{init:function(){if(typeof(ejecta)=="undefined"){this.xml="";this.xmlDoc="";this.parser=new DOMParser()||{}}this.imagename="";this.width=0;this.height=0;this.tpimages=[];return this},loadXml:function(e){if(typeof e=="string"){this.xml=loadString(e)}else{this.xml=e.data}this.xmlDoc=this.parser.parseFromString(this.xml,"text/xml");this.imagename=this.xmlDoc.getElementsByTagName("TextureAtlas")[0].getAttribute("imagePath");this.width=parseInt(this.xmlDoc.getElementsByTagName("TextureAtlas")[0].getAttribute("width"));this.height=parseInt(this.xmlDoc.getElementsByTagName("TextureAtlas")[0].getAttribute("height"));var f=this.xmlDoc.getElementsByTagName("sprite");for(var d=0,b=f.length;d<b;d++){tpimage=new CG.TPImage(f[d].getAttribute("n"),parseInt(f[d].getAttribute("x")),parseInt(f[d].getAttribute("y")),parseInt(f[d].getAttribute("w")),parseInt(f[d].getAttribute("h")));if(f[d].getAttribute("r")=="y"){tpimage.rotation=90}tpimage.atlasimage=this.imagename;tpimage.source="xml";tpimage.atlasname=this.imagename.split(/(\\|\/)/g).pop().split(".")[0];this.tpimages.push(tpimage)}return this},loadJson:function(e){if(typeof e=="string"){this.json=JSON.parse(loadString(e))}else{this.json=e.data}this.imagename=this.json.meta.image;this.width=this.json.meta.size.w;this.height=this.json.meta.size.h;for(var d=0,b=this.json.frames.length;d<b;d++){var g=this.json.frames[d];var f=new CG.TPImage(g.filename,g.frame.x,g.frame.y,g.frame.w,g.frame.h);if(g.rotated===true){f.rotation=90}f.atlasimage=this.imagename;f.source="json";f.atlasname=this.imagename.split(/(\\|\/)/g).pop().split(".")[0];this.tpimages.push(f)}return this},getTPImages:function(){return this.tpimages}});CG.Sprite.extend("Animation",{init:function(g,b,j,f,e,d){this._super(g,b);if(typeof g=="string"){this.image=new Image();this.image.src=g}else{this.image=g}this.loop=true;this.status=0;this.currentframe=0;this.startframe=j-1;this.endframe=f-1;this.width=e;this.height=d;if(this.startframe===undefined&&this.endframe===undefined){this.frames=1;this.startframe=0;this.endframe=0}else{this.currentframe=this.startframe-1;this.frames=this.endframe-this.startframe+1}this.fx=0;this.fy=0;this.delay=0;this.tempdelay=0;return this},update:function(){if(this.status==0){this.tempdelay+=1;if(this.tempdelay>=this.delay){this.tempdelay=0;if(this.frames>1){this.currentframe+=1;if((this.currentframe-this.startframe)>=this.frames){if(this.loop===false){this.status=1}else{this.currentframe=this.startframe}}}}}this._super()},draw:function(){this.updateDiff();Game.b_ctx.save();Game.b_ctx.globalAlpha=this.alpha;Game.b_ctx.translate(this.position.x,this.position.y);if(this.frames==1){Game.b_ctx.drawImage(this.image,this.position.x,this.position.y,this.image.width*this.xscale,this.image.height*this.yscale)}else{this.fx=this.currentframe*this.width;if((this.fx/this.image.width)>0){this.fx=this.fx%this.image.width}this.fy=Math.floor(this.width*this.currentframe/this.image.width)*this.height;Game.b_ctx.rotate(this.rotation*CG.Const_PI_180);try{Game.b_ctx.drawImage(this.image,this.fx,this.fy,this.width,this.height,0-this.xhandle,0-this.yhandle,this.width*this.xscale,this.height*this.yscale)}catch(b){}}Game.b_ctx.restore()}});CG.Entity.extend("Bitmap",{init:function(d,b){this._super(this);this.x=0;this.y=0;this.bitmap_canvas=document.createElement("canvas");this.bitmap_canvas.width=d;this.bitmap_canvas.height=b;this.bitmap_ctx=this.bitmap_canvas.getContext("2d");return this},loadImage:function(b){this.setImage(b);this.drawImageToBuffer();return this},update:function(){},draw:function(){Game.b_ctx.drawImage(this.bitmap_canvas,this.x,this.y)},clearBuffer:function(){this.bitmap_ctx.clearRect(0,0,this.bitmap_canvas.width,this.bitmap_canvas.height);return this},drawImageToBuffer:function(){this.bitmap_ctx.drawImage(this.image,0,0);return this},clearRect:function(d,f,e,b){this.bitmap_ctx.save();this.bitmap_ctx.globalCompositeOperation="destination-out";this.bitmap_ctx.clearRect(d,f,e,b);this.bitmap_ctx.restore()},clearCircle:function(d,e,b){this.bitmap_ctx.save();this.bitmap_ctx.globalCompositeOperation="destination-out";this.bitmap_ctx.beginPath();this.bitmap_ctx.arc(d,e,b,0,2*Math.PI,false);this.bitmap_ctx.closePath();this.bitmap_ctx.fill();this.bitmap_ctx.restore()},getPixel:function(b,d){return this.bitmap_ctx.getImageData(b,d,1,1)},getPixels:function(d,f,e,b){return this.bitmap_ctx.getImageData(d,f,e,b)}});CG.Sprite.extend("Button",{init:function(f,d,g,e,b){this._super(f,d);this.font=e;this.clickedCallback=b;this.clicked=false;this.clickable=true;this.text=g;return this},update:function(){this.ifClicked();this.ifMouseOver();this.ifAttached();if(this.clicked){if(this.clickedCallback){this.clicked=false;this.clickedCallback(this)}}},draw:function(){Game.b_ctx.save();Game.b_ctx.translate(this.position.x,this.position.y);if(this.atlasimage){var b=this.rotation;Game.b_ctx.rotate((b-this.imagerotation)*CG.Const_PI_180);Game.b_ctx.drawImage(this.image,this.xoffset,this.yoffset,this.cutwidth,this.cutheight,0-(this.cutwidth/2),0-(this.cutheight/2),this.cutwidth*this.xscale,this.cutheight*this.yscale);Game.b_ctx.rotate(this.imagerotation*CG.Const_PI_180)}else{Game.b_ctx.rotate(b*CG.Const_PI_180);Game.b_ctx.drawImage(this.image,0-(this.image.width*this.xscale/2),0-(this.image.height*this.yscale/2),this.image.width*this.xscale,this.image.height*this.yscale)}this.font.draw(this.text,0-(this.font.getTextWidth(this.text)/2>>0),0-((this.font.getFontSize()/2)>>0));Game.b_ctx.restore()}});CG.Entity.extend("Menu",{init:function(b,e,d){this.x=b;this.y=e;this.margin=d;this.step=this.y;this.buttons=[];return this},addButton:function(b){this.buttons.push(b)},update:function(){this.buttons.forEach(function(b){b.update()},this)},draw:function(){this.buttons.forEach(function(b){b.position.x=this.x;b.position.y=this.step;b.draw();this.step+=b.height;this.step+=this.margin},this);this.step=this.y}});CG.Class.extend("MediaAsset",{init:function(b){if(b){this.image=new Image();this.image.src=b}this.ready=false;this.images=[];this.currimage=0;this.sounds=[];this.currsound=0;this.xmls=[];this.currxml=0;this.jsons=[];this.currjson=0;this.fonts=[];this.currfont=0;this.assetcount=0;this.assetcurrent=0;this.width=300;this.height=20;this.radius=10;this.linewidth=8;this.bordercolor="white";this.progresscolor="red";this.shadowcolor="#222";this.shadowblur=6;this.shadowoffsetx=2;this.shadowoffsety=2},addImage:function(d,b){this.assetcount+=1;this.images.push({name:b||"",path:d,img:new Image()});return this},addFont:function(d,b){this.assetcount+=1;this.fonts.push({name:b||"",path:d,data:""});return this},addXml:function(d,b){this.assetcount+=1;this.xmls.push({name:b||"",path:d,data:""});return this},addJson:function(d,b){this.assetcount+=1;this.jsons.push({name:b||"",path:d,data:""});return this},getImageByName:function(d){for(var e=0,b=this.images.length;e<b;e++){if(this.images[e].name==d){if(this.images[e] instanceof CG.TPImage){return this.images[e]}else{return this.images[e].img}}}throw new CG.MediaAssetException("No image with this name in asset.")},getImagesByName:function(d){names=[];for(var e=0,b=this.images.length;e<b;e++){if(this.images[e].name==d){if(this.images[e] instanceof CG.TPImage){names.push(this.images[e])}else{names.push(this.images[e].img)}}}if(names.length===0){throw new CG.MediaAssetException("No image with this name in asset.")}return names},getFontByName:function(d){for(var e=0,b=this.fonts.length;e<b;e++){if(this.fonts[e].name==d){return this.fonts[e]}}throw new CG.MediaAssetException("No font with this name in asset.")},getXmlByName:function(d){for(var e=0,b=this.xmls.length;e<b;e++){if(this.xmls[e].name==d){return this.xmls[e]}}throw new CG.MediaAssetException("No XML with this name in asset.")},getJsonByName:function(d){for(var e=0,b=this.jsons.length;e<b;e++){if(this.jsons[e].name==d){return this.jsons[e]}}throw new CG.MediaAssetException("No JSON with this name in asset.")},startPreLoad:function(){progress=100/this.assetcount*this.assetcurrent;this.progressScreen(progress);if(this.currimage<this.images.length){this.images[this.currimage].img.onload=function(){console.log("loaded image ("+Math.floor(100/(this.images.length-1)*this.currimage)+" %): "+this.images[this.currimage].name);this.currimage+=1;this.assetcurrent+=1;this.startPreLoad()}.bind(this);this.images[this.currimage].img.src=this.images[this.currimage].path}else{if(this.currfont<this.fonts.length){this.fonts[this.currfont].data=loadString(this.fonts[this.currfont].path);this.currfont+=1;this.assetcurrent+=1;this.startPreLoad()}else{if(this.currxml<this.xmls.length){this.xmls[this.currxml].data=loadString(this.xmls[this.currxml].path);this.currxml+=1;this.assetcurrent+=1;this.startPreLoad()}else{if(this.currjson<this.jsons.length){this.jsons[this.currjson].data=JSON.parse(loadString(this.jsons[this.currjson].path));this.currjson+=1;this.assetcurrent+=1;this.startPreLoad()}else{if(this.currimage==this.images.length&&this.assetcount==this.assetcurrent){this.ready=true;Game.create()}}}}}},progressScreen:function(d){var b=(Game.bound.width-this.width)/2;var e=(Game.bound.height-this.height)/2;if(this.image){Game.b_ctx.drawImage(this.image,0,0,this.image.width,this.image.height)}else{Game.b_ctx.clearRect(0,0,Game.bound.width,Game.bound.height)}Game.b_ctx.save();Game.b_ctx.fillStyle=this.progresscolor;Game.b_ctx.fillRect((Game.bound.width-this.width)/2,(Game.bound.height-this.height)/2,this.width/100*d,this.height);Game.b_ctx.strokeStyle=this.bordercolor;Game.b_ctx.shadowColor=this.shadowcolor;Game.b_ctx.shadowBlur=this.shadowblur;Game.b_ctx.shadowOffsetX=this.shadowoffsetx;Game.b_ctx.shadowOffsetY=this.shadowoffsety;Game.b_ctx.beginPath();Game.b_ctx.moveTo(b+this.radius,e);Game.b_ctx.lineTo(b+this.width-(1*this.radius),e);Game.b_ctx.arcTo(b+this.width,e,b+this.width,e+this.radius,this.radius);Game.b_ctx.arcTo(b+this.width,this.radius*2+e,b+this.width-(1*this.radius),this.radius*2+e,this.radius);Game.b_ctx.lineTo(b+this.radius,2*this.radius+e);Game.b_ctx.arcTo(b,2*this.radius+e,b,e,this.radius);Game.b_ctx.arcTo(b,e,2*this.radius+b,e,this.radius);Game.b_ctx.lineWidth=this.linewidth;Game.b_ctx.stroke();Game.b_ctx.restore()}});function MediaAssetException(b){this.message=b}CG.Entity.extend("Font",{init:function(){this.atlas=new Image();this.fieldname="";this.initText="";this.chars=new Array(256);this.x=new Array(256);this.y=new Array(256);this.width=new Array(256);this.height=new Array(256);this.xoff=new Array(256);this.yoff=new Array(256);this.xadv=new Array(256);this.lineHeight=0;this.face="";this.size=0;this.bold=0;this.italic=0;this.base=0;this.scaleW=0;this.scaleH=0;return this},update:function(){throw {name:"Font Error",message:"TODO, not defined yet."}},draw:function(f,d,g){currx=0;curry=0;c=0;currx=d;curry=g;for(var e=0,b=f.length;e<b;e++){Game.b_ctx.drawImage(this.atlas,this.x[f.charCodeAt(e)],this.y[f.charCodeAt(e)],this.width[f.charCodeAt(e)],this.height[f.charCodeAt(e)],currx,curry+this.yoff[f.charCodeAt(e)],this.width[f.charCodeAt(e)],this.height[f.charCodeAt(e)]);currx+=this.xadv[f.charCodeAt(e)]}},getLineHeight:function(){return this.lineHeight},getFontSize:function(){return this.size},getTextWidth:function(f){var d=0;var g=0;for(var e=0,b=f.length;e<b;e++){d+=this.xadv[f.charCodeAt(e)]}return d},loadFont:function(j){idnum=0;if(typeof j=="string"){this.initText=loadString(j)}else{this.initText=j.data}var e=this.initText.split("\n");for(l in e){line=e[l].trim();if(line.startsWith("info")||line==""){var k=line.split(" ");for(i in k){var H=k[i];if(H.startsWith("face=")){var z=H.split("=");this.face=z[1].split('"').join("")}if(H.startsWith("size=")){var C=H.split("=");this.size=parseInt(C[1])}if(H.startsWith("bold=")){var E=H.split("=");this.bold=parseInt(E[1])}if(H.startsWith("italic=")){var n=H.split("=");this.italic=parseInt(n[1])}}}if(line.startsWith("padding")){continue}if(line.startsWith("common")){var q=line.split(" ");for(c in q){var B=q[c];if(B.startsWith("lineHeight=")){var J=B.split("=");this.lineHeight=parseInt(J[1])}if(B.startsWith("base=")){var r=B.split("=");this.base=parseInt(r[1])}if(B.startsWith("scaleW=")){var I=B.split("=");this.scaleW=parseInt(I[1])}if(B.startsWith("scaleH=")){var m=B.split("=");this.scaleH=parseInt(m[1])}}}if(line.startsWith("page")){var f=line.split(" ");for(p in f){data=f[p];if(data.startsWith("file=")){var v=data.split("=");this.atlas.src="media/font/"+v[1].split('"').join("")}}}if(line.startsWith("chars")){continue}if(line.startsWith("char")){var A=line.split(" ");for(l in A){ld=A[l];if(ld.startsWith("id=")){var b=ld.split("=");idnum=parseInt(b[1])}if(ld.startsWith("x=")){var F=ld.split("=");this.x[idnum]=parseInt(F[1])}if(ld.startsWith("y=")){var g=ld.split("=");this.y[idnum]=parseInt(g[1])}if(ld.startsWith("width=")){var y=ld.split("=");this.width[idnum]=parseInt(y[1])}if(ld.startsWith("height=")){var u=ld.split("=");this.height[idnum]=parseInt(u[1])}if(ld.startsWith("xoffset=")){var d=ld.split("=");this.xoff[idnum]=parseInt(d[1])}if(ld.startsWith("yoffset=")){var D=ld.split("=");this.yoff[idnum]=parseInt(D[1])}if(ld.startsWith("xadvance=")){var G=ld.split("=");this.xadv[idnum]=parseInt(G[1])}}}}return this}});CG.Class.extend("Director",{init:function(){this.screens=[];this.activescreen=0;this.nextscreen=0;this.duration=20;this.alpha=0;this.fademode="fade";this.color="rgb(0,0,0)";return this},update:function(){switch(this.fademode){case"scale":if(this.nextscreen!=this.activescreen){this.screens[this.activescreen].xscale-=0.4/this.duration;this.screens[this.activescreen].yscale-=0.4/this.duration}else{if(this.nextscreen==this.activescreen){this.screens[this.activescreen].xscale+=0.4/this.duration;this.screens[this.activescreen].yscale+=0.4/this.duration}}if(this.screens[this.activescreen].xscale>=1){this.screens[this.activescreen].xscale=this.screens[this.activescreen].yscale=1;this.screens[this.nextscreen].xscale=this.screens[this.nextscreen].yscale=1}if(this.screens[this.activescreen].xscale<=0){this.screens[this.activescreen].xscale=this.screens[this.activescreen].yscale=1;this.screens[this.nextscreen].xscale=this.screens[this.nextscreen].yscale=0;this.activescreen=this.nextscreen}break;case"fade":if(this.nextscreen!=this.activescreen&&this.alpha<1){this.alpha+=1/this.duration}else{if(this.nextscreen==this.activescreen&&this.alpha!=0){this.alpha-=1/this.duration}}if(this.alpha>=1){this.activescreen=this.nextscreen;this.alpha=1}if(this.alpha<0){this.alpha=0}break}this.screens[this.activescreen].update()},draw:function(){this.screens[this.activescreen].draw();if(this.alpha>0){Game.b_ctx.save();Game.b_ctx.globalAlpha=this.alpha;Game.b_ctx.fillStyle=this.color;Game.b_ctx.fillRect(0,0,Game.bound.width,Game.bound.height);Game.b_ctx.restore()}},addScreen:function(b){this.screens.push(b);return this},nextScreen:function(b,d){if(this.getIndexOfScreen(b)!=this.activescreen){this.duration=d;this.nextscreen=this.getIndexOfScreen(b)}},getScreenByName:function(e){for(var d=0,b=this.screens.length;d<b;d++){if(this.screens[d].name==e){return this.screens[d]}}return false},getIndexOfScreen:function(e){for(var d=0,b=this.screens.length;d<b;d++){if(this.screens[d].name==e){return d}}return false},getActiveScreenName:function(){return this.screens[this.activescreen].name},setFadeMode:function(b){if(b=="scale"){this.fademode=b;this.alpha=0}else{if(b=="fade"){this.fademode=b}}return this}});CG.Entity.extend("Screen",{init:function(d){this._super(d);this.xscale=1;this.yscale=1;var b=this;this.layers=[];return this},create:function(){},update:function(){this.layers.forEach(function(d,b){d.update()},this)},draw:function(){Game.b_ctx.save();if(this.xscale!==1||this.yscale!==1){Game.b_ctx.translate((Game.width-(Game.width*this.xscale))/2,(Game.height-(Game.height*this.yscale))/2);Game.b_ctx.scale(this.xscale,this.yscale)}this.layers.forEach(function(d,b){d.draw()},this);Game.b_ctx.restore()},addLayer:function(b){this.layers.push(b);return this},getLayerByName:function(e){for(var d=0,b=this.layers.length;d<b;d++){if(this.layers[d].name==e){return this.layers[d]}}return false}});CG.Entity.extend("Layer",{init:function(d){this._super(d);var b=this;this.elements=[];this.elementsToDelete=[];return this},update:function(){if(this.visible==true){this.elements.forEach(function(d,b){d.update();if(d.status==1){this.elementsToDelete.push(b)}},this);if(this.elementsToDelete.length>0){this._deleteElements()}}},draw:function(){if(this.visible==true){this.elements.forEach(function(b){b.draw()},this)}},_deleteElements:function(){this.elementsToDelete.reverse();this.elementsToDelete.forEach(this._deleteElement,this);this.elementsToDelete=[]},_deleteElement:function(b){this.elements.splice(b,1)},addElement:function(b){this.elements.push(b);return this},getElementByName:function(d){for(var e=0,b=this.elements.length;e<b;e++){if(this.elements[e].name==d){return this.elements[e]}}return false},getElementsByName:function(d){elements=[];for(var e=0,b=this.elements.length;e<b;e++){if(this.elements[e].name==d){elements.push(this.elements[e])}}return elements}});CG.Class.extend("MapTileLayer",{init:function(){this.width=0;this.height=0;this.visible=true;this.opacity=1;this.tiles=[];return this}});CG.Class.extend("MapTileProperties",{init:function(){this.animated=false;this.animDelay=0;this.animDirection=0;this.animNext=0;this.delayTimer=0;return this}});CG.Class.extend("MapPoint",{init:function(b,f,d,e){this.initposition=b||new CG.Point(0,0);this.mapoffset=f||new CG.Point(0,0);this.gid=e;this.name=d;this.position=new CG.Point(b.x,b.y);return this},update:function(){this.position.x=this.initposition.x-this.mapoffset.x;this.position.y=this.initposition.y-this.mapoffset.y}});CG.Class.extend("MapArea",{init:function(f,e,b,d){this.initbound=f||new CG.Bound(0,0,0,0);this.mapoffset=e||new CG.Point(0,0);this.name=b;this.type=d||false;this.bound=new CG.Bound(f.x,f.y,f.width,f.height);return this},update:function(){this.bound.x=this.initbound.x-this.mapoffset.x;this.bound.y=this.initbound.y-this.mapoffset.y}});CG.Entity.extend("Map",{init:function(d,b,e){this._super(e);this.elements=[];this.points=[];this.areas=[];this.position=new CG.Point(0,0);this.changemap="";this.animated=false;this.animDelayFactor=20;this.atlas=new Image();this.atlaswidth=0;this.atlasheight=0;this.atlastranscol="";if(typeof(ejecta)=="undefined"){this.xml="";this.parser=new DOMParser();this.xmlDoc=""}this.json={};this.layers=[];this.renderlayer="all";this.tileproperties=[];this.orientation="";this.width=0;this.height=0;this.tilewidth=0;this.tileheight=0;this.tileset={tilewidth:0,tileheight:0,offsetx:0,offsety:0,spacing:0,margin:0};this.xspeed=0;this.yspeed=0;this.xscale=1;this.yscale=1;this.alpha=1;this.wrapX=false;this.wrapY=false;this.layertocheck=0;return this},loadMapXml:function(f){this.changemap="";this.animated=false;this.layers=[];if(typeof f=="string"){this.xml=loadString(f)}else{this.xml=f.data}this.removeJsonData();this.xmlDoc=this.parser.parseFromString(this.xml,"text/xml");var D=map.xmlDoc.getElementsByTagName("map")[0];this.orientation=D.getAttribute("orientation");this.width=parseInt(D.getAttribute("width"));this.height=parseInt(D.getAttribute("height"));this.tilewidth=parseInt(D.getAttribute("tilewidth"));this.tileheight=parseInt(D.getAttribute("tileheight"));var n=D.childElementCount;var e=D.firstElementChild;for(i=0;i<n;i++){console.log(">"+e.nodeName);switch(e.nodeName){case"tileset":this.tileset.tilewidth=parseInt(e.getAttribute("tilewidth"));this.tileset.tileheight=parseInt(e.getAttribute("tileheight"));if(e.getAttribute("spacing")){this.tileset.spacing=parseInt(e.getAttribute("spacing"))}if(e.getAttribute("margin")){this.tileset.margin=parseInt(e.getAttribute("margin"))}if(e.getElementsByTagName("tileoffset")[0]){this.tileset.offsetx=parseInt(e.getElementsByTagName("tileoffset")[0].getAttribute("x"));this.tileset.offsety=parseInt(e.getElementsByTagName("tileoffset")[0].getAttribute("y"))}var q=e.getElementsByTagName("image")[0];this.atlas.src="media/map/"+q.getAttribute("source");this.atlaswidth=parseInt(q.getAttribute("width"));this.atlasheight=parseInt(q.getAttribute("height"));this.atlastranscol=q.getAttribute("trans");break;case"layer":var g=new CG.MapTileLayer();data=e.getElementsByTagName("data")[0];if(data.getAttribute("encoding")=="csv"){g.tiles=data.textContent.replace(/(\r\n|\n|\r)/gm,"").split(",");console.log("map encoding csv [layer "+i+"]")}else{if(data.getAttribute("encoding")=="base64"&&data.getAttribute("compression")=="gzip"){throw"base64 gzip compressed map format not supported at the moment"}else{if(data.getAttribute("encoding")=="base64"&&data.getAttribute("compression")=="zlib"){throw"base64 zlib compressed map format not supported at the moment"}else{if(data.getAttribute("encoding")=="base64"){throw"base64 map format not supported at the moment"}else{console.log("map encoding xml [layer "+i+"]");var B=e.getElementsByTagName("tile");for(x in B){if(x<B.length){g.tiles[x]=parseInt(B[x].getAttribute("gid"))}}}}}}g.name=e.getAttribute("name");g.width=parseInt(e.getAttribute("width"));g.height=parseInt(e.getAttribute("height"));if(e.getAttribute("opacity")){g.opacity=parseFloat(e.getAttribute("opacity"))}if(e.getAttribute("visible")==="0"){g.visible=false}this.layers.push(g);break;case"objectgroup":console.log("grouplayer found");var b=e.getElementsByTagName("object");for(o in b){if(o<b.length){var m=b[o];var E=m.getAttribute("name");if(m.getAttribute("gid")){this.points.push(new CG.MapPoint(new CG.Point(parseInt(m.getAttribute("x")),parseInt(m.getAttribute("y"))),this.position,m.getAttribute("name"),parseInt(m.getAttribute("gid"))));console.log("tile as oject found: "+E);console.log(m)}else{if(m.getAttribute("width")){type=false;k=m.getElementsByTagName("property");console.log(k.length);for(var r=0,y=k.length;r<y;r++){if(k[r].getAttribute("name")=="type"){type=k[r].getAttribute("value")}}this.areas.push(new CG.MapArea(new CG.Bound(parseInt(m.getAttribute("x")),parseInt(m.getAttribute("y")),parseInt(m.getAttribute("width")),parseInt(m.getAttribute("height"))),this.position,m.getAttribute("name"),type));console.log("group object found: "+E);console.log(m)}else{if(m.getElementsByTagName("polygon").length>0){console.log("polygon found: "+E)}else{if(m.getElementsByTagName("polyline").length>0){console.log("polyline found: "+E)}}}}}}break}e=e.nextElementSibling}this.tileproperties=Array(parseInt((this.atlaswidth/this.tilewidth))*parseInt((this.atlasheight/this.tileheight)));var B=map.xmlDoc.getElementsByTagName("tileset")[0].getElementsByTagName("tile");var j=new Date().getTime();for(i in B){var z=new CG.MapTileProperties();var C=B[i];if(i<this.tileproperties.length){var u=C.getAttribute("id");var k=C.getElementsByTagName("properties")[0].getElementsByTagName("property");for(r in k){if(r<k.length){var d=k[r];var A=d.getAttribute("name");var v=d.getAttribute("value");if(A=="name"){z.name=v}else{if(A=="anim_delay"){z.animDelay=parseInt(v);z.delayTimer=j;this.animated=true}else{if(A=="anim_direction"){z.animDirection=parseInt(v)}else{if(A=="anim_next"){z.animNext=parseInt(v);z.animated=true}}}}}}this.tileproperties[u]=z}}return this},loadMapJson:function(d){this.changemap="";this.animated=false;this.layers=[];if(typeof d=="string"){this.json=JSON.parse(loadString(d))}else{this.json=d.data}this.removeXmlData();this.orientation=this.json.orientation;this.width=this.json.width;this.height=this.json.height;this.tilewidth=this.json.tilewidth;this.tileheight=this.json.tileheight;for(i=0,l=this.json.layers.length;i<l;i++){switch(this.json.layers[i].type){case"tilelayer":var m=new CG.MapTileLayer();m.tiles=this.json.layers[i].data;m.name=this.json.layers[i].name;m.width=this.json.layers[i].width;m.height=this.json.layers[i].height;m.opacity=this.json.layers[i].opacity;m.visible=this.json.layers[i].visible;this.layers.push(m);break;case"objectgroup":console.log("grouplayer found");var k=this.json.layers[i].objects;for(o in k){if(o<k.length){var f=k[o];var b=f.name;if(f.gid){this.points.push(new CG.MapPoint(new CG.Point(parseInt(f.x),parseInt(f.y)),this.position,f.name,parseInt(f.gid)));console.log("tile as oject found: "+b);console.log(f)}else{if(f.width){this.areas.push(new CG.MapArea(new CG.Bound(parseInt(f.x),parseInt(f.y),parseInt(f.width),parseInt(f.height)),this.position,f.name,f.properties.type));console.log("group object found: "+b);console.log(f)}else{if(f.polygon){console.log("polygon found: "+b)}else{if(f.polyline){console.log("polyline found: "+b)}}}}}}break}}this.atlas.src="media/map/"+this.json.tilesets[0].image;this.atlaswidth=this.json.tilesets[0].imagewidth;this.atlasheight=this.json.tilesets[0].imageheight;this.atlastranscol=this.json.tilesets[0].transparentcolor;this.tileproperties=Array(parseInt((this.atlaswidth/this.tilewidth))*parseInt((this.atlasheight/this.tileheight)));var j=this.json.tilesets[0].tileproperties;var e=new Date().getTime();for(id in j){var n=new CG.MapTileProperties();var g=j[id];n.name=g.name;n.animDelay=parseInt(g.anim_delay);n.delayTimer=(n.animDelay>0)?e:0;n.animated=(n.animDelay>0)?true:false;n.animNext=parseInt(g.anim_next);if(n.animDelay>0){this.animated=true}n.animDirection=parseInt(g.anim_direction);this.tileproperties[id]=n}return this},drawMap:function(A,v,E,D,F,d,n){this.position.x=E;this.position.y=D;this.bx=E||this.bx||0;this.by=D||this.by||0;this.bw=F||Game.bound.width;this.bh=d||Game.bound.height;this.sx=A||this.sx||0;this.sy=v||this.sy||0;this.callback=n||false;this.updatePointsAndAreas();if(this.changemap!=""){this.loadMap(this.changemap)}if(this.visible){this.updateAnimation();if(this.layers.length>0){for(var H=0,C=this.layers.length;H<C;H++){var j=this.layers[H];if(this.renderlayer==j.name||this.renderlayer==H||this.renderlayer=="all"){if(this.orientation=="orthogonal"&&j.visible==true){modx=(this.bx*this.xscale)%this.tilewidth;mody=(this.by*this.yscale)%this.tileheight;r=this.by;my=Math.floor(parseFloat(this.by)/parseFloat(this.tileheight))>>0;var b=(this.by+this.bh+this.tileheight);while(r<b){x=this.bx;mx=Math.floor(parseFloat(this.bx)/parseFloat(this.tilewidth))>>0;var f=(this.bx+this.bw+this.tilewidth);while(x<f){if((this.wrapX||(mx>=0&&mx<this.width))&&(this.wrapY||(my>=0&&my<this.height))){mx2=mx;my2=my;while(mx2<0){mx2+=this.width}while(mx2>=this.width){mx2-=this.width}while(my2<0){my2+=this.height}while(my2>=this.height){my2-=this.height}z=j.tiles[mx2+my2*j.width]-1;if(z>=0){if(modx<0){modx+=this.tilewidth}if(mody<0){mody+=this.tileheight}m=x-modx-this.bx;k=r-mody-this.by;if(this.elements.length>0&&this.layertocheck==C){for(var B=0,C=this.elements.length;B<C;B++){if(this.checkMapCollision(this.elements[0],m,k)){this.callback(this.elements[B],this.tileproperties[z])}}}cx=(z%(this.atlaswidth/this.tilewidth))*this.tilewidth;cy=Math.floor(this.tilewidth*z/this.atlaswidth)*this.tileheight;Game.b_ctx.save();Game.b_ctx.globalAlpha=this.layers[H].opacity;Game.b_ctx.translate(m,k);try{Game.b_ctx.drawImage(this.atlas,cx,cy,this.tilewidth,this.tileheight,this.sx,this.sy,this.tilewidth*this.xscale,this.tileheight*this.yscale)}catch(G){}Game.b_ctx.restore()}}x=x+this.tilewidth;mx+=1}r=r+this.tileheight;my+=1}}else{if(this.orientation=="isometric"){var u=j.width+j.height;for(var r=0;r<u;r++){var k=r;var m=0;while(k>=j.height){k-=1;m+=1}while(k>=0&&m<j.width){var z=j.tiles[m+k*j.width];var g=(m-k-1)*this.tilewidth/2-E;var q=(m+k+1)*this.tileheight/2-D;if(g>-this.tileset.tilewidth&&g<F&&q>-this.tileset.tileheight&&q<d){if(z>0){cx=((z-1)%(this.atlaswidth/this.tilewidth))*this.tilewidth;cy=Math.floor(this.tilewidth*(z-1)/this.atlaswidth)*this.tileset.tileheight;Game.b_ctx.save();Game.b_ctx.globalAlpha=this.layers[H].opacity;Game.b_ctx.translate(g,q);try{Game.b_ctx.drawImage(this.atlas,cx,cy,this.tilewidth,this.tileset.tileheight,0,0,this.tilewidth*this.xscale,this.tileset.tileheight*this.yscale)}catch(G){}Game.b_ctx.restore()}}k-=1;m+=1}}}}}}}}},updatePointsAndAreas:function(){this.points.forEach(function(b,d){b.update()},this);this.areas.forEach(function(d,b){d.update()},this)},getPointsByName:function(d){points=[];for(var e=0,b=this.points.length;e<b;e++){if(this.points[e].name===d){points.push(this.points[e])}}if(points.length>0){return points}return false},getAreasByName:function(d){areas=[];for(var e=0,b=this.areas.length;e<b;e++){if(this.areas[e].name===d){areas.push(this.areas[e])}}if(areas.length>0){return areas}return false},setLayerToRender:function(b){this.renderlayer=b;return this},update:function(){this.bx+=this.xspeed;this.by+=this.yspeed;if(this.getBounds().width-Game.bound.width<this.bx){this.xspeed=this.xspeed*-1}if(this.bx<0){this.xspeed=this.xspeed*-1}if(this.getBounds().height-Game.bound.height<this.by){this.yspeed=this.yspeed*-1}if(this.by<0){this.yspeed=this.yspeed*-1}return this},draw:function(){this.drawMap(this.bx,this.by,this.bw,this.bh,this.sx,this.sy,this.callback);return this},getBounds:function(){return{width:this.width*this.tilewidth,height:this.height*this.tileheight}},updateAnimation:function(){if(this.visible&&this.animated){if(this.layers.length>0){for(var f=0,b=this.layers.length;f<b;f++){var k=new Date().getTime();for(t=0;t<this.layers[f].tiles.length;t++){var g=this.layers[f].tiles[t];if(g>0){try{var d=this.tileproperties[g-1];if(d.animated&&d.animDirection!=0){if(k>(d.delayTimer+(d.animDelay/this.animDelayFactor))){switch(d.animDirection){case 1:this.layers[f].tiles[t]+=d.animNext;this.tileproperties[g-1+d.animNext].delayTimer=k;break;case -1:this.layers[f].tiles[t]-=d.animNext;this.tileproperties[g-1-d.animNext].delayTimer=k;break;default:break}}}}catch(j){}}}}}}},addElement:function(b){this.elements.push(b);return this},checkMapCollision:function(b,e,d){if(b.boundingradius>0){xr=b.boundingradius/2*b.xscale;yr=b.boundingradius/2*b.yscale;if(b.position.x+xr>=e&&b.position.x-xr<=e+this.tilewidth&&b.position.y+yr>=d&&b.position.y-yr<=d+this.tileheight){return true}}else{xw=b.width/2*b.xscale;yh=b.height/2*b.yscale;if(b.position.x+xw>=e&&b.position.x-xw<=e+this.tilewidth&&b.position.y+yh>=d&&b.position.y-yh<=d+this.tileheight){return true}}return false},checkElementsToAreasCollision:function(f,e){for(var d=0,b=f.length;d<b;d++){obj=f[d].checkCollision(this.areas,e)}return this},removeJsonData:function(){this.json={};return this},removeXmlData:function(){this.xml="";this.xmlDoc="";return this}});CG.Entity.extend("Sequence",{init:function(b){this._super(b);this.current=0;this.loop=false;this.translations=[];return this},addTranslation:function(b){this.translations.push(b);return this},update:function(b){if(this.current<this.translations.length){if(this.translations[this.current].finished===false){this.translations[this.current].update()}else{this.current+=1}}else{if(this.loop){this.reset()}else{}}},draw:function(){},reset:function(){for(var d=0,b=this.translations.length;d<b;d++){this.translations[d].reset()}this.current=0;return this}});CG.Entity.extend("Translate",{init:function(){this._super();this.type="";this.tx=0;this.ty=0;this.x1=0;this.y1=0;this.x2=0;this.y2=0;this.bx=0;this.by=0;this.theobj={};this.r1=0;this.r2=0;this.startangle=0;this.angle=0;this.speed=0;this.steps=0;this.step=0;this.positions=[];this.finished=false;return this},initTween:function(f,k,b,n){this.type="tween";this.theobj=f;this.steps=k;this.x1=b.x;this.y1=b.y;this.x2=n.x;this.y2=n.y;var m=(this.x2-this.x1)/this.steps;var j=(this.y2-this.y1)/this.steps;var g=this.x1>>0;var d=this.y1>>0;for(var e=0;e<=this.steps;e++){this.positions.push(new CG.Point(g,d));g+=m;d+=j}return this},initOval:function(g,f,e,b,j,d){this.type="oval";this.theobj=g;this.x1=f.x;this.y1=f.y;this.r1=e;this.r2=b;this.startangle=j;this.speed=d;return this},initBezier:function(j,f,b,k,e,d){this.type="bezier";this.theobj=j;this.steps=f;this.start=k;this.end=b;if(this.control2=="undefined"&&this.control1=="undefined"){this.control2=new CG.Point(this.start.x+3*(this.end.x-this.start.x)/4,this.start.y+3*(this.end.y-this.start.y)/4)}else{this.control2=d||e}this.control1=e||new CG.Point(this.start.x+(this.end.x-this.start.x)/4,this.start.y+(this.end.y-this.start.y)/4);b1=function(n){return(n*n*n)};b2=function(n){return(3*n*n*(1-n))};b3=function(n){return(3*n*(1-n)*(1-n))};b4=function(n){return((1-n)*(1-n)*(1-n))};for(var g=0;g<=this.steps;g++){percent=(1/this.steps)*g;var m=new CG.Point();m.x=this.start.x*b1(percent)+this.control1.x*b2(percent)+this.control2.x*b3(percent)+this.end.x*b4(percent);m.y=this.start.y*b1(percent)+this.control1.y*b2(percent)+this.control2.y*b3(percent)+this.end.y*b4(percent);this.positions.push(m)}return this},draw:function(){},update:function(){var d=this.theobj;switch(this.type){case"bezier":case"tween":if(this.step<this.steps){d.position.x=d.position._x=this.positions[this.step].x;d.position.y=d.position._y=this.positions[this.step].y;this.step+=1}else{this.finished=true}break;case"oval":var b=this.startangle*CG.Const_PI_180;this.tx=this.x1-(this.r1*Math.cos(b));this.ty=this.y1-(this.r2*Math.sin(b));this.startangle+=this.speed;if(this.startangle>360){this.startangle=0+(this.startangle-360)}d.position.x=d.position._x=this.tx>>0;d.position.y=d.position._y=this.ty>>0;break;default:break}},draw:function(){},reset:function(){this.step=0;this.finished=false}});CG.Entity.extend("Morph",{init:function(f,d,b,e){this.mode=f;this.min=d;this.max=b;this.speed=e;this.angle=0;this.rad=this.max-this.min;this.val=0},update:function(){switch(this.mode){case"sinus":var b=this.angle*CG.Const_PI_180;this.val=this.rad*Math.sin(b);if(this.val<0){this.val=this.val*-1}this.angle+=this.speed;if(this.angle>360){this.angle=0+(this.angle-360)}break}return this},draw:function(){},getVal:function(){return this.val}});CG.Sprite.extend("Particle",{init:function(b){this._super(b,new CG.Point(0,0));this.lifetime=100;this.currtime=this.lifetime;this.aging=1;this.fadeout=false;this.alpha=1;this.gravity=0},update:function(){if(this.visible){if(this.fadeout){this.alpha=this.currtime/this.lifetime;if(this.alpha<=0){this.visible=false}}this.currtime-=this.aging;if(this.currtime<0){this.visible=false}this.position.x+=this.xspeed;this.position.y+=this.yspeed;this.yspeed+=this.gravity;this.rotation+=this.rotationspeed}},draw:function(){if(this.visible){Game.b_ctx.save();Game.b_ctx.globalAlpha=this.alpha;Game.b_ctx.translate(this.position.x,this.position.y);if(this.atlasimage){Game.b_ctx.rotate((this.rotation-this.imagerotation)*CG.Const_PI_180);Game.b_ctx.drawImage(this.image,this.xoffset,this.yoffset,this.cutwidth,this.cutheight,0-(this.cutwidth/2),0-(this.cutheight/2),this.cutwidth*this.xscale,this.cutheight*this.yscale);Game.b_ctx.rotate((this.rotation+this.imagerotation)*CG.Const_PI_180)}else{Game.b_ctx.rotate(this.rotation*CG.Const_PI_180);Game.b_ctx.drawImage(this.image,0-(this.image.width*this.xscale/2),0-(this.image.height*this.yscale/2),this.image.width*this.xscale,this.image.height*this.yscale)}Game.b_ctx.restore()}}});CG.Entity.extend("Emitter",{init:function(b){this._super();this.particles=[];this.maxparticles=50;this.creationtime=100;this.currenttime=0;this.creationspeed=50;this.gravity=0.05;this.image=null;this.type="";this.position=b||new CG.Point(0,0);this.position._x=this.position.x;this.position._y=this.position.y;this.rotation=0;this.width=200;this.height=200;this.radius=0;this.pspeed=10;this.protation=0;this.pdirection=0;this.plifetime=100;this.paging=1;this.pfadeout=false;return this},initAsPoint:function(b){this.image=b;this.type="point";return this},initAsExplosion:function(e,d,b){this.image=e;this.type="explosion";this.min=d;this.max=b;return this},initAsCorona:function(d,b){this.image=d;this.type="corona";this.radius=b||0;return this},initAsLine:function(e,b,d){this.image=e;this.width=b||200;this.pdirection=d||CG.UP;this.type="line";return this},initAsRectangle:function(e,d,b){this.image=e;this.width=d||200;this.height=b||200;this.type="rectangle";return this},createParticle:function(){particle=new CG.Particle(this.image);return particle},initParticle:function(d){if(this.pfadeout){d.fadeout=true}d.gravity=this.gravity;d.alpha=1;d.visible=true;d.lifetime=this.plifetime;d.currtime=this.plifetime;d.rotationspeed=this.protation;switch(this.type){case"corona":var b=this.getRandom(0,359)*CG.Const_PI_180;d.position.x=this.getX()-(this.radius*Math.cos(b));d.position.y=this.getY()-(this.radius*Math.sin(b));angl=Math.atan2(d.position.x-this.getX(),d.position.y-this.getY())*CG.Const_180_PI;d.xspeed=this.pspeed*Math.sin(angl*CG.Const_PI_180);d.yspeed=this.pspeed*Math.cos(angl*CG.Const_PI_180);break;case"rectangle":rndx=this.getRandom(this.width/2*-1,this.width/2);rndy=this.getRandom(this.height/2*-1,this.height/2);d.position.x=this.position._x-rndx;d.position.y=this.position._y-rndy;d.xspeed=0;d.yspeed=0;break;case"line":rnd=this.getRandom(this.width/2*-1,this.width/2);switch(this.pdirection){default:case CG.UP:d.xspeed=0;d.yspeed=this.pspeed*-1;d.position.x=rnd+this.getX();d.position.y=this.position._y;break;case CG.DOWN:d.xspeed=0;d.yspeed=this.pspeed;d.position.x=rnd+this.getX();d.position.y=this.position._y;break;case CG.LEFT:d.xspeed=this.pspeed*-1;d.yspeed=0;d.position.x=this.position._x;d.position.y=rnd+this.getY();break;case CG.RIGHT:d.xspeed=this.pspeed;d.yspeed=0;d.position.x=this.position._x;d.position.y=rnd+this.getY();break}break;case"explosion":d.position.x=this.position._x;d.position.y=this.position._y;d.xspeed=this.getRandom(this.min,this.max);d.yspeed=this.getRandom(this.min,this.max);break;case"point":default:d.xspeed=0;d.yspeed=0;d.position.x=this.position._x;d.position.y=this.position._y;break}return d},update:function(){if(this.visible){this.currenttime+=this.creationspeed;if(this.currenttime>=this.creationtime){this.currenttime=0;if(this.particles.length<this.maxparticles){this.particles.push(this.initParticle(this.createParticle()))}else{particle=this.searchInvisibleParticle();this.initParticle(particle);this.particles.sort(function(f,e){return f.currtime-e.currtime})}}for(var d=0,b=this.particles.length;d<b;d++){this.particles[d].update()}return this}},draw:function(){if(this.visible){for(var d=0,b=this.particles.length;d<b;d++){this.particles[d].draw()}return this}},searchInvisibleParticle:function(){for(var d=0,b=this.particles.length;d<b;d++){if(this.particles[d].visible==false){return this.particles[d]}}return this},setEmitterPosition:function(b){this.position=b;return this},setName:function(b){this.name=b;return this},setCreationTime:function(b){this.creationtime=b;return this},setMaxParticles:function(b){this.maxparticles=b;return this},setGravity:function(b){this.gravity=b;return this},setParticleSpeed:function(b){this.pspeed=b;return this},setProtation:function(b){this.protation=b;return this},setPLifetime:function(b){this.plifetime=b;return this},activateFadeout:function(){this.pfadeout=true;return this},deactivateFadeout:function(){this.pfadeout=false;return this},getRandom:function(d,b){return Math.random()*(b-d+1)+d>>0},getX:function(){return this.position._x},getY:function(){return this.position._y}});var Box2D={};(function(d,j){if(!(Object.prototype.defineProperty instanceof Function)&&Object.prototype.__defineGetter__ instanceof Function&&Object.prototype.__defineSetter__ instanceof Function){Object.defineProperty=function(n,m,k){if(k.get instanceof Function){n.__defineGetter__(m,k.get)}if(k.set instanceof Function){n.__defineSetter__(m,k.set)}}}function e(){}d.inherit=function(k,m){var n=k;e.prototype=m.prototype;k.prototype=new e;k.prototype.constructor=n};d.generateCallback=function g(m,k){return function(){k.apply(m,arguments)}};d.NVector=function b(n){if(n===j){n=0}var m=new Array(n||0);for(var k=0;k<n;++k){m[k]=0}return m};d.is=function f(m,k){if(m===null){return false}if((k instanceof Function)&&(m instanceof k)){return true}if((m.constructor.__implements!=j)&&(m.constructor.__implements[k])){return true}return false};d.parseUInt=function(k){return Math.abs(parseInt(k))}})(Box2D);var Vector=Array;var Vector_a2j_Number=Box2D.NVector;if(typeof(Box2D)==="undefined"){Box2D={}}if(typeof(Box2D.Collision)==="undefined"){Box2D.Collision={}}if(typeof(Box2D.Collision.Shapes)==="undefined"){Box2D.Collision.Shapes={}}if(typeof(Box2D.Common)==="undefined"){Box2D.Common={}}if(typeof(Box2D.Common.Math)==="undefined"){Box2D.Common.Math={}}if(typeof(Box2D.Dynamics)==="undefined"){Box2D.Dynamics={}}if(typeof(Box2D.Dynamics.Contacts)==="undefined"){Box2D.Dynamics.Contacts={}}if(typeof(Box2D.Dynamics.Controllers)==="undefined"){Box2D.Dynamics.Controllers={}}if(typeof(Box2D.Dynamics.Joints)==="undefined"){Box2D.Dynamics.Joints={}}(function(){Box2D.Collision.IBroadPhase="Box2D.Collision.IBroadPhase";function ao(){ao.b2AABB.apply(this,arguments)}Box2D.Collision.b2AABB=ao;function aL(){aL.b2Bound.apply(this,arguments)}Box2D.Collision.b2Bound=aL;function a0(){a0.b2BoundValues.apply(this,arguments);if(this.constructor===a0){this.b2BoundValues.apply(this,arguments)}}Box2D.Collision.b2BoundValues=a0;function N(){N.b2Collision.apply(this,arguments)}Box2D.Collision.b2Collision=N;function P(){P.b2ContactID.apply(this,arguments);if(this.constructor===P){this.b2ContactID.apply(this,arguments)}}Box2D.Collision.b2ContactID=P;function au(){au.b2ContactPoint.apply(this,arguments)}Box2D.Collision.b2ContactPoint=au;function aQ(){aQ.b2Distance.apply(this,arguments)}Box2D.Collision.b2Distance=aQ;function k(){k.b2DistanceInput.apply(this,arguments)}Box2D.Collision.b2DistanceInput=k;function z(){z.b2DistanceOutput.apply(this,arguments)}Box2D.Collision.b2DistanceOutput=z;function ae(){ae.b2DistanceProxy.apply(this,arguments)}Box2D.Collision.b2DistanceProxy=ae;function u(){u.b2DynamicTree.apply(this,arguments);if(this.constructor===u){this.b2DynamicTree.apply(this,arguments)}}Box2D.Collision.b2DynamicTree=u;function aY(){aY.b2DynamicTreeBroadPhase.apply(this,arguments)}Box2D.Collision.b2DynamicTreeBroadPhase=aY;function aK(){aK.b2DynamicTreeNode.apply(this,arguments)}Box2D.Collision.b2DynamicTreeNode=aK;function ac(){ac.b2DynamicTreePair.apply(this,arguments)}Box2D.Collision.b2DynamicTreePair=ac;function ad(){ad.b2Manifold.apply(this,arguments);if(this.constructor===ad){this.b2Manifold.apply(this,arguments)}}Box2D.Collision.b2Manifold=ad;function W(){W.b2ManifoldPoint.apply(this,arguments);if(this.constructor===W){this.b2ManifoldPoint.apply(this,arguments)}}Box2D.Collision.b2ManifoldPoint=W;function ag(){ag.b2Point.apply(this,arguments)}Box2D.Collision.b2Point=ag;function ak(){ak.b2RayCastInput.apply(this,arguments);if(this.constructor===ak){this.b2RayCastInput.apply(this,arguments)}}Box2D.Collision.b2RayCastInput=ak;function v(){v.b2RayCastOutput.apply(this,arguments)}Box2D.Collision.b2RayCastOutput=v;function m(){m.b2Segment.apply(this,arguments)}Box2D.Collision.b2Segment=m;function aO(){aO.b2SeparationFunction.apply(this,arguments)}Box2D.Collision.b2SeparationFunction=aO;function aW(){aW.b2Simplex.apply(this,arguments);if(this.constructor===aW){this.b2Simplex.apply(this,arguments)}}Box2D.Collision.b2Simplex=aW;function L(){L.b2SimplexCache.apply(this,arguments)}Box2D.Collision.b2SimplexCache=L;function a4(){a4.b2SimplexVertex.apply(this,arguments)}Box2D.Collision.b2SimplexVertex=a4;function aD(){aD.b2TimeOfImpact.apply(this,arguments)}Box2D.Collision.b2TimeOfImpact=aD;function aT(){aT.b2TOIInput.apply(this,arguments)}Box2D.Collision.b2TOIInput=aT;function aX(){aX.b2WorldManifold.apply(this,arguments);if(this.constructor===aX){this.b2WorldManifold.apply(this,arguments)}}Box2D.Collision.b2WorldManifold=aX;function aR(){aR.ClipVertex.apply(this,arguments)}Box2D.Collision.ClipVertex=aR;function am(){am.Features.apply(this,arguments)}Box2D.Collision.Features=am;function a1(){a1.b2CircleShape.apply(this,arguments);if(this.constructor===a1){this.b2CircleShape.apply(this,arguments)}}Box2D.Collision.Shapes.b2CircleShape=a1;function f(){f.b2EdgeChainDef.apply(this,arguments);if(this.constructor===f){this.b2EdgeChainDef.apply(this,arguments)}}Box2D.Collision.Shapes.b2EdgeChainDef=f;function aV(){aV.b2EdgeShape.apply(this,arguments);if(this.constructor===aV){this.b2EdgeShape.apply(this,arguments)}}Box2D.Collision.Shapes.b2EdgeShape=aV;function at(){at.b2MassData.apply(this,arguments)}Box2D.Collision.Shapes.b2MassData=at;function aU(){aU.b2PolygonShape.apply(this,arguments);if(this.constructor===aU){this.b2PolygonShape.apply(this,arguments)}}Box2D.Collision.Shapes.b2PolygonShape=aU;function aG(){aG.b2Shape.apply(this,arguments);if(this.constructor===aG){this.b2Shape.apply(this,arguments)}}Box2D.Collision.Shapes.b2Shape=aG;Box2D.Common.b2internal="Box2D.Common.b2internal";function aA(){aA.b2Color.apply(this,arguments);if(this.constructor===aA){this.b2Color.apply(this,arguments)}}Box2D.Common.b2Color=aA;function J(){J.b2Settings.apply(this,arguments)}Box2D.Common.b2Settings=J;function ab(){ab.b2Mat22.apply(this,arguments);if(this.constructor===ab){this.b2Mat22.apply(this,arguments)}}Box2D.Common.Math.b2Mat22=ab;function C(){C.b2Mat33.apply(this,arguments);if(this.constructor===C){this.b2Mat33.apply(this,arguments)}}Box2D.Common.Math.b2Mat33=C;function an(){an.b2Math.apply(this,arguments)}Box2D.Common.Math.b2Math=an;function aF(){aF.b2Sweep.apply(this,arguments)}Box2D.Common.Math.b2Sweep=aF;function j(){j.b2Transform.apply(this,arguments);if(this.constructor===j){this.b2Transform.apply(this,arguments)}}Box2D.Common.Math.b2Transform=j;function aE(){aE.b2Vec2.apply(this,arguments);if(this.constructor===aE){this.b2Vec2.apply(this,arguments)}}Box2D.Common.Math.b2Vec2=aE;function aC(){aC.b2Vec3.apply(this,arguments);if(this.constructor===aC){this.b2Vec3.apply(this,arguments)}}Box2D.Common.Math.b2Vec3=aC;function R(){R.b2Body.apply(this,arguments);if(this.constructor===R){this.b2Body.apply(this,arguments)}}Box2D.Dynamics.b2Body=R;function y(){y.b2BodyDef.apply(this,arguments);if(this.constructor===y){this.b2BodyDef.apply(this,arguments)}}Box2D.Dynamics.b2BodyDef=y;function ax(){ax.b2ContactFilter.apply(this,arguments)}Box2D.Dynamics.b2ContactFilter=ax;function av(){av.b2ContactImpulse.apply(this,arguments)}Box2D.Dynamics.b2ContactImpulse=av;function I(){I.b2ContactListener.apply(this,arguments)}Box2D.Dynamics.b2ContactListener=I;function M(){M.b2ContactManager.apply(this,arguments);if(this.constructor===M){this.b2ContactManager.apply(this,arguments)}}Box2D.Dynamics.b2ContactManager=M;function Z(){Z.b2DebugDraw.apply(this,arguments);if(this.constructor===Z){this.b2DebugDraw.apply(this,arguments)}}Box2D.Dynamics.b2DebugDraw=Z;function O(){O.b2DestructionListener.apply(this,arguments)}Box2D.Dynamics.b2DestructionListener=O;function aM(){aM.b2FilterData.apply(this,arguments)}Box2D.Dynamics.b2FilterData=aM;function aZ(){aZ.b2Fixture.apply(this,arguments);if(this.constructor===aZ){this.b2Fixture.apply(this,arguments)}}Box2D.Dynamics.b2Fixture=aZ;function b(){b.b2FixtureDef.apply(this,arguments);if(this.constructor===b){this.b2FixtureDef.apply(this,arguments)}}Box2D.Dynamics.b2FixtureDef=b;function a2(){a2.b2Island.apply(this,arguments);if(this.constructor===a2){this.b2Island.apply(this,arguments)}}Box2D.Dynamics.b2Island=a2;function F(){F.b2TimeStep.apply(this,arguments)}Box2D.Dynamics.b2TimeStep=F;function D(){D.b2World.apply(this,arguments);if(this.constructor===D){this.b2World.apply(this,arguments)}}Box2D.Dynamics.b2World=D;function g(){g.b2CircleContact.apply(this,arguments)}Box2D.Dynamics.Contacts.b2CircleContact=g;function E(){E.b2Contact.apply(this,arguments);if(this.constructor===E){this.b2Contact.apply(this,arguments)}}Box2D.Dynamics.Contacts.b2Contact=E;function X(){X.b2ContactConstraint.apply(this,arguments);if(this.constructor===X){this.b2ContactConstraint.apply(this,arguments)}}Box2D.Dynamics.Contacts.b2ContactConstraint=X;function af(){af.b2ContactConstraintPoint.apply(this,arguments)}Box2D.Dynamics.Contacts.b2ContactConstraintPoint=af;function d(){d.b2ContactEdge.apply(this,arguments)}Box2D.Dynamics.Contacts.b2ContactEdge=d;function aJ(){aJ.b2ContactFactory.apply(this,arguments);if(this.constructor===aJ){this.b2ContactFactory.apply(this,arguments)}}Box2D.Dynamics.Contacts.b2ContactFactory=aJ;function r(){r.b2ContactRegister.apply(this,arguments)}Box2D.Dynamics.Contacts.b2ContactRegister=r;function G(){G.b2ContactResult.apply(this,arguments)}Box2D.Dynamics.Contacts.b2ContactResult=G;function ai(){ai.b2ContactSolver.apply(this,arguments);if(this.constructor===ai){this.b2ContactSolver.apply(this,arguments)}}Box2D.Dynamics.Contacts.b2ContactSolver=ai;function a8(){a8.b2EdgeAndCircleContact.apply(this,arguments)}Box2D.Dynamics.Contacts.b2EdgeAndCircleContact=a8;function B(){B.b2NullContact.apply(this,arguments);if(this.constructor===B){this.b2NullContact.apply(this,arguments)}}Box2D.Dynamics.Contacts.b2NullContact=B;function aI(){aI.b2PolyAndCircleContact.apply(this,arguments)}Box2D.Dynamics.Contacts.b2PolyAndCircleContact=aI;function K(){K.b2PolyAndEdgeContact.apply(this,arguments)}Box2D.Dynamics.Contacts.b2PolyAndEdgeContact=K;function ah(){ah.b2PolygonContact.apply(this,arguments)}Box2D.Dynamics.Contacts.b2PolygonContact=ah;function aH(){aH.b2PositionSolverManifold.apply(this,arguments);if(this.constructor===aH){this.b2PositionSolverManifold.apply(this,arguments)}}Box2D.Dynamics.Contacts.b2PositionSolverManifold=aH;function al(){al.b2BuoyancyController.apply(this,arguments)}Box2D.Dynamics.Controllers.b2BuoyancyController=al;function aN(){aN.b2ConstantAccelController.apply(this,arguments)}Box2D.Dynamics.Controllers.b2ConstantAccelController=aN;function n(){n.b2ConstantForceController.apply(this,arguments)}Box2D.Dynamics.Controllers.b2ConstantForceController=n;function ay(){ay.b2Controller.apply(this,arguments)}Box2D.Dynamics.Controllers.b2Controller=ay;function aq(){aq.b2ControllerEdge.apply(this,arguments)}Box2D.Dynamics.Controllers.b2ControllerEdge=aq;function Y(){Y.b2GravityController.apply(this,arguments)}Box2D.Dynamics.Controllers.b2GravityController=Y;function T(){T.b2TensorDampingController.apply(this,arguments)}Box2D.Dynamics.Controllers.b2TensorDampingController=T;function S(){S.b2DistanceJoint.apply(this,arguments);if(this.constructor===S){this.b2DistanceJoint.apply(this,arguments)}}Box2D.Dynamics.Joints.b2DistanceJoint=S;function aS(){aS.b2DistanceJointDef.apply(this,arguments);if(this.constructor===aS){this.b2DistanceJointDef.apply(this,arguments)}}Box2D.Dynamics.Joints.b2DistanceJointDef=aS;function A(){A.b2FrictionJoint.apply(this,arguments);if(this.constructor===A){this.b2FrictionJoint.apply(this,arguments)}}Box2D.Dynamics.Joints.b2FrictionJoint=A;function a7(){a7.b2FrictionJointDef.apply(this,arguments);if(this.constructor===a7){this.b2FrictionJointDef.apply(this,arguments)}}Box2D.Dynamics.Joints.b2FrictionJointDef=a7;function H(){H.b2GearJoint.apply(this,arguments);if(this.constructor===H){this.b2GearJoint.apply(this,arguments)}}Box2D.Dynamics.Joints.b2GearJoint=H;function V(){V.b2GearJointDef.apply(this,arguments);if(this.constructor===V){this.b2GearJointDef.apply(this,arguments)}}Box2D.Dynamics.Joints.b2GearJointDef=V;function a6(){a6.b2Jacobian.apply(this,arguments)}Box2D.Dynamics.Joints.b2Jacobian=a6;function ar(){ar.b2Joint.apply(this,arguments);if(this.constructor===ar){this.b2Joint.apply(this,arguments)}}Box2D.Dynamics.Joints.b2Joint=ar;function aB(){aB.b2JointDef.apply(this,arguments);if(this.constructor===aB){this.b2JointDef.apply(this,arguments)}}Box2D.Dynamics.Joints.b2JointDef=aB;function az(){az.b2JointEdge.apply(this,arguments)}Box2D.Dynamics.Joints.b2JointEdge=az;function q(){q.b2LineJoint.apply(this,arguments);if(this.constructor===q){this.b2LineJoint.apply(this,arguments)}}Box2D.Dynamics.Joints.b2LineJoint=q;function aP(){aP.b2LineJointDef.apply(this,arguments);if(this.constructor===aP){this.b2LineJointDef.apply(this,arguments)}}Box2D.Dynamics.Joints.b2LineJointDef=aP;function a5(){a5.b2MouseJoint.apply(this,arguments);if(this.constructor===a5){this.b2MouseJoint.apply(this,arguments)}}Box2D.Dynamics.Joints.b2MouseJoint=a5;function U(){U.b2MouseJointDef.apply(this,arguments);if(this.constructor===U){this.b2MouseJointDef.apply(this,arguments)}}Box2D.Dynamics.Joints.b2MouseJointDef=U;function a3(){a3.b2PrismaticJoint.apply(this,arguments);if(this.constructor===a3){this.b2PrismaticJoint.apply(this,arguments)}}Box2D.Dynamics.Joints.b2PrismaticJoint=a3;function ap(){ap.b2PrismaticJointDef.apply(this,arguments);if(this.constructor===ap){this.b2PrismaticJointDef.apply(this,arguments)}}Box2D.Dynamics.Joints.b2PrismaticJointDef=ap;function a9(){a9.b2PulleyJoint.apply(this,arguments);if(this.constructor===a9){this.b2PulleyJoint.apply(this,arguments)}}Box2D.Dynamics.Joints.b2PulleyJoint=a9;function aj(){aj.b2PulleyJointDef.apply(this,arguments);if(this.constructor===aj){this.b2PulleyJointDef.apply(this,arguments)}}Box2D.Dynamics.Joints.b2PulleyJointDef=aj;function e(){e.b2RevoluteJoint.apply(this,arguments);if(this.constructor===e){this.b2RevoluteJoint.apply(this,arguments)}}Box2D.Dynamics.Joints.b2RevoluteJoint=e;function Q(){Q.b2RevoluteJointDef.apply(this,arguments);if(this.constructor===Q){this.b2RevoluteJointDef.apply(this,arguments)}}Box2D.Dynamics.Joints.b2RevoluteJointDef=Q;function aw(){aw.b2WeldJoint.apply(this,arguments);if(this.constructor===aw){this.b2WeldJoint.apply(this,arguments)}}Box2D.Dynamics.Joints.b2WeldJoint=aw;function aa(){aa.b2WeldJointDef.apply(this,arguments);if(this.constructor===aa){this.b2WeldJointDef.apply(this,arguments)}}Box2D.Dynamics.Joints.b2WeldJointDef=aa})();Box2D.postDefs=[];(function(){var H=Box2D.Collision.Shapes.b2CircleShape,Z=Box2D.Collision.Shapes.b2EdgeChainDef,ae=Box2D.Collision.Shapes.b2EdgeShape,L=Box2D.Collision.Shapes.b2MassData,v=Box2D.Collision.Shapes.b2PolygonShape,n=Box2D.Collision.Shapes.b2Shape,y=Box2D.Common.b2Color,M=Box2D.Common.b2internal,e=Box2D.Common.b2Settings,E=Box2D.Common.Math.b2Mat22,m=Box2D.Common.Math.b2Mat33,u=Box2D.Common.Math.b2Math,z=Box2D.Common.Math.b2Sweep,g=Box2D.Common.Math.b2Transform,Q=Box2D.Common.Math.b2Vec2,O=Box2D.Common.Math.b2Vec3,Y=Box2D.Collision.b2AABB,d=Box2D.Collision.b2Bound,N=Box2D.Collision.b2BoundValues,A=Box2D.Collision.b2Collision,S=Box2D.Collision.b2ContactID,C=Box2D.Collision.b2ContactPoint,I=Box2D.Collision.b2Distance,f=Box2D.Collision.b2DistanceInput,J=Box2D.Collision.b2DistanceOutput,ac=Box2D.Collision.b2DistanceProxy,G=Box2D.Collision.b2DynamicTree,V=Box2D.Collision.b2DynamicTreeBroadPhase,ad=Box2D.Collision.b2DynamicTreeNode,K=Box2D.Collision.b2DynamicTreePair,T=Box2D.Collision.b2Manifold,ab=Box2D.Collision.b2ManifoldPoint,B=Box2D.Collision.b2Point,r=Box2D.Collision.b2RayCastInput,F=Box2D.Collision.b2RayCastOutput,U=Box2D.Collision.b2Segment,X=Box2D.Collision.b2SeparationFunction,D=Box2D.Collision.b2Simplex,k=Box2D.Collision.b2SimplexCache,j=Box2D.Collision.b2SimplexVertex,W=Box2D.Collision.b2TimeOfImpact,aa=Box2D.Collision.b2TOIInput,b=Box2D.Collision.b2WorldManifold,q=Box2D.Collision.ClipVertex,R=Box2D.Collision.Features,P=Box2D.Collision.IBroadPhase;Y.b2AABB=function(){this.lowerBound=new Q();this.upperBound=new Q()};Y.prototype.IsValid=function(){var ag=this.upperBound.x-this.lowerBound.x;var af=this.upperBound.y-this.lowerBound.y;var ah=ag>=0&&af>=0;ah=ah&&this.lowerBound.IsValid()&&this.upperBound.IsValid();return ah};Y.prototype.GetCenter=function(){return new Q((this.lowerBound.x+this.upperBound.x)/2,(this.lowerBound.y+this.upperBound.y)/2)};Y.prototype.GetExtents=function(){return new Q((this.upperBound.x-this.lowerBound.x)/2,(this.upperBound.y-this.lowerBound.y)/2)};Y.prototype.Contains=function(ag){var af=true;af=af&&this.lowerBound.x<=ag.lowerBound.x;af=af&&this.lowerBound.y<=ag.lowerBound.y;af=af&&ag.upperBound.x<=this.upperBound.x;af=af&&ag.upperBound.y<=this.upperBound.y;return af};Y.prototype.RayCast=function(ai,au){var af=(-Number.MAX_VALUE);var ap=Number.MAX_VALUE;var ah=au.p1.x;var ag=au.p1.y;var ak=au.p2.x-au.p1.x;var aj=au.p2.y-au.p1.y;var ar=Math.abs(ak);var ao=Math.abs(aj);var at=ai.normal;var am=0;var aq=0;var an=0;var al=0;var av=0;if(ar<Number.MIN_VALUE){if(ah<this.lowerBound.x||this.upperBound.x<ah){return false}}else{am=1/ak;aq=(this.lowerBound.x-ah)*am;an=(this.upperBound.x-ah)*am;av=(-1);if(aq>an){al=aq;aq=an;an=al;av=1}if(aq>af){at.x=av;at.y=0;af=aq}ap=Math.min(ap,an);if(af>ap){return false}}if(ao<Number.MIN_VALUE){if(ag<this.lowerBound.y||this.upperBound.y<ag){return false}}else{am=1/aj;aq=(this.lowerBound.y-ag)*am;an=(this.upperBound.y-ag)*am;av=(-1);if(aq>an){al=aq;aq=an;an=al;av=1}if(aq>af){at.y=av;at.x=0;af=aq}ap=Math.min(ap,an);if(af>ap){return false}}ai.fraction=af;return true};Y.prototype.TestOverlap=function(af){var ah=af.lowerBound.x-this.upperBound.x;var ag=af.lowerBound.y-this.upperBound.y;var aj=this.lowerBound.x-af.upperBound.x;var ai=this.lowerBound.y-af.upperBound.y;if(ah>0||ag>0){return false}if(aj>0||ai>0){return false}return true};Y.Combine=function(ah,af){var ag=new Y();ag.Combine(ah,af);return ag};Y.prototype.Combine=function(ag,af){this.lowerBound.x=Math.min(ag.lowerBound.x,af.lowerBound.x);this.lowerBound.y=Math.min(ag.lowerBound.y,af.lowerBound.y);this.upperBound.x=Math.max(ag.upperBound.x,af.upperBound.x);this.upperBound.y=Math.max(ag.upperBound.y,af.upperBound.y)};d.b2Bound=function(){};d.prototype.IsLower=function(){return(this.value&1)==0};d.prototype.IsUpper=function(){return(this.value&1)==1};d.prototype.Swap=function(ag){var ai=this.value;var ah=this.proxy;var af=this.stabbingCount;this.value=ag.value;this.proxy=ag.proxy;this.stabbingCount=ag.stabbingCount;ag.value=ai;ag.proxy=ah;ag.stabbingCount=af};N.b2BoundValues=function(){};N.prototype.b2BoundValues=function(){this.lowerValues=new Vector_a2j_Number();this.lowerValues[0]=0;this.lowerValues[1]=0;this.upperValues=new Vector_a2j_Number();this.upperValues[0]=0;this.upperValues[1]=0};A.b2Collision=function(){};A.ClipSegmentToLine=function(an,ai,al,ag){if(ag===undefined){ag=0}var ah;var aj=0;ah=ai[0];var ap=ah.v;ah=ai[1];var ao=ah.v;var am=al.x*ap.x+al.y*ap.y-ag;var ak=al.x*ao.x+al.y*ao.y-ag;if(am<=0){an[aj++].Set(ai[0])}if(ak<=0){an[aj++].Set(ai[1])}if(am*ak<0){var aq=am/(am-ak);ah=an[aj];var ar=ah.v;ar.x=ap.x+aq*(ao.x-ap.x);ar.y=ap.y+aq*(ao.y-ap.y);ah=an[aj];var af;if(am>0){af=ai[0];ah.id=af.id}else{af=ai[1];ah.id=af.id}++aj}return aj};A.EdgeSeparation=function(az,ah,aA,ax,af){if(aA===undefined){aA=0}var an=parseInt(az.m_vertexCount);var ak=az.m_vertices;var aE=az.m_normals;var am=parseInt(ax.m_vertexCount);var ai=ax.m_vertices;var av;var al;av=ah.R;al=aE[aA];var aq=(av.col1.x*al.x+av.col2.x*al.y);var ap=(av.col1.y*al.x+av.col2.y*al.y);av=af.R;var aB=(av.col1.x*aq+av.col1.y*ap);var ay=(av.col2.x*aq+av.col2.y*ap);var ao=0;var aw=Number.MAX_VALUE;for(var aD=0;aD<am;++aD){al=ai[aD];var aC=al.x*aB+al.y*ay;if(aC<aw){aw=aC;ao=aD}}al=ak[aA];av=ah.R;var aj=ah.position.x+(av.col1.x*al.x+av.col2.x*al.y);var ag=ah.position.y+(av.col1.y*al.x+av.col2.y*al.y);al=ai[ao];av=af.R;var au=af.position.x+(av.col1.x*al.x+av.col2.x*al.y);var ar=af.position.y+(av.col1.y*al.x+av.col2.y*al.y);au-=aj;ar-=ag;var at=au*aq+ar*ap;return at};A.FindMaxSeparation=function(aA,av,ah,au,ag){var aq=parseInt(av.m_vertexCount);var aD=av.m_normals;var ai;var at;at=ag.R;ai=au.m_centroid;var al=ag.position.x+(at.col1.x*ai.x+at.col2.x*ai.y);var ak=ag.position.y+(at.col1.y*ai.x+at.col2.y*ai.y);at=ah.R;ai=av.m_centroid;al-=ah.position.x+(at.col1.x*ai.x+at.col2.x*ai.y);ak-=ah.position.y+(at.col1.y*ai.x+at.col2.y*ai.y);var an=(al*ah.R.col1.x+ak*ah.R.col1.y);var am=(al*ah.R.col2.x+ak*ah.R.col2.y);var ap=0;var af=(-Number.MAX_VALUE);for(var az=0;az<aq;++az){ai=aD[az];var ax=(ai.x*an+ai.y*am);if(ax>af){af=ax;ap=az}}var aw=A.EdgeSeparation(av,ah,ap,au,ag);var ao=parseInt(ap-1>=0?ap-1:aq-1);var aB=A.EdgeSeparation(av,ah,ao,au,ag);var ay=parseInt(ap+1<aq?ap+1:0);var aC=A.EdgeSeparation(av,ah,ay,au,ag);var aj=0;var ar=0;var aE=0;if(aB>aw&&aB>aC){aE=(-1);aj=ao;ar=aB}else{if(aC>aw){aE=1;aj=ay;ar=aC}else{aA[0]=ap;return aw}}while(true){if(aE==(-1)){ap=aj-1>=0?aj-1:aq-1}else{ap=aj+1<aq?aj+1:0}aw=A.EdgeSeparation(av,ah,ap,au,ag);if(aw>ar){aj=ap;ar=aw}else{break}}aA[0]=aj;return ar};A.FindIncidentEdge=function(aC,aq,ag,ar,ao,af){if(ar===undefined){ar=0}var ak=parseInt(aq.m_vertexCount);var aB=aq.m_normals;var aj=parseInt(ao.m_vertexCount);var ah=ao.m_vertices;var aA=ao.m_normals;var am;var ai;am=ag.R;ai=aB[ar];var at=(am.col1.x*ai.x+am.col2.x*ai.y);var ap=(am.col1.y*ai.x+am.col2.y*ai.y);am=af.R;var au=(am.col1.x*at+am.col1.y*ap);ap=(am.col2.x*at+am.col2.y*ap);at=au;var al=0;var an=Number.MAX_VALUE;for(var az=0;az<aj;++az){ai=aA[az];var av=(at*ai.x+ap*ai.y);if(av<an){an=av;al=az}}var aw;var ay=parseInt(al);var ax=parseInt(ay+1<aj?ay+1:0);aw=aC[0];ai=ah[ay];am=af.R;aw.v.x=af.position.x+(am.col1.x*ai.x+am.col2.x*ai.y);aw.v.y=af.position.y+(am.col1.y*ai.x+am.col2.y*ai.y);aw.id.features.referenceEdge=ar;aw.id.features.incidentEdge=ay;aw.id.features.incidentVertex=0;aw=aC[1];ai=ah[ax];am=af.R;aw.v.x=af.position.x+(am.col1.x*ai.x+am.col2.x*ai.y);aw.v.y=af.position.y+(am.col1.y*ai.x+am.col2.y*ai.y);aw.id.features.referenceEdge=ar;aw.id.features.incidentEdge=ax;aw.id.features.incidentVertex=1};A.MakeClipPointVector=function(){var af=new Vector(2);af[0]=new q();af[1]=new q();return af};A.CollidePolygons=function(aD,an,aj,am,ai){var ay;aD.m_pointCount=0;var ap=an.m_radius+am.m_radius;var aU=0;A.s_edgeAO[0]=aU;var aP=A.FindMaxSeparation(A.s_edgeAO,an,aj,am,ai);aU=A.s_edgeAO[0];if(aP>ap){return}var aT=0;A.s_edgeBO[0]=aT;var aN=A.FindMaxSeparation(A.s_edgeBO,am,ai,an,aj);aT=A.s_edgeBO[0];if(aN>ap){return}var ax;var aw;var av;var at;var af=0;var aY=0;var ah=0.98;var aV=0.001;var aS;if(aN>ah*aP+aV){ax=am;aw=an;av=ai;at=aj;af=aT;aD.m_type=T.e_faceB;aY=1}else{ax=an;aw=am;av=aj;at=ai;af=aU;aD.m_type=T.e_faceA;aY=0}var ag=A.s_incidentEdge;A.FindIncidentEdge(ag,ax,av,af,aw,at);var aJ=parseInt(ax.m_vertexCount);var aA=ax.m_vertices;var ar=aA[af];var aq;if(af+1<aJ){aq=aA[parseInt(af+1)]}else{aq=aA[0]}var aI=A.s_localTangent;aI.Set(aq.x-ar.x,aq.y-ar.y);aI.Normalize();var aC=A.s_localNormal;aC.x=aI.y;aC.y=(-aI.x);var aL=A.s_planePoint;aL.Set(0.5*(ar.x+aq.x),0.5*(ar.y+aq.y));var aM=A.s_tangent;aS=av.R;aM.x=(aS.col1.x*aI.x+aS.col2.x*aI.y);aM.y=(aS.col1.y*aI.x+aS.col2.y*aI.y);var ao=A.s_tangent2;ao.x=(-aM.x);ao.y=(-aM.y);var aO=A.s_normal;aO.x=aM.y;aO.y=(-aM.x);var aR=A.s_v11;var aQ=A.s_v12;aR.x=av.position.x+(aS.col1.x*ar.x+aS.col2.x*ar.y);aR.y=av.position.y+(aS.col1.y*ar.x+aS.col2.y*ar.y);aQ.x=av.position.x+(aS.col1.x*aq.x+aS.col2.x*aq.y);aQ.y=av.position.y+(aS.col1.y*aq.x+aS.col2.y*aq.y);var aK=aO.x*aR.x+aO.y*aR.y;var aH=(-aM.x*aR.x)-aM.y*aR.y+ap;var aG=aM.x*aQ.x+aM.y*aQ.y+ap;var aF=A.s_clipPoints1;var aE=A.s_clipPoints2;var aX=0;aX=A.ClipSegmentToLine(aF,ag,ao,aH);if(aX<2){return}aX=A.ClipSegmentToLine(aE,aF,aM,aG);if(aX<2){return}aD.m_localPlaneNormal.SetV(aC);aD.m_localPoint.SetV(aL);var az=0;for(var aW=0;aW<e.b2_maxManifoldPoints;++aW){ay=aE[aW];var au=aO.x*ay.v.x+aO.y*ay.v.y-aK;if(au<=ap){var aB=aD.m_points[az];aS=at.R;var al=ay.v.x-at.position.x;var ak=ay.v.y-at.position.y;aB.m_localPoint.x=(al*aS.col1.x+ak*aS.col1.y);aB.m_localPoint.y=(al*aS.col2.x+ak*aS.col2.y);aB.m_id.Set(ay.id);aB.m_id.features.flip=aY;++az}}aD.m_pointCount=az};A.CollideCircles=function(ak,am,ao,aj,an){ak.m_pointCount=0;var ar;var au;ar=ao.R;au=am.m_p;var ap=ao.position.x+(ar.col1.x*au.x+ar.col2.x*au.y);var al=ao.position.y+(ar.col1.y*au.x+ar.col2.y*au.y);ar=an.R;au=aj.m_p;var ag=an.position.x+(ar.col1.x*au.x+ar.col2.x*au.y);var af=an.position.y+(ar.col1.y*au.x+ar.col2.y*au.y);var ai=ag-ap;var ah=af-al;var at=ai*ai+ah*ah;var aq=am.m_radius+aj.m_radius;if(at>aq*aq){return}ak.m_type=T.e_circles;ak.m_localPoint.SetV(am.m_p);ak.m_localPlaneNormal.SetZero();ak.m_pointCount=1;ak.m_points[0].m_localPoint.SetV(aj.m_p);ak.m_points[0].m_id.key=0};A.CollidePolygonAndCircle=function(aE,ay,ai,aq,ah){aE.m_pointCount=0;var ap;var an=0;var am=0;var aM=0;var aL=0;var al;var aw;aw=ah.R;al=aq.m_p;var aJ=ah.position.x+(aw.col1.x*al.x+aw.col2.x*al.y);var aI=ah.position.y+(aw.col1.y*al.x+aw.col2.y*al.y);an=aJ-ai.position.x;am=aI-ai.position.y;aw=ai.R;var aC=(an*aw.col1.x+am*aw.col1.y);var aA=(an*aw.col2.x+am*aw.col2.y);var aD=0;var aK=0;var av=(-Number.MAX_VALUE);var ao=ay.m_radius+aq.m_radius;var ax=parseInt(ay.m_vertexCount);var ar=ay.m_vertices;var aB=ay.m_normals;for(var aG=0;aG<ax;++aG){al=ar[aG];an=aC-al.x;am=aA-al.y;al=aB[aG];var az=al.x*an+al.y*am;if(az>ao){return}if(az>av){av=az;aK=aG}}var ag=parseInt(aK);var af=parseInt(ag+1<ax?ag+1:0);var ak=ar[ag];var aj=ar[af];if(av<Number.MIN_VALUE){aE.m_pointCount=1;aE.m_type=T.e_faceA;aE.m_localPlaneNormal.SetV(aB[aK]);aE.m_localPoint.x=0.5*(ak.x+aj.x);aE.m_localPoint.y=0.5*(ak.y+aj.y);aE.m_points[0].m_localPoint.SetV(aq.m_p);aE.m_points[0].m_id.key=0;return}var aH=(aC-ak.x)*(aj.x-ak.x)+(aA-ak.y)*(aj.y-ak.y);var aF=(aC-aj.x)*(ak.x-aj.x)+(aA-aj.y)*(ak.y-aj.y);if(aH<=0){if((aC-ak.x)*(aC-ak.x)+(aA-ak.y)*(aA-ak.y)>ao*ao){return}aE.m_pointCount=1;aE.m_type=T.e_faceA;aE.m_localPlaneNormal.x=aC-ak.x;aE.m_localPlaneNormal.y=aA-ak.y;aE.m_localPlaneNormal.Normalize();aE.m_localPoint.SetV(ak);aE.m_points[0].m_localPoint.SetV(aq.m_p);aE.m_points[0].m_id.key=0}else{if(aF<=0){if((aC-aj.x)*(aC-aj.x)+(aA-aj.y)*(aA-aj.y)>ao*ao){return}aE.m_pointCount=1;aE.m_type=T.e_faceA;aE.m_localPlaneNormal.x=aC-aj.x;aE.m_localPlaneNormal.y=aA-aj.y;aE.m_localPlaneNormal.Normalize();aE.m_localPoint.SetV(aj);aE.m_points[0].m_localPoint.SetV(aq.m_p);aE.m_points[0].m_id.key=0}else{var au=0.5*(ak.x+aj.x);var at=0.5*(ak.y+aj.y);av=(aC-au)*aB[ag].x+(aA-at)*aB[ag].y;if(av>ao){return}aE.m_pointCount=1;aE.m_type=T.e_faceA;aE.m_localPlaneNormal.x=aB[ag].x;aE.m_localPlaneNormal.y=aB[ag].y;aE.m_localPlaneNormal.Normalize();aE.m_localPoint.Set(au,at);aE.m_points[0].m_localPoint.SetV(aq.m_p);aE.m_points[0].m_id.key=0}}};A.TestOverlap=function(ag,af){var al=af.lowerBound;var aj=ag.upperBound;var ai=al.x-aj.x;var ah=al.y-aj.y;al=ag.lowerBound;aj=af.upperBound;var am=al.x-aj.x;var ak=al.y-aj.y;if(ai>0||ah>0){return false}if(am>0||ak>0){return false}return true};Box2D.postDefs.push(function(){Box2D.Collision.b2Collision.s_incidentEdge=A.MakeClipPointVector();Box2D.Collision.b2Collision.s_clipPoints1=A.MakeClipPointVector();Box2D.Collision.b2Collision.s_clipPoints2=A.MakeClipPointVector();Box2D.Collision.b2Collision.s_edgeAO=new Vector_a2j_Number(1);Box2D.Collision.b2Collision.s_edgeBO=new Vector_a2j_Number(1);Box2D.Collision.b2Collision.s_localTangent=new Q();Box2D.Collision.b2Collision.s_localNormal=new Q();Box2D.Collision.b2Collision.s_planePoint=new Q();Box2D.Collision.b2Collision.s_normal=new Q();Box2D.Collision.b2Collision.s_tangent=new Q();Box2D.Collision.b2Collision.s_tangent2=new Q();Box2D.Collision.b2Collision.s_v11=new Q();Box2D.Collision.b2Collision.s_v12=new Q();Box2D.Collision.b2Collision.b2CollidePolyTempVec=new Q();Box2D.Collision.b2Collision.b2_nullFeature=255});S.b2ContactID=function(){this.features=new R()};S.prototype.b2ContactID=function(){this.features._m_id=this};S.prototype.Set=function(af){this.key=af._key};S.prototype.Copy=function(){var af=new S();af.key=this.key;return af};Object.defineProperty(S.prototype,"key",{enumerable:false,configurable:true,get:function(){return this._key}});Object.defineProperty(S.prototype,"key",{enumerable:false,configurable:true,set:function(af){if(af===undefined){af=0}this._key=af;this.features._referenceEdge=this._key&255;this.features._incidentEdge=((this._key&65280)>>8)&255;this.features._incidentVertex=((this._key&16711680)>>16)&255;this.features._flip=((this._key&4278190080)>>24)&255}});C.b2ContactPoint=function(){this.position=new Q();this.velocity=new Q();this.normal=new Q();this.id=new S()};I.b2Distance=function(){};I.Distance=function(al,au,ar){++I.b2_gjkCalls;var aC=ar.proxyA;var aA=ar.proxyB;var aq=ar.transformA;var ap=ar.transformB;var ao=I.s_simplex;ao.ReadCache(au,aC,aq,aA,ap);var aj=ao.m_vertices;var an=20;var ax=I.s_saveA;var aw=I.s_saveB;var at=0;var ai=ao.GetClosestPoint();var ah=ai.LengthSquared();var ag=ah;var az=0;var av;var ay=0;while(ay<an){at=ao.m_count;for(az=0;az<at;az++){ax[az]=aj[az].indexA;aw[az]=aj[az].indexB}switch(ao.m_count){case 1:break;case 2:ao.Solve2();break;case 3:ao.Solve3();break;default:e.b2Assert(false)}if(ao.m_count==3){break}av=ao.GetClosestPoint();ag=av.LengthSquared();if(ag>ah){}ah=ag;var aD=ao.GetSearchDirection();if(aD.LengthSquared()<Number.MIN_VALUE*Number.MIN_VALUE){break}var aB=aj[ao.m_count];aB.indexA=aC.GetSupport(u.MulTMV(aq.R,aD.GetNegative()));aB.wA=u.MulX(aq,aC.GetVertex(aB.indexA));aB.indexB=aA.GetSupport(u.MulTMV(ap.R,aD));aB.wB=u.MulX(ap,aA.GetVertex(aB.indexB));aB.w=u.SubtractVV(aB.wB,aB.wA);++ay;++I.b2_gjkIters;var af=false;for(az=0;az<at;az++){if(aB.indexA==ax[az]&&aB.indexB==aw[az]){af=true;break}}if(af){break}++ao.m_count}I.b2_gjkMaxIters=u.Max(I.b2_gjkMaxIters,ay);ao.GetWitnessPoints(al.pointA,al.pointB);al.distance=u.SubtractVV(al.pointA,al.pointB).Length();al.iterations=ay;ao.WriteCache(au);if(ar.useRadii){var am=aC.m_radius;var ak=aA.m_radius;if(al.distance>am+ak&&al.distance>Number.MIN_VALUE){al.distance-=am+ak;var aE=u.SubtractVV(al.pointB,al.pointA);aE.Normalize();al.pointA.x+=am*aE.x;al.pointA.y+=am*aE.y;al.pointB.x-=ak*aE.x;al.pointB.y-=ak*aE.y}else{av=new Q();av.x=0.5*(al.pointA.x+al.pointB.x);av.y=0.5*(al.pointA.y+al.pointB.y);al.pointA.x=al.pointB.x=av.x;al.pointA.y=al.pointB.y=av.y;al.distance=0}}};Box2D.postDefs.push(function(){Box2D.Collision.b2Distance.s_simplex=new D();Box2D.Collision.b2Distance.s_saveA=new Vector_a2j_Number(3);Box2D.Collision.b2Distance.s_saveB=new Vector_a2j_Number(3)});f.b2DistanceInput=function(){};J.b2DistanceOutput=function(){this.pointA=new Q();this.pointB=new Q()};ac.b2DistanceProxy=function(){};ac.prototype.Set=function(af){switch(af.GetType()){case n.e_circleShape:var ah=(af instanceof H?af:null);this.m_vertices=new Vector(1,true);this.m_vertices[0]=ah.m_p;this.m_count=1;this.m_radius=ah.m_radius;break;case n.e_polygonShape:var ag=(af instanceof v?af:null);this.m_vertices=ag.m_vertices;this.m_count=ag.m_vertexCount;this.m_radius=ag.m_radius;break;default:e.b2Assert(false)}};ac.prototype.GetSupport=function(aj){var ag=0;var ai=this.m_vertices[0].x*aj.x+this.m_vertices[0].y*aj.y;for(var af=1;af<this.m_count;++af){var ah=this.m_vertices[af].x*aj.x+this.m_vertices[af].y*aj.y;if(ah>ai){ag=af;ai=ah}}return ag};ac.prototype.GetSupportVertex=function(aj){var ag=0;var ai=this.m_vertices[0].x*aj.x+this.m_vertices[0].y*aj.y;for(var af=1;af<this.m_count;++af){var ah=this.m_vertices[af].x*aj.x+this.m_vertices[af].y*aj.y;if(ah>ai){ag=af;ai=ah}}return this.m_vertices[ag]};ac.prototype.GetVertexCount=function(){return this.m_count};ac.prototype.GetVertex=function(af){if(af===undefined){af=0}e.b2Assert(0<=af&&af<this.m_count);return this.m_vertices[af]};G.b2DynamicTree=function(){};G.prototype.b2DynamicTree=function(){this.m_root=null;this.m_freeList=null;this.m_path=0;this.m_insertionCount=0};G.prototype.CreateProxy=function(ai,ag){var aj=this.AllocateNode();var ah=e.b2_aabbExtension;var af=e.b2_aabbExtension;aj.aabb.lowerBound.x=ai.lowerBound.x-ah;aj.aabb.lowerBound.y=ai.lowerBound.y-af;aj.aabb.upperBound.x=ai.upperBound.x+ah;aj.aabb.upperBound.y=ai.upperBound.y+af;aj.userData=ag;this.InsertLeaf(aj);return aj};G.prototype.DestroyProxy=function(af){this.RemoveLeaf(af);this.FreeNode(af)};G.prototype.MoveProxy=function(aj,ah,ai){e.b2Assert(aj.IsLeaf());if(aj.aabb.Contains(ah)){return false}this.RemoveLeaf(aj);var ag=e.b2_aabbExtension+e.b2_aabbMultiplier*(ai.x>0?ai.x:(-ai.x));var af=e.b2_aabbExtension+e.b2_aabbMultiplier*(ai.y>0?ai.y:(-ai.y));aj.aabb.lowerBound.x=ah.lowerBound.x-ag;aj.aabb.lowerBound.y=ah.lowerBound.y-af;aj.aabb.upperBound.x=ah.upperBound.x+ag;aj.aabb.upperBound.y=ah.upperBound.y+af;this.InsertLeaf(aj);return true};G.prototype.Rebalance=function(ah){if(ah===undefined){ah=0}if(this.m_root==null){return}for(var af=0;af<ah;af++){var ag=this.m_root;var ai=0;while(ag.IsLeaf()==false){ag=(this.m_path>>ai)&1?ag.child2:ag.child1;ai=(ai+1)&31}++this.m_path;this.RemoveLeaf(ag);this.InsertLeaf(ag)}};G.prototype.GetFatAABB=function(af){return af.aabb};G.prototype.GetUserData=function(af){return af.userData};G.prototype.Query=function(ak,ag){if(this.m_root==null){return}var af=new Vector();var aj=0;af[aj++]=this.m_root;while(aj>0){var ai=af[--aj];if(ai.aabb.TestOverlap(ag)){if(ai.IsLeaf()){var ah=ak(ai);if(!ah){return}}else{af[aj++]=ai.child1;af[aj++]=ai.child2}}}};G.prototype.RayCast=function(aj,ao){if(this.m_root==null){return}var ai=ao.p1;var ag=ao.p2;var ap=u.SubtractVV(ai,ag);ap.Normalize();var an=u.CrossFV(1,ap);var aw=u.AbsV(an);var at=ao.maxFraction;var ah=new Y();var ar=0;var aq=0;ar=ai.x+at*(ag.x-ai.x);aq=ai.y+at*(ag.y-ai.y);ah.lowerBound.x=Math.min(ai.x,ar);ah.lowerBound.y=Math.min(ai.y,aq);ah.upperBound.x=Math.max(ai.x,ar);ah.upperBound.y=Math.max(ai.y,aq);var ak=new Vector();var al=0;ak[al++]=this.m_root;while(al>0){var au=ak[--al];if(au.aabb.TestOverlap(ah)==false){continue}var ax=au.aabb.GetCenter();var av=au.aabb.GetExtents();var am=Math.abs(an.x*(ai.x-ax.x)+an.y*(ai.y-ax.y))-aw.x*av.x-aw.y*av.y;if(am>0){continue}if(au.IsLeaf()){var af=new r();af.p1=ao.p1;af.p2=ao.p2;af.maxFraction=ao.maxFraction;at=aj(af,au);if(at==0){return}if(at>0){ar=ai.x+at*(ag.x-ai.x);aq=ai.y+at*(ag.y-ai.y);ah.lowerBound.x=Math.min(ai.x,ar);ah.lowerBound.y=Math.min(ai.y,aq);ah.upperBound.x=Math.max(ai.x,ar);ah.upperBound.y=Math.max(ai.y,aq)}}else{ak[al++]=au.child1;ak[al++]=au.child2}}};G.prototype.AllocateNode=function(){if(this.m_freeList){var af=this.m_freeList;this.m_freeList=af.parent;af.parent=null;af.child1=null;af.child2=null;return af}return new ad()};G.prototype.FreeNode=function(af){af.parent=this.m_freeList;this.m_freeList=af};G.prototype.InsertLeaf=function(ak){++this.m_insertionCount;if(this.m_root==null){this.m_root=ak;this.m_root.parent=null;return}var af=ak.aabb.GetCenter();var al=this.m_root;if(al.IsLeaf()==false){do{var aj=al.child1;var ai=al.child2;var ah=Math.abs((aj.aabb.lowerBound.x+aj.aabb.upperBound.x)/2-af.x)+Math.abs((aj.aabb.lowerBound.y+aj.aabb.upperBound.y)/2-af.y);var ag=Math.abs((ai.aabb.lowerBound.x+ai.aabb.upperBound.x)/2-af.x)+Math.abs((ai.aabb.lowerBound.y+ai.aabb.upperBound.y)/2-af.y);if(ah<ag){al=aj}else{al=ai}}while(al.IsLeaf()==false)}var an=al.parent;var am=this.AllocateNode();am.parent=an;am.userData=null;am.aabb.Combine(ak.aabb,al.aabb);if(an){if(al.parent.child1==al){an.child1=am}else{an.child2=am}am.child1=al;am.child2=ak;al.parent=am;ak.parent=am;do{if(an.aabb.Contains(am.aabb)){break}an.aabb.Combine(an.child1.aabb,an.child2.aabb);am=an;an=an.parent}while(an)}else{am.child1=al;am.child2=ak;al.parent=am;ak.parent=am;this.m_root=am}};G.prototype.RemoveLeaf=function(ah){if(ah==this.m_root){this.m_root=null;return}var ag=ah.parent;var ai=ag.parent;var aj;if(ag.child1==ah){aj=ag.child2}else{aj=ag.child1}if(ai){if(ai.child1==ag){ai.child1=aj}else{ai.child2=aj}aj.parent=ai;this.FreeNode(ag);while(ai){var af=ai.aabb;ai.aabb=Y.Combine(ai.child1.aabb,ai.child2.aabb);if(af.Contains(ai.aabb)){break}ai=ai.parent}}else{this.m_root=aj;aj.parent=null;this.FreeNode(ag)}};V.b2DynamicTreeBroadPhase=function(){this.m_tree=new G();this.m_moveBuffer=new Vector();this.m_pairBuffer=new Vector();this.m_pairCount=0};V.prototype.CreateProxy=function(ag,af){var ah=this.m_tree.CreateProxy(ag,af);++this.m_proxyCount;this.BufferMove(ah);return ah};V.prototype.DestroyProxy=function(af){this.UnBufferMove(af);--this.m_proxyCount;this.m_tree.DestroyProxy(af)};V.prototype.MoveProxy=function(ai,ag,ah){var af=this.m_tree.MoveProxy(ai,ag,ah);if(af){this.BufferMove(ai)}};V.prototype.TestOverlap=function(ag,af){var ai=this.m_tree.GetFatAABB(ag);var ah=this.m_tree.GetFatAABB(af);return ai.TestOverlap(ah)};V.prototype.GetUserData=function(af){return this.m_tree.GetUserData(af)};V.prototype.GetFatAABB=function(af){return this.m_tree.GetFatAABB(af)};V.prototype.GetProxyCount=function(){return this.m_proxyCount};V.prototype.UpdatePairs=function(ao){var an=this;an.m_pairCount=0;var am=0,ai;for(am=0;am<an.m_moveBuffer.length;++am){ai=an.m_moveBuffer[am];function af(ap){if(ap==ai){return true}if(an.m_pairCount==an.m_pairBuffer.length){an.m_pairBuffer[an.m_pairCount]=new K()}var aq=an.m_pairBuffer[an.m_pairCount];aq.proxyA=ap<ai?ap:ai;aq.proxyB=ap>=ai?ap:ai;++an.m_pairCount;return true}var ak=an.m_tree.GetFatAABB(ai);an.m_tree.Query(af,ak)}an.m_moveBuffer.length=0;for(var am=0;am<an.m_pairCount;){var ag=an.m_pairBuffer[am];var aj=an.m_tree.GetUserData(ag.proxyA);var ah=an.m_tree.GetUserData(ag.proxyB);ao(aj,ah);++am;while(am<an.m_pairCount){var al=an.m_pairBuffer[am];if(al.proxyA!=ag.proxyA||al.proxyB!=ag.proxyB){break}++am}}};V.prototype.Query=function(ag,af){this.m_tree.Query(ag,af)};V.prototype.RayCast=function(ag,af){this.m_tree.RayCast(ag,af)};V.prototype.Validate=function(){};V.prototype.Rebalance=function(af){if(af===undefined){af=0}this.m_tree.Rebalance(af)};V.prototype.BufferMove=function(af){this.m_moveBuffer[this.m_moveBuffer.length]=af};V.prototype.UnBufferMove=function(ag){var af=parseInt(this.m_moveBuffer.indexOf(ag));this.m_moveBuffer.splice(af,1)};V.prototype.ComparePairs=function(ag,af){return 0};V.__implements={};V.__implements[P]=true;ad.b2DynamicTreeNode=function(){this.aabb=new Y()};ad.prototype.IsLeaf=function(){return this.child1==null};K.b2DynamicTreePair=function(){};T.b2Manifold=function(){this.m_pointCount=0};T.prototype.b2Manifold=function(){this.m_points=new Vector(e.b2_maxManifoldPoints);for(var af=0;af<e.b2_maxManifoldPoints;af++){this.m_points[af]=new ab()}this.m_localPlaneNormal=new Q();this.m_localPoint=new Q()};T.prototype.Reset=function(){for(var af=0;af<e.b2_maxManifoldPoints;af++){((this.m_points[af] instanceof ab?this.m_points[af]:null)).Reset()}this.m_localPlaneNormal.SetZero();this.m_localPoint.SetZero();this.m_type=0;this.m_pointCount=0};T.prototype.Set=function(af){this.m_pointCount=af.m_pointCount;for(var ag=0;ag<e.b2_maxManifoldPoints;ag++){((this.m_points[ag] instanceof ab?this.m_points[ag]:null)).Set(af.m_points[ag])}this.m_localPlaneNormal.SetV(af.m_localPlaneNormal);this.m_localPoint.SetV(af.m_localPoint);this.m_type=af.m_type};T.prototype.Copy=function(){var af=new T();af.Set(this);return af};Box2D.postDefs.push(function(){Box2D.Collision.b2Manifold.e_circles=1;Box2D.Collision.b2Manifold.e_faceA=2;Box2D.Collision.b2Manifold.e_faceB=4});ab.b2ManifoldPoint=function(){this.m_localPoint=new Q();this.m_id=new S()};ab.prototype.b2ManifoldPoint=function(){this.Reset()};ab.prototype.Reset=function(){this.m_localPoint.SetZero();this.m_normalImpulse=0;this.m_tangentImpulse=0;this.m_id.key=0};ab.prototype.Set=function(af){this.m_localPoint.SetV(af.m_localPoint);this.m_normalImpulse=af.m_normalImpulse;this.m_tangentImpulse=af.m_tangentImpulse;this.m_id.Set(af.m_id)};B.b2Point=function(){this.p=new Q()};B.prototype.Support=function(ah,ag,af){if(ag===undefined){ag=0}if(af===undefined){af=0}return this.p};B.prototype.GetFirstVertex=function(af){return this.p};r.b2RayCastInput=function(){this.p1=new Q();this.p2=new Q()};r.prototype.b2RayCastInput=function(ah,ag,af){if(ah===undefined){ah=null}if(ag===undefined){ag=null}if(af===undefined){af=1}if(ah){this.p1.SetV(ah)}if(ag){this.p2.SetV(ag)}this.maxFraction=af};F.b2RayCastOutput=function(){this.normal=new Q()};U.b2Segment=function(){this.p1=new Q();this.p2=new Q()};U.prototype.TestSegment=function(an,aw,ah,ar){if(ar===undefined){ar=0}var ao=ah.p1;var av=ah.p2.x-ao.x;var at=ah.p2.y-ao.y;var aj=this.p2.x-this.p1.x;var ai=this.p2.y-this.p1.y;var aq=ai;var ap=(-aj);var ax=100*Number.MIN_VALUE;var ag=(-(av*aq+at*ap));if(ag>ax){var am=ao.x-this.p1.x;var al=ao.y-this.p1.y;var au=(am*aq+al*ap);if(0<=au&&au<=ar*ag){var af=(-av*al)+at*am;if((-ax*ag)<=af&&af<=ag*(1+ax)){au/=ag;var ak=Math.sqrt(aq*aq+ap*ap);aq/=ak;ap/=ak;an[0]=au;aw.Set(aq,ap);return true}}}return false};U.prototype.Extend=function(af){this.ExtendForward(af);this.ExtendBackward(af)};U.prototype.ExtendForward=function(ah){var ag=this.p2.x-this.p1.x;var af=this.p2.y-this.p1.y;var ai=Math.min(ag>0?(ah.upperBound.x-this.p1.x)/ag:ag<0?(ah.lowerBound.x-this.p1.x)/ag:Number.POSITIVE_INFINITY,af>0?(ah.upperBound.y-this.p1.y)/af:af<0?(ah.lowerBound.y-this.p1.y)/af:Number.POSITIVE_INFINITY);this.p2.x=this.p1.x+ag*ai;this.p2.y=this.p1.y+af*ai};U.prototype.ExtendBackward=function(ah){var ag=(-this.p2.x)+this.p1.x;var af=(-this.p2.y)+this.p1.y;var ai=Math.min(ag>0?(ah.upperBound.x-this.p2.x)/ag:ag<0?(ah.lowerBound.x-this.p2.x)/ag:Number.POSITIVE_INFINITY,af>0?(ah.upperBound.y-this.p2.y)/af:af<0?(ah.lowerBound.y-this.p2.y)/af:Number.POSITIVE_INFINITY);this.p1.x=this.p2.x+ag*ai;this.p1.y=this.p2.y+af*ai};X.b2SeparationFunction=function(){this.m_localPoint=new Q();this.m_axis=new Q()};X.prototype.Initialize=function(ax,aG,ar,aF,aq){this.m_proxyA=aG;this.m_proxyB=aF;var al=parseInt(ax.count);e.b2Assert(0<al&&al<3);var au;var ak;var aj;var at;var aA;var az;var aN=0;var aM=0;var ao=0;var am=0;var ai=0;var ah=0;var ap;var ag;var aw=0;var an=0;if(al==1){this.m_type=X.e_points;au=this.m_proxyA.GetVertex(ax.indexA[0]);at=this.m_proxyB.GetVertex(ax.indexB[0]);ag=au;ap=ar.R;aN=ar.position.x+(ap.col1.x*ag.x+ap.col2.x*ag.y);aM=ar.position.y+(ap.col1.y*ag.x+ap.col2.y*ag.y);ag=at;ap=aq.R;ao=aq.position.x+(ap.col1.x*ag.x+ap.col2.x*ag.y);am=aq.position.y+(ap.col1.y*ag.x+ap.col2.y*ag.y);this.m_axis.x=ao-aN;this.m_axis.y=am-aM;this.m_axis.Normalize()}else{if(ax.indexB[0]==ax.indexB[1]){this.m_type=X.e_faceA;ak=this.m_proxyA.GetVertex(ax.indexA[0]);aj=this.m_proxyA.GetVertex(ax.indexA[1]);at=this.m_proxyB.GetVertex(ax.indexB[0]);this.m_localPoint.x=0.5*(ak.x+aj.x);this.m_localPoint.y=0.5*(ak.y+aj.y);this.m_axis=u.CrossVF(u.SubtractVV(aj,ak),1);this.m_axis.Normalize();ag=this.m_axis;ap=ar.R;ai=ap.col1.x*ag.x+ap.col2.x*ag.y;ah=ap.col1.y*ag.x+ap.col2.y*ag.y;ag=this.m_localPoint;ap=ar.R;aN=ar.position.x+(ap.col1.x*ag.x+ap.col2.x*ag.y);aM=ar.position.y+(ap.col1.y*ag.x+ap.col2.y*ag.y);ag=at;ap=aq.R;ao=aq.position.x+(ap.col1.x*ag.x+ap.col2.x*ag.y);am=aq.position.y+(ap.col1.y*ag.x+ap.col2.y*ag.y);aw=(ao-aN)*ai+(am-aM)*ah;if(aw<0){this.m_axis.NegativeSelf()}}else{if(ax.indexA[0]==ax.indexA[0]){this.m_type=X.e_faceB;aA=this.m_proxyB.GetVertex(ax.indexB[0]);az=this.m_proxyB.GetVertex(ax.indexB[1]);au=this.m_proxyA.GetVertex(ax.indexA[0]);this.m_localPoint.x=0.5*(aA.x+az.x);this.m_localPoint.y=0.5*(aA.y+az.y);this.m_axis=u.CrossVF(u.SubtractVV(az,aA),1);this.m_axis.Normalize();ag=this.m_axis;ap=aq.R;ai=ap.col1.x*ag.x+ap.col2.x*ag.y;ah=ap.col1.y*ag.x+ap.col2.y*ag.y;ag=this.m_localPoint;ap=aq.R;ao=aq.position.x+(ap.col1.x*ag.x+ap.col2.x*ag.y);am=aq.position.y+(ap.col1.y*ag.x+ap.col2.y*ag.y);ag=au;ap=ar.R;aN=ar.position.x+(ap.col1.x*ag.x+ap.col2.x*ag.y);aM=ar.position.y+(ap.col1.y*ag.x+ap.col2.y*ag.y);aw=(aN-ao)*ai+(aM-am)*ah;if(aw<0){this.m_axis.NegativeSelf()}}else{ak=this.m_proxyA.GetVertex(ax.indexA[0]);aj=this.m_proxyA.GetVertex(ax.indexA[1]);aA=this.m_proxyB.GetVertex(ax.indexB[0]);az=this.m_proxyB.GetVertex(ax.indexB[1]);var aE=u.MulX(ar,au);var aC=u.MulMV(ar.R,u.SubtractVV(aj,ak));var aD=u.MulX(aq,at);var aB=u.MulMV(aq.R,u.SubtractVV(az,aA));var aL=aC.x*aC.x+aC.y*aC.y;var aI=aB.x*aB.x+aB.y*aB.y;var ay=u.SubtractVV(aB,aC);var aJ=aC.x*ay.x+aC.y*ay.y;var aH=aB.x*ay.x+aB.y*ay.y;var aK=aC.x*aB.x+aC.y*aB.y;var af=aL*aI-aK*aK;aw=0;if(af!=0){aw=u.Clamp((aK*aH-aJ*aI)/af,0,1)}var av=(aK*aw+aH)/aI;if(av<0){av=0;aw=u.Clamp((aK-aJ)/aL,0,1)}au=new Q();au.x=ak.x+aw*(aj.x-ak.x);au.y=ak.y+aw*(aj.y-ak.y);at=new Q();at.x=aA.x+aw*(az.x-aA.x);at.y=aA.y+aw*(az.y-aA.y);if(aw==0||aw==1){this.m_type=X.e_faceB;this.m_axis=u.CrossVF(u.SubtractVV(az,aA),1);this.m_axis.Normalize();this.m_localPoint=at;ag=this.m_axis;ap=aq.R;ai=ap.col1.x*ag.x+ap.col2.x*ag.y;ah=ap.col1.y*ag.x+ap.col2.y*ag.y;ag=this.m_localPoint;ap=aq.R;ao=aq.position.x+(ap.col1.x*ag.x+ap.col2.x*ag.y);am=aq.position.y+(ap.col1.y*ag.x+ap.col2.y*ag.y);ag=au;ap=ar.R;aN=ar.position.x+(ap.col1.x*ag.x+ap.col2.x*ag.y);aM=ar.position.y+(ap.col1.y*ag.x+ap.col2.y*ag.y);an=(aN-ao)*ai+(aM-am)*ah;if(aw<0){this.m_axis.NegativeSelf()}}else{this.m_type=X.e_faceA;this.m_axis=u.CrossVF(u.SubtractVV(aj,ak),1);this.m_localPoint=au;ag=this.m_axis;ap=ar.R;ai=ap.col1.x*ag.x+ap.col2.x*ag.y;ah=ap.col1.y*ag.x+ap.col2.y*ag.y;ag=this.m_localPoint;ap=ar.R;aN=ar.position.x+(ap.col1.x*ag.x+ap.col2.x*ag.y);aM=ar.position.y+(ap.col1.y*ag.x+ap.col2.y*ag.y);ag=at;ap=aq.R;ao=aq.position.x+(ap.col1.x*ag.x+ap.col2.x*ag.y);am=aq.position.y+(ap.col1.y*ag.x+ap.col2.y*ag.y);an=(ao-aN)*ai+(am-aM)*ah;if(aw<0){this.m_axis.NegativeSelf()}}}}}};X.prototype.Evaluate=function(an,am){var ah;var ag;var ak;var aj;var af;var ao;var ai=0;var al;switch(this.m_type){case X.e_points:ah=u.MulTMV(an.R,this.m_axis);ag=u.MulTMV(am.R,this.m_axis.GetNegative());ak=this.m_proxyA.GetSupportVertex(ah);aj=this.m_proxyB.GetSupportVertex(ag);af=u.MulX(an,ak);ao=u.MulX(am,aj);ai=(ao.x-af.x)*this.m_axis.x+(ao.y-af.y)*this.m_axis.y;return ai;case X.e_faceA:al=u.MulMV(an.R,this.m_axis);af=u.MulX(an,this.m_localPoint);ag=u.MulTMV(am.R,al.GetNegative());aj=this.m_proxyB.GetSupportVertex(ag);ao=u.MulX(am,aj);ai=(ao.x-af.x)*al.x+(ao.y-af.y)*al.y;return ai;case X.e_faceB:al=u.MulMV(am.R,this.m_axis);ao=u.MulX(am,this.m_localPoint);ah=u.MulTMV(an.R,al.GetNegative());ak=this.m_proxyA.GetSupportVertex(ah);af=u.MulX(an,ak);ai=(af.x-ao.x)*al.x+(af.y-ao.y)*al.y;return ai;default:e.b2Assert(false);return 0}};Box2D.postDefs.push(function(){Box2D.Collision.b2SeparationFunction.e_points=1;Box2D.Collision.b2SeparationFunction.e_faceA=2;Box2D.Collision.b2SeparationFunction.e_faceB=4});D.b2Simplex=function(){this.m_v1=new j();this.m_v2=new j();this.m_v3=new j();this.m_vertices=new Vector(3)};D.prototype.b2Simplex=function(){this.m_vertices[0]=this.m_v1;this.m_vertices[1]=this.m_v2;this.m_vertices[2]=this.m_v3};D.prototype.ReadCache=function(af,an,ap,am,ao){e.b2Assert(0<=af.count&&af.count<=3);var ag;var ah;this.m_count=af.count;var al=this.m_vertices;for(var ai=0;ai<this.m_count;ai++){var aq=al[ai];aq.indexA=af.indexA[ai];aq.indexB=af.indexB[ai];ag=an.GetVertex(aq.indexA);ah=am.GetVertex(aq.indexB);aq.wA=u.MulX(ap,ag);aq.wB=u.MulX(ao,ah);aq.w=u.SubtractVV(aq.wB,aq.wA);aq.a=0}if(this.m_count>1){var ak=af.metric;var aj=this.GetMetric();if(aj<0.5*ak||2*ak<aj||aj<Number.MIN_VALUE){this.m_count=0}}if(this.m_count==0){aq=al[0];aq.indexA=0;aq.indexB=0;ag=an.GetVertex(0);ah=am.GetVertex(0);aq.wA=u.MulX(ap,ag);aq.wB=u.MulX(ao,ah);aq.w=u.SubtractVV(aq.wB,aq.wA);this.m_count=1}};D.prototype.WriteCache=function(af){af.metric=this.GetMetric();af.count=Box2D.parseUInt(this.m_count);var ag=this.m_vertices;for(var ah=0;ah<this.m_count;ah++){af.indexA[ah]=Box2D.parseUInt(ag[ah].indexA);af.indexB[ah]=Box2D.parseUInt(ag[ah].indexB)}};D.prototype.GetSearchDirection=function(){switch(this.m_count){case 1:return this.m_v1.w.GetNegative();case 2:var af=u.SubtractVV(this.m_v2.w,this.m_v1.w);var ag=u.CrossVV(af,this.m_v1.w.GetNegative());if(ag>0){return u.CrossFV(1,af)}else{return u.CrossVF(af,1)}default:e.b2Assert(false);return new Q()}};D.prototype.GetClosestPoint=function(){switch(this.m_count){case 0:e.b2Assert(false);return new Q();case 1:return this.m_v1.w;case 2:return new Q(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);default:e.b2Assert(false);return new Q()}};D.prototype.GetWitnessPoints=function(ag,af){switch(this.m_count){case 0:e.b2Assert(false);break;case 1:ag.SetV(this.m_v1.wA);af.SetV(this.m_v1.wB);break;case 2:ag.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x;ag.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y;af.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x;af.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:af.x=ag.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x;af.y=ag.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y;break;default:e.b2Assert(false);break}};D.prototype.GetMetric=function(){switch(this.m_count){case 0:e.b2Assert(false);return 0;case 1:return 0;case 2:return u.SubtractVV(this.m_v1.w,this.m_v2.w).Length();case 3:return u.CrossVV(u.SubtractVV(this.m_v2.w,this.m_v1.w),u.SubtractVV(this.m_v3.w,this.m_v1.w));default:e.b2Assert(false);return 0}};D.prototype.Solve2=function(){var ag=this.m_v1.w;var af=this.m_v2.w;var ai=u.SubtractVV(af,ag);var aj=(-(ag.x*ai.x+ag.y*ai.y));if(aj<=0){this.m_v1.a=1;this.m_count=1;return}var ak=(af.x*ai.x+af.y*ai.y);if(ak<=0){this.m_v2.a=1;this.m_count=1;this.m_v1.Set(this.m_v2);return}var ah=1/(ak+aj);this.m_v1.a=ak*ah;this.m_v2.a=aj*ah;this.m_count=2};D.prototype.Solve3=function(){var au=this.m_v1.w;var ar=this.m_v2.w;var ap=this.m_v3.w;var av=u.SubtractVV(ar,au);var ai=u.Dot(au,av);var ak=u.Dot(ar,av);var aF=ak;var aE=(-ai);var at=u.SubtractVV(ap,au);var ah=u.Dot(au,at);var ax=u.Dot(ap,at);var ay=ax;var aw=(-ah);var aC=u.SubtractVV(ap,ar);var aB=u.Dot(ar,aC);var aD=u.Dot(ap,aC);var aA=aD;var az=(-aB);var ao=u.CrossVV(av,at);var an=ao*u.CrossVV(ar,ap);var am=ao*u.CrossVV(ap,au);var aj=ao*u.CrossVV(au,ar);if(aE<=0&&aw<=0){this.m_v1.a=1;this.m_count=1;return}if(aF>0&&aE>0&&aj<=0){var ag=1/(aF+aE);this.m_v1.a=aF*ag;this.m_v2.a=aE*ag;this.m_count=2;return}if(ay>0&&aw>0&&am<=0){var af=1/(ay+aw);this.m_v1.a=ay*af;this.m_v3.a=aw*af;this.m_count=2;this.m_v2.Set(this.m_v3);return}if(aF<=0&&az<=0){this.m_v2.a=1;this.m_count=1;this.m_v1.Set(this.m_v2);return}if(ay<=0&&aA<=0){this.m_v3.a=1;this.m_count=1;this.m_v1.Set(this.m_v3);return}if(aA>0&&az>0&&an<=0){var aq=1/(aA+az);this.m_v2.a=aA*aq;this.m_v3.a=az*aq;this.m_count=2;this.m_v1.Set(this.m_v3);return}var al=1/(an+am+aj);this.m_v1.a=an*al;this.m_v2.a=am*al;this.m_v3.a=aj*al;this.m_count=3};k.b2SimplexCache=function(){this.indexA=new Vector_a2j_Number(3);this.indexB=new Vector_a2j_Number(3)};j.b2SimplexVertex=function(){};j.prototype.Set=function(af){this.wA.SetV(af.wA);this.wB.SetV(af.wB);this.w.SetV(af.w);this.a=af.a;this.indexA=af.indexA;this.indexB=af.indexB};W.b2TimeOfImpact=function(){};W.TimeOfImpact=function(am){++W.b2_toiCalls;var aw=am.proxyA;var au=am.proxyB;var ah=am.sweepA;var ag=am.sweepB;e.b2Assert(ah.t0==ag.t0);e.b2Assert(1-ah.t0>Number.MIN_VALUE);var ai=aw.m_radius+au.m_radius;var at=am.tolerance;var aj=0;var an=1000;var ar=0;var az=0;W.s_cache.count=0;W.s_distanceInput.useRadii=false;for(;;){ah.GetTransform(W.s_xfA,aj);ag.GetTransform(W.s_xfB,aj);W.s_distanceInput.proxyA=aw;W.s_distanceInput.proxyB=au;W.s_distanceInput.transformA=W.s_xfA;W.s_distanceInput.transformB=W.s_xfB;I.Distance(W.s_distanceOutput,W.s_cache,W.s_distanceInput);if(W.s_distanceOutput.distance<=0){aj=1;break}W.s_fcn.Initialize(W.s_cache,aw,W.s_xfA,au,W.s_xfB);var ak=W.s_fcn.Evaluate(W.s_xfA,W.s_xfB);if(ak<=0){aj=1;break}if(ar==0){if(ak>ai){az=u.Max(ai-at,0.75*ai)}else{az=u.Max(ak-at,0.02*ai)}}if(ak-az<0.5*at){if(ar==0){aj=1;break}break}var af=aj;var ax=aj;var av=1;var aq=ak;ah.GetTransform(W.s_xfA,av);ag.GetTransform(W.s_xfB,av);var ap=W.s_fcn.Evaluate(W.s_xfA,W.s_xfB);if(ap>=az){aj=1;break}var ao=0;for(;;){var al=0;if(ao&1){al=ax+(az-aq)*(av-ax)/(ap-aq)}else{al=0.5*(ax+av)}ah.GetTransform(W.s_xfA,al);ag.GetTransform(W.s_xfB,al);var ay=W.s_fcn.Evaluate(W.s_xfA,W.s_xfB);if(u.Abs(ay-az)<0.025*at){af=al;break}if(ay>az){ax=al;aq=ay}else{av=al;ap=ay}++ao;++W.b2_toiRootIters;if(ao==50){break}}W.b2_toiMaxRootIters=u.Max(W.b2_toiMaxRootIters,ao);if(af<(1+100*Number.MIN_VALUE)*aj){break}aj=af;ar++;++W.b2_toiIters;if(ar==an){break}}W.b2_toiMaxIters=u.Max(W.b2_toiMaxIters,ar);return aj};Box2D.postDefs.push(function(){Box2D.Collision.b2TimeOfImpact.b2_toiCalls=0;Box2D.Collision.b2TimeOfImpact.b2_toiIters=0;Box2D.Collision.b2TimeOfImpact.b2_toiMaxIters=0;Box2D.Collision.b2TimeOfImpact.b2_toiRootIters=0;Box2D.Collision.b2TimeOfImpact.b2_toiMaxRootIters=0;Box2D.Collision.b2TimeOfImpact.s_cache=new k();Box2D.Collision.b2TimeOfImpact.s_distanceInput=new f();Box2D.Collision.b2TimeOfImpact.s_xfA=new g();Box2D.Collision.b2TimeOfImpact.s_xfB=new g();Box2D.Collision.b2TimeOfImpact.s_fcn=new X();Box2D.Collision.b2TimeOfImpact.s_distanceOutput=new J()});aa.b2TOIInput=function(){this.proxyA=new ac();this.proxyB=new ac();this.sweepA=new z();this.sweepB=new z()};b.b2WorldManifold=function(){this.m_normal=new Q()};b.prototype.b2WorldManifold=function(){this.m_points=new Vector(e.b2_maxManifoldPoints);for(var af=0;af<e.b2_maxManifoldPoints;af++){this.m_points[af]=new Q()}};b.prototype.Initialize=function(ar,au,ax,at,aw){if(ax===undefined){ax=0}if(aw===undefined){aw=0}if(ar.m_pointCount==0){return}var av=0;var ah;var aq;var al=0;var aj=0;var ag=0;var aF=0;var aA=0;var az=0;switch(ar.m_type){case T.e_circles:aq=au.R;ah=ar.m_localPoint;var aE=au.position.x+aq.col1.x*ah.x+aq.col2.x*ah.y;var aC=au.position.y+aq.col1.y*ah.x+aq.col2.y*ah.y;aq=at.R;ah=ar.m_points[0].m_localPoint;var ao=at.position.x+aq.col1.x*ah.x+aq.col2.x*ah.y;var am=at.position.y+aq.col1.y*ah.x+aq.col2.y*ah.y;var ak=ao-aE;var ai=am-aC;var aB=ak*ak+ai*ai;if(aB>Number.MIN_VALUE*Number.MIN_VALUE){var ay=Math.sqrt(aB);this.m_normal.x=ak/ay;this.m_normal.y=ai/ay}else{this.m_normal.x=1;this.m_normal.y=0}var af=aE+ax*this.m_normal.x;var aD=aC+ax*this.m_normal.y;var ap=ao-aw*this.m_normal.x;var an=am-aw*this.m_normal.y;this.m_points[0].x=0.5*(af+ap);this.m_points[0].y=0.5*(aD+an);break;case T.e_faceA:aq=au.R;ah=ar.m_localPlaneNormal;al=aq.col1.x*ah.x+aq.col2.x*ah.y;aj=aq.col1.y*ah.x+aq.col2.y*ah.y;aq=au.R;ah=ar.m_localPoint;ag=au.position.x+aq.col1.x*ah.x+aq.col2.x*ah.y;aF=au.position.y+aq.col1.y*ah.x+aq.col2.y*ah.y;this.m_normal.x=al;this.m_normal.y=aj;for(av=0;av<ar.m_pointCount;av++){aq=at.R;ah=ar.m_points[av].m_localPoint;aA=at.position.x+aq.col1.x*ah.x+aq.col2.x*ah.y;az=at.position.y+aq.col1.y*ah.x+aq.col2.y*ah.y;this.m_points[av].x=aA+0.5*(ax-(aA-ag)*al-(az-aF)*aj-aw)*al;this.m_points[av].y=az+0.5*(ax-(aA-ag)*al-(az-aF)*aj-aw)*aj}break;case T.e_faceB:aq=at.R;ah=ar.m_localPlaneNormal;al=aq.col1.x*ah.x+aq.col2.x*ah.y;aj=aq.col1.y*ah.x+aq.col2.y*ah.y;aq=at.R;ah=ar.m_localPoint;ag=at.position.x+aq.col1.x*ah.x+aq.col2.x*ah.y;aF=at.position.y+aq.col1.y*ah.x+aq.col2.y*ah.y;this.m_normal.x=(-al);this.m_normal.y=(-aj);for(av=0;av<ar.m_pointCount;av++){aq=au.R;ah=ar.m_points[av].m_localPoint;aA=au.position.x+aq.col1.x*ah.x+aq.col2.x*ah.y;az=au.position.y+aq.col1.y*ah.x+aq.col2.y*ah.y;this.m_points[av].x=aA+0.5*(aw-(aA-ag)*al-(az-aF)*aj-ax)*al;this.m_points[av].y=az+0.5*(aw-(aA-ag)*al-(az-aF)*aj-ax)*aj}break}};q.ClipVertex=function(){this.v=new Q();this.id=new S()};q.prototype.Set=function(af){this.v.SetV(af.v);this.id.Set(af.id)};R.Features=function(){};Object.defineProperty(R.prototype,"referenceEdge",{enumerable:false,configurable:true,get:function(){return this._referenceEdge}});Object.defineProperty(R.prototype,"referenceEdge",{enumerable:false,configurable:true,set:function(af){if(af===undefined){af=0}this._referenceEdge=af;this._m_id._key=(this._m_id._key&4294967040)|(this._referenceEdge&255)}});Object.defineProperty(R.prototype,"incidentEdge",{enumerable:false,configurable:true,get:function(){return this._incidentEdge}});Object.defineProperty(R.prototype,"incidentEdge",{enumerable:false,configurable:true,set:function(af){if(af===undefined){af=0}this._incidentEdge=af;this._m_id._key=(this._m_id._key&4294902015)|((this._incidentEdge<<8)&65280)}});Object.defineProperty(R.prototype,"incidentVertex",{enumerable:false,configurable:true,get:function(){return this._incidentVertex}});Object.defineProperty(R.prototype,"incidentVertex",{enumerable:false,configurable:true,set:function(af){if(af===undefined){af=0}this._incidentVertex=af;this._m_id._key=(this._m_id._key&4278255615)|((this._incidentVertex<<16)&16711680)}});Object.defineProperty(R.prototype,"flip",{enumerable:false,configurable:true,get:function(){return this._flip}});Object.defineProperty(R.prototype,"flip",{enumerable:false,configurable:true,set:function(af){if(af===undefined){af=0}this._flip=af;this._m_id._key=(this._m_id._key&16777215)|((this._flip<<24)&4278190080)}})})();(function(){var E=Box2D.Common.b2Color,Y=Box2D.Common.b2internal,e=Box2D.Common.b2Settings,Q=Box2D.Collision.Shapes.b2CircleShape,am=Box2D.Collision.Shapes.b2EdgeChainDef,ar=Box2D.Collision.Shapes.b2EdgeShape,W=Box2D.Collision.Shapes.b2MassData,C=Box2D.Collision.Shapes.b2PolygonShape,r=Box2D.Collision.Shapes.b2Shape,N=Box2D.Common.Math.b2Mat22,q=Box2D.Common.Math.b2Mat33,B=Box2D.Common.Math.b2Math,F=Box2D.Common.Math.b2Sweep,g=Box2D.Common.Math.b2Transform,ac=Box2D.Common.Math.b2Vec2,aa=Box2D.Common.Math.b2Vec3,u=Box2D.Dynamics.b2Body,M=Box2D.Dynamics.b2BodyDef,aj=Box2D.Dynamics.b2ContactFilter,L=Box2D.Dynamics.b2ContactImpulse,S=Box2D.Dynamics.b2ContactListener,X=Box2D.Dynamics.b2ContactManager,z=Box2D.Dynamics.b2DebugDraw,j=Box2D.Dynamics.b2DestructionListener,H=Box2D.Dynamics.b2FilterData,at=Box2D.Dynamics.b2Fixture,D=Box2D.Dynamics.b2FixtureDef,n=Box2D.Dynamics.b2Island,V=Box2D.Dynamics.b2TimeStep,A=Box2D.Dynamics.b2World,al=Box2D.Collision.b2AABB,d=Box2D.Collision.b2Bound,Z=Box2D.Collision.b2BoundValues,G=Box2D.Collision.b2Collision,af=Box2D.Collision.b2ContactID,J=Box2D.Collision.b2ContactPoint,R=Box2D.Collision.b2Distance,f=Box2D.Collision.b2DistanceInput,U=Box2D.Collision.b2DistanceOutput,ap=Box2D.Collision.b2DistanceProxy,P=Box2D.Collision.b2DynamicTree,ah=Box2D.Collision.b2DynamicTreeBroadPhase,aq=Box2D.Collision.b2DynamicTreeNode,T=Box2D.Collision.b2DynamicTreePair,ae=Box2D.Collision.b2Manifold,ao=Box2D.Collision.b2ManifoldPoint,I=Box2D.Collision.b2Point,y=Box2D.Collision.b2RayCastInput,O=Box2D.Collision.b2RayCastOutput,ag=Box2D.Collision.b2Segment,ak=Box2D.Collision.b2SeparationFunction,K=Box2D.Collision.b2Simplex,m=Box2D.Collision.b2SimplexCache,k=Box2D.Collision.b2SimplexVertex,ai=Box2D.Collision.b2TimeOfImpact,an=Box2D.Collision.b2TOIInput,b=Box2D.Collision.b2WorldManifold,v=Box2D.Collision.ClipVertex,ad=Box2D.Collision.Features,ab=Box2D.Collision.IBroadPhase;Box2D.inherit(Q,Box2D.Collision.Shapes.b2Shape);Q.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype;Q.b2CircleShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments);this.m_p=new ac()};Q.prototype.Copy=function(){var au=new Q();au.Set(this);return au};Q.prototype.Set=function(au){this.__super.Set.call(this,au);if(Box2D.is(au,Q)){var av=(au instanceof Q?au:null);this.m_p.SetV(av.m_p)}};Q.prototype.TestPoint=function(aw,ay){var ax=aw.R;var av=aw.position.x+(ax.col1.x*this.m_p.x+ax.col2.x*this.m_p.y);var au=aw.position.y+(ax.col1.y*this.m_p.x+ax.col2.y*this.m_p.y);av=ay.x-av;au=ay.y-au;return(av*av+au*au)<=this.m_radius*this.m_radius};Q.prototype.RayCast=function(ax,aH,aw){var aE=aw.R;var aC=aw.position.x+(aE.col1.x*this.m_p.x+aE.col2.x*this.m_p.y);var aB=aw.position.y+(aE.col1.y*this.m_p.x+aE.col2.y*this.m_p.y);var av=aH.p1.x-aC;var au=aH.p1.y-aB;var aF=(av*av+au*au)-this.m_radius*this.m_radius;var aA=aH.p2.x-aH.p1.x;var az=aH.p2.y-aH.p1.y;var aD=(av*aA+au*az);var ay=(aA*aA+az*az);var aI=aD*aD-ay*aF;if(aI<0||ay<Number.MIN_VALUE){return false}var aG=(-(aD+Math.sqrt(aI)));if(0<=aG&&aG<=aH.maxFraction*ay){aG/=ay;ax.fraction=aG;ax.normal.x=av+aG*aA;ax.normal.y=au+aG*az;ax.normal.Normalize();return true}return false};Q.prototype.ComputeAABB=function(au,ax){var ay=ax.R;var aw=ax.position.x+(ay.col1.x*this.m_p.x+ay.col2.x*this.m_p.y);var av=ax.position.y+(ay.col1.y*this.m_p.x+ay.col2.y*this.m_p.y);au.lowerBound.Set(aw-this.m_radius,av-this.m_radius);au.upperBound.Set(aw+this.m_radius,av+this.m_radius)};Q.prototype.ComputeMass=function(av,au){if(au===undefined){au=0}av.mass=au*e.b2_pi*this.m_radius*this.m_radius;av.center.SetV(this.m_p);av.I=av.mass*(0.5*this.m_radius*this.m_radius+(this.m_p.x*this.m_p.x+this.m_p.y*this.m_p.y))};Q.prototype.ComputeSubmergedArea=function(aB,aA,aD,aC){if(aA===undefined){aA=0}var av=B.MulX(aD,this.m_p);var az=(-(B.Dot(aB,av)-aA));if(az<(-this.m_radius)+Number.MIN_VALUE){return 0}if(az>this.m_radius){aC.SetV(av);return Math.PI*this.m_radius*this.m_radius}var ax=this.m_radius*this.m_radius;var ay=az*az;var au=ax*(Math.asin(az/this.m_radius)+Math.PI/2)+az*Math.sqrt(ax-ay);var aw=(-2/3*Math.pow(ax-ay,1.5)/au);aC.x=av.x+aB.x*aw;aC.y=av.y+aB.y*aw;return au};Q.prototype.GetLocalPosition=function(){return this.m_p};Q.prototype.SetLocalPosition=function(au){this.m_p.SetV(au)};Q.prototype.GetRadius=function(){return this.m_radius};Q.prototype.SetRadius=function(au){if(au===undefined){au=0}this.m_radius=au};Q.prototype.b2CircleShape=function(au){if(au===undefined){au=0}this.__super.b2Shape.call(this);this.m_type=r.e_circleShape;this.m_radius=au};am.b2EdgeChainDef=function(){};am.prototype.b2EdgeChainDef=function(){this.vertexCount=0;this.isALoop=true;this.vertices=[]};Box2D.inherit(ar,Box2D.Collision.Shapes.b2Shape);ar.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype;ar.b2EdgeShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments);this.s_supportVec=new ac();this.m_v1=new ac();this.m_v2=new ac();this.m_coreV1=new ac();this.m_coreV2=new ac();this.m_normal=new ac();this.m_direction=new ac();this.m_cornerDir1=new ac();this.m_cornerDir2=new ac()};ar.prototype.TestPoint=function(au,av){return false};ar.prototype.RayCast=function(ax,aG,aw){var aC;var aA=aG.p2.x-aG.p1.x;var ay=aG.p2.y-aG.p1.y;aC=aw.R;var aF=aw.position.x+(aC.col1.x*this.m_v1.x+aC.col2.x*this.m_v1.y);var aD=aw.position.y+(aC.col1.y*this.m_v1.x+aC.col2.y*this.m_v1.y);var aK=aw.position.y+(aC.col1.y*this.m_v2.x+aC.col2.y*this.m_v2.y)-aD;var aI=(-(aw.position.x+(aC.col1.x*this.m_v2.x+aC.col2.x*this.m_v2.y)-aF));var aB=100*Number.MIN_VALUE;var az=(-(aA*aK+ay*aI));if(az>aB){var av=aG.p1.x-aF;var au=aG.p1.y-aD;var aE=(av*aK+au*aI);if(0<=aE&&aE<=aG.maxFraction*az){var aH=(-aA*au)+ay*av;if((-aB*az)<=aH&&aH<=az*(1+aB)){aE/=az;ax.fraction=aE;var aJ=Math.sqrt(aK*aK+aI*aI);ax.normal.x=aK/aJ;ax.normal.y=aI/aJ;return true}}}return false};ar.prototype.ComputeAABB=function(aw,ax){var ay=ax.R;var aA=ax.position.x+(ay.col1.x*this.m_v1.x+ay.col2.x*this.m_v1.y);var az=ax.position.y+(ay.col1.y*this.m_v1.x+ay.col2.y*this.m_v1.y);var av=ax.position.x+(ay.col1.x*this.m_v2.x+ay.col2.x*this.m_v2.y);var au=ax.position.y+(ay.col1.y*this.m_v2.x+ay.col2.y*this.m_v2.y);if(aA<av){aw.lowerBound.x=aA;aw.upperBound.x=av}else{aw.lowerBound.x=av;aw.upperBound.x=aA}if(az<au){aw.lowerBound.y=az;aw.upperBound.y=au}else{aw.lowerBound.y=au;aw.upperBound.y=az}};ar.prototype.ComputeMass=function(av,au){if(au===undefined){au=0}av.mass=0;av.center.SetV(this.m_v1);av.I=0};ar.prototype.ComputeSubmergedArea=function(ax,aw,aB,ay){if(aw===undefined){aw=0}var aC=new ac(ax.x*aw,ax.y*aw);var aA=B.MulX(aB,this.m_v1);var az=B.MulX(aB,this.m_v2);var av=B.Dot(ax,aA)-aw;var au=B.Dot(ax,az)-aw;if(av>0){if(au>0){return 0}else{aA.x=(-au/(av-au)*aA.x)+av/(av-au)*az.x;aA.y=(-au/(av-au)*aA.y)+av/(av-au)*az.y}}else{if(au>0){az.x=(-au/(av-au)*aA.x)+av/(av-au)*az.x;az.y=(-au/(av-au)*aA.y)+av/(av-au)*az.y}else{}}ay.x=(aC.x+aA.x+az.x)/3;ay.y=(aC.y+aA.y+az.y)/3;return 0.5*((aA.x-aC.x)*(az.y-aC.y)-(aA.y-aC.y)*(az.x-aC.x))};ar.prototype.GetLength=function(){return this.m_length};ar.prototype.GetVertex1=function(){return this.m_v1};ar.prototype.GetVertex2=function(){return this.m_v2};ar.prototype.GetCoreVertex1=function(){return this.m_coreV1};ar.prototype.GetCoreVertex2=function(){return this.m_coreV2};ar.prototype.GetNormalVector=function(){return this.m_normal};ar.prototype.GetDirectionVector=function(){return this.m_direction};ar.prototype.GetCorner1Vector=function(){return this.m_cornerDir1};ar.prototype.GetCorner2Vector=function(){return this.m_cornerDir2};ar.prototype.Corner1IsConvex=function(){return this.m_cornerConvex1};ar.prototype.Corner2IsConvex=function(){return this.m_cornerConvex2};ar.prototype.GetFirstVertex=function(av){var au=av.R;return new ac(av.position.x+(au.col1.x*this.m_coreV1.x+au.col2.x*this.m_coreV1.y),av.position.y+(au.col1.y*this.m_coreV1.x+au.col2.y*this.m_coreV1.y))};ar.prototype.GetNextEdge=function(){return this.m_nextEdge};ar.prototype.GetPrevEdge=function(){return this.m_prevEdge};ar.prototype.Support=function(az,ax,av){if(ax===undefined){ax=0}if(av===undefined){av=0}var ay=az.R;var aB=az.position.x+(ay.col1.x*this.m_coreV1.x+ay.col2.x*this.m_coreV1.y);var aA=az.position.y+(ay.col1.y*this.m_coreV1.x+ay.col2.y*this.m_coreV1.y);var aw=az.position.x+(ay.col1.x*this.m_coreV2.x+ay.col2.x*this.m_coreV2.y);var au=az.position.y+(ay.col1.y*this.m_coreV2.x+ay.col2.y*this.m_coreV2.y);if((aB*ax+aA*av)>(aw*ax+au*av)){this.s_supportVec.x=aB;this.s_supportVec.y=aA}else{this.s_supportVec.x=aw;this.s_supportVec.y=au}return this.s_supportVec};ar.prototype.b2EdgeShape=function(av,au){this.__super.b2Shape.call(this);this.m_type=r.e_edgeShape;this.m_prevEdge=null;this.m_nextEdge=null;this.m_v1=av;this.m_v2=au;this.m_direction.Set(this.m_v2.x-this.m_v1.x,this.m_v2.y-this.m_v1.y);this.m_length=this.m_direction.Normalize();this.m_normal.Set(this.m_direction.y,(-this.m_direction.x));this.m_coreV1.Set((-e.b2_toiSlop*(this.m_normal.x-this.m_direction.x))+this.m_v1.x,(-e.b2_toiSlop*(this.m_normal.y-this.m_direction.y))+this.m_v1.y);this.m_coreV2.Set((-e.b2_toiSlop*(this.m_normal.x+this.m_direction.x))+this.m_v2.x,(-e.b2_toiSlop*(this.m_normal.y+this.m_direction.y))+this.m_v2.y);this.m_cornerDir1=this.m_normal;this.m_cornerDir2.Set((-this.m_normal.x),(-this.m_normal.y))};ar.prototype.SetPrevEdge=function(ax,au,aw,av){this.m_prevEdge=ax;this.m_coreV1=au;this.m_cornerDir1=aw;this.m_cornerConvex1=av};ar.prototype.SetNextEdge=function(ax,au,aw,av){this.m_nextEdge=ax;this.m_coreV2=au;this.m_cornerDir2=aw;this.m_cornerConvex2=av};W.b2MassData=function(){this.mass=0;this.center=new ac(0,0);this.I=0};Box2D.inherit(C,Box2D.Collision.Shapes.b2Shape);C.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype;C.b2PolygonShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments)};C.prototype.Copy=function(){var au=new C();au.Set(this);return au};C.prototype.Set=function(au){this.__super.Set.call(this,au);if(Box2D.is(au,C)){var aw=(au instanceof C?au:null);this.m_centroid.SetV(aw.m_centroid);this.m_vertexCount=aw.m_vertexCount;this.Reserve(this.m_vertexCount);for(var av=0;av<this.m_vertexCount;av++){this.m_vertices[av].SetV(aw.m_vertices[av]);this.m_normals[av].SetV(aw.m_normals[av])}}};C.prototype.SetAsArray=function(av,ay){if(ay===undefined){ay=0}var au=new Vector();var ax=0,aw;for(ax=0;ax<av.length;++ax){aw=av[ax];au.push(aw)}this.SetAsVector(au,ay)};C.AsArray=function(av,aw){if(aw===undefined){aw=0}var au=new C();au.SetAsArray(av,aw);return au};C.prototype.SetAsVector=function(au,ax){if(ax===undefined){ax=0}if(ax==0){ax=au.length}e.b2Assert(2<=ax);this.m_vertexCount=ax;this.Reserve(ax);var av=0;for(av=0;av<this.m_vertexCount;av++){this.m_vertices[av].SetV(au[av])}for(av=0;av<this.m_vertexCount;++av){var az=parseInt(av);var aw=parseInt(av+1<this.m_vertexCount?av+1:0);var ay=B.SubtractVV(this.m_vertices[aw],this.m_vertices[az]);e.b2Assert(ay.LengthSquared()>Number.MIN_VALUE);this.m_normals[av].SetV(B.CrossVF(ay,1));this.m_normals[av].Normalize()}this.m_centroid=C.ComputeCentroid(this.m_vertices,this.m_vertexCount)};C.AsVector=function(av,aw){if(aw===undefined){aw=0}var au=new C();au.SetAsVector(av,aw);return au};C.prototype.SetAsBox=function(av,au){if(av===undefined){av=0}if(au===undefined){au=0}this.m_vertexCount=4;this.Reserve(4);this.m_vertices[0].Set((-av),(-au));this.m_vertices[1].Set(av,(-au));this.m_vertices[2].Set(av,au);this.m_vertices[3].Set((-av),au);this.m_normals[0].Set(0,(-1));this.m_normals[1].Set(1,0);this.m_normals[2].Set(0,1);this.m_normals[3].Set((-1),0);this.m_centroid.SetZero()};C.AsBox=function(aw,av){if(aw===undefined){aw=0}if(av===undefined){av=0}var au=new C();au.SetAsBox(aw,av);return au};C.prototype.SetAsOrientedBox=function(az,ay,au,ax){if(az===undefined){az=0}if(ay===undefined){ay=0}if(au===undefined){au=null}if(ax===undefined){ax=0}this.m_vertexCount=4;this.Reserve(4);this.m_vertices[0].Set((-az),(-ay));this.m_vertices[1].Set(az,(-ay));this.m_vertices[2].Set(az,ay);this.m_vertices[3].Set((-az),ay);this.m_normals[0].Set(0,(-1));this.m_normals[1].Set(1,0);this.m_normals[2].Set(0,1);this.m_normals[3].Set((-1),0);this.m_centroid=au;var aw=new g();aw.position=au;aw.R.Set(ax);for(var av=0;av<this.m_vertexCount;++av){this.m_vertices[av]=B.MulX(aw,this.m_vertices[av]);this.m_normals[av]=B.MulMV(aw.R,this.m_normals[av])}};C.AsOrientedBox=function(ay,ax,av,aw){if(ay===undefined){ay=0}if(ax===undefined){ax=0}if(av===undefined){av=null}if(aw===undefined){aw=0}var au=new C();au.SetAsOrientedBox(ay,ax,av,aw);return au};C.prototype.SetAsEdge=function(av,au){this.m_vertexCount=2;this.Reserve(2);this.m_vertices[0].SetV(av);this.m_vertices[1].SetV(au);this.m_centroid.x=0.5*(av.x+au.x);this.m_centroid.y=0.5*(av.y+au.y);this.m_normals[0]=B.CrossVF(B.SubtractVV(au,av),1);this.m_normals[0].Normalize();this.m_normals[1].x=(-this.m_normals[0].x);this.m_normals[1].y=(-this.m_normals[0].y)};C.AsEdge=function(aw,av){var au=new C();au.SetAsEdge(aw,av);return au};C.prototype.TestPoint=function(aB,av){var aD;var az=aB.R;var aC=av.x-aB.position.x;var aA=av.y-aB.position.y;var ax=(aC*az.col1.x+aA*az.col1.y);var aw=(aC*az.col2.x+aA*az.col2.y);for(var ay=0;ay<this.m_vertexCount;++ay){aD=this.m_vertices[ay];aC=ax-aD.x;aA=aw-aD.y;aD=this.m_normals[ay];var au=(aD.x*aC+aD.y*aA);if(au>0){return false}}return true};C.prototype.RayCast=function(aB,aD,aE){var aL=0;var aK=aD.maxFraction;var aG=0;var aF=0;var aC;var ax;aG=aD.p1.x-aE.position.x;aF=aD.p1.y-aE.position.y;aC=aE.R;var aI=(aG*aC.col1.x+aF*aC.col1.y);var aH=(aG*aC.col2.x+aF*aC.col2.y);aG=aD.p2.x-aE.position.x;aF=aD.p2.y-aE.position.y;aC=aE.R;var aw=(aG*aC.col1.x+aF*aC.col1.y);var av=(aG*aC.col2.x+aF*aC.col2.y);var az=aw-aI;var ay=av-aH;var aA=parseInt((-1));for(var aJ=0;aJ<this.m_vertexCount;++aJ){ax=this.m_vertices[aJ];aG=ax.x-aI;aF=ax.y-aH;ax=this.m_normals[aJ];var aM=(ax.x*aG+ax.y*aF);var au=(ax.x*az+ax.y*ay);if(au==0){if(aM<0){return false}}else{if(au<0&&aM<aL*au){aL=aM/au;aA=aJ}else{if(au>0&&aM<aK*au){aK=aM/au}}}if(aK<aL-Number.MIN_VALUE){return false}}if(aA>=0){aB.fraction=aL;aC=aE.R;ax=this.m_normals[aA];aB.normal.x=(aC.col1.x*ax.x+aC.col2.x*ax.y);aB.normal.y=(aC.col1.y*ax.x+aC.col2.y*ax.y);return true}return false};C.prototype.ComputeAABB=function(az,aB){var aA=aB.R;var aE=this.m_vertices[0];var aD=aB.position.x+(aA.col1.x*aE.x+aA.col2.x*aE.y);var aC=aB.position.y+(aA.col1.y*aE.x+aA.col2.y*aE.y);var ax=aD;var aw=aC;for(var ay=1;ay<this.m_vertexCount;++ay){aE=this.m_vertices[ay];var av=aB.position.x+(aA.col1.x*aE.x+aA.col2.x*aE.y);var au=aB.position.y+(aA.col1.y*aE.x+aA.col2.y*aE.y);aD=aD<av?aD:av;aC=aC<au?aC:au;ax=ax>av?ax:av;aw=aw>au?aw:au}az.lowerBound.x=aD-this.m_radius;az.lowerBound.y=aC-this.m_radius;az.upperBound.x=ax+this.m_radius;az.upperBound.y=aw+this.m_radius};C.prototype.ComputeMass=function(aF,aC){if(aC===undefined){aC=0}if(this.m_vertexCount==2){aF.center.x=0.5*(this.m_vertices[0].x+this.m_vertices[1].x);aF.center.y=0.5*(this.m_vertices[0].y+this.m_vertices[1].y);aF.mass=0;aF.I=0;return}var aD=0;var aB=0;var aR=0;var aE=0;var aP=0;var aO=0;var aA=1/3;for(var aQ=0;aQ<this.m_vertexCount;++aQ){var ax=this.m_vertices[aQ];var aw=aQ+1<this.m_vertexCount?this.m_vertices[parseInt(aQ+1)]:this.m_vertices[0];var aN=ax.x-aP;var aL=ax.y-aO;var av=aw.x-aP;var aT=aw.y-aO;var aI=aN*aT-aL*av;var az=0.5*aI;aR+=az;aD+=az*aA*(aP+ax.x+aw.x);aB+=az*aA*(aO+ax.y+aw.y);var aJ=aP;var aH=aO;var aM=aN;var au=aL;var aK=av;var aS=aT;var ay=aA*(0.25*(aM*aM+aK*aM+aK*aK)+(aJ*aM+aJ*aK))+0.5*aJ*aJ;var aG=aA*(0.25*(au*au+aS*au+aS*aS)+(aH*au+aH*aS))+0.5*aH*aH;aE+=aI*(ay+aG)}aF.mass=aC*aR;aD*=1/aR;aB*=1/aR;aF.center.Set(aD,aB);aF.I=aC*aE};C.prototype.ComputeSubmergedArea=function(aR,aE,aK,aO){if(aE===undefined){aE=0}var aI=B.MulTMV(aK.R,aR);var ax=aE-B.Dot(aR,aK.position);var aG=new Vector_a2j_Number();var aF=0;var ay=parseInt((-1));var av=parseInt((-1));var aD=false;var aM=0;for(aM=0;aM<this.m_vertexCount;++aM){aG[aM]=B.Dot(aI,this.m_vertices[aM])-ax;var aA=aG[aM]<(-Number.MIN_VALUE);if(aM>0){if(aA){if(!aD){ay=aM-1;aF++}}else{if(aD){av=aM-1;aF++}}}aD=aA}switch(aF){case 0:if(aD){var aQ=new W();this.ComputeMass(aQ,1);aO.SetV(B.MulX(aK,aQ.center));return aQ.mass}else{return 0}break;case 1:if(ay==(-1)){ay=this.m_vertexCount-1}else{av=this.m_vertexCount-1}break}var aH=parseInt((ay+1)%this.m_vertexCount);var aJ=parseInt((av+1)%this.m_vertexCount);var aL=(0-aG[ay])/(aG[aH]-aG[ay]);var aS=(0-aG[av])/(aG[aJ]-aG[av]);var aB=new ac(this.m_vertices[ay].x*(1-aL)+this.m_vertices[aH].x*aL,this.m_vertices[ay].y*(1-aL)+this.m_vertices[aH].y*aL);var az=new ac(this.m_vertices[av].x*(1-aS)+this.m_vertices[aJ].x*aS,this.m_vertices[av].y*(1-aS)+this.m_vertices[aJ].y*aS);var aN=0;var aP=new ac();var aw=this.m_vertices[aH];var au;aM=aH;while(aM!=aJ){aM=(aM+1)%this.m_vertexCount;if(aM==aJ){au=az}else{au=this.m_vertices[aM]}var aC=0.5*((aw.x-aB.x)*(au.y-aB.y)-(aw.y-aB.y)*(au.x-aB.x));aN+=aC;aP.x+=aC*(aB.x+aw.x+au.x)/3;aP.y+=aC*(aB.y+aw.y+au.y)/3;aw=au}aP.Multiply(1/aN);aO.SetV(B.MulX(aK,aP));return aN};C.prototype.GetVertexCount=function(){return this.m_vertexCount};C.prototype.GetVertices=function(){return this.m_vertices};C.prototype.GetNormals=function(){return this.m_normals};C.prototype.GetSupport=function(ay){var av=0;var ax=this.m_vertices[0].x*ay.x+this.m_vertices[0].y*ay.y;for(var au=1;au<this.m_vertexCount;++au){var aw=this.m_vertices[au].x*ay.x+this.m_vertices[au].y*ay.y;if(aw>ax){av=au;ax=aw}}return av};C.prototype.GetSupportVertex=function(ay){var av=0;var ax=this.m_vertices[0].x*ay.x+this.m_vertices[0].y*ay.y;for(var au=1;au<this.m_vertexCount;++au){var aw=this.m_vertices[au].x*ay.x+this.m_vertices[au].y*ay.y;if(aw>ax){av=au;ax=aw}}return this.m_vertices[av]};C.prototype.Validate=function(){return false};C.prototype.b2PolygonShape=function(){this.__super.b2Shape.call(this);this.m_type=r.e_polygonShape;this.m_centroid=new ac();this.m_vertices=new Vector();this.m_normals=new Vector()};C.prototype.Reserve=function(av){if(av===undefined){av=0}for(var au=parseInt(this.m_vertices.length);au<av;au++){this.m_vertices[au]=new ac();this.m_normals[au]=new ac()}};C.ComputeCentroid=function(aJ,aC){if(aC===undefined){aC=0}var aE=new ac();var ax=0;var aB=0;var aA=0;var ay=1/3;for(var az=0;az<aC;++az){var aI=aJ[az];var aG=az+1<aC?aJ[parseInt(az+1)]:aJ[0];var aw=aI.x-aB;var av=aI.y-aA;var aF=aG.x-aB;var aD=aG.y-aA;var au=(aw*aD-av*aF);var aH=0.5*au;ax+=aH;aE.x+=aH*ay*(aB+aI.x+aG.x);aE.y+=aH*ay*(aA+aI.y+aG.y)}aE.x*=1/ax;aE.y*=1/ax;return aE};C.ComputeOBB=function(aI,aL,aC){if(aC===undefined){aC=0}var aN=0;var aG=new Vector(aC+1);for(aN=0;aN<aC;++aN){aG[aN]=aL[aN]}aG[aC]=aG[0];var aB=Number.MAX_VALUE;for(aN=1;aN<=aC;++aN){var aK=aG[parseInt(aN-1)];var aJ=aG[aN].x-aK.x;var aH=aG[aN].y-aK.y;var ay=Math.sqrt(aJ*aJ+aH*aH);aJ/=ay;aH/=ay;var av=(-aH);var au=aJ;var aA=Number.MAX_VALUE;var az=Number.MAX_VALUE;var aS=(-Number.MAX_VALUE);var aR=(-Number.MAX_VALUE);for(var aM=0;aM<aC;++aM){var ax=aG[aM].x-aK.x;var aw=aG[aM].y-aK.y;var aQ=(aJ*ax+aH*aw);var aP=(av*ax+au*aw);if(aQ<aA){aA=aQ}if(aP<az){az=aP}if(aQ>aS){aS=aQ}if(aP>aR){aR=aP}}var aO=(aS-aA)*(aR-az);if(aO<0.95*aB){aB=aO;aI.R.col1.x=aJ;aI.R.col1.y=aH;aI.R.col2.x=av;aI.R.col2.y=au;var aE=0.5*(aA+aS);var aD=0.5*(az+aR);var aF=aI.R;aI.center.x=aK.x+(aF.col1.x*aE+aF.col2.x*aD);aI.center.y=aK.y+(aF.col1.y*aE+aF.col2.y*aD);aI.extents.x=0.5*(aS-aA);aI.extents.y=0.5*(aR-az)}}};Box2D.postDefs.push(function(){Box2D.Collision.Shapes.b2PolygonShape.s_mat=new N()});r.b2Shape=function(){};r.prototype.Copy=function(){return null};r.prototype.Set=function(au){this.m_radius=au.m_radius};r.prototype.GetType=function(){return this.m_type};r.prototype.TestPoint=function(au,av){return false};r.prototype.RayCast=function(av,au,aw){return false};r.prototype.ComputeAABB=function(au,av){};r.prototype.ComputeMass=function(av,au){if(au===undefined){au=0}};r.prototype.ComputeSubmergedArea=function(av,aw,au,ax){if(aw===undefined){aw=0}return 0};r.TestOverlap=function(av,aA,au,az){var ay=new f();ay.proxyA=new ap();ay.proxyA.Set(av);ay.proxyB=new ap();ay.proxyB.Set(au);ay.transformA=aA;ay.transformB=az;ay.useRadii=true;var ax=new m();ax.count=0;var aw=new U();R.Distance(aw,ax,ay);return aw.distance<10*Number.MIN_VALUE};r.prototype.b2Shape=function(){this.m_type=r.e_unknownShape;this.m_radius=e.b2_linearSlop};Box2D.postDefs.push(function(){Box2D.Collision.Shapes.b2Shape.e_unknownShape=parseInt((-1));Box2D.Collision.Shapes.b2Shape.e_circleShape=0;Box2D.Collision.Shapes.b2Shape.e_polygonShape=1;Box2D.Collision.Shapes.b2Shape.e_edgeShape=2;Box2D.Collision.Shapes.b2Shape.e_shapeTypeCount=3;Box2D.Collision.Shapes.b2Shape.e_hitCollide=1;Box2D.Collision.Shapes.b2Shape.e_missCollide=0;Box2D.Collision.Shapes.b2Shape.e_startsInsideCollide=parseInt((-1))})})();(function(){var k=Box2D.Common.b2Color,f=Box2D.Common.b2internal,q=Box2D.Common.b2Settings,b=Box2D.Common.Math.b2Mat22,m=Box2D.Common.Math.b2Mat33,n=Box2D.Common.Math.b2Math,e=Box2D.Common.Math.b2Sweep,d=Box2D.Common.Math.b2Transform,j=Box2D.Common.Math.b2Vec2,g=Box2D.Common.Math.b2Vec3;k.b2Color=function(){this._r=0;this._g=0;this._b=0};k.prototype.b2Color=function(u,r,v){if(u===undefined){u=0}if(r===undefined){r=0}if(v===undefined){v=0}this._r=Box2D.parseUInt(255*n.Clamp(u,0,1));this._g=Box2D.parseUInt(255*n.Clamp(r,0,1));this._b=Box2D.parseUInt(255*n.Clamp(v,0,1))};k.prototype.Set=function(u,r,v){if(u===undefined){u=0}if(r===undefined){r=0}if(v===undefined){v=0}this._r=Box2D.parseUInt(255*n.Clamp(u,0,1));this._g=Box2D.parseUInt(255*n.Clamp(r,0,1));this._b=Box2D.parseUInt(255*n.Clamp(v,0,1))};Object.defineProperty(k.prototype,"r",{enumerable:false,configurable:true,set:function(r){if(r===undefined){r=0}this._r=Box2D.parseUInt(255*n.Clamp(r,0,1))}});Object.defineProperty(k.prototype,"g",{enumerable:false,configurable:true,set:function(r){if(r===undefined){r=0}this._g=Box2D.parseUInt(255*n.Clamp(r,0,1))}});Object.defineProperty(k.prototype,"b",{enumerable:false,configurable:true,set:function(r){if(r===undefined){r=0}this._b=Box2D.parseUInt(255*n.Clamp(r,0,1))}});Object.defineProperty(k.prototype,"color",{enumerable:false,configurable:true,get:function(){return(this._r<<16)|(this._g<<8)|(this._b)}});q.b2Settings=function(){};q.b2MixFriction=function(u,r){if(u===undefined){u=0}if(r===undefined){r=0}return Math.sqrt(u*r)};q.b2MixRestitution=function(r,u){if(r===undefined){r=0}if(u===undefined){u=0}return r>u?r:u};q.b2Assert=function(r){if(!r){throw"Assertion Failed"}};Box2D.postDefs.push(function(){Box2D.Common.b2Settings.VERSION="2.1alpha";Box2D.Common.b2Settings.USHRT_MAX=65535;Box2D.Common.b2Settings.b2_pi=Math.PI;Box2D.Common.b2Settings.b2_maxManifoldPoints=2;Box2D.Common.b2Settings.b2_aabbExtension=0.1;Box2D.Common.b2Settings.b2_aabbMultiplier=2;Box2D.Common.b2Settings.b2_polygonRadius=2*q.b2_linearSlop;Box2D.Common.b2Settings.b2_linearSlop=0.005;Box2D.Common.b2Settings.b2_angularSlop=2/180*q.b2_pi;Box2D.Common.b2Settings.b2_toiSlop=8*q.b2_linearSlop;Box2D.Common.b2Settings.b2_maxTOIContactsPerIsland=32;Box2D.Common.b2Settings.b2_maxTOIJointsPerIsland=32;Box2D.Common.b2Settings.b2_velocityThreshold=1;Box2D.Common.b2Settings.b2_maxLinearCorrection=0.2;Box2D.Common.b2Settings.b2_maxAngularCorrection=8/180*q.b2_pi;Box2D.Common.b2Settings.b2_maxTranslation=2;Box2D.Common.b2Settings.b2_maxTranslationSquared=q.b2_maxTranslation*q.b2_maxTranslation;Box2D.Common.b2Settings.b2_maxRotation=0.5*q.b2_pi;Box2D.Common.b2Settings.b2_maxRotationSquared=q.b2_maxRotation*q.b2_maxRotation;Box2D.Common.b2Settings.b2_contactBaumgarte=0.2;Box2D.Common.b2Settings.b2_timeToSleep=0.5;Box2D.Common.b2Settings.b2_linearSleepTolerance=0.01;Box2D.Common.b2Settings.b2_angularSleepTolerance=2/180*q.b2_pi})})();(function(){var b=Box2D.Collision.b2AABB,m=Box2D.Common.b2Color,g=Box2D.Common.b2internal,r=Box2D.Common.b2Settings,e=Box2D.Common.Math.b2Mat22,n=Box2D.Common.Math.b2Mat33,q=Box2D.Common.Math.b2Math,f=Box2D.Common.Math.b2Sweep,d=Box2D.Common.Math.b2Transform,k=Box2D.Common.Math.b2Vec2,j=Box2D.Common.Math.b2Vec3;e.b2Mat22=function(){this.col1=new k();this.col2=new k()};e.prototype.b2Mat22=function(){this.SetIdentity()};e.FromAngle=function(v){if(v===undefined){v=0}var u=new e();u.Set(v);return u};e.FromVV=function(y,v){var u=new e();u.SetVV(y,v);return u};e.prototype.Set=function(v){if(v===undefined){v=0}var y=Math.cos(v);var u=Math.sin(v);this.col1.x=y;this.col2.x=(-u);this.col1.y=u;this.col2.y=y};e.prototype.SetVV=function(v,u){this.col1.SetV(v);this.col2.SetV(u)};e.prototype.Copy=function(){var u=new e();u.SetM(this);return u};e.prototype.SetM=function(u){this.col1.SetV(u.col1);this.col2.SetV(u.col2)};e.prototype.AddM=function(u){this.col1.x+=u.col1.x;this.col1.y+=u.col1.y;this.col2.x+=u.col2.x;this.col2.y+=u.col2.y};e.prototype.SetIdentity=function(){this.col1.x=1;this.col2.x=0;this.col1.y=0;this.col2.y=1};e.prototype.SetZero=function(){this.col1.x=0;this.col2.x=0;this.col1.y=0;this.col2.y=0};e.prototype.GetAngle=function(){return Math.atan2(this.col1.y,this.col1.x)};e.prototype.GetInverse=function(y){var v=this.col1.x;var u=this.col2.x;var B=this.col1.y;var A=this.col2.y;var z=v*A-u*B;if(z!=0){z=1/z}y.col1.x=z*A;y.col2.x=(-z*u);y.col1.y=(-z*B);y.col2.y=z*v;return y};e.prototype.Solve=function(A,D,C){if(D===undefined){D=0}if(C===undefined){C=0}var v=this.col1.x;var u=this.col2.x;var z=this.col1.y;var y=this.col2.y;var B=v*y-u*z;if(B!=0){B=1/B}A.x=B*(y*D-u*C);A.y=B*(v*C-z*D);return A};e.prototype.Abs=function(){this.col1.Abs();this.col2.Abs()};n.b2Mat33=function(){this.col1=new j();this.col2=new j();this.col3=new j()};n.prototype.b2Mat33=function(y,v,u){if(y===undefined){y=null}if(v===undefined){v=null}if(u===undefined){u=null}if(!y&&!v&&!u){this.col1.SetZero();this.col2.SetZero();this.col3.SetZero()}else{this.col1.SetV(y);this.col2.SetV(v);this.col3.SetV(u)}};n.prototype.SetVVV=function(y,v,u){this.col1.SetV(y);this.col2.SetV(v);this.col3.SetV(u)};n.prototype.Copy=function(){return new n(this.col1,this.col2,this.col3)};n.prototype.SetM=function(u){this.col1.SetV(u.col1);this.col2.SetV(u.col2);this.col3.SetV(u.col3)};n.prototype.AddM=function(u){this.col1.x+=u.col1.x;this.col1.y+=u.col1.y;this.col1.z+=u.col1.z;this.col2.x+=u.col2.x;this.col2.y+=u.col2.y;this.col2.z+=u.col2.z;this.col3.x+=u.col3.x;this.col3.y+=u.col3.y;this.col3.z+=u.col3.z};n.prototype.SetIdentity=function(){this.col1.x=1;this.col2.x=0;this.col3.x=0;this.col1.y=0;this.col2.y=1;this.col3.y=0;this.col1.z=0;this.col2.z=0;this.col3.z=1};n.prototype.SetZero=function(){this.col1.x=0;this.col2.x=0;this.col3.x=0;this.col1.y=0;this.col2.y=0;this.col3.y=0;this.col1.z=0;this.col2.z=0;this.col3.z=0};n.prototype.Solve22=function(A,D,C){if(D===undefined){D=0}if(C===undefined){C=0}var v=this.col1.x;var u=this.col2.x;var z=this.col1.y;var y=this.col2.y;var B=v*y-u*z;if(B!=0){B=1/B}A.x=B*(y*D-u*C);A.y=B*(v*C-z*D);return A};n.prototype.Solve33=function(B,v,u,J){if(v===undefined){v=0}if(u===undefined){u=0}if(J===undefined){J=0}var I=this.col1.x;var F=this.col1.y;var A=this.col1.z;var H=this.col2.x;var D=this.col2.y;var z=this.col2.z;var G=this.col3.x;var C=this.col3.y;var y=this.col3.z;var E=I*(D*y-z*C)+F*(z*G-H*y)+A*(H*C-D*G);if(E!=0){E=1/E}B.x=E*(v*(D*y-z*C)+u*(z*G-H*y)+J*(H*C-D*G));B.y=E*(I*(u*y-J*C)+F*(J*G-v*y)+A*(v*C-u*G));B.z=E*(I*(D*J-z*u)+F*(z*v-H*J)+A*(H*u-D*v));return B};q.b2Math=function(){};q.IsValid=function(u){if(u===undefined){u=0}return isFinite(u)};q.Dot=function(v,u){return v.x*u.x+v.y*u.y};q.CrossVV=function(v,u){return v.x*u.y-v.y*u.x};q.CrossVF=function(u,z){if(z===undefined){z=0}var y=new k(z*u.y,(-z*u.x));return y};q.CrossFV=function(z,u){if(z===undefined){z=0}var y=new k((-z*u.y),z*u.x);return y};q.MulMV=function(y,z){var B=new k(y.col1.x*z.x+y.col2.x*z.y,y.col1.y*z.x+y.col2.y*z.y);return B};q.MulTMV=function(y,z){var B=new k(q.Dot(z,y.col1),q.Dot(z,y.col2));return B};q.MulX=function(z,y){var u=q.MulMV(z.R,y);u.x+=z.position.x;u.y+=z.position.y;return u};q.MulXT=function(A,z){var y=q.SubtractVV(z,A.position);var u=(y.x*A.R.col1.x+y.y*A.R.col1.y);y.y=(y.x*A.R.col2.x+y.y*A.R.col2.y);y.x=u;return y};q.AddVV=function(y,u){var z=new k(y.x+u.x,y.y+u.y);return z};q.SubtractVV=function(y,u){var z=new k(y.x-u.x,y.y-u.y);return z};q.Distance=function(v,u){var z=v.x-u.x;var y=v.y-u.y;return Math.sqrt(z*z+y*y)};q.DistanceSquared=function(v,u){var z=v.x-u.x;var y=v.y-u.y;return(z*z+y*y)};q.MulFV=function(z,u){if(z===undefined){z=0}var y=new k(z*u.x,z*u.y);return y};q.AddMM=function(u,y){var v=e.FromVV(q.AddVV(u.col1,y.col1),q.AddVV(u.col2,y.col2));return v};q.MulMM=function(u,y){var v=e.FromVV(q.MulMV(u,y.col1),q.MulMV(u,y.col2));return v};q.MulTMM=function(u,D){var y=new k(q.Dot(u.col1,D.col1),q.Dot(u.col2,D.col1));var v=new k(q.Dot(u.col1,D.col2),q.Dot(u.col2,D.col2));var z=e.FromVV(y,v);return z};q.Abs=function(u){if(u===undefined){u=0}return u>0?u:(-u)};q.AbsV=function(v){var u=new k(q.Abs(v.x),q.Abs(v.y));return u};q.AbsM=function(u){var v=e.FromVV(q.AbsV(u.col1),q.AbsV(u.col2));return v};q.Min=function(v,u){if(v===undefined){v=0}if(u===undefined){u=0}return v<u?v:u};q.MinV=function(v,u){var y=new k(q.Min(v.x,u.x),q.Min(v.y,u.y));return y};q.Max=function(v,u){if(v===undefined){v=0}if(u===undefined){u=0}return v>u?v:u};q.MaxV=function(v,u){var y=new k(q.Max(v.x,u.x),q.Max(v.y,u.y));return y};q.Clamp=function(v,u,y){if(v===undefined){v=0}if(u===undefined){u=0}if(y===undefined){y=0}return v<u?u:v>y?y:v};q.ClampV=function(v,u,y){return q.MaxV(u,q.MinV(v,y))};q.Swap=function(v,u){var y=v[0];v[0]=u[0];u[0]=y};q.Random=function(){return Math.random()*2-1};q.RandomRange=function(v,u){if(v===undefined){v=0}if(u===undefined){u=0}var y=Math.random();y=(u-v)*y+v;return y};q.NextPowerOfTwo=function(u){if(u===undefined){u=0}u|=(u>>1)&2147483647;u|=(u>>2)&1073741823;u|=(u>>4)&268435455;u|=(u>>8)&16777215;u|=(u>>16)&65535;return u+1};q.IsPowerOfTwo=function(v){if(v===undefined){v=0}var u=v>0&&(v&(v-1))==0;return u};Box2D.postDefs.push(function(){Box2D.Common.Math.b2Math.b2Vec2_zero=new k(0,0);Box2D.Common.Math.b2Math.b2Mat22_identity=e.FromVV(new k(1,0),new k(0,1));Box2D.Common.Math.b2Math.b2Transform_identity=new d(q.b2Vec2_zero,q.b2Mat22_identity)});f.b2Sweep=function(){this.localCenter=new k();this.c0=new k;this.c=new k()};f.prototype.Set=function(u){this.localCenter.SetV(u.localCenter);this.c0.SetV(u.c0);this.c.SetV(u.c);this.a0=u.a0;this.a=u.a;this.t0=u.t0};f.prototype.Copy=function(){var u=new f();u.localCenter.SetV(this.localCenter);u.c0.SetV(this.c0);u.c.SetV(this.c);u.a0=this.a0;u.a=this.a;u.t0=this.t0;return u};f.prototype.GetTransform=function(v,y){if(y===undefined){y=0}v.position.x=(1-y)*this.c0.x+y*this.c.x;v.position.y=(1-y)*this.c0.y+y*this.c.y;var z=(1-y)*this.a0+y*this.a;v.R.Set(z);var u=v.R;v.position.x-=(u.col1.x*this.localCenter.x+u.col2.x*this.localCenter.y);v.position.y-=(u.col1.y*this.localCenter.x+u.col2.y*this.localCenter.y)};f.prototype.Advance=function(u){if(u===undefined){u=0}if(this.t0<u&&1-this.t0>Number.MIN_VALUE){var v=(u-this.t0)/(1-this.t0);this.c0.x=(1-v)*this.c0.x+v*this.c.x;this.c0.y=(1-v)*this.c0.y+v*this.c.y;this.a0=(1-v)*this.a0+v*this.a;this.t0=u}};d.b2Transform=function(){this.position=new k;this.R=new e()};d.prototype.b2Transform=function(v,u){if(v===undefined){v=null}if(u===undefined){u=null}if(v){this.position.SetV(v);this.R.SetM(u)}};d.prototype.Initialize=function(v,u){this.position.SetV(v);this.R.SetM(u)};d.prototype.SetIdentity=function(){this.position.SetZero();this.R.SetIdentity()};d.prototype.Set=function(u){this.position.SetV(u.position);this.R.SetM(u.R)};d.prototype.GetAngle=function(){return Math.atan2(this.R.col1.y,this.R.col1.x)};k.b2Vec2=function(){};k.prototype.b2Vec2=function(u,v){if(u===undefined){u=0}if(v===undefined){v=0}this.x=u;this.y=v};k.prototype.SetZero=function(){this.x=0;this.y=0};k.prototype.Set=function(u,v){if(u===undefined){u=0}if(v===undefined){v=0}this.x=u;this.y=v};k.prototype.SetV=function(u){this.x=u.x;this.y=u.y};k.prototype.GetNegative=function(){return new k((-this.x),(-this.y))};k.prototype.NegativeSelf=function(){this.x=(-this.x);this.y=(-this.y)};k.Make=function(u,v){if(u===undefined){u=0}if(v===undefined){v=0}return new k(u,v)};k.prototype.Copy=function(){return new k(this.x,this.y)};k.prototype.Add=function(u){this.x+=u.x;this.y+=u.y};k.prototype.Subtract=function(u){this.x-=u.x;this.y-=u.y};k.prototype.Multiply=function(u){if(u===undefined){u=0}this.x*=u;this.y*=u};k.prototype.MulM=function(v){var u=this.x;this.x=v.col1.x*u+v.col2.x*this.y;this.y=v.col1.y*u+v.col2.y*this.y};k.prototype.MulTM=function(v){var u=q.Dot(this,v.col1);this.y=q.Dot(this,v.col2);this.x=u};k.prototype.CrossVF=function(v){if(v===undefined){v=0}var u=this.x;this.x=v*this.y;this.y=(-v*u)};k.prototype.CrossFV=function(v){if(v===undefined){v=0}var u=this.x;this.x=(-v*this.y);this.y=v*u};k.prototype.MinV=function(u){this.x=this.x<u.x?this.x:u.x;this.y=this.y<u.y?this.y:u.y};k.prototype.MaxV=function(u){this.x=this.x>u.x?this.x:u.x;this.y=this.y>u.y?this.y:u.y};k.prototype.Abs=function(){if(this.x<0){this.x=(-this.x)}if(this.y<0){this.y=(-this.y)}};k.prototype.Length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};k.prototype.LengthSquared=function(){return(this.x*this.x+this.y*this.y)};k.prototype.Normalize=function(){var v=Math.sqrt(this.x*this.x+this.y*this.y);if(v<Number.MIN_VALUE){return 0}var u=1/v;this.x*=u;this.y*=u;return v};k.prototype.IsValid=function(){return q.IsValid(this.x)&&q.IsValid(this.y)};j.b2Vec3=function(){};j.prototype.b2Vec3=function(u,A,v){if(u===undefined){u=0}if(A===undefined){A=0}if(v===undefined){v=0}this.x=u;this.y=A;this.z=v};j.prototype.SetZero=function(){this.x=this.y=this.z=0};j.prototype.Set=function(u,A,v){if(u===undefined){u=0}if(A===undefined){A=0}if(v===undefined){v=0}this.x=u;this.y=A;this.z=v};j.prototype.SetV=function(u){this.x=u.x;this.y=u.y;this.z=u.z};j.prototype.GetNegative=function(){return new j((-this.x),(-this.y),(-this.z))};j.prototype.NegativeSelf=function(){this.x=(-this.x);this.y=(-this.y);this.z=(-this.z)};j.prototype.Copy=function(){return new j(this.x,this.y,this.z)};j.prototype.Add=function(u){this.x+=u.x;this.y+=u.y;this.z+=u.z};j.prototype.Subtract=function(u){this.x-=u.x;this.y-=u.y;this.z-=u.z};j.prototype.Multiply=function(u){if(u===undefined){u=0}this.x*=u;this.y*=u;this.z*=u}})();(function(){var am=Box2D.Dynamics.Controllers.b2ControllerEdge,Y=Box2D.Common.Math.b2Mat22,B=Box2D.Common.Math.b2Mat33,aj=Box2D.Common.Math.b2Math,aB=Box2D.Common.Math.b2Sweep,j=Box2D.Common.Math.b2Transform,aA=Box2D.Common.Math.b2Vec2,ay=Box2D.Common.Math.b2Vec3,aw=Box2D.Common.b2Color,aW=Box2D.Common.b2internal,I=Box2D.Common.b2Settings,ak=Box2D.Collision.b2AABB,aI=Box2D.Collision.b2Bound,aX=Box2D.Collision.b2BoundValues,M=Box2D.Collision.b2Collision,O=Box2D.Collision.b2ContactID,ap=Box2D.Collision.b2ContactPoint,aM=Box2D.Collision.b2Distance,k=Box2D.Collision.b2DistanceInput,y=Box2D.Collision.b2DistanceOutput,ab=Box2D.Collision.b2DistanceProxy,r=Box2D.Collision.b2DynamicTree,aU=Box2D.Collision.b2DynamicTreeBroadPhase,aH=Box2D.Collision.b2DynamicTreeNode,Z=Box2D.Collision.b2DynamicTreePair,aa=Box2D.Collision.b2Manifold,U=Box2D.Collision.b2ManifoldPoint,ad=Box2D.Collision.b2Point,ah=Box2D.Collision.b2RayCastInput,u=Box2D.Collision.b2RayCastOutput,m=Box2D.Collision.b2Segment,aK=Box2D.Collision.b2SeparationFunction,aS=Box2D.Collision.b2Simplex,K=Box2D.Collision.b2SimplexCache,a1=Box2D.Collision.b2SimplexVertex,az=Box2D.Collision.b2TimeOfImpact,aP=Box2D.Collision.b2TOIInput,aT=Box2D.Collision.b2WorldManifold,aN=Box2D.Collision.ClipVertex,ai=Box2D.Collision.Features,aG=Box2D.Collision.IBroadPhase,aY=Box2D.Collision.Shapes.b2CircleShape,f=Box2D.Collision.Shapes.b2EdgeChainDef,aR=Box2D.Collision.Shapes.b2EdgeShape,ao=Box2D.Collision.Shapes.b2MassData,aQ=Box2D.Collision.Shapes.b2PolygonShape,aC=Box2D.Collision.Shapes.b2Shape,Q=Box2D.Dynamics.b2Body,v=Box2D.Dynamics.b2BodyDef,at=Box2D.Dynamics.b2ContactFilter,aq=Box2D.Dynamics.b2ContactImpulse,H=Box2D.Dynamics.b2ContactListener,L=Box2D.Dynamics.b2ContactManager,W=Box2D.Dynamics.b2DebugDraw,N=Box2D.Dynamics.b2DestructionListener,aJ=Box2D.Dynamics.b2FilterData,aV=Box2D.Dynamics.b2Fixture,b=Box2D.Dynamics.b2FixtureDef,aZ=Box2D.Dynamics.b2Island,E=Box2D.Dynamics.b2TimeStep,C=Box2D.Dynamics.b2World,g=Box2D.Dynamics.Contacts.b2CircleContact,D=Box2D.Dynamics.Contacts.b2Contact,V=Box2D.Dynamics.Contacts.b2ContactConstraint,ac=Box2D.Dynamics.Contacts.b2ContactConstraintPoint,d=Box2D.Dynamics.Contacts.b2ContactEdge,aF=Box2D.Dynamics.Contacts.b2ContactFactory,q=Box2D.Dynamics.Contacts.b2ContactRegister,F=Box2D.Dynamics.Contacts.b2ContactResult,af=Box2D.Dynamics.Contacts.b2ContactSolver,a5=Box2D.Dynamics.Contacts.b2EdgeAndCircleContact,A=Box2D.Dynamics.Contacts.b2NullContact,aE=Box2D.Dynamics.Contacts.b2PolyAndCircleContact,J=Box2D.Dynamics.Contacts.b2PolyAndEdgeContact,ae=Box2D.Dynamics.Contacts.b2PolygonContact,aD=Box2D.Dynamics.Contacts.b2PositionSolverManifold,au=Box2D.Dynamics.Controllers.b2Controller,R=Box2D.Dynamics.Joints.b2DistanceJoint,aO=Box2D.Dynamics.Joints.b2DistanceJointDef,z=Box2D.Dynamics.Joints.b2FrictionJoint,a4=Box2D.Dynamics.Joints.b2FrictionJointDef,G=Box2D.Dynamics.Joints.b2GearJoint,T=Box2D.Dynamics.Joints.b2GearJointDef,a3=Box2D.Dynamics.Joints.b2Jacobian,an=Box2D.Dynamics.Joints.b2Joint,ax=Box2D.Dynamics.Joints.b2JointDef,av=Box2D.Dynamics.Joints.b2JointEdge,n=Box2D.Dynamics.Joints.b2LineJoint,aL=Box2D.Dynamics.Joints.b2LineJointDef,a2=Box2D.Dynamics.Joints.b2MouseJoint,S=Box2D.Dynamics.Joints.b2MouseJointDef,a0=Box2D.Dynamics.Joints.b2PrismaticJoint,al=Box2D.Dynamics.Joints.b2PrismaticJointDef,a6=Box2D.Dynamics.Joints.b2PulleyJoint,ag=Box2D.Dynamics.Joints.b2PulleyJointDef,e=Box2D.Dynamics.Joints.b2RevoluteJoint,P=Box2D.Dynamics.Joints.b2RevoluteJointDef,ar=Box2D.Dynamics.Joints.b2WeldJoint,X=Box2D.Dynamics.Joints.b2WeldJointDef;Q.b2Body=function(){this.m_xf=new j();this.m_sweep=new aB();this.m_linearVelocity=new aA();this.m_force=new aA()};Q.prototype.connectEdges=function(bb,ba,be){if(be===undefined){be=0}var bd=Math.atan2(ba.GetDirectionVector().y,ba.GetDirectionVector().x);var a8=Math.tan((bd-be)*0.5);var a7=aj.MulFV(a8,ba.GetDirectionVector());a7=aj.SubtractVV(a7,ba.GetNormalVector());a7=aj.MulFV(I.b2_toiSlop,a7);a7=aj.AddVV(a7,ba.GetVertex1());var bc=aj.AddVV(bb.GetDirectionVector(),ba.GetDirectionVector());bc.Normalize();var a9=aj.Dot(bb.GetDirectionVector(),ba.GetNormalVector())>0;bb.SetNextEdge(ba,a7,bc,a9);ba.SetPrevEdge(bb,a7,bc,a9);return bd};Q.prototype.CreateFixture=function(a9){if(this.m_world.IsLocked()==true){return null}var a8=new aV();a8.Create(this,this.m_xf,a9);if(this.m_flags&Q.e_activeFlag){var a7=this.m_world.m_contactManager.m_broadPhase;a8.CreateProxy(a7,this.m_xf)}a8.m_next=this.m_fixtureList;this.m_fixtureList=a8;++this.m_fixtureCount;a8.m_body=this;if(a8.m_density>0){this.ResetMassData()}this.m_world.m_flags|=C.e_newFixture;return a8};Q.prototype.CreateFixture2=function(a8,a7){if(a7===undefined){a7=0}var a9=new b();a9.shape=a8;a9.density=a7;return this.CreateFixture(a9)};Q.prototype.DestroyFixture=function(a8){if(this.m_world.IsLocked()==true){return}var a9=this.m_fixtureList;var ba=null;var bf=false;while(a9!=null){if(a9==a8){if(ba){ba.m_next=a8.m_next}else{this.m_fixtureList=a8.m_next}bf=true;break}ba=a9;a9=a9.m_next}var a7=this.m_contactList;while(a7){var be=a7.contact;a7=a7.next;var bd=be.GetFixtureA();var bc=be.GetFixtureB();if(a8==bd||a8==bc){this.m_world.m_contactManager.Destroy(be)}}if(this.m_flags&Q.e_activeFlag){var bb=this.m_world.m_contactManager.m_broadPhase;a8.DestroyProxy(bb)}else{}a8.Destroy();a8.m_body=null;a8.m_next=null;--this.m_fixtureCount;this.ResetMassData()};Q.prototype.SetPositionAndAngle=function(a8,bc){if(bc===undefined){bc=0}var bb;if(this.m_world.IsLocked()==true){return}this.m_xf.R.Set(bc);this.m_xf.position.SetV(a8);var ba=this.m_xf.R;var a9=this.m_sweep.localCenter;this.m_sweep.c.x=(ba.col1.x*a9.x+ba.col2.x*a9.y);this.m_sweep.c.y=(ba.col1.y*a9.x+ba.col2.y*a9.y);this.m_sweep.c.x+=this.m_xf.position.x;this.m_sweep.c.y+=this.m_xf.position.y;this.m_sweep.c0.SetV(this.m_sweep.c);this.m_sweep.a0=this.m_sweep.a=bc;var a7=this.m_world.m_contactManager.m_broadPhase;for(bb=this.m_fixtureList;bb;bb=bb.m_next){bb.Synchronize(a7,this.m_xf,this.m_xf)}this.m_world.m_contactManager.FindNewContacts()};Q.prototype.SetTransform=function(a7){this.SetPositionAndAngle(a7.position,a7.GetAngle())};Q.prototype.GetTransform=function(){return this.m_xf};Q.prototype.GetPosition=function(){return this.m_xf.position};Q.prototype.SetPosition=function(a7){this.SetPositionAndAngle(a7,this.GetAngle())};Q.prototype.GetAngle=function(){return this.m_sweep.a};Q.prototype.SetAngle=function(a7){if(a7===undefined){a7=0}this.SetPositionAndAngle(this.GetPosition(),a7)};Q.prototype.GetWorldCenter=function(){return this.m_sweep.c};Q.prototype.GetLocalCenter=function(){return this.m_sweep.localCenter};Q.prototype.SetLinearVelocity=function(a7){if(this.m_type==Q.b2_staticBody){return}this.m_linearVelocity.SetV(a7)};Q.prototype.GetLinearVelocity=function(){return this.m_linearVelocity};Q.prototype.SetAngularVelocity=function(a7){if(a7===undefined){a7=0}if(this.m_type==Q.b2_staticBody){return}this.m_angularVelocity=a7};Q.prototype.GetAngularVelocity=function(){return this.m_angularVelocity};Q.prototype.GetDefinition=function(){var a7=new v();a7.type=this.GetType();a7.allowSleep=(this.m_flags&Q.e_allowSleepFlag)==Q.e_allowSleepFlag;a7.angle=this.GetAngle();a7.angularDamping=this.m_angularDamping;a7.angularVelocity=this.m_angularVelocity;a7.fixedRotation=(this.m_flags&Q.e_fixedRotationFlag)==Q.e_fixedRotationFlag;a7.bullet=(this.m_flags&Q.e_bulletFlag)==Q.e_bulletFlag;a7.awake=(this.m_flags&Q.e_awakeFlag)==Q.e_awakeFlag;a7.linearDamping=this.m_linearDamping;a7.linearVelocity.SetV(this.GetLinearVelocity());a7.position=this.GetPosition();a7.userData=this.GetUserData();return a7};Q.prototype.ApplyForce=function(a8,a7){if(this.m_type!=Q.b2_dynamicBody){return}if(this.IsAwake()==false){this.SetAwake(true)}this.m_force.x+=a8.x;this.m_force.y+=a8.y;this.m_torque+=((a7.x-this.m_sweep.c.x)*a8.y-(a7.y-this.m_sweep.c.y)*a8.x)};Q.prototype.ApplyTorque=function(a7){if(a7===undefined){a7=0}if(this.m_type!=Q.b2_dynamicBody){return}if(this.IsAwake()==false){this.SetAwake(true)}this.m_torque+=a7};Q.prototype.ApplyImpulse=function(a8,a7){if(this.m_type!=Q.b2_dynamicBody){return}if(this.IsAwake()==false){this.SetAwake(true)}this.m_linearVelocity.x+=this.m_invMass*a8.x;this.m_linearVelocity.y+=this.m_invMass*a8.y;this.m_angularVelocity+=this.m_invI*((a7.x-this.m_sweep.c.x)*a8.y-(a7.y-this.m_sweep.c.y)*a8.x)};Q.prototype.Split=function(bi){var bh=this.GetLinearVelocity().Copy();var bb=this.GetAngularVelocity();var a9=this.GetWorldCenter();var a8=this;var bj=this.m_world.CreateBody(this.GetDefinition());var bc;for(var bg=a8.m_fixtureList;bg;){if(bi(bg)){var bf=bg.m_next;if(bc){bc.m_next=bf}else{a8.m_fixtureList=bf}a8.m_fixtureCount--;bg.m_next=bj.m_fixtureList;bj.m_fixtureList=bg;bj.m_fixtureCount++;bg.m_body=bj;bg=bf}else{bc=bg;bg=bg.m_next}}a8.ResetMassData();bj.ResetMassData();var ba=a8.GetWorldCenter();var a7=bj.GetWorldCenter();var be=aj.AddVV(bh,aj.CrossFV(bb,aj.SubtractVV(ba,a9)));var bd=aj.AddVV(bh,aj.CrossFV(bb,aj.SubtractVV(a7,a9)));a8.SetLinearVelocity(be);bj.SetLinearVelocity(bd);a8.SetAngularVelocity(bb);bj.SetAngularVelocity(bb);a8.SynchronizeFixtures();bj.SynchronizeFixtures();return bj};Q.prototype.Merge=function(be){var bd;for(bd=be.m_fixtureList;bd;){var bc=bd.m_next;be.m_fixtureCount--;bd.m_next=this.m_fixtureList;this.m_fixtureList=bd;this.m_fixtureCount++;bd.m_body=bh;bd=bc}a7.m_fixtureCount=0;var a7=this;var bh=be;var a9=a7.GetWorldCenter();var a8=bh.GetWorldCenter();var bb=a7.GetLinearVelocity().Copy();var ba=bh.GetLinearVelocity().Copy();var bg=a7.GetAngularVelocity();var bf=bh.GetAngularVelocity();a7.ResetMassData();this.SynchronizeFixtures()};Q.prototype.GetMass=function(){return this.m_mass};Q.prototype.GetInertia=function(){return this.m_I};Q.prototype.GetMassData=function(a7){a7.mass=this.m_mass;a7.I=this.m_I;a7.center.SetV(this.m_sweep.localCenter)};Q.prototype.SetMassData=function(a7){I.b2Assert(this.m_world.IsLocked()==false);if(this.m_world.IsLocked()==true){return}if(this.m_type!=Q.b2_dynamicBody){return}this.m_invMass=0;this.m_I=0;this.m_invI=0;this.m_mass=a7.mass;if(this.m_mass<=0){this.m_mass=1}this.m_invMass=1/this.m_mass;if(a7.I>0&&(this.m_flags&Q.e_fixedRotationFlag)==0){this.m_I=a7.I-this.m_mass*(a7.center.x*a7.center.x+a7.center.y*a7.center.y);this.m_invI=1/this.m_I}var a8=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(a7.center);this.m_sweep.c0.SetV(aj.MulX(this.m_xf,this.m_sweep.localCenter));this.m_sweep.c.SetV(this.m_sweep.c0);this.m_linearVelocity.x+=this.m_angularVelocity*(-(this.m_sweep.c.y-a8.y));this.m_linearVelocity.y+=this.m_angularVelocity*(+(this.m_sweep.c.x-a8.x))};Q.prototype.ResetMassData=function(){this.m_mass=0;this.m_invMass=0;this.m_I=0;this.m_invI=0;this.m_sweep.localCenter.SetZero();if(this.m_type==Q.b2_staticBody||this.m_type==Q.b2_kinematicBody){return}var a7=aA.Make(0,0);for(var a9=this.m_fixtureList;a9;a9=a9.m_next){if(a9.m_density==0){continue}var a8=a9.GetMassData();this.m_mass+=a8.mass;a7.x+=a8.center.x*a8.mass;a7.y+=a8.center.y*a8.mass;this.m_I+=a8.I}if(this.m_mass>0){this.m_invMass=1/this.m_mass;a7.x*=this.m_invMass;a7.y*=this.m_invMass}else{this.m_mass=1;this.m_invMass=1}if(this.m_I>0&&(this.m_flags&Q.e_fixedRotationFlag)==0){this.m_I-=this.m_mass*(a7.x*a7.x+a7.y*a7.y);this.m_I*=this.m_inertiaScale;I.b2Assert(this.m_I>0);this.m_invI=1/this.m_I}else{this.m_I=0;this.m_invI=0}var ba=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(a7);this.m_sweep.c0.SetV(aj.MulX(this.m_xf,this.m_sweep.localCenter));this.m_sweep.c.SetV(this.m_sweep.c0);this.m_linearVelocity.x+=this.m_angularVelocity*(-(this.m_sweep.c.y-ba.y));this.m_linearVelocity.y+=this.m_angularVelocity*(+(this.m_sweep.c.x-ba.x))};Q.prototype.GetWorldPoint=function(a9){var a7=this.m_xf.R;var a8=new aA(a7.col1.x*a9.x+a7.col2.x*a9.y,a7.col1.y*a9.x+a7.col2.y*a9.y);a8.x+=this.m_xf.position.x;a8.y+=this.m_xf.position.y;return a8};Q.prototype.GetWorldVector=function(a7){return aj.MulMV(this.m_xf.R,a7)};Q.prototype.GetLocalPoint=function(a7){return aj.MulXT(this.m_xf,a7)};Q.prototype.GetLocalVector=function(a7){return aj.MulTMV(this.m_xf.R,a7)};Q.prototype.GetLinearVelocityFromWorldPoint=function(a7){return new aA(this.m_linearVelocity.x-this.m_angularVelocity*(a7.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(a7.x-this.m_sweep.c.x))};Q.prototype.GetLinearVelocityFromLocalPoint=function(a9){var a7=this.m_xf.R;var a8=new aA(a7.col1.x*a9.x+a7.col2.x*a9.y,a7.col1.y*a9.x+a7.col2.y*a9.y);a8.x+=this.m_xf.position.x;a8.y+=this.m_xf.position.y;return new aA(this.m_linearVelocity.x-this.m_angularVelocity*(a8.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(a8.x-this.m_sweep.c.x))};Q.prototype.GetLinearDamping=function(){return this.m_linearDamping};Q.prototype.SetLinearDamping=function(a7){if(a7===undefined){a7=0}this.m_linearDamping=a7};Q.prototype.GetAngularDamping=function(){return this.m_angularDamping};Q.prototype.SetAngularDamping=function(a7){if(a7===undefined){a7=0}this.m_angularDamping=a7};Q.prototype.SetType=function(a7){if(a7===undefined){a7=0}if(this.m_type==a7){return}this.m_type=a7;this.ResetMassData();if(this.m_type==Q.b2_staticBody){this.m_linearVelocity.SetZero();this.m_angularVelocity=0}this.SetAwake(true);this.m_force.SetZero();this.m_torque=0;for(var a8=this.m_contactList;a8;a8=a8.next){a8.contact.FlagForFiltering()}};Q.prototype.GetType=function(){return this.m_type};Q.prototype.SetBullet=function(a7){if(a7){this.m_flags|=Q.e_bulletFlag}else{this.m_flags&=~Q.e_bulletFlag}};Q.prototype.IsBullet=function(){return(this.m_flags&Q.e_bulletFlag)==Q.e_bulletFlag};Q.prototype.SetSleepingAllowed=function(a7){if(a7){this.m_flags|=Q.e_allowSleepFlag}else{this.m_flags&=~Q.e_allowSleepFlag;this.SetAwake(true)}};Q.prototype.SetAwake=function(a7){if(a7){this.m_flags|=Q.e_awakeFlag;this.m_sleepTime=0}else{this.m_flags&=~Q.e_awakeFlag;this.m_sleepTime=0;this.m_linearVelocity.SetZero();this.m_angularVelocity=0;this.m_force.SetZero();this.m_torque=0}};Q.prototype.IsAwake=function(){return(this.m_flags&Q.e_awakeFlag)==Q.e_awakeFlag};Q.prototype.SetFixedRotation=function(a7){if(a7){this.m_flags|=Q.e_fixedRotationFlag}else{this.m_flags&=~Q.e_fixedRotationFlag}this.ResetMassData()};Q.prototype.IsFixedRotation=function(){return(this.m_flags&Q.e_fixedRotationFlag)==Q.e_fixedRotationFlag};Q.prototype.SetActive=function(a8){if(a8==this.IsActive()){return}var a7;var a9;if(a8){this.m_flags|=Q.e_activeFlag;a7=this.m_world.m_contactManager.m_broadPhase;for(a9=this.m_fixtureList;a9;a9=a9.m_next){a9.CreateProxy(a7,this.m_xf)}}else{this.m_flags&=~Q.e_activeFlag;a7=this.m_world.m_contactManager.m_broadPhase;for(a9=this.m_fixtureList;a9;a9=a9.m_next){a9.DestroyProxy(a7)}var ba=this.m_contactList;while(ba){var bb=ba;ba=ba.next;this.m_world.m_contactManager.Destroy(bb.contact)}this.m_contactList=null}};Q.prototype.IsActive=function(){return(this.m_flags&Q.e_activeFlag)==Q.e_activeFlag};Q.prototype.IsSleepingAllowed=function(){return(this.m_flags&Q.e_allowSleepFlag)==Q.e_allowSleepFlag};Q.prototype.GetFixtureList=function(){return this.m_fixtureList};Q.prototype.GetJointList=function(){return this.m_jointList};Q.prototype.GetControllerList=function(){return this.m_controllerList};Q.prototype.GetContactList=function(){return this.m_contactList};Q.prototype.GetNext=function(){return this.m_next};Q.prototype.GetUserData=function(){return this.m_userData};Q.prototype.SetUserData=function(a7){this.m_userData=a7};Q.prototype.GetWorld=function(){return this.m_world};Q.prototype.b2Body=function(ba,a9){this.m_flags=0;if(ba.bullet){this.m_flags|=Q.e_bulletFlag}if(ba.fixedRotation){this.m_flags|=Q.e_fixedRotationFlag}if(ba.allowSleep){this.m_flags|=Q.e_allowSleepFlag}if(ba.awake){this.m_flags|=Q.e_awakeFlag}if(ba.active){this.m_flags|=Q.e_activeFlag}this.m_world=a9;this.m_xf.position.SetV(ba.position);this.m_xf.R.Set(ba.angle);this.m_sweep.localCenter.SetZero();this.m_sweep.t0=1;this.m_sweep.a0=this.m_sweep.a=ba.angle;var a8=this.m_xf.R;var a7=this.m_sweep.localCenter;this.m_sweep.c.x=(a8.col1.x*a7.x+a8.col2.x*a7.y);this.m_sweep.c.y=(a8.col1.y*a7.x+a8.col2.y*a7.y);this.m_sweep.c.x+=this.m_xf.position.x;this.m_sweep.c.y+=this.m_xf.position.y;this.m_sweep.c0.SetV(this.m_sweep.c);this.m_jointList=null;this.m_controllerList=null;this.m_contactList=null;this.m_controllerCount=0;this.m_prev=null;this.m_next=null;this.m_linearVelocity.SetV(ba.linearVelocity);this.m_angularVelocity=ba.angularVelocity;this.m_linearDamping=ba.linearDamping;this.m_angularDamping=ba.angularDamping;this.m_force.Set(0,0);this.m_torque=0;this.m_sleepTime=0;this.m_type=ba.type;if(this.m_type==Q.b2_dynamicBody){this.m_mass=1;this.m_invMass=1}else{this.m_mass=0;this.m_invMass=0}this.m_I=0;this.m_invI=0;this.m_inertiaScale=ba.inertiaScale;this.m_userData=ba.userData;this.m_fixtureList=null;this.m_fixtureCount=0};Q.prototype.SynchronizeFixtures=function(){var ba=Q.s_xf1;ba.R.Set(this.m_sweep.a0);var a9=ba.R;var a8=this.m_sweep.localCenter;ba.position.x=this.m_sweep.c0.x-(a9.col1.x*a8.x+a9.col2.x*a8.y);ba.position.y=this.m_sweep.c0.y-(a9.col1.y*a8.x+a9.col2.y*a8.y);var bb;var a7=this.m_world.m_contactManager.m_broadPhase;for(bb=this.m_fixtureList;bb;bb=bb.m_next){bb.Synchronize(a7,ba,this.m_xf)}};Q.prototype.SynchronizeTransform=function(){this.m_xf.R.Set(this.m_sweep.a);var a8=this.m_xf.R;var a7=this.m_sweep.localCenter;this.m_xf.position.x=this.m_sweep.c.x-(a8.col1.x*a7.x+a8.col2.x*a7.y);this.m_xf.position.y=this.m_sweep.c.y-(a8.col1.y*a7.x+a8.col2.y*a7.y)};Q.prototype.ShouldCollide=function(a7){if(this.m_type!=Q.b2_dynamicBody&&a7.m_type!=Q.b2_dynamicBody){return false}for(var a8=this.m_jointList;a8;a8=a8.next){if(a8.other==a7){if(a8.joint.m_collideConnected==false){return false}}}return true};Q.prototype.Advance=function(a7){if(a7===undefined){a7=0}this.m_sweep.Advance(a7);this.m_sweep.c.SetV(this.m_sweep.c0);this.m_sweep.a=this.m_sweep.a0;this.SynchronizeTransform()};Box2D.postDefs.push(function(){Box2D.Dynamics.b2Body.s_xf1=new j();Box2D.Dynamics.b2Body.e_islandFlag=1;Box2D.Dynamics.b2Body.e_awakeFlag=2;Box2D.Dynamics.b2Body.e_allowSleepFlag=4;Box2D.Dynamics.b2Body.e_bulletFlag=8;Box2D.Dynamics.b2Body.e_fixedRotationFlag=16;Box2D.Dynamics.b2Body.e_activeFlag=32;Box2D.Dynamics.b2Body.b2_staticBody=0;Box2D.Dynamics.b2Body.b2_kinematicBody=1;Box2D.Dynamics.b2Body.b2_dynamicBody=2});v.b2BodyDef=function(){this.position=new aA();this.linearVelocity=new aA()};v.prototype.b2BodyDef=function(){this.userData=null;this.position.Set(0,0);this.angle=0;this.linearVelocity.Set(0,0);this.angularVelocity=0;this.linearDamping=0;this.angularDamping=0;this.allowSleep=true;this.awake=true;this.fixedRotation=false;this.bullet=false;this.type=Q.b2_staticBody;this.active=true;this.inertiaScale=1};at.b2ContactFilter=function(){};at.prototype.ShouldCollide=function(a7,bb){var a9=a7.GetFilterData();var a8=bb.GetFilterData();if(a9.groupIndex==a8.groupIndex&&a9.groupIndex!=0){return a9.groupIndex>0}var ba=(a9.maskBits&a8.categoryBits)!=0&&(a9.categoryBits&a8.maskBits)!=0;return ba};at.prototype.RayCollide=function(a7,a8){if(!a7){return true}return this.ShouldCollide((a7 instanceof aV?a7:null),a8)};Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactFilter.b2_defaultFilter=new at()});aq.b2ContactImpulse=function(){this.normalImpulses=new Vector_a2j_Number(I.b2_maxManifoldPoints);this.tangentImpulses=new Vector_a2j_Number(I.b2_maxManifoldPoints)};H.b2ContactListener=function(){};H.prototype.BeginContact=function(a7){};H.prototype.EndContact=function(a7){};H.prototype.PreSolve=function(a7,a8){};H.prototype.PostSolve=function(a7,a8){};Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactListener.b2_defaultListener=new H()});L.b2ContactManager=function(){};L.prototype.b2ContactManager=function(){this.m_world=null;this.m_contactCount=0;this.m_contactFilter=at.b2_defaultFilter;this.m_contactListener=H.b2_defaultListener;this.m_contactFactory=new aF(this.m_allocator);this.m_broadPhase=new aU()};L.prototype.AddPair=function(a9,a7){var bd=(a9 instanceof aV?a9:null);var bc=(a7 instanceof aV?a7:null);var bb=bd.GetBody();var ba=bc.GetBody();if(bb==ba){return}var a8=ba.GetContactList();while(a8){if(a8.other==bb){var bg=a8.contact.GetFixtureA();var be=a8.contact.GetFixtureB();if(bg==bd&&be==bc){return}if(bg==bc&&be==bd){return}}a8=a8.next}if(ba.ShouldCollide(bb)==false){return}if(this.m_contactFilter.ShouldCollide(bd,bc)==false){return}var bf=this.m_contactFactory.Create(bd,bc);bd=bf.GetFixtureA();bc=bf.GetFixtureB();bb=bd.m_body;ba=bc.m_body;bf.m_prev=null;bf.m_next=this.m_world.m_contactList;if(this.m_world.m_contactList!=null){this.m_world.m_contactList.m_prev=bf}this.m_world.m_contactList=bf;bf.m_nodeA.contact=bf;bf.m_nodeA.other=ba;bf.m_nodeA.prev=null;bf.m_nodeA.next=bb.m_contactList;if(bb.m_contactList!=null){bb.m_contactList.prev=bf.m_nodeA}bb.m_contactList=bf.m_nodeA;bf.m_nodeB.contact=bf;bf.m_nodeB.other=bb;bf.m_nodeB.prev=null;bf.m_nodeB.next=ba.m_contactList;if(ba.m_contactList!=null){ba.m_contactList.prev=bf.m_nodeB}ba.m_contactList=bf.m_nodeB;++this.m_world.m_contactCount;return};L.prototype.FindNewContacts=function(){this.m_broadPhase.UpdatePairs(Box2D.generateCallback(this,this.AddPair))};L.prototype.Destroy=function(bb){var a7=bb.GetFixtureA();var ba=bb.GetFixtureB();var a9=a7.GetBody();var a8=ba.GetBody();if(bb.IsTouching()){this.m_contactListener.EndContact(bb)}if(bb.m_prev){bb.m_prev.m_next=bb.m_next}if(bb.m_next){bb.m_next.m_prev=bb.m_prev}if(bb==this.m_world.m_contactList){this.m_world.m_contactList=bb.m_next}if(bb.m_nodeA.prev){bb.m_nodeA.prev.next=bb.m_nodeA.next}if(bb.m_nodeA.next){bb.m_nodeA.next.prev=bb.m_nodeA.prev}if(bb.m_nodeA==a9.m_contactList){a9.m_contactList=bb.m_nodeA.next}if(bb.m_nodeB.prev){bb.m_nodeB.prev.next=bb.m_nodeB.next}if(bb.m_nodeB.next){bb.m_nodeB.next.prev=bb.m_nodeB.prev}if(bb.m_nodeB==a8.m_contactList){a8.m_contactList=bb.m_nodeB.next}this.m_contactFactory.Destroy(bb);--this.m_contactCount};L.prototype.Collide=function(){var bd=this.m_world.m_contactList;while(bd){var bb=bd.GetFixtureA();var a9=bd.GetFixtureB();var a8=bb.GetBody();var a7=a9.GetBody();if(a8.IsAwake()==false&&a7.IsAwake()==false){bd=bd.GetNext();continue}if(bd.m_flags&D.e_filterFlag){if(a7.ShouldCollide(a8)==false){var bf=bd;bd=bf.GetNext();this.Destroy(bf);continue}if(this.m_contactFilter.ShouldCollide(bb,a9)==false){bf=bd;bd=bf.GetNext();this.Destroy(bf);continue}bd.m_flags&=~D.e_filterFlag}var bc=bb.m_proxy;var ba=a9.m_proxy;var be=this.m_broadPhase.TestOverlap(bc,ba);if(be==false){bf=bd;bd=bf.GetNext();this.Destroy(bf);continue}bd.Update(this.m_contactListener);bd=bd.GetNext()}};Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactManager.s_evalCP=new ap()});W.b2DebugDraw=function(){};W.prototype.b2DebugDraw=function(){};W.prototype.SetFlags=function(a7){if(a7===undefined){a7=0}};W.prototype.GetFlags=function(){};W.prototype.AppendFlags=function(a7){if(a7===undefined){a7=0}};W.prototype.ClearFlags=function(a7){if(a7===undefined){a7=0}};W.prototype.SetSprite=function(a7){};W.prototype.GetSprite=function(){};W.prototype.SetDrawScale=function(a7){if(a7===undefined){a7=0}};W.prototype.GetDrawScale=function(){};W.prototype.SetLineThickness=function(a7){if(a7===undefined){a7=0}};W.prototype.GetLineThickness=function(){};W.prototype.SetAlpha=function(a7){if(a7===undefined){a7=0}};W.prototype.GetAlpha=function(){};W.prototype.SetFillAlpha=function(a7){if(a7===undefined){a7=0}};W.prototype.GetFillAlpha=function(){};W.prototype.SetXFormScale=function(a7){if(a7===undefined){a7=0}};W.prototype.GetXFormScale=function(){};W.prototype.DrawPolygon=function(a8,a9,a7){if(a9===undefined){a9=0}};W.prototype.DrawSolidPolygon=function(a8,a9,a7){if(a9===undefined){a9=0}};W.prototype.DrawCircle=function(a8,a7,a9){if(a7===undefined){a7=0}};W.prototype.DrawSolidCircle=function(a8,a7,ba,a9){if(a7===undefined){a7=0}};W.prototype.DrawSegment=function(a9,a8,a7){};W.prototype.DrawTransform=function(a7){};Box2D.postDefs.push(function(){Box2D.Dynamics.b2DebugDraw.e_shapeBit=1;Box2D.Dynamics.b2DebugDraw.e_jointBit=2;Box2D.Dynamics.b2DebugDraw.e_aabbBit=4;Box2D.Dynamics.b2DebugDraw.e_pairBit=8;Box2D.Dynamics.b2DebugDraw.e_centerOfMassBit=16;Box2D.Dynamics.b2DebugDraw.e_controllerBit=32});N.b2DestructionListener=function(){};N.prototype.SayGoodbyeJoint=function(a7){};N.prototype.SayGoodbyeFixture=function(a7){};aJ.b2FilterData=function(){this.categoryBits=1;this.maskBits=65535;this.groupIndex=0};aJ.prototype.Copy=function(){var a7=new aJ();a7.categoryBits=this.categoryBits;a7.maskBits=this.maskBits;a7.groupIndex=this.groupIndex;return a7};aV.b2Fixture=function(){this.m_filter=new aJ()};aV.prototype.GetType=function(){return this.m_shape.GetType()};aV.prototype.GetShape=function(){return this.m_shape};aV.prototype.SetSensor=function(ba){if(this.m_isSensor==ba){return}this.m_isSensor=ba;if(this.m_body==null){return}var a9=this.m_body.GetContactList();while(a9){var a8=a9.contact;var a7=a8.GetFixtureA();var bb=a8.GetFixtureB();if(a7==this||bb==this){a8.SetSensor(a7.IsSensor()||bb.IsSensor())}a9=a9.next}};aV.prototype.IsSensor=function(){return this.m_isSensor};aV.prototype.SetFilterData=function(a9){this.m_filter=a9.Copy();if(this.m_body){return}var ba=this.m_body.GetContactList();while(ba){var a8=ba.contact;var a7=a8.GetFixtureA();var bb=a8.GetFixtureB();if(a7==this||bb==this){a8.FlagForFiltering()}ba=ba.next}};aV.prototype.GetFilterData=function(){return this.m_filter.Copy()};aV.prototype.GetBody=function(){return this.m_body};aV.prototype.GetNext=function(){return this.m_next};aV.prototype.GetUserData=function(){return this.m_userData};aV.prototype.SetUserData=function(a7){this.m_userData=a7};aV.prototype.TestPoint=function(a7){return this.m_shape.TestPoint(this.m_body.GetTransform(),a7)};aV.prototype.RayCast=function(a8,a7){return this.m_shape.RayCast(a8,a7,this.m_body.GetTransform())};aV.prototype.GetMassData=function(a7){if(a7===undefined){a7=null}if(a7==null){a7=new ao()}this.m_shape.ComputeMass(a7,this.m_density);return a7};aV.prototype.SetDensity=function(a7){if(a7===undefined){a7=0}this.m_density=a7};aV.prototype.GetDensity=function(){return this.m_density};aV.prototype.GetFriction=function(){return this.m_friction};aV.prototype.SetFriction=function(a7){if(a7===undefined){a7=0}this.m_friction=a7};aV.prototype.GetRestitution=function(){return this.m_restitution};aV.prototype.SetRestitution=function(a7){if(a7===undefined){a7=0}this.m_restitution=a7};aV.prototype.GetAABB=function(){return this.m_aabb};aV.prototype.b2Fixture=function(){this.m_aabb=new ak();this.m_userData=null;this.m_body=null;this.m_next=null;this.m_shape=null;this.m_density=0;this.m_friction=0;this.m_restitution=0};aV.prototype.Create=function(a7,a8,a9){this.m_userData=a9.userData;this.m_friction=a9.friction;this.m_restitution=a9.restitution;this.m_body=a7;this.m_next=null;this.m_filter=a9.filter.Copy();this.m_isSensor=a9.isSensor;this.m_shape=a9.shape.Copy();this.m_density=a9.density};aV.prototype.Destroy=function(){this.m_shape=null};aV.prototype.CreateProxy=function(a7,a8){this.m_shape.ComputeAABB(this.m_aabb,a8);this.m_proxy=a7.CreateProxy(this.m_aabb,this)};aV.prototype.DestroyProxy=function(a7){if(this.m_proxy==null){return}a7.DestroyProxy(this.m_proxy);this.m_proxy=null};aV.prototype.Synchronize=function(a8,bc,bb){if(!this.m_proxy){return}var a9=new ak();var a7=new ak();this.m_shape.ComputeAABB(a9,bc);this.m_shape.ComputeAABB(a7,bb);this.m_aabb.Combine(a9,a7);var ba=aj.SubtractVV(bb.position,bc.position);a8.MoveProxy(this.m_proxy,this.m_aabb,ba)};b.b2FixtureDef=function(){this.filter=new aJ()};b.prototype.b2FixtureDef=function(){this.shape=null;this.userData=null;this.friction=0.2;this.restitution=0;this.density=0;this.filter.categoryBits=1;this.filter.maskBits=65535;this.filter.groupIndex=0;this.isSensor=false};aZ.b2Island=function(){};aZ.prototype.b2Island=function(){this.m_bodies=new Vector();this.m_contacts=new Vector();this.m_joints=new Vector()};aZ.prototype.Initialize=function(bd,bb,ba,a8,bc,a7){if(bd===undefined){bd=0}if(bb===undefined){bb=0}if(ba===undefined){ba=0}var a9=0;this.m_bodyCapacity=bd;this.m_contactCapacity=bb;this.m_jointCapacity=ba;this.m_bodyCount=0;this.m_contactCount=0;this.m_jointCount=0;this.m_allocator=a8;this.m_listener=bc;this.m_contactSolver=a7;for(a9=this.m_bodies.length;a9<bd;a9++){this.m_bodies[a9]=null}for(a9=this.m_contacts.length;a9<bb;a9++){this.m_contacts[a9]=null}for(a9=this.m_joints.length;a9<ba;a9++){this.m_joints[a9]=null}};aZ.prototype.Clear=function(){this.m_bodyCount=0;this.m_contactCount=0;this.m_jointCount=0};aZ.prototype.Solve=function(a9,bn,bh){var be=0;var bd=0;var bk;var bc;for(be=0;be<this.m_bodyCount;++be){bk=this.m_bodies[be];if(bk.GetType()!=Q.b2_dynamicBody){continue}bk.m_linearVelocity.x+=a9.dt*(bn.x+bk.m_invMass*bk.m_force.x);bk.m_linearVelocity.y+=a9.dt*(bn.y+bk.m_invMass*bk.m_force.y);bk.m_angularVelocity+=a9.dt*bk.m_invI*bk.m_torque;bk.m_linearVelocity.Multiply(aj.Clamp(1-a9.dt*bk.m_linearDamping,0,1));bk.m_angularVelocity*=aj.Clamp(1-a9.dt*bk.m_angularDamping,0,1)}this.m_contactSolver.Initialize(a9,this.m_contacts,this.m_contactCount,this.m_allocator);var ba=this.m_contactSolver;ba.InitVelocityConstraints(a9);for(be=0;be<this.m_jointCount;++be){bc=this.m_joints[be];bc.InitVelocityConstraints(a9)}for(be=0;be<a9.velocityIterations;++be){for(bd=0;bd<this.m_jointCount;++bd){bc=this.m_joints[bd];bc.SolveVelocityConstraints(a9)}ba.SolveVelocityConstraints()}for(be=0;be<this.m_jointCount;++be){bc=this.m_joints[be];bc.FinalizeVelocityConstraints()}ba.FinalizeVelocityConstraints();for(be=0;be<this.m_bodyCount;++be){bk=this.m_bodies[be];if(bk.GetType()==Q.b2_staticBody){continue}var bi=a9.dt*bk.m_linearVelocity.x;var bg=a9.dt*bk.m_linearVelocity.y;if((bi*bi+bg*bg)>I.b2_maxTranslationSquared){bk.m_linearVelocity.Normalize();bk.m_linearVelocity.x*=I.b2_maxTranslation*a9.inv_dt;bk.m_linearVelocity.y*=I.b2_maxTranslation*a9.inv_dt}var bm=a9.dt*bk.m_angularVelocity;if(bm*bm>I.b2_maxRotationSquared){if(bk.m_angularVelocity<0){bk.m_angularVelocity=(-I.b2_maxRotation*a9.inv_dt)}else{bk.m_angularVelocity=I.b2_maxRotation*a9.inv_dt}}bk.m_sweep.c0.SetV(bk.m_sweep.c);bk.m_sweep.a0=bk.m_sweep.a;bk.m_sweep.c.x+=a9.dt*bk.m_linearVelocity.x;bk.m_sweep.c.y+=a9.dt*bk.m_linearVelocity.y;bk.m_sweep.a+=a9.dt*bk.m_angularVelocity;bk.SynchronizeTransform()}for(be=0;be<a9.positionIterations;++be){var bf=ba.SolvePositionConstraints(I.b2_contactBaumgarte);var bj=true;for(bd=0;bd<this.m_jointCount;++bd){bc=this.m_joints[bd];var a8=bc.SolvePositionConstraints(I.b2_contactBaumgarte);bj=bj&&a8}if(bf&&bj){break}}this.Report(ba.m_constraints);if(bh){var bb=Number.MAX_VALUE;var a7=I.b2_linearSleepTolerance*I.b2_linearSleepTolerance;var bl=I.b2_angularSleepTolerance*I.b2_angularSleepTolerance;for(be=0;be<this.m_bodyCount;++be){bk=this.m_bodies[be];if(bk.GetType()==Q.b2_staticBody){continue}if((bk.m_flags&Q.e_allowSleepFlag)==0){bk.m_sleepTime=0;bb=0}if((bk.m_flags&Q.e_allowSleepFlag)==0||bk.m_angularVelocity*bk.m_angularVelocity>bl||aj.Dot(bk.m_linearVelocity,bk.m_linearVelocity)>a7){bk.m_sleepTime=0;bb=0}else{bk.m_sleepTime+=a9.dt;bb=aj.Min(bb,bk.m_sleepTime)}}if(bb>=I.b2_timeToSleep){for(be=0;be<this.m_bodyCount;++be){bk=this.m_bodies[be];bk.SetAwake(false)}}}};aZ.prototype.SolveTOI=function(ba){var bb=0;var a9=0;this.m_contactSolver.Initialize(ba,this.m_contacts,this.m_contactCount,this.m_allocator);var a8=this.m_contactSolver;for(bb=0;bb<this.m_jointCount;++bb){this.m_joints[bb].InitVelocityConstraints(ba)}for(bb=0;bb<ba.velocityIterations;++bb){a8.SolveVelocityConstraints();for(a9=0;a9<this.m_jointCount;++a9){this.m_joints[a9].SolveVelocityConstraints(ba)}}for(bb=0;bb<this.m_bodyCount;++bb){var bg=this.m_bodies[bb];if(bg.GetType()==Q.b2_staticBody){continue}var be=ba.dt*bg.m_linearVelocity.x;var bd=ba.dt*bg.m_linearVelocity.y;if((be*be+bd*bd)>I.b2_maxTranslationSquared){bg.m_linearVelocity.Normalize();bg.m_linearVelocity.x*=I.b2_maxTranslation*ba.inv_dt;bg.m_linearVelocity.y*=I.b2_maxTranslation*ba.inv_dt}var bi=ba.dt*bg.m_angularVelocity;if(bi*bi>I.b2_maxRotationSquared){if(bg.m_angularVelocity<0){bg.m_angularVelocity=(-I.b2_maxRotation*ba.inv_dt)}else{bg.m_angularVelocity=I.b2_maxRotation*ba.inv_dt}}bg.m_sweep.c0.SetV(bg.m_sweep.c);bg.m_sweep.a0=bg.m_sweep.a;bg.m_sweep.c.x+=ba.dt*bg.m_linearVelocity.x;bg.m_sweep.c.y+=ba.dt*bg.m_linearVelocity.y;bg.m_sweep.a+=ba.dt*bg.m_angularVelocity;bg.SynchronizeTransform()}var bh=0.75;for(bb=0;bb<ba.positionIterations;++bb){var bc=a8.SolvePositionConstraints(bh);var bf=true;for(a9=0;a9<this.m_jointCount;++a9){var a7=this.m_joints[a9].SolvePositionConstraints(I.b2_contactBaumgarte);bf=bf&&a7}if(bc&&bf){break}}this.Report(a8.m_constraints)};aZ.prototype.Report=function(bb){if(this.m_listener==null){return}for(var a8=0;a8<this.m_contactCount;++a8){var ba=this.m_contacts[a8];var a9=bb[a8];for(var a7=0;a7<a9.pointCount;++a7){aZ.s_impulse.normalImpulses[a7]=a9.points[a7].normalImpulse;aZ.s_impulse.tangentImpulses[a7]=a9.points[a7].tangentImpulse}this.m_listener.PostSolve(ba,aZ.s_impulse)}};aZ.prototype.AddBody=function(a7){a7.m_islandIndex=this.m_bodyCount;this.m_bodies[this.m_bodyCount++]=a7};aZ.prototype.AddContact=function(a7){this.m_contacts[this.m_contactCount++]=a7};aZ.prototype.AddJoint=function(a7){this.m_joints[this.m_jointCount++]=a7};Box2D.postDefs.push(function(){Box2D.Dynamics.b2Island.s_impulse=new aq()});E.b2TimeStep=function(){};E.prototype.Set=function(a7){this.dt=a7.dt;this.inv_dt=a7.inv_dt;this.positionIterations=a7.positionIterations;this.velocityIterations=a7.velocityIterations;this.warmStarting=a7.warmStarting};C.b2World=function(){this.s_stack=new Vector();this.m_contactManager=new L();this.m_contactSolver=new af();this.m_island=new aZ()};C.prototype.b2World=function(a9,a8){this.m_destructionListener=null;this.m_debugDraw=null;this.m_bodyList=null;this.m_contactList=null;this.m_jointList=null;this.m_controllerList=null;this.m_bodyCount=0;this.m_contactCount=0;this.m_jointCount=0;this.m_controllerCount=0;C.m_warmStarting=true;C.m_continuousPhysics=true;this.m_allowSleep=a8;this.m_gravity=a9;this.m_inv_dt0=0;this.m_contactManager.m_world=this;var a7=new v();this.m_groundBody=this.CreateBody(a7)};C.prototype.SetDestructionListener=function(a7){this.m_destructionListener=a7};C.prototype.SetContactFilter=function(a7){this.m_contactManager.m_contactFilter=a7};C.prototype.SetContactListener=function(a7){this.m_contactManager.m_contactListener=a7};C.prototype.SetDebugDraw=function(a7){this.m_debugDraw=a7};C.prototype.SetBroadPhase=function(a8){var a9=this.m_contactManager.m_broadPhase;this.m_contactManager.m_broadPhase=a8;for(var a7=this.m_bodyList;a7;a7=a7.m_next){for(var ba=a7.m_fixtureList;ba;ba=ba.m_next){ba.m_proxy=a8.CreateProxy(a9.GetFatAABB(ba.m_proxy),ba)}}};C.prototype.Validate=function(){this.m_contactManager.m_broadPhase.Validate()};C.prototype.GetProxyCount=function(){return this.m_contactManager.m_broadPhase.GetProxyCount()};C.prototype.CreateBody=function(a8){if(this.IsLocked()==true){return null}var a7=new Q(a8,this);a7.m_prev=null;a7.m_next=this.m_bodyList;if(this.m_bodyList){this.m_bodyList.m_prev=a7}this.m_bodyList=a7;++this.m_bodyCount;return a7};C.prototype.DestroyBody=function(bf){if(this.IsLocked()==true){return}var ba=bf.m_jointList;while(ba){var be=ba;ba=ba.next;if(this.m_destructionListener){this.m_destructionListener.SayGoodbyeJoint(be.joint)}this.DestroyJoint(be.joint)}var bc=bf.m_controllerList;while(bc){var a7=bc;bc=bc.nextController;a7.controller.RemoveBody(bf)}var a8=bf.m_contactList;while(a8){var a9=a8;a8=a8.next;this.m_contactManager.Destroy(a9.contact)}bf.m_contactList=null;var bd=bf.m_fixtureList;while(bd){var bb=bd;bd=bd.m_next;if(this.m_destructionListener){this.m_destructionListener.SayGoodbyeFixture(bb)}bb.DestroyProxy(this.m_contactManager.m_broadPhase);bb.Destroy()}bf.m_fixtureList=null;bf.m_fixtureCount=0;if(bf.m_prev){bf.m_prev.m_next=bf.m_next}if(bf.m_next){bf.m_next.m_prev=bf.m_prev}if(bf==this.m_bodyList){this.m_bodyList=bf.m_next}--this.m_bodyCount};C.prototype.CreateJoint=function(a9){var a7=an.Create(a9,null);a7.m_prev=null;a7.m_next=this.m_jointList;if(this.m_jointList){this.m_jointList.m_prev=a7}this.m_jointList=a7;++this.m_jointCount;a7.m_edgeA.joint=a7;a7.m_edgeA.other=a7.m_bodyB;a7.m_edgeA.prev=null;a7.m_edgeA.next=a7.m_bodyA.m_jointList;if(a7.m_bodyA.m_jointList){a7.m_bodyA.m_jointList.prev=a7.m_edgeA}a7.m_bodyA.m_jointList=a7.m_edgeA;a7.m_edgeB.joint=a7;a7.m_edgeB.other=a7.m_bodyA;a7.m_edgeB.prev=null;a7.m_edgeB.next=a7.m_bodyB.m_jointList;if(a7.m_bodyB.m_jointList){a7.m_bodyB.m_jointList.prev=a7.m_edgeB}a7.m_bodyB.m_jointList=a7.m_edgeB;var bb=a9.bodyA;var ba=a9.bodyB;if(a9.collideConnected==false){var a8=ba.GetContactList();while(a8){if(a8.other==bb){a8.contact.FlagForFiltering()}a8=a8.next}}return a7};C.prototype.DestroyJoint=function(a7){var a9=a7.m_collideConnected;if(a7.m_prev){a7.m_prev.m_next=a7.m_next}if(a7.m_next){a7.m_next.m_prev=a7.m_prev}if(a7==this.m_jointList){this.m_jointList=a7.m_next}var bb=a7.m_bodyA;var ba=a7.m_bodyB;bb.SetAwake(true);ba.SetAwake(true);if(a7.m_edgeA.prev){a7.m_edgeA.prev.next=a7.m_edgeA.next}if(a7.m_edgeA.next){a7.m_edgeA.next.prev=a7.m_edgeA.prev}if(a7.m_edgeA==bb.m_jointList){bb.m_jointList=a7.m_edgeA.next}a7.m_edgeA.prev=null;a7.m_edgeA.next=null;if(a7.m_edgeB.prev){a7.m_edgeB.prev.next=a7.m_edgeB.next}if(a7.m_edgeB.next){a7.m_edgeB.next.prev=a7.m_edgeB.prev}if(a7.m_edgeB==ba.m_jointList){ba.m_jointList=a7.m_edgeB.next}a7.m_edgeB.prev=null;a7.m_edgeB.next=null;an.Destroy(a7,null);--this.m_jointCount;if(a9==false){var a8=ba.GetContactList();while(a8){if(a8.other==bb){a8.contact.FlagForFiltering()}a8=a8.next}}};C.prototype.AddController=function(a7){a7.m_next=this.m_controllerList;a7.m_prev=null;this.m_controllerList=a7;a7.m_world=this;this.m_controllerCount++;return a7};C.prototype.RemoveController=function(a7){if(a7.m_prev){a7.m_prev.m_next=a7.m_next}if(a7.m_next){a7.m_next.m_prev=a7.m_prev}if(this.m_controllerList==a7){this.m_controllerList=a7.m_next}this.m_controllerCount--};C.prototype.CreateController=function(a7){if(a7.m_world!=this){throw new Error("Controller can only be a member of one world")}a7.m_next=this.m_controllerList;a7.m_prev=null;if(this.m_controllerList){this.m_controllerList.m_prev=a7}this.m_controllerList=a7;++this.m_controllerCount;a7.m_world=this;return a7};C.prototype.DestroyController=function(a7){a7.Clear();if(a7.m_next){a7.m_next.m_prev=a7.m_prev}if(a7.m_prev){a7.m_prev.m_next=a7.m_next}if(a7==this.m_controllerList){this.m_controllerList=a7.m_next}--this.m_controllerCount};C.prototype.SetWarmStarting=function(a7){C.m_warmStarting=a7};C.prototype.SetContinuousPhysics=function(a7){C.m_continuousPhysics=a7};C.prototype.GetBodyCount=function(){return this.m_bodyCount};C.prototype.GetJointCount=function(){return this.m_jointCount};C.prototype.GetContactCount=function(){return this.m_contactCount};C.prototype.SetGravity=function(a7){this.m_gravity=a7};C.prototype.GetGravity=function(){return this.m_gravity};C.prototype.GetGroundBody=function(){return this.m_groundBody};C.prototype.Step=function(a8,ba,a9){if(a8===undefined){a8=0}if(ba===undefined){ba=0}if(a9===undefined){a9=0}if(this.m_flags&C.e_newFixture){this.m_contactManager.FindNewContacts();this.m_flags&=~C.e_newFixture}this.m_flags|=C.e_locked;var a7=C.s_timestep2;a7.dt=a8;a7.velocityIterations=ba;a7.positionIterations=a9;if(a8>0){a7.inv_dt=1/a8}else{a7.inv_dt=0}a7.dtRatio=this.m_inv_dt0*a8;a7.warmStarting=C.m_warmStarting;this.m_contactManager.Collide();if(a7.dt>0){this.Solve(a7)}if(C.m_continuousPhysics&&a7.dt>0){this.SolveTOI(a7)}if(a7.dt>0){this.m_inv_dt0=a7.inv_dt}this.m_flags&=~C.e_locked};C.prototype.ClearForces=function(){for(var a7=this.m_bodyList;a7;a7=a7.m_next){a7.m_force.SetZero();a7.m_torque=0}};C.prototype.DrawDebugData=function(){if(this.m_debugDraw==null){return}this.m_debugDraw.m_sprite.graphics.clear();var a9=this.m_debugDraw.GetFlags();var bj=0;var bo;var bm;var bd;var bh;var bs;var bq=new aA;var bl=new aA;var bk=new aA;var be;var bb=new ak();var a8=new ak();var bf=[new aA(),new aA(),new aA(),new aA()];var bg=new aw(0,0,0);if(a9&W.e_shapeBit){for(bo=this.m_bodyList;bo;bo=bo.m_next){be=bo.m_xf;for(bm=bo.GetFixtureList();bm;bm=bm.m_next){bd=bm.GetShape();if(bo.IsActive()==false){bg.Set(0.5,0.5,0.3);this.DrawShape(bd,be,bg)}else{if(bo.GetType()==Q.b2_staticBody){bg.Set(0.5,0.9,0.5);this.DrawShape(bd,be,bg)}else{if(bo.GetType()==Q.b2_kinematicBody){bg.Set(0.5,0.5,0.9);this.DrawShape(bd,be,bg)}else{if(bo.IsAwake()==false){bg.Set(0.6,0.6,0.6);this.DrawShape(bd,be,bg)}else{bg.Set(0.9,0.7,0.7);this.DrawShape(bd,be,bg)}}}}}}}if(a9&W.e_jointBit){for(bh=this.m_jointList;bh;bh=bh.m_next){this.DrawJoint(bh)}}if(a9&W.e_controllerBit){for(var bn=this.m_controllerList;bn;bn=bn.m_next){bn.Draw(this.m_debugDraw)}}if(a9&W.e_pairBit){bg.Set(0.3,0.9,0.9);for(var bi=this.m_contactManager.m_contactList;bi;bi=bi.GetNext()){var bt=bi.GetFixtureA();var br=bi.GetFixtureB();var ba=bt.GetAABB().GetCenter();var a7=br.GetAABB().GetCenter();this.m_debugDraw.DrawSegment(ba,a7,bg)}}if(a9&W.e_aabbBit){bs=this.m_contactManager.m_broadPhase;bf=[new aA(),new aA(),new aA(),new aA()];for(bo=this.m_bodyList;bo;bo=bo.GetNext()){if(bo.IsActive()==false){continue}for(bm=bo.GetFixtureList();bm;bm=bm.GetNext()){var bc=bs.GetFatAABB(bm.m_proxy);bf[0].Set(bc.lowerBound.x,bc.lowerBound.y);bf[1].Set(bc.upperBound.x,bc.lowerBound.y);bf[2].Set(bc.upperBound.x,bc.upperBound.y);bf[3].Set(bc.lowerBound.x,bc.upperBound.y);this.m_debugDraw.DrawPolygon(bf,4,bg)}}}if(a9&W.e_centerOfMassBit){for(bo=this.m_bodyList;bo;bo=bo.m_next){be=C.s_xf;be.R=bo.m_xf.R;be.position=bo.GetWorldCenter();this.m_debugDraw.DrawTransform(be)}}};C.prototype.QueryAABB=function(bb,a8){var ba=this;var a7=ba.m_contactManager.m_broadPhase;function a9(bc){return bb(a7.GetUserData(bc))}a7.Query(a9,a8)};C.prototype.QueryShape=function(bd,a9,bb){var bc=this;if(bb===undefined){bb=null}if(bb==null){bb=new j();bb.SetIdentity()}var a7=bc.m_contactManager.m_broadPhase;function ba(be){var bf=(a7.GetUserData(be) instanceof aV?a7.GetUserData(be):null);if(aC.TestOverlap(a9,bb,bf.GetShape(),bf.GetBody().GetTransform())){return bd(bf)}return true}var a8=new ak();a9.ComputeAABB(a8,bb);a7.Query(ba,a8)};C.prototype.QueryPoint=function(bc,bb){var ba=this;var a7=ba.m_contactManager.m_broadPhase;function a9(bd){var be=(a7.GetUserData(bd) instanceof aV?a7.GetUserData(bd):null);if(be.TestPoint(bb)){return bc(be)}return true}var a8=new ak();a8.lowerBound.Set(bb.x-I.b2_linearSlop,bb.y-I.b2_linearSlop);a8.upperBound.Set(bb.x+I.b2_linearSlop,bb.y+I.b2_linearSlop);a7.Query(a9,a8)};C.prototype.RayCast=function(be,bd,bb){var bc=this;var a7=bc.m_contactManager.m_broadPhase;var ba=new u;function a9(bh,bi){var bg=a7.GetUserData(bi);var bk=(bg instanceof aV?bg:null);var bl=bk.RayCast(ba,bh);if(bl){var bj=ba.fraction;var bf=new aA((1-bj)*bd.x+bj*bb.x,(1-bj)*bd.y+bj*bb.y);return be(bk,bf,ba.normal,bj)}return bh.maxFraction}var a8=new ah(bd,bb);a7.RayCast(a9,a8)};C.prototype.RayCastOne=function(bb,a8){var ba=this;var a7;function a9(be,bc,bf,bd){if(bd===undefined){bd=0}a7=be;return bd}ba.RayCast(a9,bb,a8);return a7};C.prototype.RayCastAll=function(bb,a9){var ba=this;var a7=new Vector();function a8(be,bc,bf,bd){if(bd===undefined){bd=0}a7[a7.length]=be;return 1}ba.RayCast(a8,bb,a9);return a7};C.prototype.GetBodyList=function(){return this.m_bodyList};C.prototype.GetJointList=function(){return this.m_jointList};C.prototype.GetContactList=function(){return this.m_contactList};C.prototype.IsLocked=function(){return(this.m_flags&C.e_locked)>0};C.prototype.Solve=function(a8){var bh;for(var bd=this.m_controllerList;bd;bd=bd.m_next){bd.Step(a8)}var be=this.m_island;be.Initialize(this.m_bodyCount,this.m_contactCount,this.m_jointCount,null,this.m_contactManager.m_contactListener,this.m_contactSolver);for(bh=this.m_bodyList;bh;bh=bh.m_next){bh.m_flags&=~Q.e_islandFlag}for(var bg=this.m_contactList;bg;bg=bg.m_next){bg.m_flags&=~D.e_islandFlag}for(var ba=this.m_jointList;ba;ba=ba.m_next){ba.m_islandFlag=false}var bk=parseInt(this.m_bodyCount);var bi=this.s_stack;for(var bc=this.m_bodyList;bc;bc=bc.m_next){if(bc.m_flags&Q.e_islandFlag){continue}if(bc.IsAwake()==false||bc.IsActive()==false){continue}if(bc.GetType()==Q.b2_staticBody){continue}be.Clear();var bj=0;bi[bj++]=bc;bc.m_flags|=Q.e_islandFlag;while(bj>0){bh=bi[--bj];be.AddBody(bh);if(bh.IsAwake()==false){bh.SetAwake(true)}if(bh.GetType()==Q.b2_staticBody){continue}var bf;for(var a7=bh.m_contactList;a7;a7=a7.next){if(a7.contact.m_flags&D.e_islandFlag){continue}if(a7.contact.IsSensor()==true||a7.contact.IsEnabled()==false||a7.contact.IsTouching()==false){continue}be.AddContact(a7.contact);a7.contact.m_flags|=D.e_islandFlag;bf=a7.other;if(bf.m_flags&Q.e_islandFlag){continue}bi[bj++]=bf;bf.m_flags|=Q.e_islandFlag}for(var a9=bh.m_jointList;a9;a9=a9.next){if(a9.joint.m_islandFlag==true){continue}bf=a9.other;if(bf.IsActive()==false){continue}be.AddJoint(a9.joint);a9.joint.m_islandFlag=true;if(bf.m_flags&Q.e_islandFlag){continue}bi[bj++]=bf;bf.m_flags|=Q.e_islandFlag}}be.Solve(a8,this.m_gravity,this.m_allowSleep);for(var bb=0;bb<be.m_bodyCount;++bb){bh=be.m_bodies[bb];if(bh.GetType()==Q.b2_staticBody){bh.m_flags&=~Q.e_islandFlag}}}for(bb=0;bb<bi.length;++bb){if(!bi[bb]){break}bi[bb]=null}for(bh=this.m_bodyList;bh;bh=bh.m_next){if(bh.IsAwake()==false||bh.IsActive()==false){continue}if(bh.GetType()==Q.b2_staticBody){continue}bh.SynchronizeFixtures()}this.m_contactManager.FindNewContacts()};C.prototype.SolveTOI=function(a9){var bp;var bc;var ba;var bs;var br;var bf;var bi;var bm=this.m_island;bm.Initialize(this.m_bodyCount,I.b2_maxTOIContactsPerIsland,I.b2_maxTOIJointsPerIsland,null,this.m_contactManager.m_contactListener,this.m_contactSolver);var bg=C.s_queue;for(bp=this.m_bodyList;bp;bp=bp.m_next){bp.m_flags&=~Q.e_islandFlag;bp.m_sweep.t0=0}var bn;for(bn=this.m_contactList;bn;bn=bn.m_next){bn.m_flags&=~(D.e_toiFlag|D.e_islandFlag)}for(bi=this.m_jointList;bi;bi=bi.m_next){bi.m_islandFlag=false}for(;;){var bb=null;var bd=1;for(bn=this.m_contactList;bn;bn=bn.m_next){if(bn.IsSensor()==true||bn.IsEnabled()==false||bn.IsContinuous()==false){continue}var bh=1;if(bn.m_flags&D.e_toiFlag){bh=bn.m_toi}else{bc=bn.m_fixtureA;ba=bn.m_fixtureB;bs=bc.m_body;br=ba.m_body;if((bs.GetType()!=Q.b2_dynamicBody||bs.IsAwake()==false)&&(br.GetType()!=Q.b2_dynamicBody||br.IsAwake()==false)){continue}var be=bs.m_sweep.t0;if(bs.m_sweep.t0<br.m_sweep.t0){be=br.m_sweep.t0;bs.m_sweep.Advance(be)}else{if(br.m_sweep.t0<bs.m_sweep.t0){be=bs.m_sweep.t0;br.m_sweep.Advance(be)}}bh=bn.ComputeTOI(bs.m_sweep,br.m_sweep);I.b2Assert(0<=bh&&bh<=1);if(bh>0&&bh<1){bh=(1-bh)*be+bh;if(bh>1){bh=1}}bn.m_toi=bh;bn.m_flags|=D.e_toiFlag}if(Number.MIN_VALUE<bh&&bh<bd){bb=bn;bd=bh}}if(bb==null||1-100*Number.MIN_VALUE<bd){break}bc=bb.m_fixtureA;ba=bb.m_fixtureB;bs=bc.m_body;br=ba.m_body;C.s_backupA.Set(bs.m_sweep);C.s_backupB.Set(br.m_sweep);bs.Advance(bd);br.Advance(bd);bb.Update(this.m_contactManager.m_contactListener);bb.m_flags&=~D.e_toiFlag;if(bb.IsSensor()==true||bb.IsEnabled()==false){bs.m_sweep.Set(C.s_backupA);br.m_sweep.Set(C.s_backupB);bs.SynchronizeTransform();br.SynchronizeTransform();continue}if(bb.IsTouching()==false){continue}var a8=bs;if(a8.GetType()!=Q.b2_dynamicBody){a8=br}bm.Clear();var bj=0;var bl=0;bg[bj+bl++]=a8;a8.m_flags|=Q.e_islandFlag;while(bl>0){bp=bg[bj++];--bl;bm.AddBody(bp);if(bp.IsAwake()==false){bp.SetAwake(true)}if(bp.GetType()!=Q.b2_dynamicBody){continue}for(bf=bp.m_contactList;bf;bf=bf.next){if(bm.m_contactCount==bm.m_contactCapacity){break}if(bf.contact.m_flags&D.e_islandFlag){continue}if(bf.contact.IsSensor()==true||bf.contact.IsEnabled()==false||bf.contact.IsTouching()==false){continue}bm.AddContact(bf.contact);bf.contact.m_flags|=D.e_islandFlag;var a7=bf.other;if(a7.m_flags&Q.e_islandFlag){continue}if(a7.GetType()!=Q.b2_staticBody){a7.Advance(bd);a7.SetAwake(true)}bg[bj+bl]=a7;++bl;a7.m_flags|=Q.e_islandFlag}for(var bo=bp.m_jointList;bo;bo=bo.next){if(bm.m_jointCount==bm.m_jointCapacity){continue}if(bo.joint.m_islandFlag==true){continue}a7=bo.other;if(a7.IsActive()==false){continue}bm.AddJoint(bo.joint);bo.joint.m_islandFlag=true;if(a7.m_flags&Q.e_islandFlag){continue}if(a7.GetType()!=Q.b2_staticBody){a7.Advance(bd);a7.SetAwake(true)}bg[bj+bl]=a7;++bl;a7.m_flags|=Q.e_islandFlag}}var bq=C.s_timestep;bq.warmStarting=false;bq.dt=(1-bd)*a9.dt;bq.inv_dt=1/bq.dt;bq.dtRatio=0;bq.velocityIterations=a9.velocityIterations;bq.positionIterations=a9.positionIterations;bm.SolveTOI(bq);var bk=0;for(bk=0;bk<bm.m_bodyCount;++bk){bp=bm.m_bodies[bk];bp.m_flags&=~Q.e_islandFlag;if(bp.IsAwake()==false){continue}if(bp.GetType()!=Q.b2_dynamicBody){continue}bp.SynchronizeFixtures();for(bf=bp.m_contactList;bf;bf=bf.next){bf.contact.m_flags&=~D.e_toiFlag}}for(bk=0;bk<bm.m_contactCount;++bk){bn=bm.m_contacts[bk];bn.m_flags&=~(D.e_toiFlag|D.e_islandFlag)}for(bk=0;bk<bm.m_jointCount;++bk){bi=bm.m_joints[bk];bi.m_islandFlag=false}this.m_contactManager.FindNewContacts()}};C.prototype.DrawJoint=function(bb){var bf=bb.GetBodyA();var be=bb.GetBodyB();var bd=bf.m_xf;var bc=be.m_xf;var a9=bd.position;var a8=bc.position;var bj=bb.GetAnchorA();var bi=bb.GetAnchorB();var ba=C.s_jointColor;switch(bb.m_type){case an.e_distanceJoint:this.m_debugDraw.DrawSegment(bj,bi,ba);break;case an.e_pulleyJoint:var a7=((bb instanceof a6?bb:null));var bh=a7.GetGroundAnchorA();var bg=a7.GetGroundAnchorB();this.m_debugDraw.DrawSegment(bh,bj,ba);this.m_debugDraw.DrawSegment(bg,bi,ba);this.m_debugDraw.DrawSegment(bh,bg,ba);break;case an.e_mouseJoint:this.m_debugDraw.DrawSegment(bj,bi,ba);break;default:if(bf!=this.m_groundBody){this.m_debugDraw.DrawSegment(a9,bj,ba)}this.m_debugDraw.DrawSegment(bj,bi,ba);if(be!=this.m_groundBody){this.m_debugDraw.DrawSegment(a8,bi,ba)}}};C.prototype.DrawShape=function(bh,bi,bd){switch(bh.m_type){case aC.e_circleShape:var ba=((bh instanceof aY?bh:null));var a8=aj.MulX(bi,ba.m_p);var bf=ba.m_radius;var bc=bi.R.col1;this.m_debugDraw.DrawSolidCircle(a8,bf,bc,bd);break;case aC.e_polygonShape:var be=0;var a9=((bh instanceof aQ?bh:null));var a7=parseInt(a9.GetVertexCount());var bj=a9.GetVertices();var bg=new Vector(a7);for(be=0;be<a7;++be){bg[be]=aj.MulX(bi,bj[be])}this.m_debugDraw.DrawSolidPolygon(bg,a7,bd);break;case aC.e_edgeShape:var bb=(bh instanceof aR?bh:null);this.m_debugDraw.DrawSegment(aj.MulX(bi,bb.GetVertex1()),aj.MulX(bi,bb.GetVertex2()),bd);break}};Box2D.postDefs.push(function(){Box2D.Dynamics.b2World.s_timestep2=new E();Box2D.Dynamics.b2World.s_xf=new j();Box2D.Dynamics.b2World.s_backupA=new aB();Box2D.Dynamics.b2World.s_backupB=new aB();Box2D.Dynamics.b2World.s_timestep=new E();Box2D.Dynamics.b2World.s_queue=new Vector();Box2D.Dynamics.b2World.s_jointColor=new aw(0.5,0.8,0.8);Box2D.Dynamics.b2World.e_newFixture=1;Box2D.Dynamics.b2World.e_locked=2})})();(function(){var aF=Box2D.Collision.Shapes.b2CircleShape,e=Box2D.Collision.Shapes.b2EdgeChainDef,ay=Box2D.Collision.Shapes.b2EdgeShape,ab=Box2D.Collision.Shapes.b2MassData,ax=Box2D.Collision.Shapes.b2PolygonShape,ak=Box2D.Collision.Shapes.b2Shape,f=Box2D.Dynamics.Contacts.b2CircleContact,A=Box2D.Dynamics.Contacts.b2Contact,N=Box2D.Dynamics.Contacts.b2ContactConstraint,T=Box2D.Dynamics.Contacts.b2ContactConstraintPoint,d=Box2D.Dynamics.Contacts.b2ContactEdge,an=Box2D.Dynamics.Contacts.b2ContactFactory,m=Box2D.Dynamics.Contacts.b2ContactRegister,C=Box2D.Dynamics.Contacts.b2ContactResult,W=Box2D.Dynamics.Contacts.b2ContactSolver,aI=Box2D.Dynamics.Contacts.b2EdgeAndCircleContact,v=Box2D.Dynamics.Contacts.b2NullContact,am=Box2D.Dynamics.Contacts.b2PolyAndCircleContact,F=Box2D.Dynamics.Contacts.b2PolyAndEdgeContact,V=Box2D.Dynamics.Contacts.b2PolygonContact,al=Box2D.Dynamics.Contacts.b2PositionSolverManifold,L=Box2D.Dynamics.b2Body,r=Box2D.Dynamics.b2BodyDef,ae=Box2D.Dynamics.b2ContactFilter,ad=Box2D.Dynamics.b2ContactImpulse,D=Box2D.Dynamics.b2ContactListener,H=Box2D.Dynamics.b2ContactManager,O=Box2D.Dynamics.b2DebugDraw,J=Box2D.Dynamics.b2DestructionListener,ar=Box2D.Dynamics.b2FilterData,aC=Box2D.Dynamics.b2Fixture,b=Box2D.Dynamics.b2FixtureDef,aG=Box2D.Dynamics.b2Island,B=Box2D.Dynamics.b2TimeStep,z=Box2D.Dynamics.b2World,af=Box2D.Common.b2Color,aD=Box2D.Common.b2internal,E=Box2D.Common.b2Settings,P=Box2D.Common.Math.b2Mat22,y=Box2D.Common.Math.b2Mat33,Z=Box2D.Common.Math.b2Math,aj=Box2D.Common.Math.b2Sweep,g=Box2D.Common.Math.b2Transform,ai=Box2D.Common.Math.b2Vec2,ag=Box2D.Common.Math.b2Vec3,aa=Box2D.Collision.b2AABB,aq=Box2D.Collision.b2Bound,aE=Box2D.Collision.b2BoundValues,I=Box2D.Collision.b2Collision,K=Box2D.Collision.b2ContactID,ac=Box2D.Collision.b2ContactPoint,au=Box2D.Collision.b2Distance,j=Box2D.Collision.b2DistanceInput,u=Box2D.Collision.b2DistanceOutput,S=Box2D.Collision.b2DistanceProxy,n=Box2D.Collision.b2DynamicTree,aB=Box2D.Collision.b2DynamicTreeBroadPhase,ap=Box2D.Collision.b2DynamicTreeNode,Q=Box2D.Collision.b2DynamicTreePair,R=Box2D.Collision.b2Manifold,M=Box2D.Collision.b2ManifoldPoint,U=Box2D.Collision.b2Point,X=Box2D.Collision.b2RayCastInput,q=Box2D.Collision.b2RayCastOutput,k=Box2D.Collision.b2Segment,at=Box2D.Collision.b2SeparationFunction,aA=Box2D.Collision.b2Simplex,G=Box2D.Collision.b2SimplexCache,aH=Box2D.Collision.b2SimplexVertex,ah=Box2D.Collision.b2TimeOfImpact,aw=Box2D.Collision.b2TOIInput,az=Box2D.Collision.b2WorldManifold,av=Box2D.Collision.ClipVertex,Y=Box2D.Collision.Features,ao=Box2D.Collision.IBroadPhase;Box2D.inherit(f,Box2D.Dynamics.Contacts.b2Contact);f.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;f.b2CircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};f.Create=function(aJ){return new f()};f.Destroy=function(aJ,aK){};f.prototype.Reset=function(aJ,aK){this.__super.Reset.call(this,aJ,aK)};f.prototype.Evaluate=function(){var aK=this.m_fixtureA.GetBody();var aJ=this.m_fixtureB.GetBody();I.CollideCircles(this.m_manifold,(this.m_fixtureA.GetShape() instanceof aF?this.m_fixtureA.GetShape():null),aK.m_xf,(this.m_fixtureB.GetShape() instanceof aF?this.m_fixtureB.GetShape():null),aJ.m_xf)};A.b2Contact=function(){this.m_nodeA=new d();this.m_nodeB=new d();this.m_manifold=new R();this.m_oldManifold=new R()};A.prototype.GetManifold=function(){return this.m_manifold};A.prototype.GetWorldManifold=function(aM){var aN=this.m_fixtureA.GetBody();var aL=this.m_fixtureB.GetBody();var aK=this.m_fixtureA.GetShape();var aJ=this.m_fixtureB.GetShape();aM.Initialize(this.m_manifold,aN.GetTransform(),aK.m_radius,aL.GetTransform(),aJ.m_radius)};A.prototype.IsTouching=function(){return(this.m_flags&A.e_touchingFlag)==A.e_touchingFlag};A.prototype.IsContinuous=function(){return(this.m_flags&A.e_continuousFlag)==A.e_continuousFlag};A.prototype.SetSensor=function(aJ){if(aJ){this.m_flags|=A.e_sensorFlag}else{this.m_flags&=~A.e_sensorFlag}};A.prototype.IsSensor=function(){return(this.m_flags&A.e_sensorFlag)==A.e_sensorFlag};A.prototype.SetEnabled=function(aJ){if(aJ){this.m_flags|=A.e_enabledFlag}else{this.m_flags&=~A.e_enabledFlag}};A.prototype.IsEnabled=function(){return(this.m_flags&A.e_enabledFlag)==A.e_enabledFlag};A.prototype.GetNext=function(){return this.m_next};A.prototype.GetFixtureA=function(){return this.m_fixtureA};A.prototype.GetFixtureB=function(){return this.m_fixtureB};A.prototype.FlagForFiltering=function(){this.m_flags|=A.e_filterFlag};A.prototype.b2Contact=function(){};A.prototype.Reset=function(aJ,aM){if(aJ===undefined){aJ=null}if(aM===undefined){aM=null}this.m_flags=A.e_enabledFlag;if(!aJ||!aM){this.m_fixtureA=null;this.m_fixtureB=null;return}if(aJ.IsSensor()||aM.IsSensor()){this.m_flags|=A.e_sensorFlag}var aL=aJ.GetBody();var aK=aM.GetBody();if(aL.GetType()!=L.b2_dynamicBody||aL.IsBullet()||aK.GetType()!=L.b2_dynamicBody||aK.IsBullet()){this.m_flags|=A.e_continuousFlag}this.m_fixtureA=aJ;this.m_fixtureB=aM;this.m_manifold.m_pointCount=0;this.m_prev=null;this.m_next=null;this.m_nodeA.contact=null;this.m_nodeA.prev=null;this.m_nodeA.next=null;this.m_nodeA.other=null;this.m_nodeB.contact=null;this.m_nodeB.prev=null;this.m_nodeB.next=null;this.m_nodeB.other=null};A.prototype.Update=function(aK){var aJ=this.m_oldManifold;this.m_oldManifold=this.m_manifold;this.m_manifold=aJ;this.m_flags|=A.e_enabledFlag;var aT=false;var aY=(this.m_flags&A.e_touchingFlag)==A.e_touchingFlag;var aO=this.m_fixtureA.m_body;var aM=this.m_fixtureB.m_body;var aV=this.m_fixtureA.m_aabb.TestOverlap(this.m_fixtureB.m_aabb);if(this.m_flags&A.e_sensorFlag){if(aV){var aN=this.m_fixtureA.GetShape();var aL=this.m_fixtureB.GetShape();var aW=aO.GetTransform();var aU=aM.GetTransform();aT=ak.TestOverlap(aN,aW,aL,aU)}this.m_manifold.m_pointCount=0}else{if(aO.GetType()!=L.b2_dynamicBody||aO.IsBullet()||aM.GetType()!=L.b2_dynamicBody||aM.IsBullet()){this.m_flags|=A.e_continuousFlag}else{this.m_flags&=~A.e_continuousFlag}if(aV){this.Evaluate();aT=this.m_manifold.m_pointCount>0;for(var aQ=0;aQ<this.m_manifold.m_pointCount;++aQ){var aR=this.m_manifold.m_points[aQ];aR.m_normalImpulse=0;aR.m_tangentImpulse=0;var aX=aR.m_id;for(var aP=0;aP<this.m_oldManifold.m_pointCount;++aP){var aS=this.m_oldManifold.m_points[aP];if(aS.m_id.key==aX.key){aR.m_normalImpulse=aS.m_normalImpulse;aR.m_tangentImpulse=aS.m_tangentImpulse;break}}}}else{this.m_manifold.m_pointCount=0}if(aT!=aY){aO.SetAwake(true);aM.SetAwake(true)}}if(aT){this.m_flags|=A.e_touchingFlag}else{this.m_flags&=~A.e_touchingFlag}if(aY==false&&aT==true){aK.BeginContact(this)}if(aY==true&&aT==false){aK.EndContact(this)}if((this.m_flags&A.e_sensorFlag)==0){aK.PreSolve(this,this.m_oldManifold)}};A.prototype.Evaluate=function(){};A.prototype.ComputeTOI=function(aK,aJ){A.s_input.proxyA.Set(this.m_fixtureA.GetShape());A.s_input.proxyB.Set(this.m_fixtureB.GetShape());A.s_input.sweepA=aK;A.s_input.sweepB=aJ;A.s_input.tolerance=E.b2_linearSlop;return ah.TimeOfImpact(A.s_input)};Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2Contact.e_sensorFlag=1;Box2D.Dynamics.Contacts.b2Contact.e_continuousFlag=2;Box2D.Dynamics.Contacts.b2Contact.e_islandFlag=4;Box2D.Dynamics.Contacts.b2Contact.e_toiFlag=8;Box2D.Dynamics.Contacts.b2Contact.e_touchingFlag=16;Box2D.Dynamics.Contacts.b2Contact.e_enabledFlag=32;Box2D.Dynamics.Contacts.b2Contact.e_filterFlag=64;Box2D.Dynamics.Contacts.b2Contact.s_input=new aw()});N.b2ContactConstraint=function(){this.localPlaneNormal=new ai();this.localPoint=new ai();this.normal=new ai();this.normalMass=new P();this.K=new P()};N.prototype.b2ContactConstraint=function(){this.points=new Vector(E.b2_maxManifoldPoints);for(var aJ=0;aJ<E.b2_maxManifoldPoints;aJ++){this.points[aJ]=new T()}};T.b2ContactConstraintPoint=function(){this.localPoint=new ai();this.rA=new ai();this.rB=new ai()};d.b2ContactEdge=function(){};an.b2ContactFactory=function(){};an.prototype.b2ContactFactory=function(aJ){this.m_allocator=aJ;this.InitializeRegisters()};an.prototype.AddType=function(aL,aM,aK,aJ){if(aK===undefined){aK=0}if(aJ===undefined){aJ=0}this.m_registers[aK][aJ].createFcn=aL;this.m_registers[aK][aJ].destroyFcn=aM;this.m_registers[aK][aJ].primary=true;if(aK!=aJ){this.m_registers[aJ][aK].createFcn=aL;this.m_registers[aJ][aK].destroyFcn=aM;this.m_registers[aJ][aK].primary=false}};an.prototype.InitializeRegisters=function(){this.m_registers=new Vector(ak.e_shapeTypeCount);for(var aK=0;aK<ak.e_shapeTypeCount;aK++){this.m_registers[aK]=new Vector(ak.e_shapeTypeCount);for(var aJ=0;aJ<ak.e_shapeTypeCount;aJ++){this.m_registers[aK][aJ]=new m()}}this.AddType(f.Create,f.Destroy,ak.e_circleShape,ak.e_circleShape);this.AddType(am.Create,am.Destroy,ak.e_polygonShape,ak.e_circleShape);this.AddType(V.Create,V.Destroy,ak.e_polygonShape,ak.e_polygonShape);this.AddType(aI.Create,aI.Destroy,ak.e_edgeShape,ak.e_circleShape);this.AddType(F.Create,F.Destroy,ak.e_polygonShape,ak.e_edgeShape)};an.prototype.Create=function(aJ,aP){var aL=parseInt(aJ.GetType());var aK=parseInt(aP.GetType());var aN=this.m_registers[aL][aK];var aO;if(aN.pool){aO=aN.pool;aN.pool=aO.m_next;aN.poolCount--;aO.Reset(aJ,aP);return aO}var aM=aN.createFcn;if(aM!=null){if(aN.primary){aO=aM(this.m_allocator);aO.Reset(aJ,aP);return aO}else{aO=aM(this.m_allocator);aO.Reset(aP,aJ);return aO}}else{return null}};an.prototype.Destroy=function(aJ){if(aJ.m_manifold.m_pointCount>0){aJ.m_fixtureA.m_body.SetAwake(true);aJ.m_fixtureB.m_body.SetAwake(true)}var aL=parseInt(aJ.m_fixtureA.GetType());var aK=parseInt(aJ.m_fixtureB.GetType());var aM=this.m_registers[aL][aK];if(true){aM.poolCount++;aJ.m_next=aM.pool;aM.pool=aJ}var aN=aM.destroyFcn;aN(aJ,this.m_allocator)};m.b2ContactRegister=function(){};C.b2ContactResult=function(){this.position=new ai();this.normal=new ai();this.id=new K()};W.b2ContactSolver=function(){this.m_step=new B();this.m_constraints=new Vector()};W.prototype.b2ContactSolver=function(){};W.prototype.Initialize=function(bp,ba,bb,a0){if(bb===undefined){bb=0}var a5;this.m_step.Set(bp);this.m_allocator=a0;var bE=0;var bt;var by;this.m_constraintCount=bb;while(this.m_constraints.length<this.m_constraintCount){this.m_constraints[this.m_constraints.length]=new N()}for(bE=0;bE<bb;++bE){a5=ba[bE];var bn=a5.m_fixtureA;var bl=a5.m_fixtureB;var aP=bn.m_shape;var aN=bl.m_shape;var a7=aP.m_radius;var a6=aN.m_radius;var bH=bn.m_body;var bF=bl.m_body;var bk=a5.GetManifold();var bf=E.b2MixFriction(bn.GetFriction(),bl.GetFriction());var aJ=E.b2MixRestitution(bn.GetRestitution(),bl.GetRestitution());var aU=bH.m_linearVelocity.x;var aT=bH.m_linearVelocity.y;var bC=bF.m_linearVelocity.x;var bB=bF.m_linearVelocity.y;var bh=bH.m_angularVelocity;var bg=bF.m_angularVelocity;E.b2Assert(bk.m_pointCount>0);W.s_worldManifold.Initialize(bk,bH.m_xf,a7,bF.m_xf,a6);var bv=W.s_worldManifold.m_normal.x;var bu=W.s_worldManifold.m_normal.y;var bq=this.m_constraints[bE];bq.bodyA=bH;bq.bodyB=bF;bq.manifold=bk;bq.normal.x=bv;bq.normal.y=bu;bq.pointCount=bk.m_pointCount;bq.friction=bf;bq.restitution=aJ;bq.localPlaneNormal.x=bk.m_localPlaneNormal.x;bq.localPlaneNormal.y=bk.m_localPlaneNormal.y;bq.localPoint.x=bk.m_localPoint.x;bq.localPoint.y=bk.m_localPoint.y;bq.radius=a7+a6;bq.type=bk.m_type;for(var bD=0;bD<bq.pointCount;++bD){var bi=bk.m_points[bD];var aL=bq.points[bD];aL.normalImpulse=bi.m_normalImpulse;aL.tangentImpulse=bi.m_tangentImpulse;aL.localPoint.SetV(bi.m_localPoint);var bs=aL.rA.x=W.s_worldManifold.m_points[bD].x-bH.m_sweep.c.x;var br=aL.rA.y=W.s_worldManifold.m_points[bD].y-bH.m_sweep.c.y;var a9=aL.rB.x=W.s_worldManifold.m_points[bD].x-bF.m_sweep.c.x;var a8=aL.rB.y=W.s_worldManifold.m_points[bD].y-bF.m_sweep.c.y;var aZ=bs*bu-br*bv;var aW=a9*bu-a8*bv;aZ*=aZ;aW*=aW;var bj=bH.m_invMass+bF.m_invMass+bH.m_invI*aZ+bF.m_invI*aW;aL.normalMass=1/bj;var aY=bH.m_mass*bH.m_invMass+bF.m_mass*bF.m_invMass;aY+=bH.m_mass*bH.m_invI*aZ+bF.m_mass*bF.m_invI*aW;aL.equalizedMass=1/aY;var bz=bu;var bx=(-bv);var a4=bs*bx-br*bz;var a3=a9*bx-a8*bz;a4*=a4;a3*=a3;var bG=bH.m_invMass+bF.m_invMass+bH.m_invI*a4+bF.m_invI*a3;aL.tangentMass=1/bG;aL.velocityBias=0;var aX=bC+((-bg*a8))-aU-((-bh*br));var aV=bB+(bg*a9)-aT-(bh*bs);var bA=bq.normal.x*aX+bq.normal.y*aV;if(bA<(-E.b2_velocityThreshold)){aL.velocityBias+=(-bq.restitution*bA)}}if(bq.pointCount==2){var aS=bq.points[0];var aR=bq.points[1];var bo=bH.m_invMass;var a2=bH.m_invI;var bm=bF.m_invMass;var a1=bF.m_invI;var bd=aS.rA.x*bu-aS.rA.y*bv;var bc=aS.rB.x*bu-aS.rB.y*bv;var aM=aR.rA.x*bu-aR.rA.y*bv;var aK=aR.rB.x*bu-aR.rB.y*bv;var aQ=bo+bm+a2*bd*bd+a1*bc*bc;var bw=bo+bm+a2*aM*aM+a1*aK*aK;var aO=bo+bm+a2*bd*aM+a1*bc*aK;var be=100;if(aQ*aQ<be*(aQ*bw-aO*aO)){bq.K.col1.Set(aQ,aO);bq.K.col2.Set(aO,bw);bq.K.GetInverse(bq.normalMass)}else{bq.pointCount=1}}}};W.prototype.InitVelocityConstraints=function(aT){var aL;var a2;var aW;for(var a0=0;a0<this.m_constraintCount;++a0){var a3=this.m_constraints[a0];var aM=a3.bodyA;var aK=a3.bodyB;var aQ=aM.m_invMass;var a5=aM.m_invI;var aO=aK.m_invMass;var a4=aK.m_invI;var aP=a3.normal.x;var aN=a3.normal.y;var aS=aN;var aR=(-aP);var aY=0;var aZ=0;var a1=0;if(aT.warmStarting){a1=a3.pointCount;for(aZ=0;aZ<a1;++aZ){var aJ=a3.points[aZ];aJ.normalImpulse*=aT.dtRatio;aJ.tangentImpulse*=aT.dtRatio;var aV=aJ.normalImpulse*aP+aJ.tangentImpulse*aS;var aU=aJ.normalImpulse*aN+aJ.tangentImpulse*aR;aM.m_angularVelocity-=a5*(aJ.rA.x*aU-aJ.rA.y*aV);aM.m_linearVelocity.x-=aQ*aV;aM.m_linearVelocity.y-=aQ*aU;aK.m_angularVelocity+=a4*(aJ.rB.x*aU-aJ.rB.y*aV);aK.m_linearVelocity.x+=aO*aV;aK.m_linearVelocity.y+=aO*aU}}else{a1=a3.pointCount;for(aZ=0;aZ<a1;++aZ){var aX=a3.points[aZ];aX.normalImpulse=0;aX.tangentImpulse=0}}}};W.prototype.SolveVelocityConstraints=function(){var br=0;var aK;var bf=0;var be=0;var aV=0;var aT=0;var bD=0;var bC=0;var aU=0;var aS=0;var by=0;var bm=0;var bw=0;var bB=0;var bA=0;var a2=0;var a1=0;var bn=0;var bl=0;var bb=0;var a9=0;var bp;var bg;for(var bs=0;bs<this.m_constraintCount;++bs){var bz=this.m_constraints[bs];var bF=bz.bodyA;var bE=bz.bodyB;var ba=bF.m_angularVelocity;var a8=bE.m_angularVelocity;var bk=bF.m_linearVelocity;var bj=bE.m_linearVelocity;var bd=bF.m_invMass;var aR=bF.m_invI;var bc=bE.m_invMass;var aQ=bE.m_invI;var bi=bz.normal.x;var bh=bz.normal.y;var bq=bh;var bo=(-bi);var a3=bz.friction;var aP=0;for(br=0;br<bz.pointCount;br++){aK=bz.points[br];bD=bj.x-a8*aK.rB.y-bk.x+ba*aK.rA.y;bC=bj.y+a8*aK.rB.x-bk.y-ba*aK.rA.x;aS=bD*bq+bC*bo;by=aK.tangentMass*(-aS);bm=a3*aK.normalImpulse;bw=Z.Clamp(aK.tangentImpulse+by,(-bm),bm);by=bw-aK.tangentImpulse;bB=by*bq;bA=by*bo;bk.x-=bd*bB;bk.y-=bd*bA;ba-=aR*(aK.rA.x*bA-aK.rA.y*bB);bj.x+=bc*bB;bj.y+=bc*bA;a8+=aQ*(aK.rB.x*bA-aK.rB.y*bB);aK.tangentImpulse=bw}var a0=parseInt(bz.pointCount);if(bz.pointCount==1){aK=bz.points[0];bD=bj.x+((-a8*aK.rB.y))-bk.x-((-ba*aK.rA.y));bC=bj.y+(a8*aK.rB.x)-bk.y-(ba*aK.rA.x);aU=bD*bi+bC*bh;by=(-aK.normalMass*(aU-aK.velocityBias));bw=aK.normalImpulse+by;bw=bw>0?bw:0;by=bw-aK.normalImpulse;bB=by*bi;bA=by*bh;bk.x-=bd*bB;bk.y-=bd*bA;ba-=aR*(aK.rA.x*bA-aK.rA.y*bB);bj.x+=bc*bB;bj.y+=bc*bA;a8+=aQ*(aK.rB.x*bA-aK.rB.y*bB);aK.normalImpulse=bw}else{var a7=bz.points[0];var a5=bz.points[1];var aZ=a7.normalImpulse;var aW=a5.normalImpulse;var a6=bj.x-a8*a7.rB.y-bk.x+ba*a7.rA.y;var a4=bj.y+a8*a7.rB.x-bk.y-ba*a7.rA.x;var aO=bj.x-a8*a5.rB.y-bk.x+ba*a5.rA.y;var aN=bj.y+a8*a5.rB.x-bk.y-ba*a5.rA.x;var bx=a6*bi+a4*bh;var bv=aO*bi+aN*bh;var aM=bx-a7.velocityBias;var aL=bv-a5.velocityBias;bp=bz.K;aM-=bp.col1.x*aZ+bp.col2.x*aW;aL-=bp.col1.y*aZ+bp.col2.y*aW;var aJ=0.001;for(;;){bp=bz.normalMass;var bu=(-(bp.col1.x*aM+bp.col2.x*aL));var bt=(-(bp.col1.y*aM+bp.col2.y*aL));if(bu>=0&&bt>=0){a2=bu-aZ;a1=bt-aW;bn=a2*bi;bl=a2*bh;bb=a1*bi;a9=a1*bh;bk.x-=bd*(bn+bb);bk.y-=bd*(bl+a9);ba-=aR*(a7.rA.x*bl-a7.rA.y*bn+a5.rA.x*a9-a5.rA.y*bb);bj.x+=bc*(bn+bb);bj.y+=bc*(bl+a9);a8+=aQ*(a7.rB.x*bl-a7.rB.y*bn+a5.rB.x*a9-a5.rB.y*bb);a7.normalImpulse=bu;a5.normalImpulse=bt;break}bu=(-a7.normalMass*aM);bt=0;bx=0;bv=bz.K.col1.y*bu+aL;if(bu>=0&&bv>=0){a2=bu-aZ;a1=bt-aW;bn=a2*bi;bl=a2*bh;bb=a1*bi;a9=a1*bh;bk.x-=bd*(bn+bb);bk.y-=bd*(bl+a9);ba-=aR*(a7.rA.x*bl-a7.rA.y*bn+a5.rA.x*a9-a5.rA.y*bb);bj.x+=bc*(bn+bb);bj.y+=bc*(bl+a9);a8+=aQ*(a7.rB.x*bl-a7.rB.y*bn+a5.rB.x*a9-a5.rB.y*bb);a7.normalImpulse=bu;a5.normalImpulse=bt;break}bu=0;bt=(-a5.normalMass*aL);bx=bz.K.col2.x*bt+aM;bv=0;if(bt>=0&&bx>=0){a2=bu-aZ;a1=bt-aW;bn=a2*bi;bl=a2*bh;bb=a1*bi;a9=a1*bh;bk.x-=bd*(bn+bb);bk.y-=bd*(bl+a9);ba-=aR*(a7.rA.x*bl-a7.rA.y*bn+a5.rA.x*a9-a5.rA.y*bb);bj.x+=bc*(bn+bb);bj.y+=bc*(bl+a9);a8+=aQ*(a7.rB.x*bl-a7.rB.y*bn+a5.rB.x*a9-a5.rB.y*bb);a7.normalImpulse=bu;a5.normalImpulse=bt;break}bu=0;bt=0;bx=aM;bv=aL;if(bx>=0&&bv>=0){a2=bu-aZ;a1=bt-aW;bn=a2*bi;bl=a2*bh;bb=a1*bi;a9=a1*bh;bk.x-=bd*(bn+bb);bk.y-=bd*(bl+a9);ba-=aR*(a7.rA.x*bl-a7.rA.y*bn+a5.rA.x*a9-a5.rA.y*bb);bj.x+=bc*(bn+bb);bj.y+=bc*(bl+a9);a8+=aQ*(a7.rB.x*bl-a7.rB.y*bn+a5.rB.x*a9-a5.rB.y*bb);a7.normalImpulse=bu;a5.normalImpulse=bt;break}break}}bF.m_angularVelocity=ba;bE.m_angularVelocity=a8}};W.prototype.FinalizeVelocityConstraints=function(){for(var aM=0;aM<this.m_constraintCount;++aM){var aO=this.m_constraints[aM];var aJ=aO.manifold;for(var aK=0;aK<aO.pointCount;++aK){var aN=aJ.m_points[aK];var aL=aO.points[aK];aN.m_normalImpulse=aL.normalImpulse;aN.m_tangentImpulse=aL.tangentImpulse}}};W.prototype.SolvePositionConstraints=function(a0){if(a0===undefined){a0=0}var aR=0;for(var a1=0;a1<this.m_constraintCount;a1++){var a2=this.m_constraints[a1];var aL=a2.bodyA;var aK=a2.bodyB;var aN=aL.m_mass*aL.m_invMass;var a4=aL.m_mass*aL.m_invI;var aM=aK.m_mass*aK.m_invMass;var a3=aK.m_mass*aK.m_invI;W.s_psm.Initialize(a2);var a5=W.s_psm.m_normal;for(var aZ=0;aZ<a2.pointCount;aZ++){var aJ=a2.points[aZ];var aY=W.s_psm.m_points[aZ];var aU=W.s_psm.m_separations[aZ];var aP=aY.x-aL.m_sweep.c.x;var aO=aY.y-aL.m_sweep.c.y;var aX=aY.x-aK.m_sweep.c.x;var aW=aY.y-aK.m_sweep.c.y;aR=aR<aU?aR:aU;var aV=Z.Clamp(a0*(aU+E.b2_linearSlop),(-E.b2_maxLinearCorrection),0);var aT=(-aJ.equalizedMass*aV);var aS=aT*a5.x;var aQ=aT*a5.y;aL.m_sweep.c.x-=aN*aS;aL.m_sweep.c.y-=aN*aQ;aL.m_sweep.a-=a4*(aP*aQ-aO*aS);aL.SynchronizeTransform();aK.m_sweep.c.x+=aM*aS;aK.m_sweep.c.y+=aM*aQ;aK.m_sweep.a+=a3*(aX*aQ-aW*aS);aK.SynchronizeTransform()}}return aR>(-1.5*E.b2_linearSlop)};Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold=new az();Box2D.Dynamics.Contacts.b2ContactSolver.s_psm=new al()});Box2D.inherit(aI,Box2D.Dynamics.Contacts.b2Contact);aI.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;aI.b2EdgeAndCircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};aI.Create=function(aJ){return new aI()};aI.Destroy=function(aJ,aK){};aI.prototype.Reset=function(aJ,aK){this.__super.Reset.call(this,aJ,aK)};aI.prototype.Evaluate=function(){var aK=this.m_fixtureA.GetBody();var aJ=this.m_fixtureB.GetBody();this.b2CollideEdgeAndCircle(this.m_manifold,(this.m_fixtureA.GetShape() instanceof ay?this.m_fixtureA.GetShape():null),aK.m_xf,(this.m_fixtureB.GetShape() instanceof aF?this.m_fixtureB.GetShape():null),aJ.m_xf)};aI.prototype.b2CollideEdgeAndCircle=function(aJ,aM,aL,aN,aK){};Box2D.inherit(v,Box2D.Dynamics.Contacts.b2Contact);v.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;v.b2NullContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};v.prototype.b2NullContact=function(){this.__super.b2Contact.call(this)};v.prototype.Evaluate=function(){};Box2D.inherit(am,Box2D.Dynamics.Contacts.b2Contact);am.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;am.b2PolyAndCircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};am.Create=function(aJ){return new am()};am.Destroy=function(aJ,aK){};am.prototype.Reset=function(aJ,aK){this.__super.Reset.call(this,aJ,aK);E.b2Assert(aJ.GetType()==ak.e_polygonShape);E.b2Assert(aK.GetType()==ak.e_circleShape)};am.prototype.Evaluate=function(){var aK=this.m_fixtureA.m_body;var aJ=this.m_fixtureB.m_body;I.CollidePolygonAndCircle(this.m_manifold,(this.m_fixtureA.GetShape() instanceof ax?this.m_fixtureA.GetShape():null),aK.m_xf,(this.m_fixtureB.GetShape() instanceof aF?this.m_fixtureB.GetShape():null),aJ.m_xf)};Box2D.inherit(F,Box2D.Dynamics.Contacts.b2Contact);F.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;F.b2PolyAndEdgeContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};F.Create=function(aJ){return new F()};F.Destroy=function(aJ,aK){};F.prototype.Reset=function(aJ,aK){this.__super.Reset.call(this,aJ,aK);E.b2Assert(aJ.GetType()==ak.e_polygonShape);E.b2Assert(aK.GetType()==ak.e_edgeShape)};F.prototype.Evaluate=function(){var aK=this.m_fixtureA.GetBody();var aJ=this.m_fixtureB.GetBody();this.b2CollidePolyAndEdge(this.m_manifold,(this.m_fixtureA.GetShape() instanceof ax?this.m_fixtureA.GetShape():null),aK.m_xf,(this.m_fixtureB.GetShape() instanceof ay?this.m_fixtureB.GetShape():null),aJ.m_xf)};F.prototype.b2CollidePolyAndEdge=function(aJ,aM,aL,aN,aK){};Box2D.inherit(V,Box2D.Dynamics.Contacts.b2Contact);V.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;V.b2PolygonContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};V.Create=function(aJ){return new V()};V.Destroy=function(aJ,aK){};V.prototype.Reset=function(aJ,aK){this.__super.Reset.call(this,aJ,aK)};V.prototype.Evaluate=function(){var aK=this.m_fixtureA.GetBody();var aJ=this.m_fixtureB.GetBody();I.CollidePolygons(this.m_manifold,(this.m_fixtureA.GetShape() instanceof ax?this.m_fixtureA.GetShape():null),aK.m_xf,(this.m_fixtureB.GetShape() instanceof ax?this.m_fixtureB.GetShape():null),aJ.m_xf)};al.b2PositionSolverManifold=function(){};al.prototype.b2PositionSolverManifold=function(){this.m_normal=new ai();this.m_separations=new Vector_a2j_Number(E.b2_maxManifoldPoints);this.m_points=new Vector(E.b2_maxManifoldPoints);for(var aJ=0;aJ<E.b2_maxManifoldPoints;aJ++){this.m_points[aJ]=new ai()}};al.prototype.Initialize=function(aM){E.b2Assert(aM.pointCount>0);var aS=0;var aT=0;var aR=0;var aX;var aY;var aL=0;var aK=0;switch(aM.type){case R.e_circles:aX=aM.bodyA.m_xf.R;aY=aM.localPoint;var aW=aM.bodyA.m_xf.position.x+(aX.col1.x*aY.x+aX.col2.x*aY.y);var aV=aM.bodyA.m_xf.position.y+(aX.col1.y*aY.x+aX.col2.y*aY.y);aX=aM.bodyB.m_xf.R;aY=aM.points[0].localPoint;var aP=aM.bodyB.m_xf.position.x+(aX.col1.x*aY.x+aX.col2.x*aY.y);var aN=aM.bodyB.m_xf.position.y+(aX.col1.y*aY.x+aX.col2.y*aY.y);var aQ=aP-aW;var aO=aN-aV;var aJ=aQ*aQ+aO*aO;if(aJ>Number.MIN_VALUE*Number.MIN_VALUE){var aU=Math.sqrt(aJ);this.m_normal.x=aQ/aU;this.m_normal.y=aO/aU}else{this.m_normal.x=1;this.m_normal.y=0}this.m_points[0].x=0.5*(aW+aP);this.m_points[0].y=0.5*(aV+aN);this.m_separations[0]=aQ*this.m_normal.x+aO*this.m_normal.y-aM.radius;break;case R.e_faceA:aX=aM.bodyA.m_xf.R;aY=aM.localPlaneNormal;this.m_normal.x=aX.col1.x*aY.x+aX.col2.x*aY.y;this.m_normal.y=aX.col1.y*aY.x+aX.col2.y*aY.y;aX=aM.bodyA.m_xf.R;aY=aM.localPoint;aL=aM.bodyA.m_xf.position.x+(aX.col1.x*aY.x+aX.col2.x*aY.y);aK=aM.bodyA.m_xf.position.y+(aX.col1.y*aY.x+aX.col2.y*aY.y);aX=aM.bodyB.m_xf.R;for(aS=0;aS<aM.pointCount;++aS){aY=aM.points[aS].localPoint;aT=aM.bodyB.m_xf.position.x+(aX.col1.x*aY.x+aX.col2.x*aY.y);aR=aM.bodyB.m_xf.position.y+(aX.col1.y*aY.x+aX.col2.y*aY.y);this.m_separations[aS]=(aT-aL)*this.m_normal.x+(aR-aK)*this.m_normal.y-aM.radius;this.m_points[aS].x=aT;this.m_points[aS].y=aR}break;case R.e_faceB:aX=aM.bodyB.m_xf.R;aY=aM.localPlaneNormal;this.m_normal.x=aX.col1.x*aY.x+aX.col2.x*aY.y;this.m_normal.y=aX.col1.y*aY.x+aX.col2.y*aY.y;aX=aM.bodyB.m_xf.R;aY=aM.localPoint;aL=aM.bodyB.m_xf.position.x+(aX.col1.x*aY.x+aX.col2.x*aY.y);aK=aM.bodyB.m_xf.position.y+(aX.col1.y*aY.x+aX.col2.y*aY.y);aX=aM.bodyA.m_xf.R;for(aS=0;aS<aM.pointCount;++aS){aY=aM.points[aS].localPoint;aT=aM.bodyA.m_xf.position.x+(aX.col1.x*aY.x+aX.col2.x*aY.y);aR=aM.bodyA.m_xf.position.y+(aX.col1.y*aY.x+aX.col2.y*aY.y);this.m_separations[aS]=(aT-aL)*this.m_normal.x+(aR-aK)*this.m_normal.y-aM.radius;this.m_points[aS].Set(aT,aR)}this.m_normal.x*=(-1);this.m_normal.y*=(-1);break}};Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2PositionSolverManifold.circlePointA=new ai();Box2D.Dynamics.Contacts.b2PositionSolverManifold.circlePointB=new ai()})})();(function(){var q=Box2D.Dynamics.b2Body,E=Box2D.Dynamics.b2BodyDef,Q=Box2D.Dynamics.b2ContactFilter,D=Box2D.Dynamics.b2ContactImpulse,I=Box2D.Dynamics.b2ContactListener,L=Box2D.Dynamics.b2ContactManager,r=Box2D.Dynamics.b2DebugDraw,j=Box2D.Dynamics.b2DestructionListener,C=Box2D.Dynamics.b2FilterData,V=Box2D.Dynamics.b2Fixture,z=Box2D.Dynamics.b2FixtureDef,k=Box2D.Dynamics.b2Island,J=Box2D.Dynamics.b2TimeStep,u=Box2D.Dynamics.b2World,G=Box2D.Common.Math.b2Mat22,m=Box2D.Common.Math.b2Mat33,v=Box2D.Common.Math.b2Math,B=Box2D.Common.Math.b2Sweep,g=Box2D.Common.Math.b2Transform,O=Box2D.Common.Math.b2Vec2,N=Box2D.Common.Math.b2Vec3,A=Box2D.Common.b2Color,M=Box2D.Common.b2internal,f=Box2D.Common.b2Settings,H=Box2D.Collision.Shapes.b2CircleShape,S=Box2D.Collision.Shapes.b2EdgeChainDef,U=Box2D.Collision.Shapes.b2EdgeShape,K=Box2D.Collision.Shapes.b2MassData,y=Box2D.Collision.Shapes.b2PolygonShape,n=Box2D.Collision.Shapes.b2Shape,d=Box2D.Dynamics.Controllers.b2BuoyancyController,R=Box2D.Dynamics.Controllers.b2ConstantAccelController,b=Box2D.Dynamics.Controllers.b2ConstantForceController,T=Box2D.Dynamics.Controllers.b2Controller,e=Box2D.Dynamics.Controllers.b2ControllerEdge,F=Box2D.Dynamics.Controllers.b2GravityController,P=Box2D.Dynamics.Controllers.b2TensorDampingController;Box2D.inherit(d,Box2D.Dynamics.Controllers.b2Controller);d.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;d.b2BuoyancyController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.normal=new O(0,(-1));this.offset=0;this.density=0;this.velocity=new O(0,0);this.linearDrag=2;this.angularDrag=1;this.useDensity=false;this.useWorldGravity=true;this.gravity=null};d.prototype.Step=function(Y){if(!this.m_bodyList){return}if(this.useWorldGravity){this.gravity=this.GetWorld().GetGravity().Copy()}for(var ab=this.m_bodyList;ab;ab=ab.nextBody){var ad=ab.body;if(ad.IsAwake()==false){continue}var ag=new O();var ai=new O();var X=0;var ae=0;for(var Z=ad.GetFixtureList();Z;Z=Z.GetNext()){var af=new O();var W=Z.GetShape().ComputeSubmergedArea(this.normal,this.offset,ad.GetTransform(),af);X+=W;ag.x+=W*af.x;ag.y+=W*af.y;var aa=0;if(this.useDensity){aa=1}else{aa=1}ae+=W*aa;ai.x+=W*af.x*aa;ai.y+=W*af.y*aa}ag.x/=X;ag.y/=X;ai.x/=ae;ai.y/=ae;if(X<Number.MIN_VALUE){continue}var ac=this.gravity.GetNegative();ac.Multiply(this.density*X);ad.ApplyForce(ac,ai);var ah=ad.GetLinearVelocityFromWorldPoint(ag);ah.Subtract(this.velocity);ah.Multiply((-this.linearDrag*X));ad.ApplyForce(ah,ag);ad.ApplyTorque((-ad.GetInertia()/ad.GetMass()*X*ad.GetAngularVelocity()*this.angularDrag))}};d.prototype.Draw=function(aa){var X=1000;var Z=new O();var Y=new O();Z.x=this.normal.x*this.offset+this.normal.y*X;Z.y=this.normal.y*this.offset-this.normal.x*X;Y.x=this.normal.x*this.offset-this.normal.y*X;Y.y=this.normal.y*this.offset+this.normal.x*X;var W=new A(0,0,1);aa.DrawSegment(Z,Y,W)};Box2D.inherit(R,Box2D.Dynamics.Controllers.b2Controller);R.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;R.b2ConstantAccelController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.A=new O(0,0)};R.prototype.Step=function(Z){var X=new O(this.A.x*Z.dt,this.A.y*Z.dt);for(var Y=this.m_bodyList;Y;Y=Y.nextBody){var W=Y.body;if(!W.IsAwake()){continue}W.SetLinearVelocity(new O(W.GetLinearVelocity().x+X.x,W.GetLinearVelocity().y+X.y))}};Box2D.inherit(b,Box2D.Dynamics.Controllers.b2Controller);b.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;b.b2ConstantForceController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.F=new O(0,0)};b.prototype.Step=function(Y){for(var X=this.m_bodyList;X;X=X.nextBody){var W=X.body;if(!W.IsAwake()){continue}W.ApplyForce(this.F,W.GetWorldCenter())}};T.b2Controller=function(){};T.prototype.Step=function(W){};T.prototype.Draw=function(W){};T.prototype.AddBody=function(W){var X=new e();X.controller=this;X.body=W;X.nextBody=this.m_bodyList;X.prevBody=null;this.m_bodyList=X;if(X.nextBody){X.nextBody.prevBody=X}this.m_bodyCount++;X.nextController=W.m_controllerList;X.prevController=null;W.m_controllerList=X;if(X.nextController){X.nextController.prevController=X}W.m_controllerCount++};T.prototype.RemoveBody=function(W){var X=W.m_controllerList;while(X&&X.controller!=this){X=X.nextController}if(X.prevBody){X.prevBody.nextBody=X.nextBody}if(X.nextBody){X.nextBody.prevBody=X.prevBody}if(X.nextController){X.nextController.prevController=X.prevController}if(X.prevController){X.prevController.nextController=X.nextController}if(this.m_bodyList==X){this.m_bodyList=X.nextBody}if(W.m_controllerList==X){W.m_controllerList=X.nextController}W.m_controllerCount--;this.m_bodyCount--};T.prototype.Clear=function(){while(this.m_bodyList){this.RemoveBody(this.m_bodyList.body)}};T.prototype.GetNext=function(){return this.m_next};T.prototype.GetWorld=function(){return this.m_world};T.prototype.GetBodyList=function(){return this.m_bodyList};e.b2ControllerEdge=function(){};Box2D.inherit(F,Box2D.Dynamics.Controllers.b2Controller);F.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;F.b2GravityController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.G=1;this.invSqr=true};F.prototype.Step=function(Z){var ab=null;var W=null;var ae=null;var X=0;var aa=null;var ah=null;var ad=null;var ag=0;var af=0;var Y=0;var ac=null;if(this.invSqr){for(ab=this.m_bodyList;ab;ab=ab.nextBody){W=ab.body;ae=W.GetWorldCenter();X=W.GetMass();for(aa=this.m_bodyList;aa!=ab;aa=aa.nextBody){ah=aa.body;ad=ah.GetWorldCenter();ag=ad.x-ae.x;af=ad.y-ae.y;Y=ag*ag+af*af;if(Y<Number.MIN_VALUE){continue}ac=new O(ag,af);ac.Multiply(this.G/Y/Math.sqrt(Y)*X*ah.GetMass());if(W.IsAwake()){W.ApplyForce(ac,ae)}ac.Multiply((-1));if(ah.IsAwake()){ah.ApplyForce(ac,ad)}}}}else{for(ab=this.m_bodyList;ab;ab=ab.nextBody){W=ab.body;ae=W.GetWorldCenter();X=W.GetMass();for(aa=this.m_bodyList;aa!=ab;aa=aa.nextBody){ah=aa.body;ad=ah.GetWorldCenter();ag=ad.x-ae.x;af=ad.y-ae.y;Y=ag*ag+af*af;if(Y<Number.MIN_VALUE){continue}ac=new O(ag,af);ac.Multiply(this.G/Y*X*ah.GetMass());if(W.IsAwake()){W.ApplyForce(ac,ae)}ac.Multiply((-1));if(ah.IsAwake()){ah.ApplyForce(ac,ad)}}}}};Box2D.inherit(P,Box2D.Dynamics.Controllers.b2Controller);P.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;P.b2TensorDampingController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.T=new G();this.maxTimestep=0};P.prototype.SetAxisAligned=function(X,W){if(X===undefined){X=0}if(W===undefined){W=0}this.T.col1.x=(-X);this.T.col1.y=0;this.T.col2.x=0;this.T.col2.y=(-W);if(X>0||W>0){this.maxTimestep=1/Math.max(X,W)}else{this.maxTimestep=0}};P.prototype.Step=function(aa){var X=aa.dt;if(X<=Number.MIN_VALUE){return}if(X>this.maxTimestep&&this.maxTimestep>0){X=this.maxTimestep}for(var Z=this.m_bodyList;Z;Z=Z.nextBody){var W=Z.body;if(!W.IsAwake()){continue}var Y=W.GetWorldVector(v.MulMV(this.T,W.GetLocalVector(W.GetLinearVelocity())));W.SetLinearVelocity(new O(W.GetLinearVelocity().x+Y.x*X,W.GetLinearVelocity().y+Y.y*X))}}})();(function(){var G=Box2D.Common.b2Color,W=Box2D.Common.b2internal,e=Box2D.Common.b2Settings,R=Box2D.Common.Math.b2Mat22,u=Box2D.Common.Math.b2Mat33,D=Box2D.Common.Math.b2Math,H=Box2D.Common.Math.b2Sweep,q=Box2D.Common.Math.b2Transform,Z=Box2D.Common.Math.b2Vec2,Y=Box2D.Common.Math.b2Vec3,C=Box2D.Dynamics.Joints.b2DistanceJoint,ac=Box2D.Dynamics.Joints.b2DistanceJointDef,d=Box2D.Dynamics.Joints.b2FrictionJoint,K=Box2D.Dynamics.Joints.b2FrictionJointDef,L=Box2D.Dynamics.Joints.b2GearJoint,M=Box2D.Dynamics.Joints.b2GearJointDef,X=Box2D.Dynamics.Joints.b2Jacobian,n=Box2D.Dynamics.Joints.b2Joint,S=Box2D.Dynamics.Joints.b2JointDef,aa=Box2D.Dynamics.Joints.b2JointEdge,v=Box2D.Dynamics.Joints.b2LineJoint,k=Box2D.Dynamics.Joints.b2LineJointDef,Q=Box2D.Dynamics.Joints.b2MouseJoint,f=Box2D.Dynamics.Joints.b2MouseJointDef,y=Box2D.Dynamics.Joints.b2PrismaticJoint,F=Box2D.Dynamics.Joints.b2PrismaticJointDef,j=Box2D.Dynamics.Joints.b2PulleyJoint,ad=Box2D.Dynamics.Joints.b2PulleyJointDef,P=Box2D.Dynamics.Joints.b2RevoluteJoint,b=Box2D.Dynamics.Joints.b2RevoluteJointDef,g=Box2D.Dynamics.Joints.b2WeldJoint,J=Box2D.Dynamics.Joints.b2WeldJointDef,z=Box2D.Dynamics.b2Body,O=Box2D.Dynamics.b2BodyDef,ab=Box2D.Dynamics.b2ContactFilter,N=Box2D.Dynamics.b2ContactImpulse,T=Box2D.Dynamics.b2ContactListener,V=Box2D.Dynamics.b2ContactManager,B=Box2D.Dynamics.b2DebugDraw,m=Box2D.Dynamics.b2DestructionListener,I=Box2D.Dynamics.b2FilterData,ae=Box2D.Dynamics.b2Fixture,E=Box2D.Dynamics.b2FixtureDef,r=Box2D.Dynamics.b2Island,U=Box2D.Dynamics.b2TimeStep,A=Box2D.Dynamics.b2World;Box2D.inherit(C,Box2D.Dynamics.Joints.b2Joint);C.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;C.b2DistanceJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchor1=new Z();this.m_localAnchor2=new Z();this.m_u=new Z()};C.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};C.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};C.prototype.GetReactionForce=function(af){if(af===undefined){af=0}return new Z(af*this.m_impulse*this.m_u.x,af*this.m_impulse*this.m_u.y)};C.prototype.GetReactionTorque=function(af){if(af===undefined){af=0}return 0};C.prototype.GetLength=function(){return this.m_length};C.prototype.SetLength=function(af){if(af===undefined){af=0}this.m_length=af};C.prototype.GetFrequency=function(){return this.m_frequencyHz};C.prototype.SetFrequency=function(af){if(af===undefined){af=0}this.m_frequencyHz=af};C.prototype.GetDampingRatio=function(){return this.m_dampingRatio};C.prototype.SetDampingRatio=function(af){if(af===undefined){af=0}this.m_dampingRatio=af};C.prototype.b2DistanceJoint=function(ah){this.__super.b2Joint.call(this,ah);var ag;var af=0;var ai=0;this.m_localAnchor1.SetV(ah.localAnchorA);this.m_localAnchor2.SetV(ah.localAnchorB);this.m_length=ah.length;this.m_frequencyHz=ah.frequencyHz;this.m_dampingRatio=ah.dampingRatio;this.m_impulse=0;this.m_gamma=0;this.m_bias=0};C.prototype.InitVelocityConstraints=function(ai){var am;var ap=0;var ax=this.m_bodyA;var aw=this.m_bodyB;am=ax.m_xf.R;var at=this.m_localAnchor1.x-ax.m_sweep.localCenter.x;var ar=this.m_localAnchor1.y-ax.m_sweep.localCenter.y;ap=(am.col1.x*at+am.col2.x*ar);ar=(am.col1.y*at+am.col2.y*ar);at=ap;am=aw.m_xf.R;var ah=this.m_localAnchor2.x-aw.m_sweep.localCenter.x;var af=this.m_localAnchor2.y-aw.m_sweep.localCenter.y;ap=(am.col1.x*ah+am.col2.x*af);af=(am.col1.y*ah+am.col2.y*af);ah=ap;this.m_u.x=aw.m_sweep.c.x+ah-ax.m_sweep.c.x-at;this.m_u.y=aw.m_sweep.c.y+af-ax.m_sweep.c.y-ar;var ag=Math.sqrt(this.m_u.x*this.m_u.x+this.m_u.y*this.m_u.y);if(ag>e.b2_linearSlop){this.m_u.Multiply(1/ag)}else{this.m_u.SetZero()}var ay=(at*this.m_u.y-ar*this.m_u.x);var ak=(ah*this.m_u.y-af*this.m_u.x);var av=ax.m_invMass+ax.m_invI*ay*ay+aw.m_invMass+aw.m_invI*ak*ak;this.m_mass=av!=0?1/av:0;if(this.m_frequencyHz>0){var an=ag-this.m_length;var ao=2*Math.PI*this.m_frequencyHz;var au=2*this.m_mass*this.m_dampingRatio*ao;var aq=this.m_mass*ao*ao;this.m_gamma=ai.dt*(au+ai.dt*aq);this.m_gamma=this.m_gamma!=0?1/this.m_gamma:0;this.m_bias=an*ai.dt*aq*this.m_gamma;this.m_mass=av+this.m_gamma;this.m_mass=this.m_mass!=0?1/this.m_mass:0}if(ai.warmStarting){this.m_impulse*=ai.dtRatio;var al=this.m_impulse*this.m_u.x;var aj=this.m_impulse*this.m_u.y;ax.m_linearVelocity.x-=ax.m_invMass*al;ax.m_linearVelocity.y-=ax.m_invMass*aj;ax.m_angularVelocity-=ax.m_invI*(at*aj-ar*al);aw.m_linearVelocity.x+=aw.m_invMass*al;aw.m_linearVelocity.y+=aw.m_invMass*aj;aw.m_angularVelocity+=aw.m_invI*(ah*aj-af*al)}else{this.m_impulse=0}};C.prototype.SolveVelocityConstraints=function(ai){var aq;var ag=this.m_bodyA;var af=this.m_bodyB;aq=ag.m_xf.R;var aw=this.m_localAnchor1.x-ag.m_sweep.localCenter.x;var av=this.m_localAnchor1.y-ag.m_sweep.localCenter.y;var au=(aq.col1.x*aw+aq.col2.x*av);av=(aq.col1.y*aw+aq.col2.y*av);aw=au;aq=af.m_xf.R;var ao=this.m_localAnchor2.x-af.m_sweep.localCenter.x;var an=this.m_localAnchor2.y-af.m_sweep.localCenter.y;au=(aq.col1.x*ao+aq.col2.x*an);an=(aq.col1.y*ao+aq.col2.y*an);ao=au;var at=ag.m_linearVelocity.x+((-ag.m_angularVelocity*av));var ar=ag.m_linearVelocity.y+(ag.m_angularVelocity*aw);var am=af.m_linearVelocity.x+((-af.m_angularVelocity*an));var al=af.m_linearVelocity.y+(af.m_angularVelocity*ao);var ap=(this.m_u.x*(am-at)+this.m_u.y*(al-ar));var ah=(-this.m_mass*(ap+this.m_bias+this.m_gamma*this.m_impulse));this.m_impulse+=ah;var ak=ah*this.m_u.x;var aj=ah*this.m_u.y;ag.m_linearVelocity.x-=ag.m_invMass*ak;ag.m_linearVelocity.y-=ag.m_invMass*aj;ag.m_angularVelocity-=ag.m_invI*(aw*aj-av*ak);af.m_linearVelocity.x+=af.m_invMass*ak;af.m_linearVelocity.y+=af.m_invMass*aj;af.m_angularVelocity+=af.m_invI*(ao*aj-an*ak)};C.prototype.SolvePositionConstraints=function(ar){if(ar===undefined){ar=0}var aq;if(this.m_frequencyHz>0){return true}var ah=this.m_bodyA;var af=this.m_bodyB;aq=ah.m_xf.R;var av=this.m_localAnchor1.x-ah.m_sweep.localCenter.x;var au=this.m_localAnchor1.y-ah.m_sweep.localCenter.y;var at=(aq.col1.x*av+aq.col2.x*au);au=(aq.col1.y*av+aq.col2.y*au);av=at;aq=af.m_xf.R;var ap=this.m_localAnchor2.x-af.m_sweep.localCenter.x;var ao=this.m_localAnchor2.y-af.m_sweep.localCenter.y;at=(aq.col1.x*ap+aq.col2.x*ao);ao=(aq.col1.y*ap+aq.col2.y*ao);ap=at;var an=af.m_sweep.c.x+ap-ah.m_sweep.c.x-av;var am=af.m_sweep.c.y+ao-ah.m_sweep.c.y-au;var aj=Math.sqrt(an*an+am*am);an/=aj;am/=aj;var ag=aj-this.m_length;ag=D.Clamp(ag,(-e.b2_maxLinearCorrection),e.b2_maxLinearCorrection);var ai=(-this.m_mass*ag);this.m_u.Set(an,am);var al=ai*this.m_u.x;var ak=ai*this.m_u.y;ah.m_sweep.c.x-=ah.m_invMass*al;ah.m_sweep.c.y-=ah.m_invMass*ak;ah.m_sweep.a-=ah.m_invI*(av*ak-au*al);af.m_sweep.c.x+=af.m_invMass*al;af.m_sweep.c.y+=af.m_invMass*ak;af.m_sweep.a+=af.m_invI*(ap*ak-ao*al);ah.SynchronizeTransform();af.SynchronizeTransform();return D.Abs(ag)<e.b2_linearSlop};Box2D.inherit(ac,Box2D.Dynamics.Joints.b2JointDef);ac.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;ac.b2DistanceJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new Z();this.localAnchorB=new Z()};ac.prototype.b2DistanceJointDef=function(){this.__super.b2JointDef.call(this);this.type=n.e_distanceJoint;this.length=1;this.frequencyHz=0;this.dampingRatio=0};ac.prototype.Initialize=function(ak,aj,ai,ag){this.bodyA=ak;this.bodyB=aj;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(ai));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(ag));var ah=ag.x-ai.x;var af=ag.y-ai.y;this.length=Math.sqrt(ah*ah+af*af);this.frequencyHz=0;this.dampingRatio=0};Box2D.inherit(d,Box2D.Dynamics.Joints.b2Joint);d.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;d.b2FrictionJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchorA=new Z();this.m_localAnchorB=new Z();this.m_linearMass=new R();this.m_linearImpulse=new Z()};d.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)};d.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)};d.prototype.GetReactionForce=function(af){if(af===undefined){af=0}return new Z(af*this.m_linearImpulse.x,af*this.m_linearImpulse.y)};d.prototype.GetReactionTorque=function(af){if(af===undefined){af=0}return af*this.m_angularImpulse};d.prototype.SetMaxForce=function(af){if(af===undefined){af=0}this.m_maxForce=af};d.prototype.GetMaxForce=function(){return this.m_maxForce};d.prototype.SetMaxTorque=function(af){if(af===undefined){af=0}this.m_maxTorque=af};d.prototype.GetMaxTorque=function(){return this.m_maxTorque};d.prototype.b2FrictionJoint=function(af){this.__super.b2Joint.call(this,af);this.m_localAnchorA.SetV(af.localAnchorA);this.m_localAnchorB.SetV(af.localAnchorB);this.m_linearMass.SetZero();this.m_angularMass=0;this.m_linearImpulse.SetZero();this.m_angularImpulse=0;this.m_maxForce=af.maxForce;this.m_maxTorque=af.maxTorque};d.prototype.InitVelocityConstraints=function(ai){var ap;var ar=0;var ag=this.m_bodyA;var af=this.m_bodyB;ap=ag.m_xf.R;var al=this.m_localAnchorA.x-ag.m_sweep.localCenter.x;var ak=this.m_localAnchorA.y-ag.m_sweep.localCenter.y;ar=(ap.col1.x*al+ap.col2.x*ak);ak=(ap.col1.y*al+ap.col2.y*ak);al=ar;ap=af.m_xf.R;var au=this.m_localAnchorB.x-af.m_sweep.localCenter.x;var at=this.m_localAnchorB.y-af.m_sweep.localCenter.y;ar=(ap.col1.x*au+ap.col2.x*at);at=(ap.col1.y*au+ap.col2.y*at);au=ar;var aj=ag.m_invMass;var ah=af.m_invMass;var ao=ag.m_invI;var an=af.m_invI;var aq=new R();aq.col1.x=aj+ah;aq.col2.x=0;aq.col1.y=0;aq.col2.y=aj+ah;aq.col1.x+=ao*ak*ak;aq.col2.x+=(-ao*al*ak);aq.col1.y+=(-ao*al*ak);aq.col2.y+=ao*al*al;aq.col1.x+=an*at*at;aq.col2.x+=(-an*au*at);aq.col1.y+=(-an*au*at);aq.col2.y+=an*au*au;aq.GetInverse(this.m_linearMass);this.m_angularMass=ao+an;if(this.m_angularMass>0){this.m_angularMass=1/this.m_angularMass}if(ai.warmStarting){this.m_linearImpulse.x*=ai.dtRatio;this.m_linearImpulse.y*=ai.dtRatio;this.m_angularImpulse*=ai.dtRatio;var am=this.m_linearImpulse;ag.m_linearVelocity.x-=aj*am.x;ag.m_linearVelocity.y-=aj*am.y;ag.m_angularVelocity-=ao*(al*am.y-ak*am.x+this.m_angularImpulse);af.m_linearVelocity.x+=ah*am.x;af.m_linearVelocity.y+=ah*am.y;af.m_angularVelocity+=an*(au*am.y-at*am.x+this.m_angularImpulse)}else{this.m_linearImpulse.SetZero();this.m_angularImpulse=0}};d.prototype.SolveVelocityConstraints=function(am){var ar;var av=0;var aE=this.m_bodyA;var aD=this.m_bodyB;var aC=aE.m_linearVelocity;var ah=aE.m_angularVelocity;var aB=aD.m_linearVelocity;var ag=aD.m_angularVelocity;var aA=aE.m_invMass;var az=aD.m_invMass;var ap=aE.m_invI;var ao=aD.m_invI;ar=aE.m_xf.R;var an=this.m_localAnchorA.x-aE.m_sweep.localCenter.x;var al=this.m_localAnchorA.y-aE.m_sweep.localCenter.y;av=(ar.col1.x*an+ar.col2.x*al);al=(ar.col1.y*an+ar.col2.y*al);an=av;ar=aD.m_xf.R;var ax=this.m_localAnchorB.x-aD.m_sweep.localCenter.x;var aw=this.m_localAnchorB.y-aD.m_sweep.localCenter.y;av=(ar.col1.x*ax+ar.col2.x*aw);aw=(ar.col1.y*ax+ar.col2.y*aw);ax=av;var at=0;var au=ag-ah;var aq=(-this.m_angularMass*au);var aj=this.m_angularImpulse;at=am.dt*this.m_maxTorque;this.m_angularImpulse=D.Clamp(this.m_angularImpulse+aq,(-at),at);aq=this.m_angularImpulse-aj;ah-=ap*aq;ag+=ao*aq;var ak=aB.x-ag*aw-aC.x+ah*al;var ai=aB.y+ag*ax-aC.y-ah*an;var af=D.MulMV(this.m_linearMass,new Z((-ak),(-ai)));var ay=this.m_linearImpulse.Copy();this.m_linearImpulse.Add(af);at=am.dt*this.m_maxForce;if(this.m_linearImpulse.LengthSquared()>at*at){this.m_linearImpulse.Normalize();this.m_linearImpulse.Multiply(at)}af=D.SubtractVV(this.m_linearImpulse,ay);aC.x-=aA*af.x;aC.y-=aA*af.y;ah-=ap*(an*af.y-al*af.x);aB.x+=az*af.x;aB.y+=az*af.y;ag+=ao*(ax*af.y-aw*af.x);aE.m_angularVelocity=ah;aD.m_angularVelocity=ag};d.prototype.SolvePositionConstraints=function(af){if(af===undefined){af=0}return true};Box2D.inherit(K,Box2D.Dynamics.Joints.b2JointDef);K.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;K.b2FrictionJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new Z();this.localAnchorB=new Z()};K.prototype.b2FrictionJointDef=function(){this.__super.b2JointDef.call(this);this.type=n.e_frictionJoint;this.maxForce=0;this.maxTorque=0};K.prototype.Initialize=function(ah,ag,af){this.bodyA=ah;this.bodyB=ag;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(af));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(af))};Box2D.inherit(L,Box2D.Dynamics.Joints.b2Joint);L.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;L.b2GearJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_groundAnchor1=new Z();this.m_groundAnchor2=new Z();this.m_localAnchor1=new Z();this.m_localAnchor2=new Z();this.m_J=new X()};L.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};L.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};L.prototype.GetReactionForce=function(af){if(af===undefined){af=0}return new Z(af*this.m_impulse*this.m_J.linearB.x,af*this.m_impulse*this.m_J.linearB.y)};L.prototype.GetReactionTorque=function(aj){if(aj===undefined){aj=0}var ah=this.m_bodyB.m_xf.R;var al=this.m_localAnchor1.x-this.m_bodyB.m_sweep.localCenter.x;var ak=this.m_localAnchor1.y-this.m_bodyB.m_sweep.localCenter.y;var af=ah.col1.x*al+ah.col2.x*ak;ak=ah.col1.y*al+ah.col2.y*ak;al=af;var ai=this.m_impulse*this.m_J.linearB.x;var ag=this.m_impulse*this.m_J.linearB.y;return aj*(this.m_impulse*this.m_J.angularB-al*ag+ak*ai)};L.prototype.GetRatio=function(){return this.m_ratio};L.prototype.SetRatio=function(af){if(af===undefined){af=0}this.m_ratio=af};L.prototype.b2GearJoint=function(ah){this.__super.b2Joint.call(this,ah);var ag=parseInt(ah.joint1.m_type);var af=parseInt(ah.joint2.m_type);this.m_revolute1=null;this.m_prismatic1=null;this.m_revolute2=null;this.m_prismatic2=null;var aj=0;var ai=0;this.m_ground1=ah.joint1.GetBodyA();this.m_bodyA=ah.joint1.GetBodyB();if(ag==n.e_revoluteJoint){this.m_revolute1=(ah.joint1 instanceof P?ah.joint1:null);this.m_groundAnchor1.SetV(this.m_revolute1.m_localAnchor1);this.m_localAnchor1.SetV(this.m_revolute1.m_localAnchor2);aj=this.m_revolute1.GetJointAngle()}else{this.m_prismatic1=(ah.joint1 instanceof y?ah.joint1:null);this.m_groundAnchor1.SetV(this.m_prismatic1.m_localAnchor1);this.m_localAnchor1.SetV(this.m_prismatic1.m_localAnchor2);aj=this.m_prismatic1.GetJointTranslation()}this.m_ground2=ah.joint2.GetBodyA();this.m_bodyB=ah.joint2.GetBodyB();if(af==n.e_revoluteJoint){this.m_revolute2=(ah.joint2 instanceof P?ah.joint2:null);this.m_groundAnchor2.SetV(this.m_revolute2.m_localAnchor1);this.m_localAnchor2.SetV(this.m_revolute2.m_localAnchor2);ai=this.m_revolute2.GetJointAngle()}else{this.m_prismatic2=(ah.joint2 instanceof y?ah.joint2:null);this.m_groundAnchor2.SetV(this.m_prismatic2.m_localAnchor1);this.m_localAnchor2.SetV(this.m_prismatic2.m_localAnchor2);ai=this.m_prismatic2.GetJointTranslation()}this.m_ratio=ah.ratio;this.m_constant=aj+this.m_ratio*ai;this.m_impulse=0};L.prototype.InitVelocityConstraints=function(ai){var ag=this.m_ground1;var at=this.m_ground2;var ah=this.m_bodyA;var af=this.m_bodyB;var ap=0;var an=0;var ak=0;var aj=0;var al;var ar;var ao=0;var aq=0;var am=0;this.m_J.SetZero();if(this.m_revolute1){this.m_J.angularA=(-1);am+=ah.m_invI}else{al=ag.m_xf.R;ar=this.m_prismatic1.m_localXAxis1;ap=al.col1.x*ar.x+al.col2.x*ar.y;an=al.col1.y*ar.x+al.col2.y*ar.y;al=ah.m_xf.R;ak=this.m_localAnchor1.x-ah.m_sweep.localCenter.x;aj=this.m_localAnchor1.y-ah.m_sweep.localCenter.y;aq=al.col1.x*ak+al.col2.x*aj;aj=al.col1.y*ak+al.col2.y*aj;ak=aq;ao=ak*an-aj*ap;this.m_J.linearA.Set((-ap),(-an));this.m_J.angularA=(-ao);am+=ah.m_invMass+ah.m_invI*ao*ao}if(this.m_revolute2){this.m_J.angularB=(-this.m_ratio);am+=this.m_ratio*this.m_ratio*af.m_invI}else{al=at.m_xf.R;ar=this.m_prismatic2.m_localXAxis1;ap=al.col1.x*ar.x+al.col2.x*ar.y;an=al.col1.y*ar.x+al.col2.y*ar.y;al=af.m_xf.R;ak=this.m_localAnchor2.x-af.m_sweep.localCenter.x;aj=this.m_localAnchor2.y-af.m_sweep.localCenter.y;aq=al.col1.x*ak+al.col2.x*aj;aj=al.col1.y*ak+al.col2.y*aj;ak=aq;ao=ak*an-aj*ap;this.m_J.linearB.Set((-this.m_ratio*ap),(-this.m_ratio*an));this.m_J.angularB=(-this.m_ratio*ao);am+=this.m_ratio*this.m_ratio*(af.m_invMass+af.m_invI*ao*ao)}this.m_mass=am>0?1/am:0;if(ai.warmStarting){ah.m_linearVelocity.x+=ah.m_invMass*this.m_impulse*this.m_J.linearA.x;ah.m_linearVelocity.y+=ah.m_invMass*this.m_impulse*this.m_J.linearA.y;ah.m_angularVelocity+=ah.m_invI*this.m_impulse*this.m_J.angularA;af.m_linearVelocity.x+=af.m_invMass*this.m_impulse*this.m_J.linearB.x;af.m_linearVelocity.y+=af.m_invMass*this.m_impulse*this.m_J.linearB.y;af.m_angularVelocity+=af.m_invI*this.m_impulse*this.m_J.angularB}else{this.m_impulse=0}};L.prototype.SolveVelocityConstraints=function(af){var ai=this.m_bodyA;var ah=this.m_bodyB;var aj=this.m_J.Compute(ai.m_linearVelocity,ai.m_angularVelocity,ah.m_linearVelocity,ah.m_angularVelocity);var ag=(-this.m_mass*aj);this.m_impulse+=ag;ai.m_linearVelocity.x+=ai.m_invMass*ag*this.m_J.linearA.x;ai.m_linearVelocity.y+=ai.m_invMass*ag*this.m_J.linearA.y;ai.m_angularVelocity+=ai.m_invI*ag*this.m_J.angularA;ah.m_linearVelocity.x+=ah.m_invMass*ag*this.m_J.linearB.x;ah.m_linearVelocity.y+=ah.m_invMass*ag*this.m_J.linearB.y;ah.m_angularVelocity+=ah.m_invI*ag*this.m_J.angularB};L.prototype.SolvePositionConstraints=function(af){if(af===undefined){af=0}var am=0;var al=this.m_bodyA;var ai=this.m_bodyB;var ak=0;var ah=0;if(this.m_revolute1){ak=this.m_revolute1.GetJointAngle()}else{ak=this.m_prismatic1.GetJointTranslation()}if(this.m_revolute2){ah=this.m_revolute2.GetJointAngle()}else{ah=this.m_prismatic2.GetJointTranslation()}var aj=this.m_constant-(ak+this.m_ratio*ah);var ag=(-this.m_mass*aj);al.m_sweep.c.x+=al.m_invMass*ag*this.m_J.linearA.x;al.m_sweep.c.y+=al.m_invMass*ag*this.m_J.linearA.y;al.m_sweep.a+=al.m_invI*ag*this.m_J.angularA;ai.m_sweep.c.x+=ai.m_invMass*ag*this.m_J.linearB.x;ai.m_sweep.c.y+=ai.m_invMass*ag*this.m_J.linearB.y;ai.m_sweep.a+=ai.m_invI*ag*this.m_J.angularB;al.SynchronizeTransform();ai.SynchronizeTransform();return am<e.b2_linearSlop};Box2D.inherit(M,Box2D.Dynamics.Joints.b2JointDef);M.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;M.b2GearJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments)};M.prototype.b2GearJointDef=function(){this.__super.b2JointDef.call(this);this.type=n.e_gearJoint;this.joint1=null;this.joint2=null;this.ratio=1};X.b2Jacobian=function(){this.linearA=new Z();this.linearB=new Z()};X.prototype.SetZero=function(){this.linearA.SetZero();this.angularA=0;this.linearB.SetZero();this.angularB=0};X.prototype.Set=function(ai,ag,ah,af){if(ag===undefined){ag=0}if(af===undefined){af=0}this.linearA.SetV(ai);this.angularA=ag;this.linearB.SetV(ah);this.angularB=af};X.prototype.Compute=function(ai,ag,ah,af){if(ag===undefined){ag=0}if(af===undefined){af=0}return(this.linearA.x*ai.x+this.linearA.y*ai.y)+this.angularA*ag+(this.linearB.x*ah.x+this.linearB.y*ah.y)+this.angularB*af};n.b2Joint=function(){this.m_edgeA=new aa();this.m_edgeB=new aa();this.m_localCenterA=new Z();this.m_localCenterB=new Z()};n.prototype.GetType=function(){return this.m_type};n.prototype.GetAnchorA=function(){return null};n.prototype.GetAnchorB=function(){return null};n.prototype.GetReactionForce=function(af){if(af===undefined){af=0}return null};n.prototype.GetReactionTorque=function(af){if(af===undefined){af=0}return 0};n.prototype.GetBodyA=function(){return this.m_bodyA};n.prototype.GetBodyB=function(){return this.m_bodyB};n.prototype.GetNext=function(){return this.m_next};n.prototype.GetUserData=function(){return this.m_userData};n.prototype.SetUserData=function(af){this.m_userData=af};n.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()};n.Create=function(ag,af){var ah=null;switch(ag.type){case n.e_distanceJoint:ah=new C((ag instanceof ac?ag:null));break;case n.e_mouseJoint:ah=new Q((ag instanceof f?ag:null));break;case n.e_prismaticJoint:ah=new y((ag instanceof F?ag:null));break;case n.e_revoluteJoint:ah=new P((ag instanceof b?ag:null));break;case n.e_pulleyJoint:ah=new j((ag instanceof ad?ag:null));break;case n.e_gearJoint:ah=new L((ag instanceof M?ag:null));break;case n.e_lineJoint:ah=new v((ag instanceof k?ag:null));break;case n.e_weldJoint:ah=new g((ag instanceof J?ag:null));break;case n.e_frictionJoint:ah=new d((ag instanceof K?ag:null));break;default:break}return ah};n.Destroy=function(ag,af){};n.prototype.b2Joint=function(af){e.b2Assert(af.bodyA!=af.bodyB);this.m_type=af.type;this.m_prev=null;this.m_next=null;this.m_bodyA=af.bodyA;this.m_bodyB=af.bodyB;this.m_collideConnected=af.collideConnected;this.m_islandFlag=false;this.m_userData=af.userData};n.prototype.InitVelocityConstraints=function(af){};n.prototype.SolveVelocityConstraints=function(af){};n.prototype.FinalizeVelocityConstraints=function(){};n.prototype.SolvePositionConstraints=function(af){if(af===undefined){af=0}return false};Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2Joint.e_unknownJoint=0;Box2D.Dynamics.Joints.b2Joint.e_revoluteJoint=1;Box2D.Dynamics.Joints.b2Joint.e_prismaticJoint=2;Box2D.Dynamics.Joints.b2Joint.e_distanceJoint=3;Box2D.Dynamics.Joints.b2Joint.e_pulleyJoint=4;Box2D.Dynamics.Joints.b2Joint.e_mouseJoint=5;Box2D.Dynamics.Joints.b2Joint.e_gearJoint=6;Box2D.Dynamics.Joints.b2Joint.e_lineJoint=7;Box2D.Dynamics.Joints.b2Joint.e_weldJoint=8;Box2D.Dynamics.Joints.b2Joint.e_frictionJoint=9;Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit=0;Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit=1;Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit=2;Box2D.Dynamics.Joints.b2Joint.e_equalLimits=3});S.b2JointDef=function(){};S.prototype.b2JointDef=function(){this.type=n.e_unknownJoint;this.userData=null;this.bodyA=null;this.bodyB=null;this.collideConnected=false};aa.b2JointEdge=function(){};Box2D.inherit(v,Box2D.Dynamics.Joints.b2Joint);v.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;v.b2LineJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchor1=new Z();this.m_localAnchor2=new Z();this.m_localXAxis1=new Z();this.m_localYAxis1=new Z();this.m_axis=new Z();this.m_perp=new Z();this.m_K=new R();this.m_impulse=new Z()};v.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};v.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};v.prototype.GetReactionForce=function(af){if(af===undefined){af=0}return new Z(af*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x),af*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y))};v.prototype.GetReactionTorque=function(af){if(af===undefined){af=0}return af*this.m_impulse.y};v.prototype.GetJointTranslation=function(){var ah=this.m_bodyA;var ag=this.m_bodyB;var al;var an=ah.GetWorldPoint(this.m_localAnchor1);var am=ag.GetWorldPoint(this.m_localAnchor2);var ak=am.x-an.x;var aj=am.y-an.y;var ai=ah.GetWorldVector(this.m_localXAxis1);var af=ai.x*ak+ai.y*aj;return af};v.prototype.GetJointSpeed=function(){var az=this.m_bodyA;var ay=this.m_bodyB;var ao;ao=az.m_xf.R;var ax=this.m_localAnchor1.x-az.m_sweep.localCenter.x;var aw=this.m_localAnchor1.y-az.m_sweep.localCenter.y;var ar=(ao.col1.x*ax+ao.col2.x*aw);aw=(ao.col1.y*ax+ao.col2.y*aw);ax=ar;ao=ay.m_xf.R;var an=this.m_localAnchor2.x-ay.m_sweep.localCenter.x;var am=this.m_localAnchor2.y-ay.m_sweep.localCenter.y;ar=(ao.col1.x*an+ao.col2.x*am);am=(ao.col1.y*an+ao.col2.y*am);an=ar;var av=az.m_sweep.c.x+ax;var at=az.m_sweep.c.y+aw;var ah=ay.m_sweep.c.x+an;var af=ay.m_sweep.c.y+am;var al=ah-av;var ak=af-at;var aj=az.GetWorldVector(this.m_localXAxis1);var ai=az.m_linearVelocity;var ag=ay.m_linearVelocity;var aq=az.m_angularVelocity;var ap=ay.m_angularVelocity;var au=(al*((-aq*aj.y))+ak*(aq*aj.x))+(aj.x*(((ag.x+((-ap*am)))-ai.x)-((-aq*aw)))+aj.y*(((ag.y+(ap*an))-ai.y)-(aq*ax)));return au};v.prototype.IsLimitEnabled=function(){return this.m_enableLimit};v.prototype.EnableLimit=function(af){this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_enableLimit=af};v.prototype.GetLowerLimit=function(){return this.m_lowerTranslation};v.prototype.GetUpperLimit=function(){return this.m_upperTranslation};v.prototype.SetLimits=function(af,ag){if(af===undefined){af=0}if(ag===undefined){ag=0}this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_lowerTranslation=af;this.m_upperTranslation=ag};v.prototype.IsMotorEnabled=function(){return this.m_enableMotor};v.prototype.EnableMotor=function(af){this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_enableMotor=af};v.prototype.SetMotorSpeed=function(af){if(af===undefined){af=0}this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_motorSpeed=af};v.prototype.GetMotorSpeed=function(){return this.m_motorSpeed};v.prototype.SetMaxMotorForce=function(af){if(af===undefined){af=0}this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_maxMotorForce=af};v.prototype.GetMaxMotorForce=function(){return this.m_maxMotorForce};v.prototype.GetMotorForce=function(){return this.m_motorImpulse};v.prototype.b2LineJoint=function(ah){this.__super.b2Joint.call(this,ah);var ag;var af=0;var ai=0;this.m_localAnchor1.SetV(ah.localAnchorA);this.m_localAnchor2.SetV(ah.localAnchorB);this.m_localXAxis1.SetV(ah.localAxisA);this.m_localYAxis1.x=(-this.m_localXAxis1.y);this.m_localYAxis1.y=this.m_localXAxis1.x;this.m_impulse.SetZero();this.m_motorMass=0;this.m_motorImpulse=0;this.m_lowerTranslation=ah.lowerTranslation;this.m_upperTranslation=ah.upperTranslation;this.m_maxMotorForce=ah.maxMotorForce;this.m_motorSpeed=ah.motorSpeed;this.m_enableLimit=ah.enableLimit;this.m_enableMotor=ah.enableMotor;this.m_limitState=n.e_inactiveLimit;this.m_axis.SetZero();this.m_perp.SetZero()};v.prototype.InitVelocityConstraints=function(an){var aB=this.m_bodyA;var aA=this.m_bodyB;var aq;var ar=0;this.m_localCenterA.SetV(aB.GetLocalCenter());this.m_localCenterB.SetV(aA.GetLocalCenter());var ai=aB.GetTransform();var ag=aA.GetTransform();aq=aB.m_xf.R;var az=this.m_localAnchor1.x-this.m_localCenterA.x;var ax=this.m_localAnchor1.y-this.m_localCenterA.y;ar=(aq.col1.x*az+aq.col2.x*ax);ax=(aq.col1.y*az+aq.col2.y*ax);az=ar;aq=aA.m_xf.R;var am=this.m_localAnchor2.x-this.m_localCenterB.x;var al=this.m_localAnchor2.y-this.m_localCenterB.y;ar=(aq.col1.x*am+aq.col2.x*al);al=(aq.col1.y*am+aq.col2.y*al);am=ar;var ak=aA.m_sweep.c.x+am-aB.m_sweep.c.x-az;var aj=aA.m_sweep.c.y+al-aB.m_sweep.c.y-ax;this.m_invMassA=aB.m_invMass;this.m_invMassB=aA.m_invMass;this.m_invIA=aB.m_invI;this.m_invIB=aA.m_invI;this.m_axis.SetV(D.MulMV(ai.R,this.m_localXAxis1));this.m_a1=(ak+az)*this.m_axis.y-(aj+ax)*this.m_axis.x;this.m_a2=am*this.m_axis.y-al*this.m_axis.x;this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2;this.m_motorMass=this.m_motorMass>Number.MIN_VALUE?1/this.m_motorMass:0;this.m_perp.SetV(D.MulMV(ai.R,this.m_localYAxis1));this.m_s1=(ak+az)*this.m_perp.y-(aj+ax)*this.m_perp.x;this.m_s2=am*this.m_perp.y-al*this.m_perp.x;var ah=this.m_invMassA;var af=this.m_invMassB;var au=this.m_invIA;var at=this.m_invIB;this.m_K.col1.x=ah+af+au*this.m_s1*this.m_s1+at*this.m_s2*this.m_s2;this.m_K.col1.y=au*this.m_s1*this.m_a1+at*this.m_s2*this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=ah+af+au*this.m_a1*this.m_a1+at*this.m_a2*this.m_a2;if(this.m_enableLimit){var ay=this.m_axis.x*ak+this.m_axis.y*aj;if(D.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*e.b2_linearSlop){this.m_limitState=n.e_equalLimits}else{if(ay<=this.m_lowerTranslation){if(this.m_limitState!=n.e_atLowerLimit){this.m_limitState=n.e_atLowerLimit;this.m_impulse.y=0}}else{if(ay>=this.m_upperTranslation){if(this.m_limitState!=n.e_atUpperLimit){this.m_limitState=n.e_atUpperLimit;this.m_impulse.y=0}}else{this.m_limitState=n.e_inactiveLimit;this.m_impulse.y=0}}}}else{this.m_limitState=n.e_inactiveLimit}if(this.m_enableMotor==false){this.m_motorImpulse=0}if(an.warmStarting){this.m_impulse.x*=an.dtRatio;this.m_impulse.y*=an.dtRatio;this.m_motorImpulse*=an.dtRatio;var ap=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x;var ao=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y;var aw=this.m_impulse.x*this.m_s1+(this.m_motorImpulse+this.m_impulse.y)*this.m_a1;var av=this.m_impulse.x*this.m_s2+(this.m_motorImpulse+this.m_impulse.y)*this.m_a2;aB.m_linearVelocity.x-=this.m_invMassA*ap;aB.m_linearVelocity.y-=this.m_invMassA*ao;aB.m_angularVelocity-=this.m_invIA*aw;aA.m_linearVelocity.x+=this.m_invMassB*ap;aA.m_linearVelocity.y+=this.m_invMassB*ao;aA.m_angularVelocity+=this.m_invIB*av}else{this.m_impulse.SetZero();this.m_motorImpulse=0}};v.prototype.SolveVelocityConstraints=function(al){var aB=this.m_bodyA;var az=this.m_bodyB;var aj=aB.m_linearVelocity;var aq=aB.m_angularVelocity;var ai=az.m_linearVelocity;var ap=az.m_angularVelocity;var an=0;var am=0;var aw=0;var av=0;if(this.m_enableMotor&&this.m_limitState!=n.e_equalLimits){var at=this.m_axis.x*(ai.x-aj.x)+this.m_axis.y*(ai.y-aj.y)+this.m_a2*ap-this.m_a1*aq;var ao=this.m_motorMass*(this.m_motorSpeed-at);var ak=this.m_motorImpulse;var ar=al.dt*this.m_maxMotorForce;this.m_motorImpulse=D.Clamp(this.m_motorImpulse+ao,(-ar),ar);ao=this.m_motorImpulse-ak;an=ao*this.m_axis.x;am=ao*this.m_axis.y;aw=ao*this.m_a1;av=ao*this.m_a2;aj.x-=this.m_invMassA*an;aj.y-=this.m_invMassA*am;aq-=this.m_invIA*aw;ai.x+=this.m_invMassB*an;ai.y+=this.m_invMassB*am;ap+=this.m_invIB*av}var ah=this.m_perp.x*(ai.x-aj.x)+this.m_perp.y*(ai.y-aj.y)+this.m_s2*ap-this.m_s1*aq;if(this.m_enableLimit&&this.m_limitState!=n.e_inactiveLimit){var ag=this.m_axis.x*(ai.x-aj.x)+this.m_axis.y*(ai.y-aj.y)+this.m_a2*ap-this.m_a1*aq;var au=this.m_impulse.Copy();var ax=this.m_K.Solve(new Z(),(-ah),(-ag));this.m_impulse.Add(ax);if(this.m_limitState==n.e_atLowerLimit){this.m_impulse.y=D.Max(this.m_impulse.y,0)}else{if(this.m_limitState==n.e_atUpperLimit){this.m_impulse.y=D.Min(this.m_impulse.y,0)}}var ay=(-ah)-(this.m_impulse.y-au.y)*this.m_K.col2.x;var af=0;if(this.m_K.col1.x!=0){af=ay/this.m_K.col1.x+au.x}else{af=au.x}this.m_impulse.x=af;ax.x=this.m_impulse.x-au.x;ax.y=this.m_impulse.y-au.y;an=ax.x*this.m_perp.x+ax.y*this.m_axis.x;am=ax.x*this.m_perp.y+ax.y*this.m_axis.y;aw=ax.x*this.m_s1+ax.y*this.m_a1;av=ax.x*this.m_s2+ax.y*this.m_a2;aj.x-=this.m_invMassA*an;aj.y-=this.m_invMassA*am;aq-=this.m_invIA*aw;ai.x+=this.m_invMassB*an;ai.y+=this.m_invMassB*am;ap+=this.m_invIB*av}else{var aA=0;if(this.m_K.col1.x!=0){aA=((-ah))/this.m_K.col1.x}else{aA=0}this.m_impulse.x+=aA;an=aA*this.m_perp.x;am=aA*this.m_perp.y;aw=aA*this.m_s1;av=aA*this.m_s2;aj.x-=this.m_invMassA*an;aj.y-=this.m_invMassA*am;aq-=this.m_invIA*aw;ai.x+=this.m_invMassB*an;ai.y+=this.m_invMassB*am;ap+=this.m_invIB*av}aB.m_linearVelocity.SetV(aj);aB.m_angularVelocity=aq;az.m_linearVelocity.SetV(ai);az.m_angularVelocity=ap};v.prototype.SolvePositionConstraints=function(aq){if(aq===undefined){aq=0}var af=0;var aC=0;var ao=this.m_bodyA;var an=this.m_bodyB;var aj=ao.m_sweep.c;var aG=ao.m_sweep.a;var ai=an.m_sweep.c;var aF=an.m_sweep.a;var aH;var am=0;var aN=0;var aM=0;var al=0;var ak=0;var ah=0;var ap=0;var aJ=false;var aw=0;var aB=R.FromAngle(aG);var aA=R.FromAngle(aF);aH=aB;var aL=this.m_localAnchor1.x-this.m_localCenterA.x;var aK=this.m_localAnchor1.y-this.m_localCenterA.y;am=(aH.col1.x*aL+aH.col2.x*aK);aK=(aH.col1.y*aL+aH.col2.y*aK);aL=am;aH=aA;var av=this.m_localAnchor2.x-this.m_localCenterB.x;var au=this.m_localAnchor2.y-this.m_localCenterB.y;am=(aH.col1.x*av+aH.col2.x*au);au=(aH.col1.y*av+aH.col2.y*au);av=am;var at=ai.x+av-aj.x-aL;var ar=ai.y+au-aj.y-aK;if(this.m_enableLimit){this.m_axis=D.MulMV(aB,this.m_localXAxis1);this.m_a1=(at+aL)*this.m_axis.y-(ar+aK)*this.m_axis.x;this.m_a2=av*this.m_axis.y-au*this.m_axis.x;var aI=this.m_axis.x*at+this.m_axis.y*ar;if(D.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*e.b2_linearSlop){aw=D.Clamp(aI,(-e.b2_maxLinearCorrection),e.b2_maxLinearCorrection);ah=D.Abs(aI);aJ=true}else{if(aI<=this.m_lowerTranslation){aw=D.Clamp(aI-this.m_lowerTranslation+e.b2_linearSlop,(-e.b2_maxLinearCorrection),0);ah=this.m_lowerTranslation-aI;aJ=true}else{if(aI>=this.m_upperTranslation){aw=D.Clamp(aI-this.m_upperTranslation+e.b2_linearSlop,0,e.b2_maxLinearCorrection);ah=aI-this.m_upperTranslation;aJ=true}}}}this.m_perp=D.MulMV(aB,this.m_localYAxis1);this.m_s1=(at+aL)*this.m_perp.y-(ar+aK)*this.m_perp.x;this.m_s2=av*this.m_perp.y-au*this.m_perp.x;var aD=new Z();var ax=this.m_perp.x*at+this.m_perp.y*ar;ah=D.Max(ah,D.Abs(ax));ap=0;if(aJ){aN=this.m_invMassA;aM=this.m_invMassB;al=this.m_invIA;ak=this.m_invIB;this.m_K.col1.x=aN+aM+al*this.m_s1*this.m_s1+ak*this.m_s2*this.m_s2;this.m_K.col1.y=al*this.m_s1*this.m_a1+ak*this.m_s2*this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=aN+aM+al*this.m_a1*this.m_a1+ak*this.m_a2*this.m_a2;this.m_K.Solve(aD,(-ax),(-aw))}else{aN=this.m_invMassA;aM=this.m_invMassB;al=this.m_invIA;ak=this.m_invIB;var ag=aN+aM+al*this.m_s1*this.m_s1+ak*this.m_s2*this.m_s2;var aE=0;if(ag!=0){aE=((-ax))/ag}else{aE=0}aD.x=aE;aD.y=0}var aP=aD.x*this.m_perp.x+aD.y*this.m_axis.x;var aO=aD.x*this.m_perp.y+aD.y*this.m_axis.y;var az=aD.x*this.m_s1+aD.y*this.m_a1;var ay=aD.x*this.m_s2+aD.y*this.m_a2;aj.x-=this.m_invMassA*aP;aj.y-=this.m_invMassA*aO;aG-=this.m_invIA*az;ai.x+=this.m_invMassB*aP;ai.y+=this.m_invMassB*aO;aF+=this.m_invIB*ay;ao.m_sweep.a=aG;an.m_sweep.a=aF;ao.SynchronizeTransform();an.SynchronizeTransform();return ah<=e.b2_linearSlop&&ap<=e.b2_angularSlop};Box2D.inherit(k,Box2D.Dynamics.Joints.b2JointDef);k.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;k.b2LineJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new Z();this.localAnchorB=new Z();this.localAxisA=new Z()};k.prototype.b2LineJointDef=function(){this.__super.b2JointDef.call(this);this.type=n.e_lineJoint;this.localAxisA.Set(1,0);this.enableLimit=false;this.lowerTranslation=0;this.upperTranslation=0;this.enableMotor=false;this.maxMotorForce=0;this.motorSpeed=0};k.prototype.Initialize=function(ai,ah,af,ag){this.bodyA=ai;this.bodyB=ah;this.localAnchorA=this.bodyA.GetLocalPoint(af);this.localAnchorB=this.bodyB.GetLocalPoint(af);this.localAxisA=this.bodyA.GetLocalVector(ag)};Box2D.inherit(Q,Box2D.Dynamics.Joints.b2Joint);Q.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;Q.b2MouseJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.K=new R();this.K1=new R();this.K2=new R();this.m_localAnchor=new Z();this.m_target=new Z();this.m_impulse=new Z();this.m_mass=new R();this.m_C=new Z()};Q.prototype.GetAnchorA=function(){return this.m_target};Q.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor)};Q.prototype.GetReactionForce=function(af){if(af===undefined){af=0}return new Z(af*this.m_impulse.x,af*this.m_impulse.y)};Q.prototype.GetReactionTorque=function(af){if(af===undefined){af=0}return 0};Q.prototype.GetTarget=function(){return this.m_target};Q.prototype.SetTarget=function(af){if(this.m_bodyB.IsAwake()==false){this.m_bodyB.SetAwake(true)}this.m_target=af};Q.prototype.GetMaxForce=function(){return this.m_maxForce};Q.prototype.SetMaxForce=function(af){if(af===undefined){af=0}this.m_maxForce=af};Q.prototype.GetFrequency=function(){return this.m_frequencyHz};Q.prototype.SetFrequency=function(af){if(af===undefined){af=0}this.m_frequencyHz=af};Q.prototype.GetDampingRatio=function(){return this.m_dampingRatio};Q.prototype.SetDampingRatio=function(af){if(af===undefined){af=0}this.m_dampingRatio=af};Q.prototype.b2MouseJoint=function(ah){this.__super.b2Joint.call(this,ah);this.m_target.SetV(ah.target);var af=this.m_target.x-this.m_bodyB.m_xf.position.x;var ai=this.m_target.y-this.m_bodyB.m_xf.position.y;var ag=this.m_bodyB.m_xf.R;this.m_localAnchor.x=(af*ag.col1.x+ai*ag.col1.y);this.m_localAnchor.y=(af*ag.col2.x+ai*ag.col2.y);this.m_maxForce=ah.maxForce;this.m_impulse.SetZero();this.m_frequencyHz=ah.frequencyHz;this.m_dampingRatio=ah.dampingRatio;this.m_beta=0;this.m_gamma=0};Q.prototype.InitVelocityConstraints=function(af){var ao=this.m_bodyB;var am=ao.GetMass();var aq=2*Math.PI*this.m_frequencyHz;var al=2*am*this.m_dampingRatio*aq;var ai=am*aq*aq;this.m_gamma=af.dt*(al+af.dt*ai);this.m_gamma=this.m_gamma!=0?1/this.m_gamma:0;this.m_beta=af.dt*ai*this.m_gamma;var an;an=ao.m_xf.R;var ak=this.m_localAnchor.x-ao.m_sweep.localCenter.x;var aj=this.m_localAnchor.y-ao.m_sweep.localCenter.y;var ap=(an.col1.x*ak+an.col2.x*aj);aj=(an.col1.y*ak+an.col2.y*aj);ak=ap;var ah=ao.m_invMass;var ag=ao.m_invI;this.K1.col1.x=ah;this.K1.col2.x=0;this.K1.col1.y=0;this.K1.col2.y=ah;this.K2.col1.x=ag*aj*aj;this.K2.col2.x=(-ag*ak*aj);this.K2.col1.y=(-ag*ak*aj);this.K2.col2.y=ag*ak*ak;this.K.SetM(this.K1);this.K.AddM(this.K2);this.K.col1.x+=this.m_gamma;this.K.col2.y+=this.m_gamma;this.K.GetInverse(this.m_mass);this.m_C.x=ao.m_sweep.c.x+ak-this.m_target.x;this.m_C.y=ao.m_sweep.c.y+aj-this.m_target.y;ao.m_angularVelocity*=0.98;this.m_impulse.x*=af.dtRatio;this.m_impulse.y*=af.dtRatio;ao.m_linearVelocity.x+=ah*this.m_impulse.x;ao.m_linearVelocity.y+=ah*this.m_impulse.y;ao.m_angularVelocity+=ag*(ak*this.m_impulse.y-aj*this.m_impulse.x)};Q.prototype.SolveVelocityConstraints=function(ai){var ap=this.m_bodyB;var ao;var ar=0;var aq=0;ao=ap.m_xf.R;var am=this.m_localAnchor.x-ap.m_sweep.localCenter.x;var ak=this.m_localAnchor.y-ap.m_sweep.localCenter.y;ar=(ao.col1.x*am+ao.col2.x*ak);ak=(ao.col1.y*am+ao.col2.y*ak);am=ar;var af=ap.m_linearVelocity.x+((-ap.m_angularVelocity*ak));var at=ap.m_linearVelocity.y+(ap.m_angularVelocity*am);ao=this.m_mass;ar=af+this.m_beta*this.m_C.x+this.m_gamma*this.m_impulse.x;aq=at+this.m_beta*this.m_C.y+this.m_gamma*this.m_impulse.y;var aj=(-(ao.col1.x*ar+ao.col2.x*aq));var ah=(-(ao.col1.y*ar+ao.col2.y*aq));var an=this.m_impulse.x;var al=this.m_impulse.y;this.m_impulse.x+=aj;this.m_impulse.y+=ah;var ag=ai.dt*this.m_maxForce;if(this.m_impulse.LengthSquared()>ag*ag){this.m_impulse.Multiply(ag/this.m_impulse.Length())}aj=this.m_impulse.x-an;ah=this.m_impulse.y-al;ap.m_linearVelocity.x+=ap.m_invMass*aj;ap.m_linearVelocity.y+=ap.m_invMass*ah;ap.m_angularVelocity+=ap.m_invI*(am*ah-ak*aj)};Q.prototype.SolvePositionConstraints=function(af){if(af===undefined){af=0}return true};Box2D.inherit(f,Box2D.Dynamics.Joints.b2JointDef);f.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;f.b2MouseJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.target=new Z()};f.prototype.b2MouseJointDef=function(){this.__super.b2JointDef.call(this);this.type=n.e_mouseJoint;this.maxForce=0;this.frequencyHz=5;this.dampingRatio=0.7};Box2D.inherit(y,Box2D.Dynamics.Joints.b2Joint);y.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;y.b2PrismaticJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchor1=new Z();this.m_localAnchor2=new Z();this.m_localXAxis1=new Z();this.m_localYAxis1=new Z();this.m_axis=new Z();this.m_perp=new Z();this.m_K=new u();this.m_impulse=new Y()};y.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};y.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};y.prototype.GetReactionForce=function(af){if(af===undefined){af=0}return new Z(af*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),af*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y))};y.prototype.GetReactionTorque=function(af){if(af===undefined){af=0}return af*this.m_impulse.y};y.prototype.GetJointTranslation=function(){var ah=this.m_bodyA;var ag=this.m_bodyB;var al;var an=ah.GetWorldPoint(this.m_localAnchor1);var am=ag.GetWorldPoint(this.m_localAnchor2);var ak=am.x-an.x;var aj=am.y-an.y;var ai=ah.GetWorldVector(this.m_localXAxis1);var af=ai.x*ak+ai.y*aj;return af};y.prototype.GetJointSpeed=function(){var az=this.m_bodyA;var ay=this.m_bodyB;var ao;ao=az.m_xf.R;var ax=this.m_localAnchor1.x-az.m_sweep.localCenter.x;var aw=this.m_localAnchor1.y-az.m_sweep.localCenter.y;var ar=(ao.col1.x*ax+ao.col2.x*aw);aw=(ao.col1.y*ax+ao.col2.y*aw);ax=ar;ao=ay.m_xf.R;var an=this.m_localAnchor2.x-ay.m_sweep.localCenter.x;var am=this.m_localAnchor2.y-ay.m_sweep.localCenter.y;ar=(ao.col1.x*an+ao.col2.x*am);am=(ao.col1.y*an+ao.col2.y*am);an=ar;var av=az.m_sweep.c.x+ax;var at=az.m_sweep.c.y+aw;var ah=ay.m_sweep.c.x+an;var af=ay.m_sweep.c.y+am;var al=ah-av;var ak=af-at;var aj=az.GetWorldVector(this.m_localXAxis1);var ai=az.m_linearVelocity;var ag=ay.m_linearVelocity;var aq=az.m_angularVelocity;var ap=ay.m_angularVelocity;var au=(al*((-aq*aj.y))+ak*(aq*aj.x))+(aj.x*(((ag.x+((-ap*am)))-ai.x)-((-aq*aw)))+aj.y*(((ag.y+(ap*an))-ai.y)-(aq*ax)));return au};y.prototype.IsLimitEnabled=function(){return this.m_enableLimit};y.prototype.EnableLimit=function(af){this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_enableLimit=af};y.prototype.GetLowerLimit=function(){return this.m_lowerTranslation};y.prototype.GetUpperLimit=function(){return this.m_upperTranslation};y.prototype.SetLimits=function(af,ag){if(af===undefined){af=0}if(ag===undefined){ag=0}this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_lowerTranslation=af;this.m_upperTranslation=ag};y.prototype.IsMotorEnabled=function(){return this.m_enableMotor};y.prototype.EnableMotor=function(af){this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_enableMotor=af};y.prototype.SetMotorSpeed=function(af){if(af===undefined){af=0}this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_motorSpeed=af};y.prototype.GetMotorSpeed=function(){return this.m_motorSpeed};y.prototype.SetMaxMotorForce=function(af){if(af===undefined){af=0}this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_maxMotorForce=af};y.prototype.GetMotorForce=function(){return this.m_motorImpulse};y.prototype.b2PrismaticJoint=function(ah){this.__super.b2Joint.call(this,ah);var ag;var af=0;var ai=0;this.m_localAnchor1.SetV(ah.localAnchorA);this.m_localAnchor2.SetV(ah.localAnchorB);this.m_localXAxis1.SetV(ah.localAxisA);this.m_localYAxis1.x=(-this.m_localXAxis1.y);this.m_localYAxis1.y=this.m_localXAxis1.x;this.m_refAngle=ah.referenceAngle;this.m_impulse.SetZero();this.m_motorMass=0;this.m_motorImpulse=0;this.m_lowerTranslation=ah.lowerTranslation;this.m_upperTranslation=ah.upperTranslation;this.m_maxMotorForce=ah.maxMotorForce;this.m_motorSpeed=ah.motorSpeed;this.m_enableLimit=ah.enableLimit;this.m_enableMotor=ah.enableMotor;this.m_limitState=n.e_inactiveLimit;this.m_axis.SetZero();this.m_perp.SetZero()};y.prototype.InitVelocityConstraints=function(an){var aB=this.m_bodyA;var aA=this.m_bodyB;var aq;var ar=0;this.m_localCenterA.SetV(aB.GetLocalCenter());this.m_localCenterB.SetV(aA.GetLocalCenter());var ai=aB.GetTransform();var ag=aA.GetTransform();aq=aB.m_xf.R;var az=this.m_localAnchor1.x-this.m_localCenterA.x;var ax=this.m_localAnchor1.y-this.m_localCenterA.y;ar=(aq.col1.x*az+aq.col2.x*ax);ax=(aq.col1.y*az+aq.col2.y*ax);az=ar;aq=aA.m_xf.R;var am=this.m_localAnchor2.x-this.m_localCenterB.x;var al=this.m_localAnchor2.y-this.m_localCenterB.y;ar=(aq.col1.x*am+aq.col2.x*al);al=(aq.col1.y*am+aq.col2.y*al);am=ar;var ak=aA.m_sweep.c.x+am-aB.m_sweep.c.x-az;var aj=aA.m_sweep.c.y+al-aB.m_sweep.c.y-ax;this.m_invMassA=aB.m_invMass;this.m_invMassB=aA.m_invMass;this.m_invIA=aB.m_invI;this.m_invIB=aA.m_invI;this.m_axis.SetV(D.MulMV(ai.R,this.m_localXAxis1));this.m_a1=(ak+az)*this.m_axis.y-(aj+ax)*this.m_axis.x;this.m_a2=am*this.m_axis.y-al*this.m_axis.x;this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2;if(this.m_motorMass>Number.MIN_VALUE){this.m_motorMass=1/this.m_motorMass}this.m_perp.SetV(D.MulMV(ai.R,this.m_localYAxis1));this.m_s1=(ak+az)*this.m_perp.y-(aj+ax)*this.m_perp.x;this.m_s2=am*this.m_perp.y-al*this.m_perp.x;var ah=this.m_invMassA;var af=this.m_invMassB;var au=this.m_invIA;var at=this.m_invIB;this.m_K.col1.x=ah+af+au*this.m_s1*this.m_s1+at*this.m_s2*this.m_s2;this.m_K.col1.y=au*this.m_s1+at*this.m_s2;this.m_K.col1.z=au*this.m_s1*this.m_a1+at*this.m_s2*this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=au+at;this.m_K.col2.z=au*this.m_a1+at*this.m_a2;this.m_K.col3.x=this.m_K.col1.z;this.m_K.col3.y=this.m_K.col2.z;this.m_K.col3.z=ah+af+au*this.m_a1*this.m_a1+at*this.m_a2*this.m_a2;if(this.m_enableLimit){var ay=this.m_axis.x*ak+this.m_axis.y*aj;if(D.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*e.b2_linearSlop){this.m_limitState=n.e_equalLimits}else{if(ay<=this.m_lowerTranslation){if(this.m_limitState!=n.e_atLowerLimit){this.m_limitState=n.e_atLowerLimit;this.m_impulse.z=0}}else{if(ay>=this.m_upperTranslation){if(this.m_limitState!=n.e_atUpperLimit){this.m_limitState=n.e_atUpperLimit;this.m_impulse.z=0}}else{this.m_limitState=n.e_inactiveLimit;this.m_impulse.z=0}}}}else{this.m_limitState=n.e_inactiveLimit}if(this.m_enableMotor==false){this.m_motorImpulse=0}if(an.warmStarting){this.m_impulse.x*=an.dtRatio;this.m_impulse.y*=an.dtRatio;this.m_motorImpulse*=an.dtRatio;var ap=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x;var ao=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y;var aw=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1;var av=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;aB.m_linearVelocity.x-=this.m_invMassA*ap;aB.m_linearVelocity.y-=this.m_invMassA*ao;aB.m_angularVelocity-=this.m_invIA*aw;aA.m_linearVelocity.x+=this.m_invMassB*ap;aA.m_linearVelocity.y+=this.m_invMassB*ao;aA.m_angularVelocity+=this.m_invIB*av}else{this.m_impulse.SetZero();this.m_motorImpulse=0}};y.prototype.SolveVelocityConstraints=function(ak){var aD=this.m_bodyA;var aB=this.m_bodyB;var ai=aD.m_linearVelocity;var aq=aD.m_angularVelocity;var ah=aB.m_linearVelocity;var ao=aB.m_angularVelocity;var am=0;var al=0;var az=0;var ay=0;if(this.m_enableMotor&&this.m_limitState!=n.e_equalLimits){var au=this.m_axis.x*(ah.x-ai.x)+this.m_axis.y*(ah.y-ai.y)+this.m_a2*ao-this.m_a1*aq;var an=this.m_motorMass*(this.m_motorSpeed-au);var aj=this.m_motorImpulse;var at=ak.dt*this.m_maxMotorForce;this.m_motorImpulse=D.Clamp(this.m_motorImpulse+an,(-at),at);an=this.m_motorImpulse-aj;am=an*this.m_axis.x;al=an*this.m_axis.y;az=an*this.m_a1;ay=an*this.m_a2;ai.x-=this.m_invMassA*am;ai.y-=this.m_invMassA*al;aq-=this.m_invIA*az;ah.x+=this.m_invMassB*am;ah.y+=this.m_invMassB*al;ao+=this.m_invIB*ay}var ax=this.m_perp.x*(ah.x-ai.x)+this.m_perp.y*(ah.y-ai.y)+this.m_s2*ao-this.m_s1*aq;var aw=ao-aq;if(this.m_enableLimit&&this.m_limitState!=n.e_inactiveLimit){var ag=this.m_axis.x*(ah.x-ai.x)+this.m_axis.y*(ah.y-ai.y)+this.m_a2*ao-this.m_a1*aq;var av=this.m_impulse.Copy();var aA=this.m_K.Solve33(new Y(),(-ax),(-aw),(-ag));this.m_impulse.Add(aA);if(this.m_limitState==n.e_atLowerLimit){this.m_impulse.z=D.Max(this.m_impulse.z,0)}else{if(this.m_limitState==n.e_atUpperLimit){this.m_impulse.z=D.Min(this.m_impulse.z,0)}}var ar=(-ax)-(this.m_impulse.z-av.z)*this.m_K.col3.x;var ap=(-aw)-(this.m_impulse.z-av.z)*this.m_K.col3.y;var af=this.m_K.Solve22(new Z(),ar,ap);af.x+=av.x;af.y+=av.y;this.m_impulse.x=af.x;this.m_impulse.y=af.y;aA.x=this.m_impulse.x-av.x;aA.y=this.m_impulse.y-av.y;aA.z=this.m_impulse.z-av.z;am=aA.x*this.m_perp.x+aA.z*this.m_axis.x;al=aA.x*this.m_perp.y+aA.z*this.m_axis.y;az=aA.x*this.m_s1+aA.y+aA.z*this.m_a1;ay=aA.x*this.m_s2+aA.y+aA.z*this.m_a2;ai.x-=this.m_invMassA*am;ai.y-=this.m_invMassA*al;aq-=this.m_invIA*az;ah.x+=this.m_invMassB*am;ah.y+=this.m_invMassB*al;ao+=this.m_invIB*ay}else{var aC=this.m_K.Solve22(new Z(),(-ax),(-aw));this.m_impulse.x+=aC.x;this.m_impulse.y+=aC.y;am=aC.x*this.m_perp.x;al=aC.x*this.m_perp.y;az=aC.x*this.m_s1+aC.y;ay=aC.x*this.m_s2+aC.y;ai.x-=this.m_invMassA*am;ai.y-=this.m_invMassA*al;aq-=this.m_invIA*az;ah.x+=this.m_invMassB*am;ah.y+=this.m_invMassB*al;ao+=this.m_invIB*ay}aD.m_linearVelocity.SetV(ai);aD.m_angularVelocity=aq;aB.m_linearVelocity.SetV(ah);aB.m_angularVelocity=ao};y.prototype.SolvePositionConstraints=function(au){if(au===undefined){au=0}var af=0;var aE=0;var ar=this.m_bodyA;var ap=this.m_bodyB;var ak=ar.m_sweep.c;var aJ=ar.m_sweep.a;var aj=ap.m_sweep.c;var aI=ap.m_sweep.a;var aK;var an=0;var aQ=0;var aP=0;var am=0;var al=0;var ai=0;var at=0;var aM=false;var az=0;var aD=R.FromAngle(aJ);var aC=R.FromAngle(aI);aK=aD;var aO=this.m_localAnchor1.x-this.m_localCenterA.x;var aN=this.m_localAnchor1.y-this.m_localCenterA.y;an=(aK.col1.x*aO+aK.col2.x*aN);aN=(aK.col1.y*aO+aK.col2.y*aN);aO=an;aK=aC;var ay=this.m_localAnchor2.x-this.m_localCenterB.x;var ax=this.m_localAnchor2.y-this.m_localCenterB.y;an=(aK.col1.x*ay+aK.col2.x*ax);ax=(aK.col1.y*ay+aK.col2.y*ax);ay=an;var aw=aj.x+ay-ak.x-aO;var av=aj.y+ax-ak.y-aN;if(this.m_enableLimit){this.m_axis=D.MulMV(aD,this.m_localXAxis1);this.m_a1=(aw+aO)*this.m_axis.y-(av+aN)*this.m_axis.x;this.m_a2=ay*this.m_axis.y-ax*this.m_axis.x;var aL=this.m_axis.x*aw+this.m_axis.y*av;if(D.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*e.b2_linearSlop){az=D.Clamp(aL,(-e.b2_maxLinearCorrection),e.b2_maxLinearCorrection);ai=D.Abs(aL);aM=true}else{if(aL<=this.m_lowerTranslation){az=D.Clamp(aL-this.m_lowerTranslation+e.b2_linearSlop,(-e.b2_maxLinearCorrection),0);ai=this.m_lowerTranslation-aL;aM=true}else{if(aL>=this.m_upperTranslation){az=D.Clamp(aL-this.m_upperTranslation+e.b2_linearSlop,0,e.b2_maxLinearCorrection);ai=aL-this.m_upperTranslation;aM=true}}}}this.m_perp=D.MulMV(aD,this.m_localYAxis1);this.m_s1=(aw+aO)*this.m_perp.y-(av+aN)*this.m_perp.x;this.m_s2=ay*this.m_perp.y-ax*this.m_perp.x;var aG=new Y();var aq=this.m_perp.x*aw+this.m_perp.y*av;var ao=aI-aJ-this.m_refAngle;ai=D.Max(ai,D.Abs(aq));at=D.Abs(ao);if(aM){aQ=this.m_invMassA;aP=this.m_invMassB;am=this.m_invIA;al=this.m_invIB;this.m_K.col1.x=aQ+aP+am*this.m_s1*this.m_s1+al*this.m_s2*this.m_s2;this.m_K.col1.y=am*this.m_s1+al*this.m_s2;this.m_K.col1.z=am*this.m_s1*this.m_a1+al*this.m_s2*this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=am+al;this.m_K.col2.z=am*this.m_a1+al*this.m_a2;this.m_K.col3.x=this.m_K.col1.z;this.m_K.col3.y=this.m_K.col2.z;this.m_K.col3.z=aQ+aP+am*this.m_a1*this.m_a1+al*this.m_a2*this.m_a2;this.m_K.Solve33(aG,(-aq),(-ao),(-az))}else{aQ=this.m_invMassA;aP=this.m_invMassB;am=this.m_invIA;al=this.m_invIB;var ah=aQ+aP+am*this.m_s1*this.m_s1+al*this.m_s2*this.m_s2;var ag=am*this.m_s1+al*this.m_s2;var aF=am+al;this.m_K.col1.Set(ah,ag,0);this.m_K.col2.Set(ag,aF,0);var aH=this.m_K.Solve22(new Z(),(-aq),(-ao));aG.x=aH.x;aG.y=aH.y;aG.z=0}var aS=aG.x*this.m_perp.x+aG.z*this.m_axis.x;var aR=aG.x*this.m_perp.y+aG.z*this.m_axis.y;var aB=aG.x*this.m_s1+aG.y+aG.z*this.m_a1;var aA=aG.x*this.m_s2+aG.y+aG.z*this.m_a2;ak.x-=this.m_invMassA*aS;ak.y-=this.m_invMassA*aR;aJ-=this.m_invIA*aB;aj.x+=this.m_invMassB*aS;aj.y+=this.m_invMassB*aR;aI+=this.m_invIB*aA;ar.m_sweep.a=aJ;ap.m_sweep.a=aI;ar.SynchronizeTransform();ap.SynchronizeTransform();return ai<=e.b2_linearSlop&&at<=e.b2_angularSlop};Box2D.inherit(F,Box2D.Dynamics.Joints.b2JointDef);F.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;F.b2PrismaticJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new Z();this.localAnchorB=new Z();this.localAxisA=new Z()};F.prototype.b2PrismaticJointDef=function(){this.__super.b2JointDef.call(this);this.type=n.e_prismaticJoint;this.localAxisA.Set(1,0);this.referenceAngle=0;this.enableLimit=false;this.lowerTranslation=0;this.upperTranslation=0;this.enableMotor=false;this.maxMotorForce=0;this.motorSpeed=0};F.prototype.Initialize=function(ai,ah,af,ag){this.bodyA=ai;this.bodyB=ah;this.localAnchorA=this.bodyA.GetLocalPoint(af);this.localAnchorB=this.bodyB.GetLocalPoint(af);this.localAxisA=this.bodyA.GetLocalVector(ag);this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()};Box2D.inherit(j,Box2D.Dynamics.Joints.b2Joint);j.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;j.b2PulleyJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_groundAnchor1=new Z();this.m_groundAnchor2=new Z();this.m_localAnchor1=new Z();this.m_localAnchor2=new Z();this.m_u1=new Z();this.m_u2=new Z()};j.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};j.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};j.prototype.GetReactionForce=function(af){if(af===undefined){af=0}return new Z(af*this.m_impulse*this.m_u2.x,af*this.m_impulse*this.m_u2.y)};j.prototype.GetReactionTorque=function(af){if(af===undefined){af=0}return 0};j.prototype.GetGroundAnchorA=function(){var af=this.m_ground.m_xf.position.Copy();af.Add(this.m_groundAnchor1);return af};j.prototype.GetGroundAnchorB=function(){var af=this.m_ground.m_xf.position.Copy();af.Add(this.m_groundAnchor2);return af};j.prototype.GetLength1=function(){var ai=this.m_bodyA.GetWorldPoint(this.m_localAnchor1);var aj=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x;var ah=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y;var ag=ai.x-aj;var af=ai.y-ah;return Math.sqrt(ag*ag+af*af)};j.prototype.GetLength2=function(){var ai=this.m_bodyB.GetWorldPoint(this.m_localAnchor2);var aj=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x;var ah=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;var ag=ai.x-aj;var af=ai.y-ah;return Math.sqrt(ag*ag+af*af)};j.prototype.GetRatio=function(){return this.m_ratio};j.prototype.b2PulleyJoint=function(ah){this.__super.b2Joint.call(this,ah);var ag;var af=0;var ai=0;this.m_ground=this.m_bodyA.m_world.m_groundBody;this.m_groundAnchor1.x=ah.groundAnchorA.x-this.m_ground.m_xf.position.x;this.m_groundAnchor1.y=ah.groundAnchorA.y-this.m_ground.m_xf.position.y;this.m_groundAnchor2.x=ah.groundAnchorB.x-this.m_ground.m_xf.position.x;this.m_groundAnchor2.y=ah.groundAnchorB.y-this.m_ground.m_xf.position.y;this.m_localAnchor1.SetV(ah.localAnchorA);this.m_localAnchor2.SetV(ah.localAnchorB);this.m_ratio=ah.ratio;this.m_constant=ah.lengthA+this.m_ratio*ah.lengthB;this.m_maxLength1=D.Min(ah.maxLengthA,this.m_constant-this.m_ratio*j.b2_minPulleyLength);this.m_maxLength2=D.Min(ah.maxLengthB,(this.m_constant-j.b2_minPulleyLength)/this.m_ratio);this.m_impulse=0;this.m_limitImpulse1=0;this.m_limitImpulse2=0};j.prototype.InitVelocityConstraints=function(al){var aF=this.m_bodyA;var aE=this.m_bodyB;var ap;ap=aF.m_xf.R;var aC=this.m_localAnchor1.x-aF.m_sweep.localCenter.x;var aB=this.m_localAnchor1.y-aF.m_sweep.localCenter.y;var aw=(ap.col1.x*aC+ap.col2.x*aB);aB=(ap.col1.y*aC+ap.col2.y*aB);aC=aw;ap=aE.m_xf.R;var ak=this.m_localAnchor2.x-aE.m_sweep.localCenter.x;var aj=this.m_localAnchor2.y-aE.m_sweep.localCenter.y;aw=(ap.col1.x*ak+ap.col2.x*aj);aj=(ap.col1.y*ak+ap.col2.y*aj);ak=aw;var aA=aF.m_sweep.c.x+aC;var ay=aF.m_sweep.c.y+aB;var ai=aE.m_sweep.c.x+ak;var ah=aE.m_sweep.c.y+aj;var aq=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x;var ao=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y;var az=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x;var ax=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;this.m_u1.Set(aA-aq,ay-ao);this.m_u2.Set(ai-az,ah-ax);var av=this.m_u1.Length();var au=this.m_u2.Length();if(av>e.b2_linearSlop){this.m_u1.Multiply(1/av)}else{this.m_u1.SetZero()}if(au>e.b2_linearSlop){this.m_u2.Multiply(1/au)}else{this.m_u2.SetZero()}var at=this.m_constant-av-this.m_ratio*au;if(at>0){this.m_state=n.e_inactiveLimit;this.m_impulse=0}else{this.m_state=n.e_atUpperLimit}if(av<this.m_maxLength1){this.m_limitState1=n.e_inactiveLimit;this.m_limitImpulse1=0}else{this.m_limitState1=n.e_atUpperLimit}if(au<this.m_maxLength2){this.m_limitState2=n.e_inactiveLimit;this.m_limitImpulse2=0}else{this.m_limitState2=n.e_atUpperLimit}var aD=aC*this.m_u1.y-aB*this.m_u1.x;var ar=ak*this.m_u2.y-aj*this.m_u2.x;this.m_limitMass1=aF.m_invMass+aF.m_invI*aD*aD;this.m_limitMass2=aE.m_invMass+aE.m_invI*ar*ar;this.m_pulleyMass=this.m_limitMass1+this.m_ratio*this.m_ratio*this.m_limitMass2;this.m_limitMass1=1/this.m_limitMass1;this.m_limitMass2=1/this.m_limitMass2;this.m_pulleyMass=1/this.m_pulleyMass;if(al.warmStarting){this.m_impulse*=al.dtRatio;this.m_limitImpulse1*=al.dtRatio;this.m_limitImpulse2*=al.dtRatio;var ag=((-this.m_impulse)-this.m_limitImpulse1)*this.m_u1.x;var af=((-this.m_impulse)-this.m_limitImpulse1)*this.m_u1.y;var an=((-this.m_ratio*this.m_impulse)-this.m_limitImpulse2)*this.m_u2.x;var am=((-this.m_ratio*this.m_impulse)-this.m_limitImpulse2)*this.m_u2.y;aF.m_linearVelocity.x+=aF.m_invMass*ag;aF.m_linearVelocity.y+=aF.m_invMass*af;aF.m_angularVelocity+=aF.m_invI*(aC*af-aB*ag);aE.m_linearVelocity.x+=aE.m_invMass*an;aE.m_linearVelocity.y+=aE.m_invMass*am;aE.m_angularVelocity+=aE.m_invI*(ak*am-aj*an)}else{this.m_impulse=0;this.m_limitImpulse1=0;this.m_limitImpulse2=0}};j.prototype.SolveVelocityConstraints=function(am){var az=this.m_bodyA;var ay=this.m_bodyB;var ar;ar=az.m_xf.R;var ax=this.m_localAnchor1.x-az.m_sweep.localCenter.x;var aw=this.m_localAnchor1.y-az.m_sweep.localCenter.y;var av=(ar.col1.x*ax+ar.col2.x*aw);aw=(ar.col1.y*ax+ar.col2.y*aw);ax=av;ar=ay.m_xf.R;var ak=this.m_localAnchor2.x-ay.m_sweep.localCenter.x;var aj=this.m_localAnchor2.y-ay.m_sweep.localCenter.y;av=(ar.col1.x*ak+ar.col2.x*aj);aj=(ar.col1.y*ak+ar.col2.y*aj);ak=av;var ai=0;var ag=0;var at=0;var ap=0;var ah=0;var af=0;var aq=0;var ao=0;var au=0;var an=0;var al=0;if(this.m_state==n.e_atUpperLimit){ai=az.m_linearVelocity.x+((-az.m_angularVelocity*aw));ag=az.m_linearVelocity.y+(az.m_angularVelocity*ax);at=ay.m_linearVelocity.x+((-ay.m_angularVelocity*aj));ap=ay.m_linearVelocity.y+(ay.m_angularVelocity*ak);au=(-(this.m_u1.x*ai+this.m_u1.y*ag))-this.m_ratio*(this.m_u2.x*at+this.m_u2.y*ap);an=this.m_pulleyMass*((-au));al=this.m_impulse;this.m_impulse=D.Max(0,this.m_impulse+an);an=this.m_impulse-al;ah=(-an*this.m_u1.x);af=(-an*this.m_u1.y);aq=(-this.m_ratio*an*this.m_u2.x);ao=(-this.m_ratio*an*this.m_u2.y);az.m_linearVelocity.x+=az.m_invMass*ah;az.m_linearVelocity.y+=az.m_invMass*af;az.m_angularVelocity+=az.m_invI*(ax*af-aw*ah);ay.m_linearVelocity.x+=ay.m_invMass*aq;ay.m_linearVelocity.y+=ay.m_invMass*ao;ay.m_angularVelocity+=ay.m_invI*(ak*ao-aj*aq)}if(this.m_limitState1==n.e_atUpperLimit){ai=az.m_linearVelocity.x+((-az.m_angularVelocity*aw));ag=az.m_linearVelocity.y+(az.m_angularVelocity*ax);au=(-(this.m_u1.x*ai+this.m_u1.y*ag));an=(-this.m_limitMass1*au);al=this.m_limitImpulse1;this.m_limitImpulse1=D.Max(0,this.m_limitImpulse1+an);an=this.m_limitImpulse1-al;ah=(-an*this.m_u1.x);af=(-an*this.m_u1.y);az.m_linearVelocity.x+=az.m_invMass*ah;az.m_linearVelocity.y+=az.m_invMass*af;az.m_angularVelocity+=az.m_invI*(ax*af-aw*ah)}if(this.m_limitState2==n.e_atUpperLimit){at=ay.m_linearVelocity.x+((-ay.m_angularVelocity*aj));ap=ay.m_linearVelocity.y+(ay.m_angularVelocity*ak);au=(-(this.m_u2.x*at+this.m_u2.y*ap));an=(-this.m_limitMass2*au);al=this.m_limitImpulse2;this.m_limitImpulse2=D.Max(0,this.m_limitImpulse2+an);an=this.m_limitImpulse2-al;aq=(-an*this.m_u2.x);ao=(-an*this.m_u2.y);ay.m_linearVelocity.x+=ay.m_invMass*aq;ay.m_linearVelocity.y+=ay.m_invMass*ao;ay.m_angularVelocity+=ay.m_invI*(ak*ao-aj*aq)}};j.prototype.SolvePositionConstraints=function(aw){if(aw===undefined){aw=0}var aD=this.m_bodyA;var aC=this.m_bodyB;var an;var ao=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x;var am=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y;var ax=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x;var au=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;var aB=0;var aA=0;var ai=0;var ah=0;var ay=0;var av=0;var ag=0;var af=0;var ar=0;var aq=0;var ap=0;var al=0;var ak=0;var az=0;var at=0;var aj=0;if(this.m_state==n.e_atUpperLimit){an=aD.m_xf.R;aB=this.m_localAnchor1.x-aD.m_sweep.localCenter.x;aA=this.m_localAnchor1.y-aD.m_sweep.localCenter.y;at=(an.col1.x*aB+an.col2.x*aA);aA=(an.col1.y*aB+an.col2.y*aA);aB=at;an=aC.m_xf.R;ai=this.m_localAnchor2.x-aC.m_sweep.localCenter.x;ah=this.m_localAnchor2.y-aC.m_sweep.localCenter.y;at=(an.col1.x*ai+an.col2.x*ah);ah=(an.col1.y*ai+an.col2.y*ah);ai=at;ay=aD.m_sweep.c.x+aB;av=aD.m_sweep.c.y+aA;ag=aC.m_sweep.c.x+ai;af=aC.m_sweep.c.y+ah;this.m_u1.Set(ay-ao,av-am);this.m_u2.Set(ag-ax,af-au);ar=this.m_u1.Length();aq=this.m_u2.Length();if(ar>e.b2_linearSlop){this.m_u1.Multiply(1/ar)}else{this.m_u1.SetZero()}if(aq>e.b2_linearSlop){this.m_u2.Multiply(1/aq)}else{this.m_u2.SetZero()}ap=this.m_constant-ar-this.m_ratio*aq;aj=D.Max(aj,(-ap));ap=D.Clamp(ap+e.b2_linearSlop,(-e.b2_maxLinearCorrection),0);al=(-this.m_pulleyMass*ap);ay=(-al*this.m_u1.x);av=(-al*this.m_u1.y);ag=(-this.m_ratio*al*this.m_u2.x);af=(-this.m_ratio*al*this.m_u2.y);aD.m_sweep.c.x+=aD.m_invMass*ay;aD.m_sweep.c.y+=aD.m_invMass*av;aD.m_sweep.a+=aD.m_invI*(aB*av-aA*ay);aC.m_sweep.c.x+=aC.m_invMass*ag;aC.m_sweep.c.y+=aC.m_invMass*af;aC.m_sweep.a+=aC.m_invI*(ai*af-ah*ag);aD.SynchronizeTransform();aC.SynchronizeTransform()}if(this.m_limitState1==n.e_atUpperLimit){an=aD.m_xf.R;aB=this.m_localAnchor1.x-aD.m_sweep.localCenter.x;aA=this.m_localAnchor1.y-aD.m_sweep.localCenter.y;at=(an.col1.x*aB+an.col2.x*aA);aA=(an.col1.y*aB+an.col2.y*aA);aB=at;ay=aD.m_sweep.c.x+aB;av=aD.m_sweep.c.y+aA;this.m_u1.Set(ay-ao,av-am);ar=this.m_u1.Length();if(ar>e.b2_linearSlop){this.m_u1.x*=1/ar;this.m_u1.y*=1/ar}else{this.m_u1.SetZero()}ap=this.m_maxLength1-ar;aj=D.Max(aj,(-ap));ap=D.Clamp(ap+e.b2_linearSlop,(-e.b2_maxLinearCorrection),0);al=(-this.m_limitMass1*ap);ay=(-al*this.m_u1.x);av=(-al*this.m_u1.y);aD.m_sweep.c.x+=aD.m_invMass*ay;aD.m_sweep.c.y+=aD.m_invMass*av;aD.m_sweep.a+=aD.m_invI*(aB*av-aA*ay);aD.SynchronizeTransform()}if(this.m_limitState2==n.e_atUpperLimit){an=aC.m_xf.R;ai=this.m_localAnchor2.x-aC.m_sweep.localCenter.x;ah=this.m_localAnchor2.y-aC.m_sweep.localCenter.y;at=(an.col1.x*ai+an.col2.x*ah);ah=(an.col1.y*ai+an.col2.y*ah);ai=at;ag=aC.m_sweep.c.x+ai;af=aC.m_sweep.c.y+ah;this.m_u2.Set(ag-ax,af-au);aq=this.m_u2.Length();if(aq>e.b2_linearSlop){this.m_u2.x*=1/aq;this.m_u2.y*=1/aq}else{this.m_u2.SetZero()}ap=this.m_maxLength2-aq;aj=D.Max(aj,(-ap));ap=D.Clamp(ap+e.b2_linearSlop,(-e.b2_maxLinearCorrection),0);al=(-this.m_limitMass2*ap);ag=(-al*this.m_u2.x);af=(-al*this.m_u2.y);aC.m_sweep.c.x+=aC.m_invMass*ag;aC.m_sweep.c.y+=aC.m_invMass*af;aC.m_sweep.a+=aC.m_invI*(ai*af-ah*ag);aC.SynchronizeTransform()}return aj<e.b2_linearSlop};Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength=2});Box2D.inherit(ad,Box2D.Dynamics.Joints.b2JointDef);ad.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;ad.b2PulleyJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.groundAnchorA=new Z();this.groundAnchorB=new Z();this.localAnchorA=new Z();this.localAnchorB=new Z()};ad.prototype.b2PulleyJointDef=function(){this.__super.b2JointDef.call(this);this.type=n.e_pulleyJoint;this.groundAnchorA.Set((-1),1);this.groundAnchorB.Set(1,1);this.localAnchorA.Set((-1),0);this.localAnchorB.Set(1,0);this.lengthA=0;this.maxLengthA=0;this.lengthB=0;this.maxLengthB=0;this.ratio=1;this.collideConnected=true};ad.prototype.Initialize=function(ai,af,ap,an,ak,aj,ag){if(ag===undefined){ag=0}this.bodyA=ai;this.bodyB=af;this.groundAnchorA.SetV(ap);this.groundAnchorB.SetV(an);this.localAnchorA=this.bodyA.GetLocalPoint(ak);this.localAnchorB=this.bodyB.GetLocalPoint(aj);var aq=ak.x-ap.x;var ao=ak.y-ap.y;this.lengthA=Math.sqrt(aq*aq+ao*ao);var am=aj.x-an.x;var al=aj.y-an.y;this.lengthB=Math.sqrt(am*am+al*al);this.ratio=ag;var ah=this.lengthA+this.ratio*this.lengthB;this.maxLengthA=ah-this.ratio*j.b2_minPulleyLength;this.maxLengthB=(ah-j.b2_minPulleyLength)/this.ratio};Box2D.inherit(P,Box2D.Dynamics.Joints.b2Joint);P.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;P.b2RevoluteJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.K=new R();this.K1=new R();this.K2=new R();this.K3=new R();this.impulse3=new Y();this.impulse2=new Z();this.reduced=new Z();this.m_localAnchor1=new Z();this.m_localAnchor2=new Z();this.m_impulse=new Y();this.m_mass=new u()};P.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};P.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};P.prototype.GetReactionForce=function(af){if(af===undefined){af=0}return new Z(af*this.m_impulse.x,af*this.m_impulse.y)};P.prototype.GetReactionTorque=function(af){if(af===undefined){af=0}return af*this.m_impulse.z};P.prototype.GetJointAngle=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle};P.prototype.GetJointSpeed=function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity};P.prototype.IsLimitEnabled=function(){return this.m_enableLimit};P.prototype.EnableLimit=function(af){this.m_enableLimit=af};P.prototype.GetLowerLimit=function(){return this.m_lowerAngle};P.prototype.GetUpperLimit=function(){return this.m_upperAngle};P.prototype.SetLimits=function(af,ag){if(af===undefined){af=0}if(ag===undefined){ag=0}this.m_lowerAngle=af;this.m_upperAngle=ag};P.prototype.IsMotorEnabled=function(){this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);return this.m_enableMotor};P.prototype.EnableMotor=function(af){this.m_enableMotor=af};P.prototype.SetMotorSpeed=function(af){if(af===undefined){af=0}this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_motorSpeed=af};P.prototype.GetMotorSpeed=function(){return this.m_motorSpeed};P.prototype.SetMaxMotorTorque=function(af){if(af===undefined){af=0}this.m_maxMotorTorque=af};P.prototype.GetMotorTorque=function(){return this.m_maxMotorTorque};P.prototype.b2RevoluteJoint=function(af){this.__super.b2Joint.call(this,af);this.m_localAnchor1.SetV(af.localAnchorA);this.m_localAnchor2.SetV(af.localAnchorB);this.m_referenceAngle=af.referenceAngle;this.m_impulse.SetZero();this.m_motorImpulse=0;this.m_lowerAngle=af.lowerAngle;this.m_upperAngle=af.upperAngle;this.m_maxMotorTorque=af.maxMotorTorque;this.m_motorSpeed=af.motorSpeed;this.m_enableLimit=af.enableLimit;this.m_enableMotor=af.enableMotor;this.m_limitState=n.e_inactiveLimit};P.prototype.InitVelocityConstraints=function(ai){var ag=this.m_bodyA;var af=this.m_bodyB;var ap;var aq=0;if(this.m_enableMotor||this.m_enableLimit){}ap=ag.m_xf.R;var au=this.m_localAnchor1.x-ag.m_sweep.localCenter.x;var ar=this.m_localAnchor1.y-ag.m_sweep.localCenter.y;aq=(ap.col1.x*au+ap.col2.x*ar);ar=(ap.col1.y*au+ap.col2.y*ar);au=aq;ap=af.m_xf.R;var ao=this.m_localAnchor2.x-af.m_sweep.localCenter.x;var an=this.m_localAnchor2.y-af.m_sweep.localCenter.y;aq=(ap.col1.x*ao+ap.col2.x*an);an=(ap.col1.y*ao+ap.col2.y*an);ao=aq;var av=ag.m_invMass;var at=af.m_invMass;var am=ag.m_invI;var ak=af.m_invI;this.m_mass.col1.x=av+at+ar*ar*am+an*an*ak;this.m_mass.col2.x=(-ar*au*am)-an*ao*ak;this.m_mass.col3.x=(-ar*am)-an*ak;this.m_mass.col1.y=this.m_mass.col2.x;this.m_mass.col2.y=av+at+au*au*am+ao*ao*ak;this.m_mass.col3.y=au*am+ao*ak;this.m_mass.col1.z=this.m_mass.col3.x;this.m_mass.col2.z=this.m_mass.col3.y;this.m_mass.col3.z=am+ak;this.m_motorMass=1/(am+ak);if(this.m_enableMotor==false){this.m_motorImpulse=0}if(this.m_enableLimit){var ah=af.m_sweep.a-ag.m_sweep.a-this.m_referenceAngle;if(D.Abs(this.m_upperAngle-this.m_lowerAngle)<2*e.b2_angularSlop){this.m_limitState=n.e_equalLimits}else{if(ah<=this.m_lowerAngle){if(this.m_limitState!=n.e_atLowerLimit){this.m_impulse.z=0}this.m_limitState=n.e_atLowerLimit}else{if(ah>=this.m_upperAngle){if(this.m_limitState!=n.e_atUpperLimit){this.m_impulse.z=0}this.m_limitState=n.e_atUpperLimit}else{this.m_limitState=n.e_inactiveLimit;this.m_impulse.z=0}}}}else{this.m_limitState=n.e_inactiveLimit}if(ai.warmStarting){this.m_impulse.x*=ai.dtRatio;this.m_impulse.y*=ai.dtRatio;this.m_motorImpulse*=ai.dtRatio;var al=this.m_impulse.x;var aj=this.m_impulse.y;ag.m_linearVelocity.x-=av*al;ag.m_linearVelocity.y-=av*aj;ag.m_angularVelocity-=am*((au*aj-ar*al)+this.m_motorImpulse+this.m_impulse.z);af.m_linearVelocity.x+=at*al;af.m_linearVelocity.y+=at*aj;af.m_angularVelocity+=ak*((ao*aj-an*al)+this.m_motorImpulse+this.m_impulse.z)}else{this.m_impulse.SetZero();this.m_motorImpulse=0}};P.prototype.SolveVelocityConstraints=function(ap){var aG=this.m_bodyA;var aF=this.m_bodyB;var ar;var ax=0;var aE=0;var aD=0;var aC=0;var al=0;var ak=0;var aj=aG.m_linearVelocity;var au=aG.m_angularVelocity;var ai=aF.m_linearVelocity;var at=aF.m_angularVelocity;var ah=aG.m_invMass;var af=aF.m_invMass;var az=aG.m_invI;var ay=aF.m_invI;if(this.m_enableMotor&&this.m_limitState!=n.e_equalLimits){var aw=at-au-this.m_motorSpeed;var aq=this.m_motorMass*((-aw));var an=this.m_motorImpulse;var av=ap.dt*this.m_maxMotorTorque;this.m_motorImpulse=D.Clamp(this.m_motorImpulse+aq,(-av),av);aq=this.m_motorImpulse-an;au-=az*aq;at+=ay*aq}if(this.m_enableLimit&&this.m_limitState!=n.e_inactiveLimit){ar=aG.m_xf.R;aD=this.m_localAnchor1.x-aG.m_sweep.localCenter.x;aC=this.m_localAnchor1.y-aG.m_sweep.localCenter.y;ax=(ar.col1.x*aD+ar.col2.x*aC);aC=(ar.col1.y*aD+ar.col2.y*aC);aD=ax;ar=aF.m_xf.R;al=this.m_localAnchor2.x-aF.m_sweep.localCenter.x;ak=this.m_localAnchor2.y-aF.m_sweep.localCenter.y;ax=(ar.col1.x*al+ar.col2.x*ak);ak=(ar.col1.y*al+ar.col2.y*ak);al=ax;var aB=ai.x+((-at*ak))-aj.x-((-au*aC));var aA=ai.y+(at*al)-aj.y-(au*aD);var ag=at-au;this.m_mass.Solve33(this.impulse3,(-aB),(-aA),(-ag));if(this.m_limitState==n.e_equalLimits){this.m_impulse.Add(this.impulse3)}else{if(this.m_limitState==n.e_atLowerLimit){aE=this.m_impulse.z+this.impulse3.z;if(aE<0){this.m_mass.Solve22(this.reduced,(-aB),(-aA));this.impulse3.x=this.reduced.x;this.impulse3.y=this.reduced.y;this.impulse3.z=(-this.m_impulse.z);this.m_impulse.x+=this.reduced.x;this.m_impulse.y+=this.reduced.y;this.m_impulse.z=0}}else{if(this.m_limitState==n.e_atUpperLimit){aE=this.m_impulse.z+this.impulse3.z;if(aE>0){this.m_mass.Solve22(this.reduced,(-aB),(-aA));this.impulse3.x=this.reduced.x;this.impulse3.y=this.reduced.y;this.impulse3.z=(-this.m_impulse.z);this.m_impulse.x+=this.reduced.x;this.m_impulse.y+=this.reduced.y;this.m_impulse.z=0}}}}aj.x-=ah*this.impulse3.x;aj.y-=ah*this.impulse3.y;au-=az*(aD*this.impulse3.y-aC*this.impulse3.x+this.impulse3.z);ai.x+=af*this.impulse3.x;ai.y+=af*this.impulse3.y;at+=ay*(al*this.impulse3.y-ak*this.impulse3.x+this.impulse3.z)}else{ar=aG.m_xf.R;aD=this.m_localAnchor1.x-aG.m_sweep.localCenter.x;aC=this.m_localAnchor1.y-aG.m_sweep.localCenter.y;ax=(ar.col1.x*aD+ar.col2.x*aC);aC=(ar.col1.y*aD+ar.col2.y*aC);aD=ax;ar=aF.m_xf.R;al=this.m_localAnchor2.x-aF.m_sweep.localCenter.x;ak=this.m_localAnchor2.y-aF.m_sweep.localCenter.y;ax=(ar.col1.x*al+ar.col2.x*ak);ak=(ar.col1.y*al+ar.col2.y*ak);al=ax;var ao=ai.x+((-at*ak))-aj.x-((-au*aC));var am=ai.y+(at*al)-aj.y-(au*aD);this.m_mass.Solve22(this.impulse2,(-ao),(-am));this.m_impulse.x+=this.impulse2.x;this.m_impulse.y+=this.impulse2.y;aj.x-=ah*this.impulse2.x;aj.y-=ah*this.impulse2.y;au-=az*(aD*this.impulse2.y-aC*this.impulse2.x);ai.x+=af*this.impulse2.x;ai.y+=af*this.impulse2.y;at+=ay*(al*this.impulse2.y-ak*this.impulse2.x)}aG.m_linearVelocity.SetV(aj);aG.m_angularVelocity=au;aF.m_linearVelocity.SetV(ai);aF.m_angularVelocity=at};P.prototype.SolvePositionConstraints=function(aA){if(aA===undefined){aA=0}var az=0;var at=0;var ao;var aK=this.m_bodyA;var aJ=this.m_bodyB;var aD=0;var ap=0;var av=0;var ag=0;var af=0;if(this.m_enableLimit&&this.m_limitState!=n.e_inactiveLimit){var aB=aJ.m_sweep.a-aK.m_sweep.a-this.m_referenceAngle;var aw=0;if(this.m_limitState==n.e_equalLimits){at=D.Clamp(aB-this.m_lowerAngle,(-e.b2_maxAngularCorrection),e.b2_maxAngularCorrection);aw=(-this.m_motorMass*at);aD=D.Abs(at)}else{if(this.m_limitState==n.e_atLowerLimit){at=aB-this.m_lowerAngle;aD=(-at);at=D.Clamp(at+e.b2_angularSlop,(-e.b2_maxAngularCorrection),0);aw=(-this.m_motorMass*at)}else{if(this.m_limitState==n.e_atUpperLimit){at=aB-this.m_upperAngle;aD=at;at=D.Clamp(at-e.b2_angularSlop,0,e.b2_maxAngularCorrection);aw=(-this.m_motorMass*at)}}}aK.m_sweep.a-=aK.m_invI*aw;aJ.m_sweep.a+=aJ.m_invI*aw;aK.SynchronizeTransform();aJ.SynchronizeTransform()}ao=aK.m_xf.R;var aE=this.m_localAnchor1.x-aK.m_sweep.localCenter.x;var aC=this.m_localAnchor1.y-aK.m_sweep.localCenter.y;av=(ao.col1.x*aE+ao.col2.x*aC);aC=(ao.col1.y*aE+ao.col2.y*aC);aE=av;ao=aJ.m_xf.R;var aj=this.m_localAnchor2.x-aJ.m_sweep.localCenter.x;var ai=this.m_localAnchor2.y-aJ.m_sweep.localCenter.y;av=(ao.col1.x*aj+ao.col2.x*ai);ai=(ao.col1.y*aj+ao.col2.y*ai);aj=av;var aH=aJ.m_sweep.c.x+aj-aK.m_sweep.c.x-aE;var aF=aJ.m_sweep.c.y+ai-aK.m_sweep.c.y-aC;var an=aH*aH+aF*aF;var am=Math.sqrt(an);ap=am;var ar=aK.m_invMass;var aq=aJ.m_invMass;var al=aK.m_invI;var ak=aJ.m_invI;var ah=10*e.b2_linearSlop;if(an>ah*ah){var aI=aH/am;var aG=aF/am;var ay=ar+aq;var ax=1/ay;ag=ax*((-aH));af=ax*((-aF));var au=0.5;aK.m_sweep.c.x-=au*ar*ag;aK.m_sweep.c.y-=au*ar*af;aJ.m_sweep.c.x+=au*aq*ag;aJ.m_sweep.c.y+=au*aq*af;aH=aJ.m_sweep.c.x+aj-aK.m_sweep.c.x-aE;aF=aJ.m_sweep.c.y+ai-aK.m_sweep.c.y-aC}this.K1.col1.x=ar+aq;this.K1.col2.x=0;this.K1.col1.y=0;this.K1.col2.y=ar+aq;this.K2.col1.x=al*aC*aC;this.K2.col2.x=(-al*aE*aC);this.K2.col1.y=(-al*aE*aC);this.K2.col2.y=al*aE*aE;this.K3.col1.x=ak*ai*ai;this.K3.col2.x=(-ak*aj*ai);this.K3.col1.y=(-ak*aj*ai);this.K3.col2.y=ak*aj*aj;this.K.SetM(this.K1);this.K.AddM(this.K2);this.K.AddM(this.K3);this.K.Solve(P.tImpulse,(-aH),(-aF));ag=P.tImpulse.x;af=P.tImpulse.y;aK.m_sweep.c.x-=aK.m_invMass*ag;aK.m_sweep.c.y-=aK.m_invMass*af;aK.m_sweep.a-=aK.m_invI*(aE*af-aC*ag);aJ.m_sweep.c.x+=aJ.m_invMass*ag;aJ.m_sweep.c.y+=aJ.m_invMass*af;aJ.m_sweep.a+=aJ.m_invI*(aj*af-ai*ag);aK.SynchronizeTransform();aJ.SynchronizeTransform();return ap<=e.b2_linearSlop&&aD<=e.b2_angularSlop};Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2RevoluteJoint.tImpulse=new Z()});Box2D.inherit(b,Box2D.Dynamics.Joints.b2JointDef);b.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;b.b2RevoluteJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new Z();this.localAnchorB=new Z()};b.prototype.b2RevoluteJointDef=function(){this.__super.b2JointDef.call(this);this.type=n.e_revoluteJoint;this.localAnchorA.Set(0,0);this.localAnchorB.Set(0,0);this.referenceAngle=0;this.lowerAngle=0;this.upperAngle=0;this.maxMotorTorque=0;this.motorSpeed=0;this.enableLimit=false;this.enableMotor=false};b.prototype.Initialize=function(ah,ag,af){this.bodyA=ah;this.bodyB=ag;this.localAnchorA=this.bodyA.GetLocalPoint(af);this.localAnchorB=this.bodyB.GetLocalPoint(af);this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()};Box2D.inherit(g,Box2D.Dynamics.Joints.b2Joint);g.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;g.b2WeldJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchorA=new Z();this.m_localAnchorB=new Z();this.m_impulse=new Y();this.m_mass=new u()};g.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)};g.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)};g.prototype.GetReactionForce=function(af){if(af===undefined){af=0}return new Z(af*this.m_impulse.x,af*this.m_impulse.y)};g.prototype.GetReactionTorque=function(af){if(af===undefined){af=0}return af*this.m_impulse.z};g.prototype.b2WeldJoint=function(af){this.__super.b2Joint.call(this,af);this.m_localAnchorA.SetV(af.localAnchorA);this.m_localAnchorB.SetV(af.localAnchorB);this.m_referenceAngle=af.referenceAngle;this.m_impulse.SetZero();this.m_mass=new u()};g.prototype.InitVelocityConstraints=function(ai){var ao;var ap=0;var ag=this.m_bodyA;var af=this.m_bodyB;ao=ag.m_xf.R;var al=this.m_localAnchorA.x-ag.m_sweep.localCenter.x;var ak=this.m_localAnchorA.y-ag.m_sweep.localCenter.y;ap=(ao.col1.x*al+ao.col2.x*ak);ak=(ao.col1.y*al+ao.col2.y*ak);al=ap;ao=af.m_xf.R;var ar=this.m_localAnchorB.x-af.m_sweep.localCenter.x;var aq=this.m_localAnchorB.y-af.m_sweep.localCenter.y;ap=(ao.col1.x*ar+ao.col2.x*aq);aq=(ao.col1.y*ar+ao.col2.y*aq);ar=ap;var aj=ag.m_invMass;var ah=af.m_invMass;var an=ag.m_invI;var am=af.m_invI;this.m_mass.col1.x=aj+ah+ak*ak*an+aq*aq*am;this.m_mass.col2.x=(-ak*al*an)-aq*ar*am;this.m_mass.col3.x=(-ak*an)-aq*am;this.m_mass.col1.y=this.m_mass.col2.x;this.m_mass.col2.y=aj+ah+al*al*an+ar*ar*am;this.m_mass.col3.y=al*an+ar*am;this.m_mass.col1.z=this.m_mass.col3.x;this.m_mass.col2.z=this.m_mass.col3.y;this.m_mass.col3.z=an+am;if(ai.warmStarting){this.m_impulse.x*=ai.dtRatio;this.m_impulse.y*=ai.dtRatio;this.m_impulse.z*=ai.dtRatio;ag.m_linearVelocity.x-=aj*this.m_impulse.x;ag.m_linearVelocity.y-=aj*this.m_impulse.y;ag.m_angularVelocity-=an*(al*this.m_impulse.y-ak*this.m_impulse.x+this.m_impulse.z);af.m_linearVelocity.x+=ah*this.m_impulse.x;af.m_linearVelocity.y+=ah*this.m_impulse.y;af.m_angularVelocity+=am*(ar*this.m_impulse.y-aq*this.m_impulse.x+this.m_impulse.z)}else{this.m_impulse.SetZero()}};g.prototype.SolveVelocityConstraints=function(aj){var ao;var ap=0;var aA=this.m_bodyA;var az=this.m_bodyB;var ay=aA.m_linearVelocity;var ah=aA.m_angularVelocity;var ax=az.m_linearVelocity;var ag=az.m_angularVelocity;var au=aA.m_invMass;var at=az.m_invMass;var am=aA.m_invI;var al=az.m_invI;ao=aA.m_xf.R;var ak=this.m_localAnchorA.x-aA.m_sweep.localCenter.x;var ai=this.m_localAnchorA.y-aA.m_sweep.localCenter.y;ap=(ao.col1.x*ak+ao.col2.x*ai);ai=(ao.col1.y*ak+ao.col2.y*ai);ak=ap;ao=az.m_xf.R;var ar=this.m_localAnchorB.x-az.m_sweep.localCenter.x;var aq=this.m_localAnchorB.y-az.m_sweep.localCenter.y;ap=(ao.col1.x*ar+ao.col2.x*aq);aq=(ao.col1.y*ar+ao.col2.y*aq);ar=ap;var aw=ax.x-ag*aq-ay.x+ah*ai;var av=ax.y+ag*ar-ay.y-ah*ak;var af=ag-ah;var an=new Y();this.m_mass.Solve33(an,(-aw),(-av),(-af));this.m_impulse.Add(an);ay.x-=au*an.x;ay.y-=au*an.y;ah-=am*(ak*an.y-ai*an.x+an.z);ax.x+=at*an.x;ax.y+=at*an.y;ag+=al*(ar*an.y-aq*an.x+an.z);aA.m_angularVelocity=ah;az.m_angularVelocity=ag};g.prototype.SolvePositionConstraints=function(au){if(au===undefined){au=0}var am;var an=0;var az=this.m_bodyA;var ay=this.m_bodyB;am=az.m_xf.R;var ah=this.m_localAnchorA.x-az.m_sweep.localCenter.x;var ag=this.m_localAnchorA.y-az.m_sweep.localCenter.y;an=(am.col1.x*ah+am.col2.x*ag);ag=(am.col1.y*ah+am.col2.y*ag);ah=an;am=ay.m_xf.R;var ap=this.m_localAnchorB.x-ay.m_sweep.localCenter.x;var ao=this.m_localAnchorB.y-ay.m_sweep.localCenter.y;an=(am.col1.x*ap+am.col2.x*ao);ao=(am.col1.y*ap+am.col2.y*ao);ap=an;var ar=az.m_invMass;var aq=ay.m_invMass;var aj=az.m_invI;var ai=ay.m_invI;var ax=ay.m_sweep.c.x+ap-az.m_sweep.c.x-ah;var aw=ay.m_sweep.c.y+ao-az.m_sweep.c.y-ag;var at=ay.m_sweep.a-az.m_sweep.a-this.m_referenceAngle;var af=10*e.b2_linearSlop;var al=Math.sqrt(ax*ax+aw*aw);var av=D.Abs(at);if(al>af){aj*=1;ai*=1}this.m_mass.col1.x=ar+aq+ag*ag*aj+ao*ao*ai;this.m_mass.col2.x=(-ag*ah*aj)-ao*ap*ai;this.m_mass.col3.x=(-ag*aj)-ao*ai;this.m_mass.col1.y=this.m_mass.col2.x;this.m_mass.col2.y=ar+aq+ah*ah*aj+ap*ap*ai;this.m_mass.col3.y=ah*aj+ap*ai;this.m_mass.col1.z=this.m_mass.col3.x;this.m_mass.col2.z=this.m_mass.col3.y;this.m_mass.col3.z=aj+ai;var ak=new Y();this.m_mass.Solve33(ak,(-ax),(-aw),(-at));az.m_sweep.c.x-=ar*ak.x;az.m_sweep.c.y-=ar*ak.y;az.m_sweep.a-=aj*(ah*ak.y-ag*ak.x+ak.z);ay.m_sweep.c.x+=aq*ak.x;ay.m_sweep.c.y+=aq*ak.y;ay.m_sweep.a+=ai*(ap*ak.y-ao*ak.x+ak.z);az.SynchronizeTransform();ay.SynchronizeTransform();return al<=e.b2_linearSlop&&av<=e.b2_angularSlop};Box2D.inherit(J,Box2D.Dynamics.Joints.b2JointDef);J.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;J.b2WeldJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new Z();this.localAnchorB=new Z()};J.prototype.b2WeldJointDef=function(){this.__super.b2JointDef.call(this);this.type=n.e_weldJoint;this.referenceAngle=0};J.prototype.Initialize=function(ah,ag,af){this.bodyA=ah;this.bodyB=ag;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(af));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(af));this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}})();(function(){var b=Box2D.Dynamics.b2DebugDraw;b.b2DebugDraw=function(){this.m_drawScale=1;this.m_lineThickness=1;this.m_alpha=1;this.m_fillAlpha=1;this.m_xformScale=1;var d=this;this.m_sprite={graphics:{clear:function(){d.m_ctx.clearRect(0,0,d.m_ctx.canvas.width,d.m_ctx.canvas.height)}}}};b.prototype._color=function(d,e){return"rgba("+((d&16711680)>>16)+","+((d&65280)>>8)+","+(d&255)+","+e+")"};b.prototype.b2DebugDraw=function(){this.m_drawFlags=0};b.prototype.SetFlags=function(d){if(d===undefined){d=0}this.m_drawFlags=d};b.prototype.GetFlags=function(){return this.m_drawFlags};b.prototype.AppendFlags=function(d){if(d===undefined){d=0}this.m_drawFlags|=d};b.prototype.ClearFlags=function(d){if(d===undefined){d=0}this.m_drawFlags&=~d};b.prototype.SetSprite=function(d){this.m_ctx=d};b.prototype.GetSprite=function(){return this.m_ctx};b.prototype.SetDrawScale=function(d){if(d===undefined){d=0}this.m_drawScale=d};b.prototype.GetDrawScale=function(){return this.m_drawScale};b.prototype.SetLineThickness=function(d){if(d===undefined){d=0}this.m_lineThickness=d;this.m_ctx.strokeWidth=d};b.prototype.GetLineThickness=function(){return this.m_lineThickness};b.prototype.SetAlpha=function(d){if(d===undefined){d=0}this.m_alpha=d};b.prototype.GetAlpha=function(){return this.m_alpha};b.prototype.SetFillAlpha=function(d){if(d===undefined){d=0}this.m_fillAlpha=d};b.prototype.GetFillAlpha=function(){return this.m_fillAlpha};b.prototype.SetXFormScale=function(d){if(d===undefined){d=0}this.m_xformScale=d};b.prototype.GetXFormScale=function(){return this.m_xformScale};b.prototype.DrawPolygon=function(e,j,d){if(!j){return}var g=this.m_ctx;var k=this.m_drawScale;g.beginPath();g.strokeStyle=this._color(d.color,this.m_alpha);g.moveTo(e[0].x*k,e[0].y*k);for(var f=1;f<j;f++){g.lineTo(e[f].x*k,e[f].y*k)}g.lineTo(e[0].x*k,e[0].y*k);g.closePath();g.stroke()};b.prototype.DrawSolidPolygon=function(e,j,d){if(!j){return}var g=this.m_ctx;var k=this.m_drawScale;g.beginPath();g.strokeStyle=this._color(d.color,this.m_alpha);g.fillStyle=this._color(d.color,this.m_fillAlpha);g.moveTo(e[0].x*k,e[0].y*k);for(var f=1;f<j;f++){g.lineTo(e[f].x*k,e[f].y*k)}g.lineTo(e[0].x*k,e[0].y*k);g.closePath();g.fill();g.stroke()};b.prototype.DrawCircle=function(e,d,f){if(!d){return}var g=this.m_ctx;var j=this.m_drawScale;g.beginPath();g.strokeStyle=this._color(f.color,this.m_alpha);g.arc(e.x*j,e.y*j,d*j,0,Math.PI*2,true);g.closePath();g.stroke()};b.prototype.DrawSolidCircle=function(f,e,k,g){if(!e){return}var j=this.m_ctx,m=this.m_drawScale,d=f.x*m,n=f.y*m;j.moveTo(0,0);j.beginPath();j.strokeStyle=this._color(g.color,this.m_alpha);j.fillStyle=this._color(g.color,this.m_fillAlpha);j.arc(d,n,e*m,0,Math.PI*2,true);j.moveTo(d,n);j.lineTo((f.x+k.x*e)*m,(f.y+k.y*e)*m);j.closePath();j.fill();j.stroke()};b.prototype.DrawSegment=function(j,g,d){var e=this.m_ctx,f=this.m_drawScale;e.strokeStyle=this._color(d.color,this.m_alpha);e.beginPath();e.moveTo(j.x*f,j.y*f);e.lineTo(g.x*f,g.y*f);e.closePath();e.stroke()};b.prototype.DrawTransform=function(e){var d=this.m_ctx,f=this.m_drawScale;d.beginPath();d.strokeStyle=this._color(16711680,this.m_alpha);d.moveTo(e.position.x*f,e.position.y*f);d.lineTo((e.position.x+this.m_xformScale*e.R.col1.x)*f,(e.position.y+this.m_xformScale*e.R.col1.y)*f);d.strokeStyle=this._color(65280,this.m_alpha);d.moveTo(e.position.x*f,e.position.y*f);d.lineTo((e.position.x+this.m_xformScale*e.R.col2.x)*f,(e.position.y+this.m_xformScale*e.R.col2.y)*f);d.closePath();d.stroke()}})();var i;for(i=0;i<Box2D.postDefs.length;++i){Box2D.postDefs[i]()}delete Box2D.postDefs;var b2Vec2=Box2D.Common.Math.b2Vec2,b2AABB=Box2D.Collision.b2AABB,b2BodyDef=Box2D.Dynamics.b2BodyDef,b2Body=Box2D.Dynamics.b2Body,b2FixtureDef=Box2D.Dynamics.b2FixtureDef,b2Fixture=Box2D.Dynamics.b2Fixture,b2World=Box2D.Dynamics.b2World,b2MassData=Box2D.Collision.Shapes.b2MassData,b2PolygonShape=Box2D.Collision.Shapes.b2PolygonShape,b2CircleShape=Box2D.Collision.Shapes.b2CircleShape,b2DebugDraw=Box2D.Dynamics.b2DebugDraw,b2RevoluteJointDef=Box2D.Dynamics.Joints.b2RevoluteJointDef,b2MouseJointDef=Box2D.Dynamics.Joints.b2MouseJointDef,b2Shape=Box2D.Collision.Shapes.b2Shape,b2Joint=Box2D.Dynamics.Joints.b2Joint,b2PrismaticJointDef=Box2D.Dynamics.Joints.b2PrismaticJointDef,b2ContactListener=Box2D.Dynamics.b2ContactListener,b2Settings=Box2D.Common.b2Settings,b2Mat22=Box2D.Common.Math.b2Mat22,b2EdgeChainDef=Box2D.Collision.Shapes.b2EdgeChainDef,b2EdgeShape=Box2D.Collision.Shapes.b2EdgeShape,b2WorldManifold=Box2D.Collision.b2WorldManifold;CG.Entity.extend("B2DEntity",{init:function(d,f,e,b,j,g){this._super();this.body={};this.x=b;this.y=j;this.scale=g;this.id={name:d,uid:0};this.world=e;this.setImage(f);this.xhandle=(this.width/2);this.yhandle=(this.height/2);if(!this.bodyDef){this.bodyDef=new b2BodyDef;this.bodyDef.allowSleep=true;this.bodyDef.awake=true}if(!this.fixDef){this.fixDef=new b2FixtureDef;this.fixDef.density=1;this.fixDef.friction=0.5;this.fixDef.restitution=0.5}this.isHit=false;this.strength=100;this.dead=false;return this},hit:function(d,b){this.isHit=true;if(this.strength){this.strength-=d;if(this.strength<=0){this.dead=true}}},update:function(){},draw:function(){Game.b_ctx.save();Game.b_ctx.globalAlpha=this.alpha;Game.b_ctx.translate(this.body.GetPosition().x*this.scale,this.body.GetPosition().y*this.scale);if(this.atlasimage){Game.b_ctx.rotate((this.body.GetAngle()-this.imagerotation));Game.b_ctx.drawImage(this.image,this.xoffset,this.yoffset,this.cutwidth,this.cutheight,0-this.xhandle,0-this.yhandle,this.cutwidth,this.cutheight)}else{Game.b_ctx.rotate(this.body.GetAngle());Game.b_ctx.drawImage(this.image,0-this.xhandle,0-this.yhandle,this.image.width,this.image.height)}Game.b_ctx.restore()}});CG.B2DEntity.extend("B2DCircle",{init:function(g,e,j,d,b,m,k,f){this._super(e,j,g,b,m,k);this.radius=this.width/2;this.stat=f||false;if(this.stat){this.bodyDef.type=b2Body.b2_staticBody}else{this.bodyDef.type=b2Body.b2_dynamicBody}this.fixDef.shape=new b2CircleShape(this.radius/this.scale);this.bodyDef.position.x=this.x/this.scale;this.bodyDef.position.y=this.y/this.scale;this.bodyDef.userData=this.id;this.body=this.world.CreateBody(this.bodyDef);this.body.CreateFixture(this.fixDef);return this}});CG.B2DEntity.extend("B2DLine",{init:function(e,d,g,b,f){this._super(d,false,e,0,0,f);this.start=g;this.end=b;this.xhandle=0;this.yhandle=0;this.fixDef.shape=new b2PolygonShape;this.fixDef.shape.SetAsArray([this.start,this.end],2);this.bodyDef.type=b2Body.b2_staticBody;this.bodyDef.position.Set(0/this.scale,0/this.scale);this.bodyDef.userData=this.id;this.body=this.world.CreateBody(this.bodyDef);this.body.CreateFixture(this.fixDef);return this},update:function(){},draw:function(){}});CG.B2DEntity.extend("B2DRectangle",{init:function(f,d,g,b,k,j,e){this._super(d,g,f,b,k,j);this.stat=e;if(this.stat){this.bodyDef.type=b2Body.b2_staticBody}else{this.bodyDef.type=b2Body.b2_dynamicBody}this.fixDef.shape=new b2PolygonShape;this.fixDef.shape.SetAsBox(this.width/j*0.5,this.height/j*0.5);this.bodyDef.position.x=this.x/this.scale;this.bodyDef.position.y=this.y/this.scale;this.bodyDef.userData=this.id;this.body=this.world.CreateBody(this.bodyDef);this.body.CreateFixture(this.fixDef);return this}});CG.B2DEntity.extend("B2DPolygon",{init:function(n,e,j,d,r,q,g,m,b){this._super(e,j,n,r,q,g);this.stat=m||false;this.bullet=b||false;this.polys=new Array();this.vecs=new Array();this.jsondata=d.data[d.name];this.xhandle=0;this.yhandle=0;this.vecs=this.createVecs(d);if(this.stat){this.bodyDef.type=b2Body.b2_staticBody}else{this.bodyDef.type=b2Body.b2_dynamicBody}this.bodyDef.position.Set(this.x/this.scale,this.y/this.scale);this.bodyDef.userData=this.id;this.bodyDef.bullet=this.bullet;this.body=this.world.CreateBody(this.bodyDef);for(var k=0,f=this.vecs.length;k<f;k++){this.bodyShapePoly=new b2PolygonShape;this.bodyShapePoly.bounce=this.jsondata[k].restitution;this.bodyShapePoly.SetAsArray(this.vecs[k],this.vecs[k].length);this.fixDef.density=this.jsondata[k].density;this.fixDef.friction=this.jsondata[k].friction;this.fixDef.shape=this.bodyShapePoly;this.body.CreateFixture(this.fixDef)}return this},createVecs:function(){var j=[];for(var f=0,d=this.jsondata.length;f<d;f++){poly=this.jsondata[f].shape;var e=[];for(var g=0,b=poly.length;g<b;g=g+2){vec=new b2Vec2(poly[g]/this.scale,poly[g+1]/this.scale);e.push(vec)}j.push(e)}return j}});CG.B2DEntity.extend("B2DRope",{init:function(m,b,g,q,n,d,k,r,f){this._super(b,g,m,q,n,f);this.length=d;this.segments=k;this.segmentHeight=((this.length-this.y)/this.segments)/2;this.segmentWidth=r;this.anchor=new b2Vec2();this.prevBody={};this.bodyGroup=[];this.bodyCount=0;this.fixtureDef=new b2FixtureDef();this.bodyShapeCircle=new b2CircleShape();this.bodyDef=new b2BodyDef();this.bodyDef.userData=this.id;this.bodyShapeCircle.m_radius=this.segmentWidth/this.scale;this.fixtureDef.density=1;this.fixtureDef.restitution=0.2;this.fixtureDef.friction=0.2;this.fixtureDef.shape=this.bodyShapeCircle;this.bodyDef.position.Set(this.x/this.scale,this.y/this.scale);this.body=this.bodyGroup[0]=this.world.CreateBody(this.bodyDef);this.bodyGroup[0].CreateFixture(this.fixtureDef);this.prevBody=this.bodyGroup[0];this.fixtureDef=new b2FixtureDef();this.bodyShapePoly=new b2PolygonShape();this.bodyDef=new b2BodyDef();this.bodyDef.userData=this.id;this.bodyShapePoly.SetAsBox(this.segmentWidth/this.scale,this.segmentHeight/this.scale);this.bodyDef.type=b2Body.b2_dynamicBody;this.fixtureDef.shape=this.bodyShapePoly;this.fixtureDef.density=20;this.fixtureDef.restitution=0.2;this.fixtureDef.friction=0.2;this.jointDef=new b2RevoluteJointDef();this.jointDef.lowerAngle=-25/(180/Math.PI);this.jointDef.upperAngle=25/(180/Math.PI);this.jointDef.enableLimit=true;for(var j=0,e=this.segments;j<e;j++){this.bodyDef.position.Set(this.x/this.scale,((this.y+this.segmentHeight)+(this.segmentHeight*2)*j)/this.scale);this.bodyGroup[j+1]=this.world.CreateBody(this.bodyDef);this.bodyGroup[j+1].CreateFixture(this.fixtureDef);this.anchor.Set(this.x/this.scale,(this.y+(this.segmentHeight*2)*j)/this.scale);this.jointDef.Initialize(this.prevBody,this.bodyGroup[j+1],this.anchor);this.world.CreateJoint(this.jointDef);this.prevBody=this.bodyGroup[j+1];this.bodyCount=j+1}return this},draw:function(){for(var d=1;d<=this.bodyCount;d++){var b=this.bodyGroup[d].GetPosition().x;var f=this.bodyGroup[d].GetPosition().y;var e=this.bodyGroup[d].GetAngle();Game.b_ctx.save();Game.b_ctx.globalAlpha=this.alpha;Game.b_ctx.translate(b*this.scale,f*this.scale);if(this.atlasimage){Game.b_ctx.rotate(e-this.imagerotation);Game.b_ctx.drawImage(this.image,this.xoffset,this.yoffset,this.cutwidth,this.cutheight,0-this.xhandle,0-this.yhandle,this.cutwidth,this.cutheight)}else{Game.b_ctx.rotate(e);Game.b_ctx.drawImage(this.image,0-this.xhandle,0-this.yhandle,this.image.width,this.image.height)}Game.b_ctx.restore()}}});CG.B2DEntity.extend("B2DBridge",{init:function(n,b,j,r,q,e,m,d,g){this._super(b,j,n,r,q,g);this.length=e;this.segments=m;this.segmentHeight=d;this.segmentWidth=((this.length-this.x)/this.segments)/2;this.anchor=new b2Vec2();this.prevBody={};this.bodyGroup=[];this.bodyCount=0;this.fixtureDef=new b2FixtureDef();this.bodyShapeCircle=new b2CircleShape();this.bodyDef=new b2BodyDef();this.bodyDef.userData=this.id;this.bodyShapeCircle.m_radius=this.segmentHeight/this.scale;this.fixtureDef.density=20;this.fixtureDef.restitution=0.2;this.fixtureDef.friction=0.2;this.fixtureDef.shape=this.bodyShapeCircle;this.bodyDef.position.Set(this.x/this.scale,this.y/this.scale);this.body=this.bodyGroup[0]=this.world.CreateBody(this.bodyDef);this.bodyGroup[0].CreateFixture(this.fixtureDef);this.prevBody=this.bodyGroup[0];this.bodyDef.position.Set(this.length/this.scale,this.y/this.scale);this.bodyDef.userData=this.id;this.bodyGroup[1]=this.world.CreateBody(this.bodyDef);this.bodyGroup[1].CreateFixture(this.fixtureDef);this.fixtureDef=new b2FixtureDef();this.bodyShapePoly=new b2PolygonShape();this.bodyDef=new b2BodyDef();this.bodyDef.userData=this.id;this.bodyShapePoly.SetAsBox(this.segmentWidth/this.scale,this.segmentHeight/this.scale);this.bodyDef.type=b2Body.b2_dynamicBody;this.fixtureDef.shape=this.bodyShapePoly;this.fixtureDef.density=20;this.fixtureDef.restitution=0.2;this.fixtureDef.friction=0.2;this.jointDef=new b2RevoluteJointDef();this.jointDef.lowerAngle=-25/(180/Math.PI);this.jointDef.upperAngle=25/(180/Math.PI);this.jointDef.enableLimit=true;for(var k=0,f=this.segments;k<f;k++){this.bodyDef.position.Set(((this.x+this.segmentWidth)+(this.segmentWidth*2)*k)/this.scale,this.y/this.scale);this.bodyGroup[k+2]=this.world.CreateBody(this.bodyDef);this.bodyGroup[k+2].CreateFixture(this.fixtureDef);this.anchor.Set((this.x+(this.segmentWidth*2)*k)/this.scale,this.y/this.scale);this.jointDef.Initialize(this.prevBody,this.bodyGroup[k+2],this.anchor);this.world.CreateJoint(this.jointDef);this.prevBody=this.bodyGroup[k+2];this.bodyCount=k+2}this.anchor.Set((this.x+(this.segmentWidth*2)*this.segments-1)/this.scale,this.y/this.scale);this.jointDef.Initialize(this.prevBody,this.bodyGroup[1],this.anchor);this.world.CreateJoint(this.jointDef);return this},draw:function(){for(var d=2;d<=this.bodyCount;d++){var b=this.bodyGroup[d].GetPosition().x;var f=this.bodyGroup[d].GetPosition().y;var e=this.bodyGroup[d].GetAngle();Game.b_ctx.save();Game.b_ctx.globalAlpha=this.alpha;Game.b_ctx.translate(b*this.scale,f*this.scale);if(this.atlasimage){Game.b_ctx.rotate(e-this.imagerotation);Game.b_ctx.drawImage(this.image,this.xoffset,this.yoffset,this.cutwidth,this.cutheight,0-this.xhandle,0-this.yhandle,this.cutwidth,this.cutheight)}else{Game.b_ctx.rotate(e);Game.b_ctx.drawImage(this.image,0-this.xhandle,0-this.yhandle,this.image.width,this.image.height)}Game.b_ctx.restore()}}});CG.Layer.extend("B2DWorld",{init:function(b,d){d=d||{};this.name=b||"";this.debug=false;this.x=0;this.y=0;this.elements=[];this.world=new b2World(new b2Vec2(0,10),d.sleep||true);this.uid=0;this.scale=40;var e=new b2DebugDraw();e.SetSprite(Game.b_ctx);e.SetDrawScale(this.scale);e.SetFillAlpha(0.3);e.SetLineThickness(1);e.SetFlags(b2DebugDraw.e_shapeBit|b2DebugDraw.e_jointBit);this.world.SetDebugDraw(e)},update:function(){this.world.Step(1/60,10,10);if(mousedown){this.mouseDownAt(mousex,mousey)}else{if(this.isMouseDown()){this.mouseUp()}}this.elements.forEach(function(b){b.update()},this)},draw:function(){Game.b_ctx.save();Game.b_ctx.translate(this.x,this.y);if(this.debug){this.world.DrawDebugData();this.world.ClearForces()}this.elements.forEach(function(b){b.draw()},this);Game.b_ctx.restore()},addCustom:function(b){this.uid=this.uid+1;b.id.uid=this.uid;this.elements.push(b)},createBox:function(j,f,b,g,e){this.uid=this.uid+1;var d=new CG.B2DRectangle(this.world,j,f,b,g,this.scale,e);d.id.uid=this.uid;this.elements.push(d)},createLine:function(f,e,b){this.uid=this.uid+1;var d=new CG.B2DLine(this.world,f,new b2Vec2(e.x/this.scale,e.y/this.scale),new b2Vec2(b.x/this.scale,b.y/this.scale),this.scale);d.id.uid=this.uid;this.elements.push(d)},createCircle:function(k,g,d,b,j,f){this.uid=this.uid+1;var e=new CG.B2DCircle(this.world,k,g,d,b,j,this.scale,f);e.id.uid=this.uid;this.elements.push(e)},createPolyBody:function(m,j,g,b,k,f,d){this.uid=this.uid+1;var e=new CG.B2DPolygon(this.world,m,j,g,b,k,this.scale,f,d);e.id.uid=this.uid;this.elements.push(e)},createBridge:function(m,j,d,k,g,f,b){this.uid=this.uid+1;var e=new CG.B2DBridge(this.world,m,j,d,k,g,f,b,this.scale);e.id.uid=this.uid;this.elements.push(e)},createRope:function(m,j,d,k,g,f,b){this.uid=this.uid+1;var e=new CG.B2DRope(this.world,m,j,d,k,g,f,b,this.scale);e.id.uid=this.uid;this.elements.push(e)},mouseDownAt:function(d,f){if(!this.mouseJoint){var b=this.getBodyAt(d,f);if(b){var e=new b2MouseJointDef();e.bodyA=this.world.GetGroundBody();e.bodyB=b;e.target.Set((d-this.x)/this.scale,(f-this.y)/this.scale);e.collideConnected=true;e.maxForce=300*b.GetMass();this.mouseJoint=this.world.CreateJoint(e);b.SetAwake(true)}}else{this.mouseJoint.SetTarget(new b2Vec2((d-this.x)/this.scale,(f-this.y)/this.scale))}},mouseUp:function(){this.world.DestroyJoint(this.mouseJoint);this.mouseJoint=null},getBodyAt:function(b,k){var j=(b-this.x)/this.scale;var g=(k-this.y)/this.scale;var f=new b2Vec2(j,g);var e=new b2AABB();e.lowerBound.Set(j-0.001,g-0.001);e.upperBound.Set(j+0.001,g+0.001);var d=null;this.world.QueryAABB(function(m){if(m.GetBody().GetType()!=b2Body.b2_staticBody){if(m.GetShape().TestPoint(m.GetBody().GetTransform(),f)){d=m.GetBody();return false}}return true},e);return d},deleteBodyAt:function(b,f){body=this.getBodyAt(b,f);if(body){for(var e=0,d=this.elements.length;e<d;e++){if(this.elements[e].body.m_userData.uid==body.m_userData.uid){this.removeElementByIndex(e);this.world.DestroyBody(body);return true}}}return false},isMouseDown:function(){return(this.mouseJoint!=null)},removeElementByIndex:function(b){this.elements.splice(b,1)},applyImpulse:function(b,e,d){if(b){b.ApplyImpulse(new b2Vec2(Math.cos(e*(Math.PI/180))*d,Math.sin(e*(Math.PI/180))*d),b.GetWorldCenter())}},addContactListener:function(b){var d=new Box2D.Dynamics.b2ContactListener;if(b.BeginContact){d.BeginContact=function(e){b.BeginContact(e.GetFixtureA().GetBody().GetUserData(),e.GetFixtureB().GetBody().GetUserData())}}if(b.EndContact){d.EndContact=function(e){b.EndContact(e.GetFixtureA().GetBody().GetUserData(),e.GetFixtureB().GetBody().GetUserData())}}if(b.PostSolve){d.PostSolve=function(e,f){b.PostSolve(e.GetFixtureA().GetBody().GetUserData(),e.GetFixtureB().GetBody().GetUserData(),f.normalImpulses[0])}}this.world.SetContactListener(d)},getBodySpec:function(d){return{x:d.GetPosition().x,y:d.GetPosition().y,a:d.GetAngle(),c:{x:d.GetWorldCenter().x,y:d.GetWorldCenter().y}}}});